"use strict";(self.webpackChunkvendure_admin=self.webpackChunkvendure_admin||[]).push([[448],{5448:(Fs,Ce,i)=>{i.r(Ce),i.d(Ce,{AddCustomerToGroupDialogComponent:()=>ne,AddressCardComponent:()=>ie,AddressDetailDialogComponent:()=>re,CUSTOMER_DETAIL_QUERY:()=>wo,CUSTOMER_GROUP_DETAIL_QUERY:()=>Ro,CUSTOMER_LIST_QUERY:()=>Ls,CustomerDetailComponent:()=>_e,CustomerGroupDetailComponent:()=>ge,CustomerGroupDetailDialogComponent:()=>Ee,CustomerGroupListComponent:()=>he,CustomerGroupMemberListComponent:()=>j,CustomerHistoryComponent:()=>pe,CustomerHistoryEntryHostComponent:()=>de,CustomerListComponent:()=>fe,CustomerModule:()=>Be,CustomerStatusLabelComponent:()=>b,GET_CUSTOMER_GROUP_LIST:()=>hs,SelectCustomerGroupDialogComponent:()=>ce,createRoutes:()=>ke,customerBreadcrumb:()=>Ns,deleteCustomerGroupsBulkAction:()=>Me,deleteCustomersBulkAction:()=>qe,removeCustomerGroupMembersBulkAction:()=>Ye});var T,Z=i(4790),C=i(4154),u=i(3044),e=i(6108),a=i(848),w=i(4351),$=i(4073),l=i(5086),ee=i(7807),Y=i(9034),q=i(6940),te=i(24),Re=i(590),He=i(1441),ve=i(8163),v=i(4285),y=i(6445),oe=i(7615),k=i(106),B=i(2249),se=i(8269),p=i(8046),R=i(7017),h=i(1317);function je(o,s){1&o&&(e.ynx(0),e._UZ(1,"clr-icon",1),e._uU(2),e.ALo(3,"translate"),e.BQk()),2&o&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"customer.verified")," "))}function Ke(o,s){1&o&&(e.ynx(0),e._UZ(1,"clr-icon",2),e._uU(2),e.ALo(3,"translate"),e.BQk()),2&o&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"customer.registered")," "))}function Ve(o,s){if(1&o&&(e.TgZ(0,"vdr-chip"),e.YNc(1,je,4,3,"ng-container",0),e.YNc(2,Ke,4,3,"ng-container",0),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",null==t.customer.user?null:t.customer.user.verified),e.xp6(1),e.Q6J("ngIf",!(null!=t.customer.user&&t.customer.user.verified))}}function Xe(o,s){1&o&&(e.TgZ(0,"vdr-chip"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"customer.guest")))}class b{}(T=b).\u0275fac=function(s){return new(s||T)},T.\u0275cmp=e.Xpm({type:T,selectors:[["vdr-customer-status-label"]],inputs:{customer:"customer"},decls:2,vars:2,consts:[[4,"ngIf"],["shape","check-circle",1,"verified-user-icon"],["shape","check-circle",1,"registered-user-icon"]],template:function(s,t){1&s&&(e.YNc(0,Ve,3,2,"vdr-chip",0),e.YNc(1,Xe,3,3,"vdr-chip",0)),2&s&&(e.Q6J("ngIf",null==t.customer.user?null:t.customer.user.id),e.xp6(1),e.Q6J("ngIf",!(null!=t.customer.user&&t.customer.user.id)))},dependencies:[y.qvL,p.O5,R.Y,h.X$],styles:[".registered-user-icon[_ngcontent-%COMP%]{color:var(--color-grey-300)}.verified-user-icon[_ngcontent-%COMP%]{color:var(--color-success-500)}"],changeDetection:0});var D,H=i(2388);function We(o,s){if(1&o&&e._uU(0),2&o){const t=s.item;e.hij(" ",t.id," ")}}function ze(o,s){if(1&o&&(e._uU(0),e.ALo(1,"localeDate")),2&o){const t=s.item;e.hij(" ",e.xi3(1,1,t.createdAt,"short")," ")}}function et(o,s){if(1&o&&(e._uU(0),e.ALo(1,"localeDate")),2&o){const t=s.item;e.hij(" ",e.xi3(1,1,t.createdAt,"short")," ")}}const tt=function(o){return["/customer/customers",o]};function ot(o,s){if(1&o&&(e.TgZ(0,"a",9)(1,"span"),e._uU(2),e.qZA(),e._UZ(3,"clr-icon",10),e.qZA()),2&o){const t=s.item;e.Q6J("routerLink",e.VKq(4,tt,t.id)),e.xp6(2),e.lnq(" ",t.title," ",t.firstName," ",t.lastName," ")}}function st(o,s){if(1&o&&e._UZ(0,"vdr-customer-status-label",11),2&o){const t=s.item;e.Q6J("customer",t)}}function nt(o,s){if(1&o&&e._uU(0),2&o){const t=s.item;e.hij(" ",t.emailAddress," ")}}class j{constructor(s,t){this.router=s,this.dataService=t,this.selectedMemberIds=[],this.selectionChange=new e.vpe,this.fetchParamsChange=new e.vpe,this.filterTermControl=new l.NI(""),this.selectionManager=new a.ZE0({multiSelect:!0,itemsAreEqual:(n,r)=>n.id===r.id,additiveMode:!0}),this.refresh$=new Z.X(!0),this.destroy$=new ee.x}ngOnInit(){this.membersCurrentPage$=this.route.paramMap.pipe((0,u.U)(t=>t.get("membersPage")),(0,u.U)(t=>t?+t:1),(0,q.O)(1),(0,te.x)()),this.membersItemsPerPage$=this.route.paramMap.pipe((0,u.U)(t=>t.get("membersPerPage")),(0,u.U)(t=>t?+t:10),(0,q.O)(10),(0,te.x)());const s=this.filterTermControl.valueChanges.pipe((0,Re.b)(250),(0,He.b)(()=>this.setContentsPageNumber(1)),(0,q.O)(""));(0,Y.a)(this.membersCurrentPage$,this.membersItemsPerPage$,s,this.refresh$).pipe((0,ve.R)(this.destroy$)).subscribe(([t,n,r])=>{const c=n,m=(t-1)*n;this.fetchParamsChange.emit({filterTerm:r??"",skip:m,take:c})}),this.selectionManager.setCurrentItems(this.members?.filter(t=>this.selectedMemberIds.includes(t.id))??[]),this.selectionManager.selectionChanges$.pipe((0,ve.R)(this.destroy$)).subscribe(t=>{this.selectionChange.emit(t.map(n=>n.id))})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setContentsPageNumber(s){this.setParam("membersPage",s)}setContentsItemsPerPage(s){this.setParam("membersPerPage",s)}refresh(){this.refresh$.next(!0)}setParam(s,t){this.router.navigate(["./",{...this.route.snapshot.params,[s]:t}],{relativeTo:this.route,queryParamsHandling:"merge"})}}var L;(D=j).\u0275fac=function(s){return new(s||D)(e.Y36(v.F0),e.Y36(a.DoR))},D.\u0275cmp=e.Xpm({type:D,selectors:[["vdr-customer-group-member-list"]],inputs:{locationId:"locationId",members:"members",totalItems:"totalItems",route:"route",selectedMemberIds:"selectedMemberIds",activeGroup:"activeGroup"},outputs:{selectionChange:"selectionChange",fetchParamsChange:"fetchParamsChange"},decls:24,vars:39,consts:[[3,"id","items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[3,"locationId","hostComponent","selectionManager"],[3,"searchTermControl","searchTermPlaceholder"],["id","id",3,"heading","hiddenByDefault"],["id","created-at",3,"heading","hiddenByDefault"],["id","updated-at",3,"heading","hiddenByDefault"],["id","name",3,"heading","optional"],["id","status",3,"heading","hiddenByDefault"],["id","email-address",3,"heading"],[1,"button-ghost",3,"routerLink"],["shape","arrow right"],[3,"customer"]],template:function(s,t){1&s&&(e.TgZ(0,"vdr-data-table-2",0),e.NdJ("pageChange",function(r){return t.setContentsPageNumber(r)})("itemsPerPageChange",function(r){return t.setContentsItemsPerPage(r)}),e.ALo(1,"async"),e.ALo(2,"async"),e._UZ(3,"vdr-bulk-action-menu",1)(4,"vdr-dt2-search",2),e.ALo(5,"translate"),e.TgZ(6,"vdr-dt2-column",3),e.ALo(7,"translate"),e.YNc(8,We,1,1,"ng-template"),e.qZA(),e.TgZ(9,"vdr-dt2-column",4),e.ALo(10,"translate"),e.YNc(11,ze,2,4,"ng-template"),e.qZA(),e.TgZ(12,"vdr-dt2-column",5),e.ALo(13,"translate"),e.YNc(14,et,2,4,"ng-template"),e.qZA(),e.TgZ(15,"vdr-dt2-column",6),e.ALo(16,"translate"),e.YNc(17,ot,4,6,"ng-template"),e.qZA(),e.TgZ(18,"vdr-dt2-column",7),e.ALo(19,"translate"),e.YNc(20,st,1,1,"ng-template"),e.qZA(),e.TgZ(21,"vdr-dt2-column",8),e.ALo(22,"translate"),e.YNc(23,nt,1,1,"ng-template"),e.qZA()()),2&s&&(e.Q6J("id",t.locationId)("items",t.members)("itemsPerPage",e.lcZ(1,21,t.membersItemsPerPage$))("totalItems",t.totalItems)("currentPage",e.lcZ(2,23,t.membersCurrentPage$)),e.xp6(3),e.Q6J("locationId",t.locationId)("hostComponent",t)("selectionManager",t.selectionManager),e.xp6(1),e.Q6J("searchTermControl",t.filterTermControl)("searchTermPlaceholder",e.lcZ(5,25,"customer.search-customers-by-email")),e.xp6(2),e.Q6J("heading",e.lcZ(7,27,"common.id"))("hiddenByDefault",!0),e.xp6(3),e.Q6J("heading",e.lcZ(10,29,"common.created-at"))("hiddenByDefault",!0),e.xp6(3),e.Q6J("heading",e.lcZ(13,31,"common.updated-at"))("hiddenByDefault",!0),e.xp6(3),e.Q6J("heading",e.lcZ(16,33,"customer.name"))("optional",!1),e.xp6(3),e.Q6J("heading",e.lcZ(19,35,"common.status"))("hiddenByDefault",!0),e.xp6(3),e.Q6J("heading",e.lcZ(22,37,"customer.email-address")))},dependencies:[y.qvL,v.rH,oe.c,k.e,B.U,se.J,b,p.Ov,h.X$,H.H],changeDetection:0});const rt=function(o){return{groupName:o}};function it(o,s){if(1&o&&(e._uU(0),e.ALo(1,"translate")),2&o){const t=e.oxw();e.hij(" ",e.xi3(1,1,"customer.add-customers-to-group-with-name",e.VKq(4,rt,t.group.name)),"\n")}}const at=function(o){return{count:o}};function ct(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",3),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"button",4),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.add())}),e._uU(4),e.ALo(5,"translate"),e.qZA()}if(2&o){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,3,"common.cancel")),e.xp6(2),e.Q6J("disabled",!t.selectedCustomerIds.length),e.xp6(1),e.hij(" ",e.xi3(5,5,"customer.add-customers-to-group-with-count",e.VKq(8,at,t.selectedCustomerIds.length))," ")}}class ne{constructor(s){this.dataService=s,this.selectedCustomerIds=[],this.fetchGroupMembers$=new Z.X({skip:0,take:10,filterTerm:""})}ngOnInit(){const s=this.fetchGroupMembers$.pipe((0,C.w)(({skip:t,take:n,filterTerm:r})=>this.dataService.customer.getCustomerList(n,t,r).mapStream(c=>c.customers)));this.customers$=s.pipe((0,u.U)(t=>t.items)),this.customersTotal$=s.pipe((0,u.U)(t=>t.totalItems))}cancel(){this.resolveWith()}add(){this.resolveWith(this.selectedCustomerIds)}}(L=ne).\u0275fac=function(s){return new(s||L)(e.Y36(a.DoR))},L.\u0275cmp=e.Xpm({type:L,selectors:[["vdr-add-customer-to-group-dialog"]],decls:5,vars:8,consts:[["vdrDialogTitle",""],["locationId","customer-group-members-picker-list",3,"members","totalItems","route","selectedMemberIds","fetchParamsChange","selectionChange"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(s,t){1&s&&(e.YNc(0,it,2,6,"ng-template",0),e.TgZ(1,"vdr-customer-group-member-list",1),e.NdJ("fetchParamsChange",function(r){return t.fetchGroupMembers$.next(r)})("selectionChange",function(r){return t.selectedCustomerIds=r}),e.ALo(2,"async"),e.ALo(3,"async"),e.qZA(),e.YNc(4,ct,6,10,"ng-template",2)),2&s&&(e.xp6(1),e.Q6J("members",e.lcZ(2,4,t.customers$))("totalItems",e.lcZ(3,6,t.customersTotal$))("route",t.route)("selectedMemberIds",t.selectedCustomerIds))},dependencies:[w.n,$.q,j,p.Ov,h.X$],changeDetection:0});var N,ye=i(2727),Ae=i(1452),lt=i(6283);function mt(o,s){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=s.ngIf;e.xp6(1),e.hij("",t,",")}}function dt(o,s){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=s.ngIf;e.xp6(1),e.hij(" ",t,"")}}function ut(o,s){if(1&o&&(e.YNc(0,mt,2,1,"span",3),e.YNc(1,dt,2,1,"span",3)),2&o){const t=e.oxw();let n,r;e.Q6J("ngIf",null==(n=t.addressForm.get("streetLine1"))?null:n.value),e.xp6(1),e.Q6J("ngIf",null==(r=t.addressForm.get("countryCode"))?null:r.value)}}function pt(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",4),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"button",5),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.save())}),e._uU(4),e.ALo(5,"translate"),e.qZA()}if(2&o){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,3,"common.cancel")),e.xp6(2),e.Q6J("disabled",!t.addressForm.valid||!t.addressForm.touched),e.xp6(1),e.hij(" ",e.lcZ(5,5,"common.update")," ")}}class re{constructor(s){this.changeDetector=s,this.availableCountries=[]}ngOnInit(){this.addressForm.valueChanges.subscribe(()=>this.changeDetector.markForCheck())}cancel(){this.resolveWith()}save(){this.resolveWith(this.addressForm)}}(N=re).\u0275fac=function(s){return new(s||N)(e.Y36(e.sBO))},N.\u0275cmp=e.Xpm({type:N,selectors:[["vdr-address-detail-dialog"]],decls:3,vars:3,consts:[["vdrDialogTitle",""],[3,"formGroup","availableCountries","customFields"],["vdrDialogButtons",""],[4,"ngIf"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(s,t){1&s&&(e.YNc(0,ut,2,2,"ng-template",0),e._UZ(1,"vdr-address-form",1),e.YNc(2,pt,6,7,"ng-template",2)),2&s&&(e.xp6(1),e.Q6J("formGroup",t.addressForm)("availableCountries",t.availableCountries)("customFields",t.customFields))},dependencies:[p.O5,l.JL,l.sg,w.n,$.q,lt.C,h.X$],styles:["clr-input-container[_ngcontent-%COMP%]{margin-bottom:12px}"],changeDetection:0});var F,xe=i(1343),Ze=i(2279),Te=i(1921),be=i(4043),_t=i(1635),gt=i(4687);function ht(o,s){if(1&o&&(e.TgZ(0,"span",14),e._uU(1),e.qZA()),2&o){const t=e.oxw().ngIf;e.xp6(1),e.hij("",t.streetLine1,",")}}function ft(o,s){1&o&&(e.TgZ(0,"vdr-chip",15),e._UZ(1,"clr-icon",16),e._uU(2),e.ALo(3,"translate"),e.qZA()),2&o&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"customer.default-shipping-address")," "))}function Ct(o,s){1&o&&(e.TgZ(0,"vdr-chip",15),e._UZ(1,"clr-icon",17),e._uU(2),e.ALo(3,"translate"),e.qZA()),2&o&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"customer.default-billing-address")," "))}function vt(o,s){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",18),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.editAddress())}),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"vdr-dropdown")(5,"button",19),e._uU(6),e.ALo(7,"translate"),e._UZ(8,"clr-icon",20),e.qZA(),e.TgZ(9,"vdr-dropdown-menu")(10,"button",21),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.setAsDefaultShippingAddress())}),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"button",21),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.setAsDefaultBillingAddress())}),e._uU(14),e.ALo(15,"translate"),e.qZA(),e._UZ(16,"div",22),e.TgZ(17,"button",23),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.delete())}),e._UZ(18,"clr-icon",24),e._uU(19),e.ALo(20,"translate"),e.qZA()()(),e.BQk()}if(2&o){const t=e.oxw(2);e.xp6(2),e.hij(" ",e.lcZ(3,7,"common.edit")," "),e.xp6(4),e.hij(" ",e.lcZ(7,9,"common.more")," "),e.xp6(4),e.Q6J("disabled",t.isDefaultShipping),e.xp6(1),e.hij(" ",e.lcZ(12,11,"customer.set-as-default-shipping-address")," "),e.xp6(2),e.Q6J("disabled",t.isDefaultBilling),e.xp6(1),e.hij(" ",e.lcZ(15,13,"customer.set-as-default-billing-address")," "),e.xp6(5),e.hij(" ",e.lcZ(20,15,"common.delete")," ")}}function yt(o,s){if(1&o&&(e.TgZ(0,"div",1)(1,"div",2)(2,"div",3),e.YNc(3,ht,2,1,"span",4),e._uU(4),e.qZA(),e.TgZ(5,"div",5),e.YNc(6,ft,4,3,"vdr-chip",6),e.YNc(7,Ct,4,3,"vdr-chip",6),e.qZA()(),e.TgZ(8,"div",7)(9,"div",8),e._UZ(10,"vdr-formatted-address",9),e.qZA()(),e.TgZ(11,"div",10)(12,"div",11),e._UZ(13,"vdr-entity-info",12),e.YNc(14,vt,21,17,"ng-container",13),e.qZA()()()),2&o){const t=s.ngIf,n=e.oxw();e.xp6(3),e.Q6J("ngIf",t.streetLine1),e.xp6(1),e.hij(" ",t.countryCode," "),e.xp6(2),e.Q6J("ngIf",n.isDefaultShipping),e.xp6(1),e.Q6J("ngIf",n.isDefaultBilling),e.xp6(3),e.Q6J("address",t),e.xp6(3),e.Q6J("entity",t),e.xp6(1),e.Q6J("ngIf",n.editable)}}class ie{constructor(s,t){this.modalService=s,this.changeDetector=t,this.availableCountries=[],this.editable=!0,this.setAsDefaultShipping=new e.vpe,this.setAsDefaultBilling=new e.vpe,this.deleteAddress=new e.vpe,this.dataDependenciesPopulated=new Z.X(!1)}ngOnInit(){this.addressForm.get("streetLine1").value||this.dataDependenciesPopulated.pipe((0,ye.h)(t=>t),(0,Ae.q)(1)).subscribe(()=>{this.editAddress()})}ngOnChanges(s){null!=this.customFields&&null!=this.availableCountries&&this.dataDependenciesPopulated.next(!0)}getCountryName(s){if(!this.availableCountries)return"";const t=this.availableCountries.find(n=>n.code===s);return t?t.name:""}setAsDefaultBillingAddress(){this.setAsDefaultBilling.emit(this.addressForm.value.id),this.addressForm.markAsDirty()}setAsDefaultShippingAddress(){this.setAsDefaultShipping.emit(this.addressForm.value.id),this.addressForm.markAsDirty()}delete(){this.deleteAddress.emit(this.addressForm.value.id),this.addressForm.markAsDirty()}editAddress(){this.modalService.fromComponent(re,{locals:{addressForm:this.addressForm,customFields:this.customFields,availableCountries:this.availableCountries},size:"md",closable:!0}).subscribe(()=>{this.changeDetector.markForCheck()})}}(F=ie).\u0275fac=function(s){return new(s||F)(e.Y36(a.Z7U),e.Y36(e.sBO))},F.\u0275cmp=e.Xpm({type:F,selectors:[["vdr-address-card"]],inputs:{addressForm:"addressForm",customFields:"customFields",availableCountries:"availableCountries",isDefaultBilling:"isDefaultBilling",isDefaultShipping:"isDefaultShipping",editable:"editable"},outputs:{setAsDefaultShipping:"setAsDefaultShipping",setAsDefaultBilling:"setAsDefaultBilling",deleteAddress:"deleteAddress"},features:[e.TTD],decls:1,vars:1,consts:[["class","card",4,"ngIf"],[1,"card"],[1,"card-header"],[1,"address-title"],["class","street-line",4,"ngIf"],[1,"default-controls"],["class","is-default p8",4,"ngIf"],[1,"card-block"],[1,"card-text"],[3,"address"],[1,"card-footer"],[1,"address-actions"],[3,"entity"],[4,"ngIf"],[1,"street-line"],[1,"is-default","p8"],["shape","truck"],["shape","credit-card"],[1,"button-small",3,"click"],["type","button","vdrDropdownTrigger","",1,"button-small"],["shape","ellipsis-vertical","size","12"],["vdrDropdownItem","",3,"disabled","click"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",3,"click"],["shape","trash",1,"is-danger"]],template:function(s,t){1&s&&e.YNc(0,yt,15,7,"div",0),2&s&&e.Q6J("ngIf",t.addressForm.value)},dependencies:[y.qvL,p.O5,R.Y,xe.J,Ze.N,Te.U,be.H,_t.b,gt.V,h.X$],styles:["[_nghost-%COMP%]{display:block;max-width:360px}clr-input-container[_ngcontent-%COMP%]{margin-bottom:12px}.defaul-controls[_ngcontent-%COMP%]{display:flex}.is-default[_ngcontent-%COMP%]{margin:0;color:var(--color-success-500)}.address-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-unit)}.address-actions[_ngcontent-%COMP%]   vdr-entity-info[_ngcontent-%COMP%]{margin-top:1px}"],changeDetection:0});var d=i(186),At=i(4415),K=i(2840),xt=i(3839),De=i(9343),U=i(2701),Zt=i(5808),Tt=i(3729);const{isArray:bt}=Array;var Lt=i(6269),Le=i(6585);function Nt(...o){const s=(0,Le.yG)(o),t=(0,Le._6)(o,1/0);return o=function Dt(o){return 1===o.length&&bt(o[0])?o[0]:o}(o),(0,Tt.e)((n,r)=>{(0,Lt.J)(t)((0,De.D)([n,...o],s)).subscribe(r)})}var I,Ft=i(6526),Ut=i(1392),ae=i(4992);function It(o,s){1&o&&(e._uU(0),e.ALo(1,"translate")),2&o&&e.hij(" ",e.lcZ(1,1,"customer.add-customer-to-group"),"\n")}function Jt(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"span",5),e.NdJ("click",function(){const r=e.CHM(t),c=r.item,m=r.clear;return e.KtG(m(c))}),e._uU(1," \xd7 "),e.qZA(),e.TgZ(2,"vdr-chip",6),e._uU(3),e.qZA()}if(2&o){const t=s.item;e.xp6(2),e.Q6J("colorFrom",t.id),e.xp6(1),e.Oqu(t.name)}}function Gt(o,s){if(1&o&&(e.TgZ(0,"vdr-chip",6),e._uU(1),e.qZA()),2&o){const t=s.item;e.Q6J("colorFrom",t.id),e.xp6(1),e.Oqu(t.name)}}const St=function(o){return{count:o}};function Qt(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",7),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"button",8),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.add())}),e._uU(4),e.ALo(5,"translate"),e.qZA()}if(2&o){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,3,"common.cancel")),e.xp6(2),e.Q6J("disabled",!t.selectedGroupIds.length),e.xp6(1),e.hij(" ",e.xi3(5,5,"customer.add-customer-to-groups-with-count",e.VKq(8,St,t.selectedGroupIds.length))," ")}}class ce{constructor(s){this.dataService=s,this.selectedGroupIds=[]}ngOnInit(){this.groups$=this.dataService.customer.getCustomerGroupList().mapStream(s=>s.customerGroups.items)}cancel(){this.resolveWith()}add(){this.resolveWith(this.selectedGroupIds)}}(I=ce).\u0275fac=function(s){return new(s||I)(e.Y36(a.DoR))},I.\u0275cmp=e.Xpm({type:I,selectors:[["vdr-select-customer-group-dialog"]],decls:6,vars:8,consts:[["vdrDialogTitle",""],["appendTo","body","bindValue","id",3,"items","addTag","multiple","ngModel","clearable","searchable","ngModelChange"],["ng-label-tmp",""],["ng-option-tmp",""],["vdrDialogButtons",""],["aria-hidden","true",1,"ng-value-icon","left",3,"click"],[3,"colorFrom"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(s,t){1&s&&(e.YNc(0,It,2,3,"ng-template",0),e.TgZ(1,"ng-select",1),e.NdJ("ngModelChange",function(r){return t.selectedGroupIds=r}),e.ALo(2,"async"),e.YNc(3,Jt,4,2,"ng-template",2),e.YNc(4,Gt,2,2,"ng-template",3),e.qZA(),e.YNc(5,Qt,6,10,"ng-template",4)),2&s&&(e.xp6(1),e.Q6J("items",e.lcZ(2,6,t.groups$))("addTag",!1)("multiple",!0)("ngModel",t.selectedGroupIds)("clearable",!0)("searchable",!1))},dependencies:[l.JJ,l.On,ae.w9,ae.ir,ae.mR,R.Y,w.n,$.q,p.Ov,h.X$],changeDetection:0});var G,f=i(8621),le=i(8369),V=i(8251),Pt=i(5375),Ne=i(8679),J=i(5796),X=i(7491),me=i(7836),Fe=i(7432),Ue=i(419),W=i(3850),Ie=i(5276),Je=i(5655),Ge=i(9274),Se=i(8923),Ot=i(1662),Qe=i(4959),Et=i(4481);const Mt=["portal"];class de{constructor(s){this.historyEntryComponentService=s,this.expandClick=new e.vpe}ngOnInit(){const s=this.historyEntryComponentService.getComponent(this.entry.type),t=this.portalRef.createComponent(s);t.instance.entry=this.entry,t.instance.customer=this.customer,this.instance=t.instance,this.componentRef=t}ngOnDestroy(){this.componentRef?.destroy()}}(G=de).\u0275fac=function(s){return new(s||G)(e.Y36(a.GwB))},G.\u0275cmp=e.Xpm({type:G,selectors:[["vdr-customer-history-entry-host"]],viewQuery:function(s,t){if(1&s&&e.Gf(Mt,7,e.s_b),2&s){let n;e.iGM(n=e.CRH())&&(t.portalRef=n.first)}},inputs:{entry:"entry",customer:"customer",expanded:"expanded"},outputs:{expandClick:"expandClick"},exportAs:["historyEntry"],decls:3,vars:6,consts:[[3,"displayType","iconShape","createdAt","name","featured","collapsed","expandClick"],["portal",""]],template:function(s,t){1&s&&(e.TgZ(0,"vdr-timeline-entry",0),e.NdJ("expandClick",function(){return t.expandClick.emit()}),e._UZ(1,"div",null,1),e.qZA()),2&s&&e.Q6J("displayType",t.instance.getDisplayType(t.entry))("iconShape",t.instance.getIconShape&&t.instance.getIconShape(t.entry))("createdAt",t.entry.createdAt)("name",t.instance.getName&&t.instance.getName(t.entry))("featured",t.instance.isFeatured(t.entry))("collapsed",!t.expanded&&!t.instance.isFeatured(t.entry))},dependencies:[Qe._],encapsulation:2});var S,ue=i(9360);function wt(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"vdr-timeline-entry",4)(1,"div",5)(2,"textarea",6),e.NdJ("ngModelChange",function(r){e.CHM(t);const c=e.oxw();return e.KtG(c.note=r)}),e.qZA(),e.TgZ(3,"button",7),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.addNoteToCustomer())}),e._uU(4),e.ALo(5,"translate"),e.qZA()()()}if(2&o){const t=e.oxw();e.xp6(2),e.Q6J("ngModel",t.note),e.xp6(1),e.Q6J("disabled",!t.note),e.xp6(1),e.hij(" ",e.lcZ(5,3,"order.add-note")," ")}}function $t(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"vdr-customer-history-entry-host",10),e.NdJ("expandClick",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.expanded=!r.expanded)}),e.qZA()}if(2&o){const t=e.oxw().$implicit,n=e.oxw();e.Q6J("customer",n.customer)("entry",t)("expanded",n.expanded)}}function Yt(o,s){1&o&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"customer.history-using-native-auth-strategy")," "))}const Pe=function(o){return{strategy:o}};function qt(o,s){if(1&o&&(e._uU(0),e.ALo(1,"translate")),2&o){const t=e.oxw(3).$implicit;e.hij(" ",e.xi3(1,1,"customer.history-using-external-auth-strategy",e.VKq(4,Pe,t.data.strategy))," ")}}function kt(o,s){if(1&o&&(e.ynx(0),e.TgZ(1,"div",15),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,Yt,3,3,"ng-container",16),e.YNc(5,qt,2,6,"ng-template",null,17,e.W1O),e.BQk()),2&o){const t=e.MAs(6),n=e.oxw(2).$implicit;e.xp6(2),e.hij(" ",e.lcZ(3,3,"customer.history-customer-registered")," "),e.xp6(2),e.Q6J("ngIf","native"===n.data.strategy)("ngIfElse",t)}}function Bt(o,s){1&o&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"customer.history-using-native-auth-strategy")," "))}function Rt(o,s){if(1&o&&(e._uU(0),e.ALo(1,"translate")),2&o){const t=e.oxw(3).$implicit;e.hij(" ",e.xi3(1,1,"customer.history-using-external-auth-strategy",e.VKq(4,Pe,t.data.strategy))," ")}}function Ht(o,s){if(1&o&&(e.ynx(0),e.TgZ(1,"div",15),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,Bt,3,3,"ng-container",16),e.YNc(5,Rt,2,6,"ng-template",null,17,e.W1O),e.BQk()),2&o){const t=e.MAs(6),n=e.oxw(2).$implicit;e.xp6(2),e.hij(" ",e.lcZ(3,3,"customer.history-customer-verified")," "),e.xp6(2),e.Q6J("ngIf","native"===n.data.strategy)("ngIfElse",t)}}function jt(o,s){if(1&o&&(e.ynx(0),e.TgZ(1,"div",18),e._uU(2),e.ALo(3,"translate"),e.TgZ(4,"vdr-history-entry-detail"),e._UZ(5,"vdr-object-tree",19),e.qZA()(),e.BQk()),2&o){const t=e.oxw(2).$implicit;e.xp6(2),e.hij(" ",e.lcZ(3,2,"customer.history-customer-detail-updated")," "),e.xp6(3),e.Q6J("value",t.data.input)}}const Oe=function(o){return{groupName:o}};function Kt(o,s){if(1&o&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&o){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,"customer.history-customer-added-to-group",e.VKq(4,Oe,t.data.groupName))," ")}}function Vt(o,s){if(1&o&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&o){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,"customer.history-customer-removed-from-group",e.VKq(4,Oe,t.data.groupName))," ")}}function Xt(o,s){if(1&o&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.TgZ(3,"div",18)(4,"div",20),e._uU(5),e.qZA()(),e.BQk()),2&o){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,2,"customer.history-customer-address-created")," "),e.xp6(4),e.Oqu(t.data.address)}}function Wt(o,s){if(1&o&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.TgZ(3,"div",18)(4,"div",20),e._uU(5),e.qZA(),e.TgZ(6,"vdr-history-entry-detail"),e._UZ(7,"vdr-object-tree",19),e.qZA()(),e.BQk()),2&o){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,3,"customer.history-customer-address-updated")," "),e.xp6(4),e.Oqu(t.data.address),e.xp6(2),e.Q6J("value",t.data.input)}}function zt(o,s){if(1&o&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.TgZ(3,"div",20),e._uU(4),e.qZA(),e.BQk()),2&o){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,2,"customer.history-customer-address-deleted")," "),e.xp6(3),e.Oqu(t.data.address)}}function eo(o,s){1&o&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"customer.history-customer-password-updated")," "))}function to(o,s){1&o&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"customer.history-customer-password-reset-requested")," "))}function oo(o,s){1&o&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"customer.history-customer-password-reset-verified")," "))}function so(o,s){if(1&o&&(e.ynx(0),e.TgZ(1,"div",18),e._uU(2),e.ALo(3,"translate"),e.TgZ(4,"vdr-history-entry-detail")(5,"vdr-labeled-data",21),e.ALo(6,"translate"),e._uU(7),e.qZA(),e.TgZ(8,"vdr-labeled-data",21),e.ALo(9,"translate"),e._uU(10),e.qZA()()(),e.BQk()),2&o){const t=e.oxw(2).$implicit;e.xp6(2),e.hij(" ",e.lcZ(3,5,"customer.history-customer-email-update-requested")," "),e.xp6(3),e.Q6J("label",e.lcZ(6,7,"customer.old-email-address")),e.xp6(2),e.Oqu(t.data.oldEmailAddress),e.xp6(1),e.Q6J("label",e.lcZ(9,9,"customer.new-email-address")),e.xp6(2),e.Oqu(t.data.newEmailAddress)}}function no(o,s){if(1&o&&(e.ynx(0),e.TgZ(1,"div",18),e._uU(2),e.ALo(3,"translate"),e.TgZ(4,"vdr-history-entry-detail")(5,"vdr-labeled-data",21),e.ALo(6,"translate"),e._uU(7),e.qZA(),e.TgZ(8,"vdr-labeled-data",21),e.ALo(9,"translate"),e._uU(10),e.qZA()()(),e.BQk()),2&o){const t=e.oxw(2).$implicit;e.xp6(2),e.hij(" ",e.lcZ(3,5,"customer.history-customer-email-update-verified")," "),e.xp6(3),e.Q6J("label",e.lcZ(6,7,"customer.old-email-address")),e.xp6(2),e.Oqu(t.data.oldEmailAddress),e.xp6(1),e.Q6J("label",e.lcZ(9,9,"customer.new-email-address")),e.xp6(2),e.Oqu(t.data.newEmailAddress)}}function ro(o,s){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",18)(2,"div",22),e._uU(3),e.qZA(),e._UZ(4,"div",23),e.TgZ(5,"vdr-dropdown")(6,"button",24),e._UZ(7,"clr-icon",25),e.qZA(),e.TgZ(8,"vdr-dropdown-menu",26)(9,"button",27),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2).$implicit,c=e.oxw();return e.KtG(c.updateNote.emit(r))}),e.ALo(10,"hasPermission"),e._UZ(11,"clr-icon",28),e._uU(12),e.ALo(13,"translate"),e.qZA(),e._UZ(14,"div",29),e.TgZ(15,"button",27),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2).$implicit,c=e.oxw();return e.KtG(c.deleteNote.emit(r))}),e.ALo(16,"hasPermission"),e._UZ(17,"clr-icon",30),e._uU(18),e.ALo(19,"translate"),e.qZA()()()(),e.BQk()}if(2&o){const t=e.oxw(2).$implicit;e.xp6(3),e.hij(" ",t.data.note," "),e.xp6(6),e.Q6J("disabled",!e.lcZ(10,5,"UpdateCustomer")),e.xp6(3),e.hij(" ",e.lcZ(13,7,"common.edit")," "),e.xp6(3),e.Q6J("disabled",!e.lcZ(16,9,"UpdateCustomer")),e.xp6(3),e.hij(" ",e.lcZ(19,11,"common.delete")," ")}}function io(o,s){if(1&o&&(e.TgZ(0,"vdr-history-entry-detail"),e._UZ(1,"vdr-object-tree",19),e.qZA()),2&o){const t=e.oxw(3).$implicit;e.xp6(1),e.Q6J("value",t.data)}}function ao(o,s){if(1&o&&(e.ynx(0),e.TgZ(1,"div",15),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,io,2,1,"vdr-history-entry-detail",31),e.BQk()),2&o){const t=e.oxw(2).$implicit;e.xp6(2),e.hij(" ",e.lcZ(3,2,t.type)," "),e.xp6(2),e.Q6J("ngIf",t.data)}}function co(o,s){if(1&o&&(e.TgZ(0,"vdr-timeline-entry",11),e.ynx(1,12),e.YNc(2,kt,7,5,"ng-container",13),e.YNc(3,Ht,7,5,"ng-container",13),e.YNc(4,jt,6,4,"ng-container",13),e.YNc(5,Kt,3,6,"ng-container",13),e.YNc(6,Vt,3,6,"ng-container",13),e.YNc(7,Xt,6,4,"ng-container",13),e.YNc(8,Wt,8,5,"ng-container",13),e.YNc(9,zt,5,4,"ng-container",13),e.YNc(10,eo,3,3,"ng-container",13),e.YNc(11,to,3,3,"ng-container",13),e.YNc(12,oo,3,3,"ng-container",13),e.YNc(13,so,11,11,"ng-container",13),e.YNc(14,no,11,11,"ng-container",13),e.YNc(15,ro,20,13,"ng-container",13),e.YNc(16,ao,5,4,"ng-container",14),e.BQk(),e.qZA()),2&o){const t=e.oxw().$implicit,n=e.oxw();e.Q6J("displayType",n.getDisplayType(t))("iconShape",n.getTimelineIcon(t))("createdAt",t.createdAt)("name",n.getName(t))("featured",n.isFeatured(t)),e.xp6(1),e.Q6J("ngSwitch",t.type),e.xp6(1),e.Q6J("ngSwitchCase",n.type.CUSTOMER_REGISTERED),e.xp6(1),e.Q6J("ngSwitchCase",n.type.CUSTOMER_VERIFIED),e.xp6(1),e.Q6J("ngSwitchCase",n.type.CUSTOMER_DETAIL_UPDATED),e.xp6(1),e.Q6J("ngSwitchCase",n.type.CUSTOMER_ADDED_TO_GROUP),e.xp6(1),e.Q6J("ngSwitchCase",n.type.CUSTOMER_REMOVED_FROM_GROUP),e.xp6(1),e.Q6J("ngSwitchCase",n.type.CUSTOMER_ADDRESS_CREATED),e.xp6(1),e.Q6J("ngSwitchCase",n.type.CUSTOMER_ADDRESS_UPDATED),e.xp6(1),e.Q6J("ngSwitchCase",n.type.CUSTOMER_ADDRESS_DELETED),e.xp6(1),e.Q6J("ngSwitchCase",n.type.CUSTOMER_PASSWORD_UPDATED),e.xp6(1),e.Q6J("ngSwitchCase",n.type.CUSTOMER_PASSWORD_RESET_REQUESTED),e.xp6(1),e.Q6J("ngSwitchCase",n.type.CUSTOMER_PASSWORD_RESET_VERIFIED),e.xp6(1),e.Q6J("ngSwitchCase",n.type.CUSTOMER_EMAIL_UPDATE_REQUESTED),e.xp6(1),e.Q6J("ngSwitchCase",n.type.CUSTOMER_EMAIL_UPDATE_VERIFIED),e.xp6(1),e.Q6J("ngSwitchCase",n.type.CUSTOMER_NOTE)}}function lo(o,s){if(1&o&&(e.ynx(0),e.YNc(1,$t,1,3,"vdr-customer-history-entry-host",8),e.YNc(2,co,17,20,"ng-template",null,9,e.W1O),e.BQk()),2&o){const t=s.$implicit,n=e.MAs(3),r=e.oxw();e.xp6(1),e.Q6J("ngIf",r.hasCustomComponent(t.type))("ngIfElse",n)}}class pe{constructor(s){this.historyEntryComponentService=s,this.addNote=new e.vpe,this.updateNote=new e.vpe,this.deleteNote=new e.vpe,this.note="",this.expanded=!1,this.type=a.iYD}hasCustomComponent(s){return!!this.historyEntryComponentService.getComponent(s)}getDisplayType(s){switch(s.type){case a.iYD.CUSTOMER_VERIFIED:case a.iYD.CUSTOMER_EMAIL_UPDATE_VERIFIED:case a.iYD.CUSTOMER_PASSWORD_RESET_VERIFIED:return"success";case a.iYD.CUSTOMER_REGISTERED:return"muted";case a.iYD.CUSTOMER_REMOVED_FROM_GROUP:return"error";default:return"default"}}getTimelineIcon(s){switch(s.type){case a.iYD.CUSTOMER_REGISTERED:return"user";case a.iYD.CUSTOMER_VERIFIED:return["assign-user","is-solid"];case a.iYD.CUSTOMER_NOTE:return"note";case a.iYD.CUSTOMER_ADDED_TO_GROUP:case a.iYD.CUSTOMER_REMOVED_FROM_GROUP:return"users"}}isFeatured(s){switch(s.type){case a.iYD.CUSTOMER_REGISTERED:case a.iYD.CUSTOMER_VERIFIED:return!0;default:return!1}}getName(s){const{administrator:t}=s;return t?`${t.firstName} ${t.lastName}`:`${this.customer.firstName} ${this.customer.lastName}`}addNoteToCustomer(){this.addNote.emit({note:this.note}),this.note=""}}(S=pe).\u0275fac=function(s){return new(s||S)(e.Y36(a.GwB))},S.\u0275cmp=e.Xpm({type:S,selectors:[["vdr-customer-history"]],inputs:{customer:"customer",history:"history"},outputs:{addNote:"addNote",updateNote:"updateNote",deleteNote:"deleteNote"},decls:4,vars:3,consts:[[1,"entry-list"],["iconShape","note","displayType","muted",4,"vdrIfPermissions"],[4,"ngFor","ngForOf"],[3,"isLast"],["iconShape","note","displayType","muted"],[1,"note-entry"],["name","note",1,"note",3,"ngModel","ngModelChange"],[1,"btn","btn-secondary",3,"disabled","click"],[3,"customer","entry","expanded","expandClick",4,"ngIf","ngIfElse"],["defaultComponents",""],[3,"customer","entry","expanded","expandClick"],[3,"displayType","iconShape","createdAt","name","featured"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"title"],[4,"ngIf","ngIfElse"],["namedStrategy",""],[1,"flex"],[3,"value"],[1,"address-string"],[3,"label"],[1,"note-text"],[1,"flex-spacer"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["vdrDropdownItem","",3,"disabled","click"],["shape","edit"],[1,"dropdown-divider"],["shape","trash",1,"is-danger"],[4,"ngIf"]],template:function(s,t){1&s&&(e.TgZ(0,"div",0),e.YNc(1,wt,6,5,"vdr-timeline-entry",1),e.YNc(2,lo,4,2,"ng-container",2),e._UZ(3,"vdr-timeline-entry",3),e.qZA()),2&s&&(e.xp6(1),e.Q6J("vdrIfPermissions","UpdateCustomer"),e.xp6(1),e.Q6J("ngForOf",t.history),e.xp6(1),e.Q6J("isLast",!0))},dependencies:[y.qvL,p.sg,p.O5,p.RF,p.n9,p.ED,l.Fj,l.JJ,l.On,V.y,xe.J,Ze.N,Te.U,be.H,Ne.W,Ot._,J.H,Qe._,Et.C,de,h.X$,ue.j],styles:[".entry-list[_ngcontent-%COMP%]{margin:24px 12px 24px 24px}.note-entry[_ngcontent-%COMP%]{display:flex;align-items:center}.note-entry[_ngcontent-%COMP%]   .note[_ngcontent-%COMP%]{flex:1}.note-entry[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0}textarea.note[_ngcontent-%COMP%]{flex:1;height:36px;border-radius:3px;margin-inline-end:6px}.note-text[_ngcontent-%COMP%]{color:var(--color-text-100);white-space:pre-wrap}.address-string[_ngcontent-%COMP%]{font-size:smaller;color:var(--color-text-200)}"],changeDetection:0});var Q,mo=i(2814),uo=i(4531);function po(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.create())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("disabled",!(t.addressDefaultsUpdated||t.detailForm.valid&&t.detailForm.dirty)),e.xp6(1),e.hij(" ",e.lcZ(2,2,"common.create")," ")}}function _o(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.save())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&o){const t=e.oxw(2);e.Q6J("disabled",!(t.addressDefaultsUpdated||t.detailForm.valid&&t.detailForm.dirty)),e.xp6(1),e.hij(" ",e.lcZ(2,2,"common.update")," ")}}function go(o,s){1&o&&e.YNc(0,_o,3,4,"button",22),2&o&&e.Q6J("vdrIfPermissions","UpdateCustomer")}function ho(o,s){if(1&o&&(e.TgZ(0,"vdr-labeled-data",25),e.ALo(1,"translate"),e.TgZ(2,"time",26),e._uU(3),e.ALo(4,"timeAgo"),e.qZA()()),2&o){const t=s.ngIf;e.Q6J("label",e.lcZ(1,3,"customer.last-login")),e.xp6(2),e.Q6J("dateTime",t),e.xp6(1),e.Oqu(e.lcZ(4,5,t))}}function fo(o,s){if(1&o&&(e.TgZ(0,"vdr-card"),e._UZ(1,"vdr-customer-status-label",23),e.YNc(2,ho,5,7,"vdr-labeled-data",24),e.qZA()),2&o){const t=s.ngIf;e.xp6(1),e.Q6J("customer",t),e.xp6(1),e.Q6J("ngIf",null==t.user?null:t.user.lastLogin)}}function Co(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"vdr-chip",32),e.NdJ("iconClick",function(){const c=e.CHM(t).$implicit,m=e.oxw(3);return e.KtG(m.removeFromGroup(c))}),e._uU(1),e.qZA()}if(2&o){const t=s.$implicit;e.Q6J("colorFrom",t.id),e.xp6(1),e.Oqu(t.name)}}function vo(o,s){if(1&o&&(e.TgZ(0,"div"),e.YNc(1,Co,2,2,"vdr-chip",31),e.qZA()),2&o){const t=e.oxw().ngIf;e.xp6(1),e.Q6J("ngForOf",t)}}function yo(o,s){1&o&&(e.TgZ(0,"span",33),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"customer.not-a-member-of-any-groups")," "))}function Ao(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",34),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.addToGroup())}),e._UZ(1,"clr-icon",35),e._uU(2),e.ALo(3,"translate"),e.qZA()}2&o&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"customer.add-customer-to-group")," "))}function xo(o,s){if(1&o&&(e.TgZ(0,"vdr-card",27),e.ALo(1,"translate"),e.YNc(2,vo,2,1,"div",28),e.YNc(3,yo,3,3,"ng-template",null,29,e.W1O),e.TgZ(5,"div"),e.YNc(6,Ao,4,3,"button",30),e.qZA()()),2&o){const t=s.ngIf,n=e.MAs(4);e.Q6J("title",e.lcZ(1,4,"customer.customer-groups")),e.xp6(2),e.Q6J("ngIf",t.length)("ngIfElse",n),e.xp6(4),e.Q6J("vdrIfPermissions","UpdateCustomerGroup")}}function Zo(o,s){if(1&o&&e._UZ(0,"vdr-page-entity-info",36),2&o){const t=s.ngIf;e.Q6J("entity",t)}}function To(o,s){1&o&&(e.TgZ(0,"vdr-form-field",37),e.ALo(1,"translate"),e._UZ(2,"input",38),e.qZA()),2&o&&e.Q6J("label",e.lcZ(1,1,"customer.password"))}function bo(o,s){if(1&o&&(e.TgZ(0,"vdr-card",39),e.ALo(1,"translate"),e._UZ(2,"vdr-tabbed-custom-fields",40),e.qZA()),2&o){const t=e.oxw();e.Q6J("title",e.lcZ(1,3,"common.custom-fields")),e.xp6(2),e.Q6J("customFields",t.customFields)("customFieldsFormGroup",t.detailForm.get("customer.customFields"))}}const Do=function(){return["UpdateCustomer"]};function Lo(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"vdr-address-card",55),e.NdJ("setAsDefaultBilling",function(r){e.CHM(t);const c=e.oxw(2);return e.KtG(c.setDefaultBillingAddressId(r))})("setAsDefaultShipping",function(r){e.CHM(t);const c=e.oxw(2);return e.KtG(c.setDefaultShippingAddressId(r))})("deleteAddress",function(r){e.CHM(t);const c=e.oxw(2);return e.KtG(c.toggleDeleteAddress(r))}),e.ALo(1,"async"),e.ALo(2,"hasPermission"),e.qZA()}if(2&o){const t=s.$implicit,n=e.oxw(2);e.ekj("to-delete",n.addressesToDeleteIds.has(t.value.id)),e.Q6J("availableCountries",e.lcZ(1,8,n.availableCountries$))("isDefaultBilling",n.defaultBillingAddressId===t.value.id)("isDefaultShipping",n.defaultShippingAddressId===t.value.id)("addressForm",t)("customFields",n.addressCustomFields)("editable",e.lcZ(2,10,e.DdM(12,Do))&&!n.addressesToDeleteIds.has(t.value.id))}}function No(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",56),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.addAddress())}),e._UZ(1,"clr-icon",35),e._uU(2),e.ALo(3,"translate"),e.qZA()}2&o&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"customer.create-new-address")," "))}function Fo(o,s){if(1&o&&e._uU(0),2&o){const t=s.item;e.hij(" ",t.id," ")}}function Uo(o,s){if(1&o&&(e._uU(0),e.ALo(1,"localeDate")),2&o){const t=s.item;e.hij(" ",e.xi3(1,1,t.createdAt,"short")," ")}}const Io=function(o){return["/orders",o]};function Jo(o,s){if(1&o&&(e.TgZ(0,"a",57)(1,"span"),e._uU(2),e.qZA(),e._UZ(3,"clr-icon",58),e.qZA()),2&o){const t=s.item;e.Q6J("routerLink",e.VKq(2,Io,t.id)),e.xp6(2),e.Oqu(t.code)}}function Go(o,s){if(1&o&&(e.TgZ(0,"vdr-chip"),e._uU(1),e.qZA()),2&o){const t=s.item;e.xp6(1),e.Oqu(t.type)}}function So(o,s){if(1&o&&e._UZ(0,"vdr-order-state-label",59),2&o){const t=s.item;e.Q6J("state",t.state)}}function Qo(o,s){if(1&o&&(e._uU(0),e.ALo(1,"localeCurrency")),2&o){const t=s.item;e.hij(" ",e.xi3(1,1,t.totalWithTax,t.currencyCode)," ")}}function Po(o,s){if(1&o&&(e._uU(0),e.ALo(1,"timeAgo")),2&o){const t=s.item;e.hij(" ",e.lcZ(1,1,t.updatedAt)," ")}}function Oo(o,s){if(1&o&&(e._uU(0),e.ALo(1,"localeDate")),2&o){const t=s.item;e.hij(" ",e.xi3(1,1,t.orderPlacedAt,"short")," ")}}function Eo(o,s){if(1&o&&e._UZ(0,"vdr-dt2-custom-field-column",60),2&o){const t=s.$implicit;e.Q6J("customField",t)}}function Mo(o,s){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"vdr-card",27),e.ALo(2,"translate"),e.YNc(3,Lo,3,13,"vdr-address-card",41),e.YNc(4,No,4,3,"button",42),e.qZA(),e.TgZ(5,"vdr-card",43),e.ALo(6,"translate"),e.TgZ(7,"vdr-data-table-2",44),e.NdJ("itemsPerPageChange",function(r){e.CHM(t);const c=e.oxw();return e.KtG(c.setOrderItemsPerPage(r))})("pageChange",function(r){e.CHM(t);const c=e.oxw();return e.KtG(c.setOrderCurrentPage(r))}),e.ALo(8,"async"),e.ALo(9,"async"),e.ALo(10,"translate"),e.TgZ(11,"vdr-dt2-column",45),e.ALo(12,"translate"),e.YNc(13,Fo,1,1,"ng-template"),e.qZA(),e.TgZ(14,"vdr-dt2-column",46),e.ALo(15,"translate"),e.YNc(16,Uo,2,4,"ng-template"),e.qZA(),e.TgZ(17,"vdr-dt2-column",47),e.ALo(18,"translate"),e.YNc(19,Jo,4,4,"ng-template"),e.qZA(),e.TgZ(20,"vdr-dt2-column",48),e.ALo(21,"translate"),e.YNc(22,Go,2,1,"ng-template"),e.qZA(),e.TgZ(23,"vdr-dt2-column",49),e.ALo(24,"translate"),e.YNc(25,So,1,1,"ng-template"),e.qZA(),e.TgZ(26,"vdr-dt2-column",50),e.ALo(27,"translate"),e.YNc(28,Qo,2,4,"ng-template"),e.qZA(),e.TgZ(29,"vdr-dt2-column",51),e.ALo(30,"translate"),e.YNc(31,Po,2,3,"ng-template"),e.qZA(),e.TgZ(32,"vdr-dt2-column",52),e.ALo(33,"translate"),e.YNc(34,Oo,2,4,"ng-template"),e.qZA(),e.YNc(35,Eo,1,1,"vdr-dt2-custom-field-column",53),e.qZA()(),e.TgZ(36,"vdr-card",27),e.ALo(37,"translate"),e.TgZ(38,"vdr-customer-history",54),e.NdJ("addNote",function(r){e.CHM(t);const c=e.oxw();return e.KtG(c.addNoteToCustomer(r))})("updateNote",function(r){e.CHM(t);const c=e.oxw();return e.KtG(c.updateNote(r))})("deleteNote",function(r){e.CHM(t);const c=e.oxw();return e.KtG(c.deleteNote(r))}),e.ALo(39,"async"),e.ALo(40,"async"),e.qZA()(),e.BQk()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("title",e.lcZ(2,26,"customer.addresses")),e.xp6(2),e.Q6J("ngForOf",t.getAddressFormControls()),e.xp6(1),e.Q6J("vdrIfPermissions","UpdateCustomer"),e.xp6(1),e.Q6J("title",e.lcZ(6,28,"customer.orders"))("paddingX",!1),e.xp6(2),e.Q6J("items",e.lcZ(8,30,t.orders$))("itemsPerPage",t.ordersPerPage)("totalItems",e.lcZ(9,32,t.ordersCount$))("currentPage",t.currentOrdersPage)("emptyStateLabel",e.lcZ(10,34,"customer.no-orders-placed")),e.xp6(4),e.Q6J("heading",e.lcZ(12,36,"common.id"))("hiddenByDefault",!0),e.xp6(3),e.Q6J("heading",e.lcZ(15,38,"common.created-at"))("hiddenByDefault",!0),e.xp6(3),e.Q6J("heading",e.lcZ(18,40,"common.code"))("optional",!1),e.xp6(3),e.Q6J("heading",e.lcZ(21,42,"order.order-type"))("hiddenByDefault",!0),e.xp6(3),e.Q6J("heading",e.lcZ(24,44,"order.state")),e.xp6(3),e.Q6J("heading",e.lcZ(27,46,"order.total")),e.xp6(3),e.Q6J("heading",e.lcZ(30,48,"common.updated-at")),e.xp6(3),e.Q6J("heading",e.lcZ(33,50,"order.placed-at")),e.xp6(3),e.Q6J("ngForOf",t.customFields),e.xp6(1),e.Q6J("title",e.lcZ(37,52,"customer.customer-history")),e.xp6(2),e.Q6J("customer",e.lcZ(39,54,t.entity$))("history",e.lcZ(40,56,t.history$))}}const wo=K.Ps`
    query CustomerDetailQuery($id: ID!, $orderListOptions: OrderListOptions) {
        customer(id: $id) {
            ...Customer
            groups {
                id
                name
            }
            orders(options: $orderListOptions) {
                items {
                    id
                    code
                    type
                    state
                    total
                    totalWithTax
                    currencyCode
                    createdAt
                    updatedAt
                    orderPlacedAt
                }
                totalItems
            }
        }
    }
    ${a.U5R}
`;class _e extends a.VE7{constructor(s,t,n,r,c){super(),this.changeDetector=s,this.formBuilder=t,this.dataService=n,this.modalService=r,this.notificationService=c,this.customFields=this.getCustomFieldConfig("Customer"),this.addressCustomFields=this.getCustomFieldConfig("Address"),this.detailForm=this.formBuilder.group({customer:this.formBuilder.group({title:"",firstName:["",l.kI.required],lastName:["",l.kI.required],phoneNumber:"",emailAddress:["",[l.kI.required,l.kI.email]],password:"",customFields:this.formBuilder.group((0,a.Lrj)(this.customFields))}),addresses:new l.vC([])}),this.fetchHistory=new ee.x,this.addressesToDeleteIds=new Set,this.addressDefaultsUpdated=!1,this.ordersPerPage=10,this.currentOrdersPage=1,this.orderListUpdates$=new ee.x}ngOnInit(){this.init(),this.availableCountries$=this.dataService.settings.getAvailableCountries().mapSingle(t=>t.countries.items).pipe((0,Zt.d)(1));const s=this.entity$.pipe(Nt(this.orderListUpdates$));this.orders$=s.pipe((0,u.U)(t=>t.orders.items)),this.ordersCount$=this.entity$.pipe((0,u.U)(t=>t.orders.totalItems)),this.history$=this.fetchHistory.pipe((0,q.O)(null),(0,C.w)(()=>this.dataService.customer.getCustomerHistory(this.id,{sort:{createdAt:a.Asd.DESC}}).mapStream(t=>t.customer?.history.items)))}ngOnDestroy(){this.destroy(),this.orderListUpdates$.complete()}getAddressFormControls(){return this.detailForm.get(["addresses"]).controls}setDefaultBillingAddressId(s){this.defaultBillingAddressId=s,this.addressDefaultsUpdated=!0}setDefaultShippingAddressId(s){this.defaultShippingAddressId=s,this.addressDefaultsUpdated=!0}toggleDeleteAddress(s){this.addressesToDeleteIds.has(s)?this.addressesToDeleteIds.delete(s):this.addressesToDeleteIds.add(s)}addAddress(){const s=this.detailForm.get("addresses"),t=this.formBuilder.group({fullName:"",company:"",streetLine1:["",l.kI.required],streetLine2:"",city:"",province:"",postalCode:"",countryCode:["",l.kI.required],phoneNumber:"",defaultShippingAddress:!1,defaultBillingAddress:!1,customFields:this.formBuilder.group(this.addressCustomFields.reduce((n,r)=>({...n,[r.name]:""}),{}))});s.push(t)}setOrderItemsPerPage(s){this.ordersPerPage=+s,this.fetchOrdersList()}setOrderCurrentPage(s){this.currentOrdersPage=+s,this.fetchOrdersList()}create(){const s=this.detailForm.get("customer");if(!s)return;const{title:t,emailAddress:n,firstName:r,lastName:c,phoneNumber:m,password:_}=s.value,g=s.get("customFields")?.value;if(!n||!r||!c)return;const x={title:t,emailAddress:n,firstName:r,lastName:c,phoneNumber:m,customFields:g};this.dataService.customer.createCustomer(x,_).subscribe(({createCustomer:z})=>{switch(z.__typename){case"Customer":this.notificationService.success((0,d.J)("common.notify-create-success"),{entity:"Customer"}),z.emailAddress&&!_&&this.notificationService.notify({message:(0,d.J)("customer.email-verification-sent"),translationVars:{emailAddress:n},type:"info",duration:1e4}),this.detailForm.markAsPristine(),this.addressDefaultsUpdated=!1,this.changeDetector.markForCheck(),this.router.navigate(["../",z.id],{relativeTo:this.route});break;case"EmailAddressConflictError":this.notificationService.error(z.message)}})}save(){this.entity$.pipe((0,Ae.q)(1),(0,Ft.z)(({id:s})=>{const t=[],n=this.detailForm.get("customer");if(n&&n.dirty){const c=n.value,m=n.get("customFields")?.value,_={id:s,title:c.title,emailAddress:c.emailAddress,firstName:c.firstName,lastName:c.lastName,phoneNumber:c.phoneNumber,customFields:m};t.push(this.dataService.customer.updateCustomer(_).pipe((0,u.U)(g=>g.updateCustomer)))}const r=this.detailForm.get("addresses");if(r&&r.dirty||this.addressDefaultsUpdated)for(const c of r.controls)if(c.dirty||this.addressDefaultsUpdated){const m=c.value,_={fullName:m.fullName,company:m.company,streetLine1:m.streetLine1,streetLine2:m.streetLine2,city:m.city,province:m.province,postalCode:m.postalCode,countryCode:m.countryCode,phoneNumber:m.phoneNumber,defaultShippingAddress:this.defaultShippingAddressId===m.id,defaultBillingAddress:this.defaultBillingAddressId===m.id,customFields:m.customFields};m.id?this.addressesToDeleteIds.has(m.id)?t.push(this.dataService.customer.deleteCustomerAddress(m.id).pipe((0,u.U)(g=>g.deleteCustomerAddress))):t.push(this.dataService.customer.updateCustomerAddress({..._,id:m.id}).pipe((0,u.U)(g=>g.updateCustomerAddress))):t.push(this.dataService.customer.createCustomerAddress(s,_).pipe((0,u.U)(g=>g.createCustomerAddress)))}return(0,xt.D)(t)})).subscribe(s=>{let t=!1;for(const n of s)switch(n.__typename){case"Customer":case"Address":case"Success":t||(this.notificationService.success((0,d.J)("common.notify-update-success"),{entity:"Customer"}),t=!0,this.detailForm.markAsPristine(),this.addressDefaultsUpdated=!1,this.changeDetector.markForCheck(),this.fetchHistory.next(),this.refreshCustomer().subscribe());break;case"EmailAddressConflictError":this.notificationService.error(n.message)}},s=>{this.notificationService.error((0,d.J)("common.notify-update-error"),{entity:"Customer"})})}addToGroup(){this.modalService.fromComponent(ce,{size:"md"}).pipe((0,C.w)(s=>s?(0,De.D)(s):U.E),(0,Ut.b)(s=>this.dataService.customer.addCustomersToGroup(s,[this.id]))).subscribe({next:s=>{this.notificationService.success((0,d.J)("customer.add-customers-to-group-success"),{customerCount:1,groupName:s.addCustomersToGroup.name})},complete:()=>{this.refreshCustomer().subscribe(),this.fetchHistory.next()}})}removeFromGroup(s){this.modalService.dialog({title:(0,d.J)("customer.confirm-remove-customer-from-group"),buttons:[{type:"secondary",label:(0,d.J)("common.cancel")},{type:"danger",label:(0,d.J)("common.delete"),returnValue:!0}]}).pipe((0,C.w)(t=>t?this.dataService.customer.removeCustomersFromGroup(s.id,[this.id]):U.E),(0,C.w)(()=>this.refreshCustomer())).subscribe(t=>{this.notificationService.success((0,d.J)("customer.remove-customers-from-group-success"),{customerCount:1,groupName:s.name}),this.fetchHistory.next()})}addNoteToCustomer({note:s}){this.dataService.customer.addNoteToCustomer(this.id,s).subscribe(()=>{this.fetchHistory.next(),this.notificationService.success((0,d.J)("common.notify-create-success"),{entity:"Note"})})}updateNote(s){this.modalService.fromComponent(a.UlA,{closable:!0,locals:{displayPrivacyControls:!1,note:s.data.note}}).pipe((0,C.w)(t=>t?this.dataService.customer.updateCustomerNote({noteId:s.id,note:t.note}):U.E)).subscribe(t=>{this.fetchHistory.next(),this.notificationService.success((0,d.J)("common.notify-update-success"),{entity:"Note"})})}deleteNote(s){return this.modalService.dialog({title:(0,d.J)("common.confirm-delete-note"),body:s.data.note,buttons:[{type:"secondary",label:(0,d.J)("common.cancel")},{type:"danger",label:(0,d.J)("common.delete"),returnValue:!0}]}).pipe((0,C.w)(t=>t?this.dataService.customer.deleteCustomerNote(s.id):U.E)).subscribe(()=>{this.fetchHistory.next(),this.notificationService.success((0,d.J)("common.notify-delete-success"),{entity:"Note"})})}setFormValues(s){const t=this.detailForm.get("customer");if(t&&t.patchValue({title:s.title??null,firstName:s.firstName,lastName:s.lastName,phoneNumber:s.phoneNumber??null,emailAddress:s.emailAddress,password:"",customFields:{}}),s.addresses){const n=new l.vC([]);for(const r of s.addresses){const{customFields:c,...m}=r,_=this.formBuilder.group({...m,countryCode:r.country.code,customFields:this.formBuilder.group(this.addressCustomFields.reduce((g,x)=>({...g,[x.name]:r.customFields[x.name]}),{}))});n.push(_),r.defaultShippingAddress&&(this.defaultShippingAddressId=r.id),r.defaultBillingAddress&&(this.defaultBillingAddressId=r.id)}this.detailForm.setControl("addresses",n)}this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get(["customer","customFields"]),s),this.changeDetector.markForCheck()}fetchOrdersList(){this.dataService.query(a.jQ8,{id:this.id,orderListOptions:{take:this.ordersPerPage,skip:(this.currentOrdersPage-1)*this.ordersPerPage,sort:{orderPlacedAt:a.Asd.DESC}}}).single$.pipe((0,u.U)(s=>s.customer),(0,ye.h)(At.notNullOrUndefined)).subscribe(s=>this.orderListUpdates$.next(s))}refreshCustomer(){return this.dataService.query(a.jQ8,{id:this.id,orderListOptions:{take:0}}).single$}}var P;function $o(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.create())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("disabled",!(t.detailForm.valid&&t.detailForm.dirty)),e.xp6(1),e.hij(" ",e.lcZ(2,2,"common.create")," ")}}function Yo(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.save())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&o){const t=e.oxw(2);e.Q6J("disabled",!(t.detailForm.valid&&t.detailForm.dirty)),e.xp6(1),e.hij(" ",e.lcZ(2,2,"common.update")," ")}}function qo(o,s){1&o&&e.YNc(0,Yo,3,4,"button",11),2&o&&e.Q6J("vdrIfPermissions","UpdateCustomer")}function ko(o,s){if(1&o&&(e.TgZ(0,"vdr-card"),e._UZ(1,"vdr-page-entity-info",12),e.qZA()),2&o){const t=s.ngIf;e.xp6(1),e.Q6J("entity",t)}}function Bo(o,s){if(1&o&&(e.TgZ(0,"vdr-card",13),e.ALo(1,"translate"),e._UZ(2,"vdr-tabbed-custom-fields",14),e.qZA()),2&o){const t=e.oxw();e.Q6J("title",e.lcZ(1,3,"common.custom-fields")),e.xp6(2),e.Q6J("customFields",t.customFields)("customFieldsFormGroup",t.detailForm.get("customFields"))}}(Q=_e).\u0275fac=function(s){return new(s||Q)(e.Y36(e.sBO),e.Y36(l.qu),e.Y36(a.DoR),e.Y36(a.Z7U),e.Y36(a.gqp))},Q.\u0275cmp=e.Xpm({type:Q,selectors:[["vdr-customer-detail"]],features:[e.qOj],decls:49,vars:53,consts:[["locationId","customer-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],[4,"ngIf"],[3,"title",4,"ngIf"],[3,"entity",4,"ngIf"],[1,"form",3,"formGroup"],[1,"form-grid"],["for","title",3,"label","readOnlyToggle"],["id","title","type","text","formControlName","title"],["for","firstName",3,"label","readOnlyToggle"],["id","firstName","type","text","formControlName","firstName"],["for","lastName",3,"label","readOnlyToggle"],["id","lastName","type","text","formControlName","lastName"],["for","emailAddress",3,"label","readOnlyToggle"],["id","emailAddress","type","text","formControlName","emailAddress"],["for","phoneNumber",3,"label","readOnlyToggle"],["id","phoneNumber","type","text","formControlName","phoneNumber"],["for","password",3,"label",4,"ngIf"],["formGroupName","customFields",3,"title",4,"ngIf"],["locationId","customer-detail",3,"entity$","detailForm"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[3,"customer"],["class","last-login",3,"label",4,"ngIf"],[1,"last-login",3,"label"],[3,"dateTime"],[3,"title"],[4,"ngIf","ngIfElse"],["noGroups",""],["class","button-small mt-1",3,"click",4,"vdrIfPermissions"],["icon","times",3,"colorFrom","iconClick",4,"ngFor","ngForOf"],["icon","times",3,"colorFrom","iconClick"],[1,"color-weight-400"],[1,"button-small","mt-1",3,"click"],["shape","plus"],[3,"entity"],["for","password",3,"label"],["id","password","type","password","formControlName","password"],["formGroupName","customFields",3,"title"],["entityName","Customer",3,"customFields","customFieldsFormGroup"],[3,"to-delete","availableCountries","isDefaultBilling","isDefaultShipping","addressForm","customFields","editable","setAsDefaultBilling","setAsDefaultShipping","deleteAddress",4,"ngFor","ngForOf"],["class","btn btn-secondary mt-2",3,"click",4,"vdrIfPermissions"],[3,"title","paddingX"],["id","customer-order-list",3,"items","itemsPerPage","totalItems","currentPage","emptyStateLabel","itemsPerPageChange","pageChange"],["id","id",3,"heading","hiddenByDefault"],["id","created-at",3,"heading","hiddenByDefault"],["id","code",3,"heading","optional"],["id","order-type",3,"heading","hiddenByDefault"],["id","state",3,"heading"],["id","total",3,"heading"],["id","updated-at",3,"heading"],["id","placed-at",3,"heading"],[3,"customField",4,"ngFor","ngForOf"],[3,"customer","history","addNote","updateNote","deleteNote"],[3,"availableCountries","isDefaultBilling","isDefaultShipping","addressForm","customFields","editable","setAsDefaultBilling","setAsDefaultShipping","deleteAddress"],[1,"btn","btn-secondary","mt-2",3,"click"],[1,"button-ghost",3,"routerLink"],["shape","arrow right"],[3,"state"],[3,"customField"]],template:function(s,t){if(1&s&&(e.TgZ(0,"vdr-page-block")(1,"vdr-action-bar"),e._UZ(2,"vdr-ab-left"),e.TgZ(3,"vdr-ab-right"),e._UZ(4,"vdr-action-bar-items",0),e.YNc(5,po,3,4,"button",1),e.ALo(6,"async"),e.YNc(7,go,1,1,"ng-template",null,2,e.W1O),e.qZA()()(),e.TgZ(9,"vdr-page-detail-layout")(10,"vdr-page-detail-sidebar"),e.YNc(11,fo,3,2,"vdr-card",3),e.ALo(12,"async"),e.YNc(13,xo,7,6,"vdr-card",4),e.ALo(14,"async"),e.TgZ(15,"vdr-card"),e.YNc(16,Zo,1,1,"vdr-page-entity-info",5),e.ALo(17,"async"),e.qZA()(),e.TgZ(18,"vdr-page-block")(19,"form",6)(20,"vdr-card")(21,"div",7)(22,"vdr-form-field",8),e.ALo(23,"translate"),e.ALo(24,"async"),e._UZ(25,"input",9),e.qZA(),e._UZ(26,"div"),e.TgZ(27,"vdr-form-field",10),e.ALo(28,"translate"),e.ALo(29,"async"),e._UZ(30,"input",11),e.qZA(),e.TgZ(31,"vdr-form-field",12),e.ALo(32,"translate"),e.ALo(33,"async"),e._UZ(34,"input",13),e.qZA(),e.TgZ(35,"vdr-form-field",14),e.ALo(36,"translate"),e.ALo(37,"async"),e._UZ(38,"input",15),e.qZA(),e.TgZ(39,"vdr-form-field",16),e.ALo(40,"translate"),e.ALo(41,"async"),e._UZ(42,"input",17),e.qZA(),e.YNc(43,To,3,3,"vdr-form-field",18),e.ALo(44,"async"),e.qZA()(),e.YNc(45,bo,3,5,"vdr-card",19),e.qZA(),e._UZ(46,"vdr-custom-detail-component-host",20),e.YNc(47,Mo,41,58,"ng-container",3),e.ALo(48,"async"),e.qZA()()),2&s){const n=e.MAs(8);let r;e.xp6(5),e.Q6J("ngIf",e.lcZ(6,21,t.isNew$))("ngIfElse",n),e.xp6(6),e.Q6J("ngIf",e.lcZ(12,23,t.entity$)),e.xp6(2),e.Q6J("ngIf",null==(r=e.lcZ(14,25,t.entity$))?null:r.groups),e.xp6(3),e.Q6J("ngIf",e.lcZ(17,27,t.entity$)),e.xp6(3),e.Q6J("formGroup",t.detailForm.get("customer")),e.xp6(3),e.Q6J("label",e.lcZ(23,29,"customer.title"))("readOnlyToggle",!e.lcZ(24,31,t.isNew$)),e.xp6(5),e.Q6J("label",e.lcZ(28,33,"customer.first-name"))("readOnlyToggle",!e.lcZ(29,35,t.isNew$)),e.xp6(4),e.Q6J("label",e.lcZ(32,37,"customer.last-name"))("readOnlyToggle",!e.lcZ(33,39,t.isNew$)),e.xp6(4),e.Q6J("label",e.lcZ(36,41,"customer.email-address"))("readOnlyToggle",!e.lcZ(37,43,t.isNew$)),e.xp6(4),e.Q6J("label",e.lcZ(40,45,"customer.phone-number"))("readOnlyToggle",!e.lcZ(41,47,t.isNew$)),e.xp6(4),e.Q6J("ngIf",e.lcZ(44,49,t.isNew$)),e.xp6(2),e.Q6J("ngIf",t.customFields.length),e.xp6(1),e.Q6J("entity$",t.entity$)("detailForm",t.detailForm),e.xp6(1),e.Q6J("ngIf",!e.lcZ(48,51,t.isNew$))}},dependencies:[y.qvL,p.sg,p.O5,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,l.x0,v.rH,f.Kk,f.BN,f.mz,R.Y,le.h,V.y,Pt.G,Ne.W,J.H,X.W,me.y,Fe.C,k.e,B.U,Ue.j,W.z,Ie.D,Je.T,Ge.W,Se.A,b,ie,pe,p.Ov,h.X$,ue.j,mo.e,H.H,uo.k],styles:[".last-login[_ngcontent-%COMP%]{margin-inline-start:6px;color:var(--color-grey-500)}.to-delete[_ngcontent-%COMP%]{opacity:.5}"],changeDetection:0});const Ro=K.Ps`
    query GetCustomerGroupDetail($id: ID!) {
        customerGroup(id: $id) {
            ...CustomerGroupDetail
        }
    }
    fragment CustomerGroupDetail on CustomerGroup {
        id
        createdAt
        updatedAt
        name
    }
`;class ge extends a.VE7{constructor(s,t,n,r){super(),this.formBuilder=s,this.dataService=t,this.modalService=n,this.notificationService=r,this.customFields=this.getCustomFieldConfig("CustomerGroup"),this.detailForm=this.formBuilder.group({name:"",customFields:this.formBuilder.group((0,a.Lrj)(this.customFields))})}ngOnInit(){super.init()}create(){const s=this.detailForm.value;s.name&&this.dataService.customer.createCustomerGroup({name:s.name,customFields:s.customFields,customerIds:[]}).subscribe(({createCustomerGroup:t})=>{this.notificationService.success((0,d.J)("common.notify-create-success"),{entity:"CustomerGroup"}),this.detailForm.markAsPristine(),this.router.navigate(["../",t.id],{relativeTo:this.route})},t=>{this.notificationService.error((0,d.J)("common.notify-create-error"),{entity:"CustomerGroup"})})}save(){const s=this.detailForm.value;this.dataService.customer.updateCustomerGroup({id:this.id,...s}).subscribe(()=>{this.notificationService.success((0,d.J)("common.notify-update-success"),{entity:"CustomerGroup"}),this.detailForm.markAsPristine()},t=>{this.notificationService.error((0,d.J)("common.notify-update-error"),{entity:"CustomerGroup"})})}setFormValues(s){if(this.detailForm.patchValue({name:s.name}),this.customFields.length){this.detailForm.get(["customFields"]);this.setCustomFieldFormValues(this.customFields,this.detailForm.get("customFields"),s)}}}var O;function Ho(o,s){1&o&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"customer.update-customer-group")))}function jo(o,s){1&o&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"customer.create-customer-group")))}function Ko(o,s){if(1&o&&(e.YNc(0,Ho,3,3,"span",6),e.YNc(1,jo,3,3,"span",6)),2&o){const t=e.oxw();e.Q6J("ngIf",t.group.id),e.xp6(1),e.Q6J("ngIf",!t.group.id)}}function Vo(o,s){if(1&o&&(e.TgZ(0,"section",7)(1,"label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"vdr-tabbed-custom-fields",8),e.qZA()),2&o){const t=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,3,"common.custom-fields")),e.xp6(2),e.Q6J("customFields",t.customFields)("customFieldsFormGroup",t.form.get("customFields"))}}function Xo(o,s){1&o&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"customer.update-customer-group")))}function Wo(o,s){1&o&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"customer.create-customer-group")))}function zo(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"button",10),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.save())}),e.YNc(4,Xo,3,3,"span",6),e.YNc(5,Wo,3,3,"span",6),e.qZA()}if(2&o){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,4,"common.cancel")),e.xp6(2),e.Q6J("disabled",!t.form.valid),e.xp6(1),e.Q6J("ngIf",t.group.id),e.xp6(1),e.Q6J("ngIf",!t.group.id)}}(P=ge).\u0275fac=function(s){return new(s||P)(e.Y36(l.qu),e.Y36(a.DoR),e.Y36(a.Z7U),e.Y36(a.gqp))},P.\u0275cmp=e.Xpm({type:P,selectors:[["vdr-customer-group-detail"]],features:[e.qOj],decls:22,vars:14,consts:[["locationId","customer-group-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],[1,"form",3,"formGroup"],[4,"ngIf"],[1,"form-grid"],["for","name",3,"label"],["id","name","type","text","formControlName","name"],["formGroupName","customFields",3,"title",4,"ngIf"],["locationId","customer-group-detail",3,"entity$","detailForm"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[3,"entity"],["formGroupName","customFields",3,"title"],["entityName","CustomerGroup",3,"customFields","customFieldsFormGroup"]],template:function(s,t){if(1&s&&(e.TgZ(0,"vdr-page-block")(1,"vdr-action-bar"),e._UZ(2,"vdr-ab-left"),e.TgZ(3,"vdr-ab-right"),e._UZ(4,"vdr-action-bar-items",0),e.YNc(5,$o,3,4,"button",1),e.ALo(6,"async"),e.YNc(7,qo,1,1,"ng-template",null,2,e.W1O),e.qZA()()(),e.TgZ(9,"form",3)(10,"vdr-page-detail-layout")(11,"vdr-page-detail-sidebar"),e.YNc(12,ko,2,1,"vdr-card",4),e.ALo(13,"async"),e.qZA(),e.TgZ(14,"vdr-page-block")(15,"vdr-card")(16,"div",5)(17,"vdr-form-field",6),e.ALo(18,"translate"),e._UZ(19,"input",7),e.qZA()()(),e.YNc(20,Bo,3,5,"vdr-card",8),e._UZ(21,"vdr-custom-detail-component-host",9),e.qZA()()()),2&s){const n=e.MAs(8);e.xp6(5),e.Q6J("ngIf",e.lcZ(6,8,t.isNew$))("ngIfElse",n),e.xp6(4),e.Q6J("formGroup",t.detailForm),e.xp6(3),e.Q6J("ngIf",e.lcZ(13,10,t.entity$)),e.xp6(5),e.Q6J("label",e.lcZ(18,12,"common.name")),e.xp6(3),e.Q6J("ngIf",t.customFields.length),e.xp6(1),e.Q6J("entity$",t.entity$)("detailForm",t.detailForm)}},dependencies:[p.O5,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,l.x0,f.Kk,f.BN,f.mz,le.h,V.y,J.H,X.W,me.y,Fe.C,W.z,Ie.D,Je.T,Ge.W,Se.A,p.Ov,h.X$],changeDetection:0});const es=function(){return["CreateCustomerGroup","UpdateCustomerGroup"]};class Ee{constructor(s,t){this.serverConfigService=s,this.formBuilder=t,this.customFields=this.serverConfigService.getCustomFieldsFor("CustomerGroup")}ngOnInit(){if(this.form=this.formBuilder.group({name:[this.group.name,l.kI.required],customFields:this.formBuilder.group((0,a.Lrj)(this.customFields))}),this.customFields.length){const s=this.form.get("customFields");for(const t of this.customFields){const n=t.name,r=this.group.customFields?.[n],c=s.get(n);c&&c.patchValue(r)}}}cancel(){this.resolveWith()}save(){this.resolveWith(this.form.value)}}(O=Ee).\u0275fac=function(s){return new(s||O)(e.Y36(a.iHG),e.Y36(l.QS))},O.\u0275cmp=e.Xpm({type:O,selectors:[["vdr-customer-group-detail-dialog"]],decls:8,vars:9,consts:[["vdrDialogTitle",""],[3,"formGroup"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly"],["formGroupName","customFields",4,"ngIf"],["vdrDialogButtons",""],[4,"ngIf"],["formGroupName","customFields"],["entityName","CustomerGroup",3,"customFields","customFieldsFormGroup"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(s,t){1&s&&(e.YNc(0,Ko,2,2,"ng-template",0),e.TgZ(1,"form",1)(2,"vdr-form-field",2),e.ALo(3,"translate"),e._UZ(4,"input",3),e.ALo(5,"hasPermission"),e.qZA(),e.YNc(6,Vo,5,5,"section",4),e.qZA(),e.YNc(7,zo,6,6,"ng-template",5)),2&s&&(e.xp6(1),e.Q6J("formGroup",t.form),e.xp6(1),e.Q6J("label",e.lcZ(3,4,"common.name")),e.xp6(2),e.Q6J("readonly",!e.lcZ(5,6,e.DdM(8,es))),e.xp6(2),e.Q6J("ngIf",t.customFields.length))},dependencies:[y.MgK,p.O5,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,l.x0,le.h,V.y,w.n,$.q,me.y,h.X$,ue.j],changeDetection:0});const Me=(0,a.wwB)({location:"customer-group-list",requiresPermission:o=>o.includes(a.y3$.DeleteCustomerGroup),getItemName:o=>o.name,bulkDelete:(o,s)=>o.customer.deleteCustomerGroups(s).pipe((0,u.U)(t=>t.deleteCustomerGroups))});var E,ts=i(3176),os=i(1502),ss=i(9187),we=i(5806);const ns=function(){return["./","create"]};function rs(o,s){1&o&&(e.TgZ(0,"a",5),e._UZ(1,"clr-icon",6),e._uU(2),e.ALo(3,"translate"),e.qZA()),2&o&&(e.Q6J("routerLink",e.DdM(4,ns)),e.xp6(2),e.hij(" ",e.lcZ(3,2,"customer.create-new-customer-group")," "))}function is(o,s){if(1&o&&e._uU(0),2&o){const t=s.item;e.hij(" ",t.id," ")}}function as(o,s){if(1&o&&(e._uU(0),e.ALo(1,"localeDate")),2&o){const t=s.item;e.hij(" ",e.xi3(1,1,t.createdAt,"short")," ")}}function cs(o,s){if(1&o&&(e._uU(0),e.ALo(1,"localeDate")),2&o){const t=s.item;e.hij(" ",e.xi3(1,1,t.updatedAt,"short")," ")}}const $e=function(o){return["./",o]};function ls(o,s){if(1&o&&(e.TgZ(0,"a",15)(1,"span"),e._uU(2),e.qZA(),e._UZ(3,"clr-icon",16),e.qZA()),2&o){const t=s.item;e.Q6J("routerLink",e.VKq(2,$e,t.id)),e.xp6(2),e.Oqu(t.name)}}const ms=function(o){return{contents:o}};function ds(o,s){if(1&o&&(e.TgZ(0,"a",17)(1,"span"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"clr-icon",18),e.qZA()),2&o){const t=s.item;e.Q6J("routerLink",e.VKq(6,$e,e.VKq(4,ms,t.id))),e.xp6(2),e.Oqu(e.lcZ(3,2,"customer.view-group-members"))}}function us(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"vdr-data-table-2",7),e.NdJ("pageChange",function(r){e.CHM(t);const c=e.oxw();return e.KtG(c.setPageNumber(r))})("itemsPerPageChange",function(r){e.CHM(t);const c=e.oxw();return e.KtG(c.setItemsPerPage(r))}),e.ALo(1,"async"),e.ALo(2,"async"),e.ALo(3,"async"),e.ALo(4,"async"),e.ALo(5,"async"),e._UZ(6,"vdr-bulk-action-menu",8)(7,"vdr-dt2-search",9),e.ALo(8,"translate"),e.TgZ(9,"vdr-dt2-column",10),e.ALo(10,"translate"),e.YNc(11,is,1,1,"ng-template"),e.qZA(),e.TgZ(12,"vdr-dt2-column",11),e.ALo(13,"translate"),e.YNc(14,as,2,4,"ng-template"),e.qZA(),e.TgZ(15,"vdr-dt2-column",12),e.ALo(16,"translate"),e.YNc(17,cs,2,4,"ng-template"),e.qZA(),e.TgZ(18,"vdr-dt2-column",13),e.ALo(19,"translate"),e.YNc(20,ls,4,4,"ng-template"),e.qZA(),e.TgZ(21,"vdr-dt2-column",14),e.ALo(22,"translate"),e.YNc(23,ds,5,8,"ng-template"),e.qZA()()}if(2&o){const t=e.oxw();e.Q6J("items",e.lcZ(1,23,t.items$))("itemsPerPage",e.lcZ(2,25,t.itemsPerPage$))("totalItems",e.lcZ(3,27,t.totalItems$))("currentPage",e.lcZ(4,29,t.currentPage$))("filters",t.filters)("activeIndex",e.lcZ(5,31,t.activeIndex$)),e.xp6(6),e.Q6J("hostComponent",t)("selectionManager",t.selectionManager),e.xp6(1),e.Q6J("searchTermControl",t.searchTermControl)("searchTermPlaceholder",e.lcZ(8,33,"common.search-by-name")),e.xp6(2),e.Q6J("heading",e.lcZ(10,35,"common.id"))("hiddenByDefault",!0),e.xp6(3),e.Q6J("heading",e.lcZ(13,37,"common.created-at"))("hiddenByDefault",!0)("sort",t.sorts.get("createdAt")),e.xp6(3),e.Q6J("heading",e.lcZ(16,39,"common.updated-at"))("hiddenByDefault",!0)("sort",t.sorts.get("updatedAt")),e.xp6(3),e.Q6J("heading",e.lcZ(19,41,"common.name"))("optional",!1)("sort",t.sorts.get("name")),e.xp6(3),e.Q6J("heading",e.lcZ(22,43,"common.view-contents"))("optional",!1)}}const ps=function(o){return{groupName:o}};function _s(o,s){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",20),e.NdJ("click",function(){const c=e.CHM(t).ngIf,m=e.oxw(2);return e.KtG(m.addToGroup(c))}),e._UZ(2,"clr-icon",6),e.TgZ(3,"span"),e._uU(4),e.ALo(5,"translate"),e.qZA()(),e.TgZ(6,"vdr-customer-group-member-list",21),e.NdJ("fetchParamsChange",function(r){e.CHM(t);const c=e.oxw(2);return e.KtG(c.fetchGroupMembers$.next(r))}),e.ALo(7,"async"),e.ALo(8,"async"),e.ALo(9,"async"),e.qZA(),e.BQk()}if(2&o){const t=s.ngIf,n=e.oxw(2);e.xp6(4),e.Oqu(e.xi3(5,5,"customer.add-customers-to-group",e.VKq(14,ps,t.name))),e.xp6(2),e.Q6J("members",e.lcZ(7,8,n.members$))("route",n.route)("totalItems",e.lcZ(8,10,n.membersTotal$))("activeGroup",e.lcZ(9,12,n.activeGroup$))}}function gs(o,s){if(1&o&&(e.YNc(0,_s,10,16,"ng-container",19),e.ALo(1,"async")),2&o){const t=e.oxw();e.Q6J("ngIf",e.lcZ(1,1,t.activeGroup$))}}const hs=K.Ps`
    query GetCustomerGroupList($options: CustomerGroupListOptions) {
        customerGroups(options: $options) {
            items {
                ...CustomerGroup
            }
            totalItems
        }
    }
    ${a.AQ7}
`;class he extends a.$ms{constructor(s,t,n,r,c){super(),this.dataService=s,this.notificationService=t,this.modalService=n,this.route=r,this.router=c,this.fetchGroupMembers$=new Z.X({skip:0,take:0,filterTerm:""}),this.filters=this.createFilterCollection().addIdFilter().addDateFilters().addFilter({name:"name",type:{kind:"text"},label:(0,d.J)("common.name"),filterField:"name"}).connectToRoute(this.route),this.sorts=this.createSortCollection().defaultSort("createdAt","DESC").addSort({name:"createdAt"}).addSort({name:"updatedAt"}).addSort({name:"name"}).connectToRoute(this.route),this.refreshActiveGroupMembers$=new Z.X(void 0),super.configure({document:a.j9S,getItems:m=>m.customerGroups,setVariables:(m,_)=>({options:{skip:m,take:_,filter:{name:{contains:this.searchTermControl.value},...this.filters.createFilterInput()},sort:this.sorts.createSortInput()}}),refreshListOnChanges:[this.filters.valueChanges,this.sorts.valueChanges]})}ngOnInit(){super.ngOnInit();const s=this.route.paramMap.pipe((0,u.U)(n=>n.get("contents")),(0,te.x)());this.listIsEmpty$=this.items$.pipe((0,u.U)(n=>0===n.length)),this.activeGroup$=(0,Y.a)(this.items$,s).pipe((0,u.U)(([n,r])=>{if(r)return n.find(c=>c.id===r)})),this.activeIndex$=(0,Y.a)(this.items$,s).pipe((0,u.U)(([n,r])=>r?n.findIndex(c=>c.id===r):-1));const t=(0,Y.a)(this.activeGroup$,this.fetchGroupMembers$,this.refreshActiveGroupMembers$).pipe((0,C.w)(([n,{skip:r,take:c,filterTerm:m}])=>n?this.dataService.customer.getCustomerGroupWithCustomers(n.id,{skip:r,take:c,filter:{emailAddress:{contains:m}}}).mapStream(_=>_.customerGroup?.customers):(0,ts.of)(void 0)));this.members$=t.pipe((0,u.U)(n=>n?.items??[])),this.membersTotal$=t.pipe((0,u.U)(n=>n?.totalItems??0))}closeMembers(){const s={...this.route.snapshot.params};delete s.contents,this.router.navigate(["./",s],{relativeTo:this.route,queryParamsHandling:"preserve"})}addToGroup(s){this.modalService.fromComponent(ne,{locals:{group:s,route:this.route},size:"md",verticalAlign:"top"}).pipe((0,C.w)(t=>t?this.dataService.customer.addCustomersToGroup(s.id,t).pipe((0,os.h)(t)):U.E)).subscribe({next:t=>{this.notificationService.success((0,d.J)("customer.add-customers-to-group-success"),{customerCount:t.length,groupName:s.name}),this.refreshActiveGroupMembers$.next()}})}}(E=he).\u0275fac=function(s){return new(s||E)(e.Y36(a.DoR),e.Y36(a.gqp),e.Y36(a.Z7U),e.Y36(v.gz),e.Y36(v.F0))},E.\u0275cmp=e.Xpm({type:E,selectors:[["vdr-customer-group-list"]],features:[e.qOj],decls:11,vars:7,consts:[["locationId","customer-group-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"rightPanelOpen","closeClicked"],["vdrSplitViewLeft",""],["vdrSplitViewRight","",3,"splitViewTitle"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],["id","customer-group-list",1,"mt-2",3,"items","itemsPerPage","totalItems","currentPage","filters","activeIndex","pageChange","itemsPerPageChange"],["locationId","customer-group-list",3,"hostComponent","selectionManager"],[3,"searchTermControl","searchTermPlaceholder"],["id","id",3,"heading","hiddenByDefault"],["id","created-at",3,"heading","hiddenByDefault","sort"],["id","updated-at",3,"heading","hiddenByDefault","sort"],["id","name",3,"heading","optional","sort"],["id","view-contents",3,"heading","optional"],[1,"button-ghost",3,"routerLink"],["shape","arrow right"],["queryParamsHandling","preserve",1,"button-small","bg-weight-150",3,"routerLink"],["shape","file-group"],[4,"ngIf"],[1,"button-ghost","ml-4",3,"click"],["locationId","customer-group-members-list",3,"members","route","totalItems","activeGroup","fetchParamsChange"]],template:function(s,t){if(1&s&&(e.TgZ(0,"vdr-page-block")(1,"vdr-action-bar"),e._UZ(2,"vdr-ab-left"),e.TgZ(3,"vdr-ab-right"),e._UZ(4,"vdr-action-bar-items",0),e.YNc(5,rs,4,5,"a",1),e.qZA()()(),e.TgZ(6,"vdr-split-view",2),e.NdJ("closeClicked",function(){return t.closeMembers()}),e.ALo(7,"async"),e.YNc(8,us,24,45,"ng-template",3),e.YNc(9,gs,2,3,"ng-template",4),e.ALo(10,"async"),e.qZA()),2&s){let n;e.xp6(5),e.Q6J("vdrIfPermissions","CreateCustomerGroup"),e.xp6(1),e.Q6J("rightPanelOpen",e.lcZ(7,3,t.activeGroup$)),e.xp6(3),e.Q6J("splitViewTitle",null==(n=e.lcZ(10,5,t.activeGroup$))?null:n.name)}},dependencies:[y.qvL,p.O5,v.rH,f.Kk,f.BN,f.mz,J.H,X.W,oe.c,k.e,B.U,se.J,ss._,we.L,we.a,W.z,j,p.Ov,h.X$,H.H],styles:["vdr-empty-placeholder[_ngcontent-%COMP%]{flex:1}"],changeDetection:0});const Ye={location:"customer-group-members-list",label:(0,d.J)("customer.remove-from-group"),icon:"trash",iconClass:"is-danger",requiresPermission:a.y3$.UpdateCustomerGroup,onClick:({injector:o,selection:s,hostComponent:t,clearSelection:n})=>{o.get(a.Z7U);const c=o.get(a.DoR),m=o.get(a.gqp),_=t.activeGroup,g=s.map(x=>x.id);c.customer.removeCustomersFromGroup(_.id,g).subscribe({complete:()=>{m.success((0,d.J)("customer.remove-customers-from-group-success"),{customerCount:g.length,groupName:_.name}),n(),t.refresh()}})}},qe=(0,a.wwB)({location:"customer-list",requiresPermission:o=>o.includes(a.y3$.DeleteCustomer),getItemName:o=>o.firstName+" "+o.lastName,bulkDelete:(o,s)=>o.customer.deleteCustomers(s).pipe((0,u.U)(t=>t.deleteCustomers))});var M;const fs=function(){return["./create"]};function Cs(o,s){1&o&&(e.TgZ(0,"a",12),e._UZ(1,"clr-icon",13),e._uU(2),e.ALo(3,"translate"),e.qZA()),2&o&&(e.Q6J("routerLink",e.DdM(4,fs)),e.xp6(2),e.hij(" ",e.lcZ(3,2,"customer.create-new-customer")," "))}function vs(o,s){if(1&o&&e._uU(0),2&o){const t=s.item;e.hij(" ",t.id," ")}}function ys(o,s){if(1&o&&(e._uU(0),e.ALo(1,"localeDate")),2&o){const t=s.item;e.hij(" ",e.xi3(1,1,t.createdAt,"short")," ")}}function As(o,s){if(1&o&&(e._uU(0),e.ALo(1,"localeDate")),2&o){const t=s.item;e.hij(" ",e.xi3(1,1,t.updatedAt,"short")," ")}}const xs=function(o){return["./",o]};function Zs(o,s){if(1&o&&(e.TgZ(0,"a",14)(1,"span"),e._uU(2),e.qZA(),e._UZ(3,"clr-icon",15),e.qZA()),2&o){const t=s.item;e.Q6J("routerLink",e.VKq(4,xs,t.id)),e.xp6(2),e.lnq(" ",t.title," ",t.firstName," ",t.lastName," ")}}function Ts(o,s){if(1&o&&e._UZ(0,"vdr-customer-status-label",16),2&o){const t=s.item;e.Q6J("customer",t)}}function bs(o,s){if(1&o&&e._uU(0),2&o){const t=s.item;e.hij(" ",t.emailAddress," ")}}function Ds(o,s){if(1&o&&e._UZ(0,"vdr-dt2-custom-field-column",17),2&o){const t=s.$implicit,n=e.oxw();e.Q6J("customField",t)("sorts",n.sorts)}}const Ls=K.Ps`
    query CustomerListQuery($options: CustomerListOptions) {
        customers(options: $options) {
            items {
                ...CustomerListItem
            }
            totalItems
        }
    }

    fragment CustomerListItem on Customer {
        id
        createdAt
        updatedAt
        title
        firstName
        lastName
        emailAddress
        user {
            id
            verified
        }
    }
`;class fe extends a.$ms{constructor(){super(),this.customFields=this.getCustomFieldConfig("Customer"),this.filters=this.createFilterCollection().addIdFilter().addDateFilters().addFilter({name:"firstName",type:{kind:"text"},label:(0,d.J)("customer.first-name"),filterField:"firstName"}).addFilter({name:"lastName",type:{kind:"text"},label:(0,d.J)("customer.last-name"),filterField:"lastName"}).addFilter({name:"emailAddress",type:{kind:"text"},label:(0,d.J)("customer.email-address"),filterField:"emailAddress"}).addCustomFieldFilters(this.customFields).connectToRoute(this.route),this.sorts=this.createSortCollection().defaultSort("createdAt","DESC").addSort({name:"createdAt"}).addSort({name:"updatedAt"}).addSort({name:"lastName"}).addSort({name:"emailAddress"}).addCustomFieldSorts(this.customFields).connectToRoute(this.route),this.configure({document:a.B$l,getItems:s=>s.customers,setVariables:(s,t)=>({options:{skip:s,take:t,filter:{...this.searchTermControl.value?{emailAddress:{contains:this.searchTermControl.value},lastName:{contains:this.searchTermControl.value},postalCode:{contains:this.searchTermControl.value}}:{},...this.filters.createFilterInput()},filterOperator:this.searchTermControl.value?a.FnJ.OR:a.FnJ.AND,sort:this.sorts.createSortInput()}}),refreshListOnChanges:[this.sorts.valueChanges,this.filters.valueChanges]})}}(M=fe).\u0275fac=function(s){return new(s||M)},M.\u0275cmp=e.Xpm({type:M,selectors:[["vdr-customer-list"]],features:[e.qOj],decls:33,vars:47,consts:[["locationId","customer-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],["id","customer-list",1,"mt-2",3,"items","itemsPerPage","totalItems","currentPage","filters","pageChange","itemsPerPageChange"],["locationId","customer-list",3,"hostComponent","selectionManager"],[3,"searchTermControl","searchTermPlaceholder"],["id","id",3,"heading","hiddenByDefault"],["id","created-at",3,"heading","hiddenByDefault","sort"],["id","updated-at",3,"heading","hiddenByDefault","sort"],["id","name",3,"heading","optional","sort"],["id","status",3,"heading"],["id","email-address",3,"heading","sort"],[3,"customField","sorts",4,"ngFor","ngForOf"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"button-ghost",3,"routerLink"],["shape","arrow right"],[3,"customer"],[3,"customField","sorts"]],template:function(s,t){1&s&&(e.TgZ(0,"vdr-page-block")(1,"vdr-action-bar"),e._UZ(2,"vdr-ab-left"),e.TgZ(3,"vdr-ab-right"),e._UZ(4,"vdr-action-bar-items",0),e.YNc(5,Cs,4,5,"a",1),e.qZA()()(),e.TgZ(6,"vdr-data-table-2",2),e.NdJ("pageChange",function(r){return t.setPageNumber(r)})("itemsPerPageChange",function(r){return t.setItemsPerPage(r)}),e.ALo(7,"async"),e.ALo(8,"async"),e.ALo(9,"async"),e.ALo(10,"async"),e._UZ(11,"vdr-bulk-action-menu",3)(12,"vdr-dt2-search",4),e.ALo(13,"translate"),e.TgZ(14,"vdr-dt2-column",5),e.ALo(15,"translate"),e.YNc(16,vs,1,1,"ng-template"),e.qZA(),e.TgZ(17,"vdr-dt2-column",6),e.ALo(18,"translate"),e.YNc(19,ys,2,4,"ng-template"),e.qZA(),e.TgZ(20,"vdr-dt2-column",7),e.ALo(21,"translate"),e.YNc(22,As,2,4,"ng-template"),e.qZA(),e.TgZ(23,"vdr-dt2-column",8),e.ALo(24,"translate"),e.YNc(25,Zs,4,6,"ng-template"),e.qZA(),e.TgZ(26,"vdr-dt2-column",9),e.ALo(27,"translate"),e.YNc(28,Ts,1,1,"ng-template"),e.qZA(),e.TgZ(29,"vdr-dt2-column",10),e.ALo(30,"translate"),e.YNc(31,bs,1,1,"ng-template"),e.qZA(),e.YNc(32,Ds,1,2,"vdr-dt2-custom-field-column",11),e.qZA()),2&s&&(e.xp6(5),e.Q6J("vdrIfPermissions","CreateCustomer"),e.xp6(1),e.Q6J("items",e.lcZ(7,25,t.items$))("itemsPerPage",e.lcZ(8,27,t.itemsPerPage$))("totalItems",e.lcZ(9,29,t.totalItems$))("currentPage",e.lcZ(10,31,t.currentPage$))("filters",t.filters),e.xp6(5),e.Q6J("hostComponent",t)("selectionManager",t.selectionManager),e.xp6(1),e.Q6J("searchTermControl",t.searchTermControl)("searchTermPlaceholder",e.lcZ(13,33,"customer.search-customers-by-email-last-name-postal-code")),e.xp6(2),e.Q6J("heading",e.lcZ(15,35,"common.id"))("hiddenByDefault",!0),e.xp6(3),e.Q6J("heading",e.lcZ(18,37,"common.created-at"))("hiddenByDefault",!0)("sort",t.sorts.get("createdAt")),e.xp6(3),e.Q6J("heading",e.lcZ(21,39,"common.updated-at"))("hiddenByDefault",!0)("sort",t.sorts.get("updatedAt")),e.xp6(3),e.Q6J("heading",e.lcZ(24,41,"customer.name"))("optional",!1)("sort",t.sorts.get("lastName")),e.xp6(3),e.Q6J("heading",e.lcZ(27,43,"common.status")),e.xp6(3),e.Q6J("heading",e.lcZ(30,45,"customer.email-address"))("sort",t.sorts.get("emailAddress")),e.xp6(3),e.Q6J("ngForOf",t.customFields))},dependencies:[y.qvL,p.sg,v.rH,f.Kk,f.BN,f.mz,J.H,X.W,oe.c,k.e,B.U,se.J,Ue.j,W.z,b,p.Ov,h.X$,H.H],styles:[".search-input[_ngcontent-%COMP%]{margin-top:6px;min-width:300px}"]});const ke=o=>[{path:"customers",component:a.IIO,data:{breadcrumb:(0,d.J)("breadcrumb.customers")},children:o.getPageTabRoutes("customer-list")},{path:"customers/:id",component:a.IIO,data:{locationId:"customer-detail",breadcrumb:{label:(0,d.J)("breadcrumb.customers"),link:["../","customers"]}},children:o.getPageTabRoutes("customer-detail")},{path:"groups",component:a.IIO,data:{locationId:"customer-detail",breadcrumb:(0,d.J)("breadcrumb.customer-groups")},children:o.getPageTabRoutes("customer-group-list")},{path:"groups/:id",component:a.IIO,data:{locationId:"customer-group-detail",breadcrumb:{label:(0,d.J)("breadcrumb.customer-groups"),link:["../","groups"]}},children:o.getPageTabRoutes("customer-group-detail")}];function Ns(o,s){return(0,a.YWC)({entity:o.entity,id:s.id,breadcrumbKey:"breadcrumb.customers",getName:t=>`${t.firstName} ${t.lastName}`,route:"customers"})}var A;class Be{constructor(s,t){this.bulkActionRegistryService=s,this.pageService=t,s.registerBulkAction(qe),s.registerBulkAction(Me),s.registerBulkAction(Ye),t.registerPageTab({priority:0,location:"customer-list",tab:(0,d.J)("customer.customers"),route:"",component:fe}),t.registerPageTab({priority:0,location:"customer-detail",tab:(0,d.J)("customer.customer"),route:"",component:(0,a.IX9)({component:_e,query:a.jQ8,entityKey:"customer",variables:{orderListOptions:{sort:{orderPlacedAt:a.Asd.DESC}}},getBreadcrumbs:n=>[{label:n?`${n?.firstName} ${n?.lastName}`:(0,d.J)("customer.create-new-customer"),link:[n?.id]}]})}),t.registerPageTab({priority:0,location:"customer-group-list",tab:(0,d.J)("customer.customer-groups"),route:"",component:he}),t.registerPageTab({priority:0,location:"customer-group-detail",tab:(0,d.J)("customer.customer-group"),route:"",component:(0,a.IX9)({component:ge,query:a.Cu1,entityKey:"customerGroup",getBreadcrumbs:n=>[{label:n?n.name:(0,d.J)("customer.create-new-customer-group"),link:[n?.id]}]})})}}(A=Be).\u0275fac=function(s){return new(s||A)(e.LFG(a._4w),e.LFG(a.PhL))},A.\u0275mod=e.oAB({type:A}),A.\u0275inj=e.cJS({providers:[{provide:v.Z6,useFactory:o=>ke(o),multi:!0,deps:[a.PhL]}],imports:[a.m81,v.Bz.forChild([])]})}}]);
//# sourceMappingURL=448.b9901363018dc9bc.js.map