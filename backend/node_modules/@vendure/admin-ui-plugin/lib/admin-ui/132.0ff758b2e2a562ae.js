"use strict";(self.webpackChunkvendure_admin=self.webpackChunkvendure_admin||[]).push([[132],{9132:(Ht,J,i)=>{i.r(J),i.d(J,{DEFAULT_DASHBOARD_WIDGET_LAYOUT:()=>H,DEFAULT_WIDGETS:()=>V,DashboardComponent:()=>W,DashboardModule:()=>K,DashboardWidgetComponent:()=>D,GET_ORDER_CHART_DATA:()=>Jt,GET_ORDER_SUMMARY:()=>Gt,LatestOrdersWidgetComponent:()=>S,LatestOrdersWidgetModule:()=>G,OrderChartWidgetComponent:()=>U,OrderSummaryWidgetComponent:()=>k,OrderSummaryWidgetModule:()=>B,TestWidgetComponent:()=>X,TestWidgetModule:()=>z,WelcomeWidgetComponent:()=>tt,WelcomeWidgetModule:()=>et,dashboardRoutes:()=>j});var y,d=i(848),ot=i(4415),m=i(3044),nt=i(1441),t=i(6108),v=i(6445),c=i(8046),A=i(1017),rt=i(1343),at=i(2279),it=i(1921),dt=i(4043),st=i(5796),ct=i(3850),lt=i(6642),P=i(8923),_=i(1317);const mt=["portal"];function pt(n,e){1&n&&t.Hsn(0)}function gt(n,e){}class D{ngAfterViewInit(){this.loadWidget()}loadWidget(){var e=this;return(0,lt.Z)(function*(){const o=e.widgetConfig.loadComponent(),r=o instanceof Promise?yield o:o;e.componentRef=e.portal.createComponent(r),e.componentRef.changeDetectorRef.detectChanges()})()}ngOnDestroy(){this.componentRef&&this.componentRef.destroy()}}var C;function ht(n,e){if(1&n){const o=t.EpF();t.TgZ(0,"button",8),t.NdJ("click",function(){const s=t.CHM(o).$implicit,l=t.oxw();return t.KtG(l.addWidget(s.id))}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&n){const o=e.$implicit;let r;t.xp6(1),t.hij(" ",t.lcZ(2,1,null!==(r=o.config.title)&&void 0!==r?r:o.id)," ")}}(y=D).\u0275fac=function(e){return new(e||y)},y.\u0275cmp=t.Xpm({type:y,selectors:[["vdr-dashboard-widget"]],viewQuery:function(e,o){if(1&e&&t.Gf(mt,5,t.s_b),2&e){let r;t.iGM(r=t.CRH())&&(o.portal=r.first)}},inputs:{widgetConfig:"widgetConfig"},ngContentSelectors:["*"],decls:5,vars:3,consts:[[3,"title"],["vdrCardControls",""],["portal",""]],template:function(e,o){if(1&e&&(t.F$t(),t.TgZ(0,"vdr-card",0),t.ALo(1,"translate"),t.YNc(2,pt,1,0,"ng-template",1),t.YNc(3,gt,0,0,"ng-template",null,2,t.W1O),t.qZA()),2&e){let r;t.Q6J("title",t.lcZ(1,1,null!==(r=o.widgetConfig.title)&&void 0!==r?r:""))}},dependencies:[P.A,P.D,_.X$],styles:["[_nghost-%COMP%]{display:block}.card[_ngcontent-%COMP%]{margin-top:0;min-height:200px}.card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between}"],changeDetection:0});const ft=function(n){return{width:n}};function vt(n,e){if(1&n){const o=t.EpF();t.TgZ(0,"button",22),t.NdJ("click",function(){const s=t.CHM(o).$implicit,l=t.oxw(2).$implicit,Z=t.oxw(2);return t.KtG(Z.setWidgetWidth(l,s))}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&n){const o=e.$implicit,r=t.oxw(2).$implicit;t.Q6J("disabled",o===r.width),t.xp6(1),t.hij(" ",t.xi3(2,2,"dashboard.widget-width",t.VKq(5,ft,o))," ")}}function _t(n,e){if(1&n){const o=t.EpF();t.TgZ(0,"vdr-dashboard-widget",13)(1,"div",14)(2,"div",15),t._UZ(3,"clr-icon",16),t.qZA(),t.TgZ(4,"vdr-dropdown")(5,"button",17),t._UZ(6,"clr-icon",3),t.qZA(),t.TgZ(7,"vdr-dropdown-menu",4)(8,"h4",18),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.YNc(11,vt,3,7,"button",19),t._UZ(12,"div",20),t.TgZ(13,"button",8),t.NdJ("click",function(){t.CHM(o);const a=t.oxw().$implicit,s=t.oxw(2);return t.KtG(s.removeWidget(a))}),t._UZ(14,"clr-icon",21),t._uU(15),t.ALo(16,"translate"),t.qZA()()()()()}if(2&n){const o=t.oxw().$implicit,r=t.oxw(2);t.Q6J("widgetConfig",o.config),t.xp6(9),t.Oqu(t.lcZ(10,4,"dashboard.widget-resize")),t.xp6(2),t.Q6J("ngForOf",r.getSupportedWidths(o.config)),t.xp6(4),t.hij(" ",t.lcZ(16,6,"dashboard.remove-widget")," ")}}function yt(n,e){if(1&n&&(t.TgZ(0,"div",11),t.YNc(1,_t,17,8,"vdr-dashboard-widget",12),t.qZA()),2&n){const o=e.$implicit,r=t.oxw(2);t.Q6J("ngClass",r.getClassForWidth(o.width))("cdkDragData",o),t.xp6(1),t.Q6J("vdrIfPermissions",o.config.requiresPermissions||null)}}const Ct=function(n){return{index:n}};function xt(n,e){if(1&n){const o=t.EpF();t.TgZ(0,"div",9),t.NdJ("cdkDropListDropped",function(a){t.CHM(o);const s=t.oxw();return t.KtG(s.drop(a))}),t.YNc(1,yt,2,3,"div",10),t.qZA()}if(2&n){const o=e.$implicit,r=e.index,a=t.oxw();t.Q6J("cdkDropListData",t.VKq(3,Ct,r)),t.xp6(1),t.Q6J("ngForOf",o)("ngForTrackBy",a.trackRowItem)}}class W{constructor(e,o,r,a){this.dashboardWidgetService=e,this.localStorageService=o,this.changedDetectorRef=r,this.dataService=a,this.deletionMarker="__delete__",this.setTitle=(0,d.sZ5)()}ngOnInit(){this.availableWidgets$=this.dataService.client.userStatus().stream$.pipe((0,m.U)(({userStatus:e})=>e.permissions),(0,m.U)(e=>this.dashboardWidgetService.getAvailableWidgets(e)),(0,nt.b)(e=>this.widgetLayout=this.initLayout(e.map(o=>o.id)))),this.setTitle("breadcrumb.dashboard")}getClassForWidth(e){switch(e){case 3:return"clr-col-12 clr-col-sm-6 clr-col-lg-3";case 4:return"clr-col-12 clr-col-sm-6 clr-col-lg-4";case 6:return"clr-col-12 clr-col-lg-6";case 8:return"clr-col-12 clr-col-lg-8";case 12:return"clr-col-12";default:(0,ot.assertNever)(e)}}getSupportedWidths(e){return e.supportedWidths||[3,4,6,8,12]}setWidgetWidth(e,o){e.width=o,this.recalculateLayout()}trackRow(e,o){return o.map(a=>`${a.id}:${a.width}`).join("|")}trackRowItem(e,o){return o.config}addWidget(e){const o=this.dashboardWidgetService.getWidgetById(e);if(o){const a={id:e,config:o,width:this.getSupportedWidths(o)[0]};let s;this.widgetLayout&&this.widgetLayout.length?s=this.widgetLayout[this.widgetLayout.length-1]:(s=[],this.widgetLayout?.push(s)),s.push(a),this.recalculateLayout()}}removeWidget(e){e.id=this.deletionMarker,this.recalculateLayout()}drop(e){const{currentIndex:o,previousIndex:r,previousContainer:a,container:s}=e;if((r!==o||a.data.index!==s.data.index)&&this.widgetLayout){const l=this.widgetLayout[a.data.index],Z=this.widgetLayout[s.data.index];l.splice(r,1),Z.splice(o,0,e.item.data),this.recalculateLayout()}}initLayout(e){const o=this.localStorageService.get("dashboardWidgetLayout");let r;return o&&(r=o.filter(a=>e.includes(a.id))),this.dashboardWidgetService.getWidgetLayout(r)}recalculateLayout(){if(this.widgetLayout){const o=this.widgetLayout.reduce((r,a)=>[...r,...a],[]).filter(r=>r.id!==this.deletionMarker).map(r=>({id:r.id,width:r.width}));this.widgetLayout=this.dashboardWidgetService.getWidgetLayout(o),this.localStorageService.set("dashboardWidgetLayout",o),setTimeout(()=>this.changedDetectorRef.markForCheck())}}}(C=W).\u0275fac=function(e){return new(e||C)(t.Y36(d.ayj),t.Y36(d.n2A),t.Y36(t.sBO),t.Y36(d.DoR))},C.\u0275cmp=t.Xpm({type:C,selectors:[["vdr-dashboard"]],decls:13,vars:8,consts:[[1,"widget-header","mb-1"],["vdrDropdownTrigger","",1,"btn","btn-secondary","btn-sm"],["shape","plus"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["cdkDropListGroup",""],["class","clr-row dashboard-row","cdkDropList","","cdkDropListOrientation","horizontal",3,"cdkDropListData","cdkDropListDropped",4,"ngFor","ngForOf","ngForTrackBy"],["vdrDropdownItem","",3,"click"],["cdkDropList","","cdkDropListOrientation","horizontal",1,"clr-row","dashboard-row",3,"cdkDropListData","cdkDropListDropped"],["class","dashboard-item","cdkDrag","",3,"ngClass","cdkDragData",4,"ngFor","ngForOf","ngForTrackBy"],["cdkDrag","",1,"dashboard-item",3,"ngClass","cdkDragData"],[3,"widgetConfig",4,"vdrIfPermissions"],[3,"widgetConfig"],[1,"flex"],["cdkDragHandle","",1,"drag-handle"],["shape","drag-handle","size","24"],["vdrDropdownTrigger","",1,"icon-button"],[1,"dropdown-header"],["vdrDropdownItem","",3,"disabled","click",4,"ngFor","ngForOf"],["role","separator",1,"dropdown-divider"],["shape","trash",1,"is-danger"],["vdrDropdownItem","",3,"disabled","click"]],template:function(e,o){1&e&&(t.TgZ(0,"vdr-page-block")(1,"div",0)(2,"vdr-dropdown")(3,"button",1),t._UZ(4,"clr-icon",2),t._uU(5),t.ALo(6,"translate"),t._UZ(7,"clr-icon",3),t.qZA(),t.TgZ(8,"vdr-dropdown-menu",4),t.YNc(9,ht,3,3,"button",5),t.ALo(10,"async"),t.qZA()()(),t.TgZ(11,"div",6),t.YNc(12,xt,2,5,"div",7),t.qZA()()),2&e&&(t.xp6(5),t.hij(" ",t.lcZ(6,4,"dashboard.add-widget")," "),t.xp6(4),t.Q6J("ngForOf",t.lcZ(10,6,o.availableWidgets$)),t.xp6(3),t.Q6J("ngForOf",o.widgetLayout)("ngForTrackBy",o.trackRow))},dependencies:[v.q0d,v.qvL,c.mk,c.sg,A.Wj,A.Fd,A.Zt,A.Bh,rt.J,at.N,it.U,dt.H,st.H,ct.z,D,c.Ov,_.X$],styles:[".widget-header[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.placeholder[_ngcontent-%COMP%]{color:var(--color-grey-300);text-align:center}.placeholder[_ngcontent-%COMP%]   .version[_ngcontent-%COMP%]{font-size:3em;margin:24px;line-height:1em}.placeholder[_ngcontent-%COMP%]     .clr-i-outline{fill:var(--color-grey-200)}vdr-dashboard-widget[_ngcontent-%COMP%]{margin-bottom:24px}.drag-handle[_ngcontent-%COMP%]{cursor:move}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.dashboard-row[_ngcontent-%COMP%]{padding:0;border-width:1;margin-bottom:6px;transition:padding .2s,margin .2s}.dashboard-row.cdk-drop-list-dragging[_ngcontent-%COMP%], .dashboard-row.cdk-drop-list-receiving[_ngcontent-%COMP%]{border:2px dashed var(--color-component-border-200);border-radius:var(--border-radius);padding:6px}.dashboard-row.cdk-drop-list-dragging[_ngcontent-%COMP%]   .dashboard-item[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"],changeDetection:0});var F=i(4285);const j=[{path:"",component:W,pathMatch:"full"}];var x,p,L=i(186),M=i(2840),Ot=i(9466),Tt=i(5375),bt=i(106),wt=i(2249),N=i(2814),Zt=i(4531);const At=function(n){return["/orders/",n]};function Dt(n,e){if(1&n&&(t.TgZ(0,"a",6)(1,"span"),t._uU(2),t.qZA(),t._UZ(3,"clr-icon",7),t.qZA()),2&n){const o=e.item;t.Q6J("routerLink",t.VKq(2,At,o.id)),t.xp6(2),t.Oqu(o.code)}}function Wt(n,e){if(1&n&&t._UZ(0,"vdr-order-state-label",8),2&n){const o=e.item;t.Q6J("state",o.state)}}function Lt(n,e){if(1&n&&t._UZ(0,"vdr-customer-label",9),2&n){const o=e.item;t.Q6J("customer",o.customer)}}function Mt(n,e){if(1&n&&(t._uU(0),t.ALo(1,"localeCurrency")),2&n){const o=e.item;t.hij(" ",t.xi3(1,1,o.totalWithTax,o.currencyCode)," ")}}function St(n,e){if(1&n&&(t._uU(0),t.ALo(1,"timeAgo")),2&n){const o=e.item;t.hij(" ",t.lcZ(1,1,o.orderPlacedAt)," ")}}M.Ps`
    query GetLatestOrders($options: OrderListOptions) {
        orders(options: $options) {
            items {
                id
                createdAt
                updatedAt
                type
                orderPlacedAt
                code
                state
                total
                totalWithTax
                currencyCode
                customer {
                    id
                    firstName
                    lastName
                }
            }
        }
    }
`;class S{constructor(e){this.dataService=e}ngOnInit(){this.latestOrders$=this.dataService.query(d.pUH,{options:{take:10,filter:{active:{eq:!1},state:{notIn:["Cancelled","Draft"]}},sort:{orderPlacedAt:d.Asd.DESC}}}).refetchOnChannelChange().mapStream(e=>e.orders.items)}}(x=S).\u0275fac=function(e){return new(e||x)(t.Y36(d.DoR))},x.\u0275cmp=t.Xpm({type:x,selectors:[["vdr-latest-orders-widget"]],decls:17,vars:20,consts:[["id","latest-orders-widget-list",3,"items"],["id","code",3,"heading"],["id","state",3,"heading","hiddenByDefault"],["id","customer",3,"heading","hiddenByDefault"],["id","total",3,"heading"],["id","placed-at",3,"heading"],[1,"button-ghost",3,"routerLink"],["shape","arrow right"],[3,"state"],[3,"customer"]],template:function(e,o){1&e&&(t.TgZ(0,"vdr-data-table-2",0),t.ALo(1,"async"),t.TgZ(2,"vdr-dt2-column",1),t.ALo(3,"translate"),t.YNc(4,Dt,4,4,"ng-template"),t.qZA(),t.TgZ(5,"vdr-dt2-column",2),t.ALo(6,"translate"),t.YNc(7,Wt,1,1,"ng-template"),t.qZA(),t.TgZ(8,"vdr-dt2-column",3),t.ALo(9,"translate"),t.YNc(10,Lt,1,1,"ng-template"),t.qZA(),t.TgZ(11,"vdr-dt2-column",4),t.ALo(12,"translate"),t.YNc(13,Mt,2,4,"ng-template"),t.qZA(),t.TgZ(14,"vdr-dt2-column",5),t.ALo(15,"translate"),t.YNc(16,St,2,3,"ng-template"),t.qZA()()),2&e&&(t.Q6J("items",t.lcZ(1,8,o.latestOrders$)),t.xp6(2),t.Q6J("heading",t.lcZ(3,10,"common.code")),t.xp6(3),t.Q6J("heading",t.lcZ(6,12,"order.state"))("hiddenByDefault",!0),t.xp6(3),t.Q6J("heading",t.lcZ(9,14,"customer.customer"))("hiddenByDefault",!0),t.xp6(3),t.Q6J("heading",t.lcZ(12,16,"order.total")),t.xp6(3),t.Q6J("heading",t.lcZ(15,18,"order.placed-at")))},dependencies:[v.qvL,F.rH,Ot.d,Tt.G,bt.e,wt.U,c.Ov,_.X$,N.e,Zt.k],styles:["vdr-data-table[_ngcontent-%COMP%]     table{margin-top:0}vdr-order-state-label[_ngcontent-%COMP%]{display:inline-block;margin-top:2px}"],changeDetection:0});class G{}(p=G).\u0275fac=function(e){return new(e||p)},p.\u0275mod=t.oAB({type:p}),p.\u0275inj=t.cJS({imports:[d.IR2,d.m81]});var O,$t=i(7807),Y=i(4790),Ut=i(9034),$=i(4154),E=i(24),kt=i(6940),Rt=i(7874);function It(n,e){if(1&n){const o=t.EpF();t.TgZ(0,"div",2)(1,"button",3),t.NdJ("click",function(){t.CHM(o);const a=t.oxw();return t.KtG(a.metricType$.next(a.MetricType.OrderTotal))}),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"button",4),t.NdJ("click",function(){t.CHM(o);const a=t.oxw();return t.KtG(a.metricType$.next(a.MetricType.OrderCount))}),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"button",4),t.NdJ("click",function(){t.CHM(o);const a=t.oxw();return t.KtG(a.metricType$.next(a.MetricType.AverageOrderValue))}),t._uU(8),t.ALo(9,"translate"),t.qZA(),t._UZ(10,"div",5),t.TgZ(11,"button",3),t.NdJ("click",function(){t.CHM(o);const a=t.oxw();return t.KtG(a.refresh())}),t._UZ(12,"clr-icon",6),t.qZA()()}if(2&n){const o=e.ngIf,r=t.oxw();t.xp6(1),t.ekj("active",o===r.MetricType.OrderTotal),t.xp6(1),t.hij(" ",t.lcZ(3,9,"dashboard.metric-order-total-value")," "),t.xp6(2),t.ekj("active",o===r.MetricType.OrderCount),t.xp6(1),t.hij(" ",t.lcZ(6,11,"dashboard.metric-number-of-orders")," "),t.xp6(2),t.ekj("active",o===r.MetricType.AverageOrderValue),t.xp6(1),t.hij(" ",t.lcZ(9,13,"dashboard.metric-average-order-value")," ")}}const Jt=M.Ps`
    query GetOrderChartData($refresh: Boolean, $types: [MetricType!]!) {
        metricSummary(input: { interval: Daily, types: $types, refresh: $refresh }) {
            interval
            type
            entries {
                label
                value
            }
        }
    }
`;class U{constructor(e){this.dataService=e,this.refresh$=new $t.x,this.metricType$=new Y.X(d.t0y.OrderTotal),this.MetricType=d.t0y}ngOnInit(){const e=this.dataService.settings.getActiveChannel().refetchOnChannelChange().mapStream(a=>a.activeChannel.defaultCurrencyCode||void 0),o=this.dataService.client.uiState().mapStream(a=>a.uiState),r=this.metricType$.pipe((0,E.x)());this.metrics$=(0,Ut.a)(r,e,o).pipe((0,$.w)(([a,s,l])=>this.refresh$.pipe((0,kt.O)(!1),(0,$.w)(Z=>this.dataService.query(d.UZ,{types:[a],refresh:Z}).mapSingle(R=>R.metricSummary).pipe((0,m.U)(R=>{const qt=a===d.t0y.OrderCount?"number":"currency",Qt=`${l.language}-${l.locale}`,Bt={formatValueAs:qt,currencyCode:s,locale:Qt};return R.find(I=>I.type===a)?.entries.map(I=>({...I,formatOptions:Bt}))??[]}))))))}refresh(){this.refresh$.next(!0)}}(O=U).\u0275fac=function(e){return new(e||O)(t.Y36(d.DoR))},O.\u0275cmp=t.Xpm({type:O,selectors:[["vdr-order-chart-widget"]],decls:4,vars:6,consts:[[3,"entries"],["class","flex",4,"ngIf"],[1,"flex"],[1,"button-small",3,"click"],[1,"ml-1","button-small",3,"click"],[1,"flex-spacer"],["shape","refresh"]],template:function(e,o){1&e&&(t._UZ(0,"vdr-chart",0),t.ALo(1,"async"),t.YNc(2,It,13,15,"div",1),t.ALo(3,"async")),2&e&&(t.Q6J("entries",t.lcZ(1,2,o.metrics$)),t.xp6(2),t.Q6J("ngIf",t.lcZ(3,4,o.metricType$)))},dependencies:[v.qvL,c.O5,Rt.x,c.Ov,_.X$],styles:[".button-small.active[_ngcontent-%COMP%]{background-color:var(--color-primary-200);color:var(--color-primary-900)}"],changeDetection:0});var T,g,Pt=i(7530),q=i.n(Pt),Q=i(5808),Ft=i(2388);function jt(n,e){if(1&n){const o=t.EpF();t.TgZ(0,"div",7)(1,"button",8),t.NdJ("click",function(){t.CHM(o);const a=t.oxw();return t.KtG(a.selection$.next({timeframe:"day",date:a.today}))}),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"button",9),t.NdJ("click",function(){t.CHM(o);const a=t.oxw();return t.KtG(a.selection$.next({timeframe:"day",date:a.yesterday}))}),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"button",9),t.NdJ("click",function(){t.CHM(o);const a=t.oxw();return t.KtG(a.selection$.next({timeframe:"week"}))}),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"button",9),t.NdJ("click",function(){t.CHM(o);const a=t.oxw();return t.KtG(a.selection$.next({timeframe:"month"}))}),t._uU(11),t.ALo(12,"translate"),t.qZA()()}if(2&n){const o=e.ngIf,r=t.oxw();t.xp6(1),t.ekj("active",o.date===r.today),t.xp6(1),t.hij(" ",t.lcZ(3,12,"dashboard.today")," "),t.xp6(2),t.ekj("active",o.date===r.yesterday),t.xp6(1),t.hij(" ",t.lcZ(6,14,"dashboard.yesterday")," "),t.xp6(2),t.ekj("active","week"===o.timeframe),t.xp6(1),t.hij(" ",t.lcZ(9,16,"dashboard.thisWeek")," "),t.xp6(2),t.ekj("active","month"===o.timeframe),t.xp6(1),t.hij(" ",t.lcZ(12,18,"dashboard.thisMonth")," ")}}function Nt(n,e){if(1&n&&(t.TgZ(0,"div",10),t._uU(1),t.ALo(2,"localeDate"),t.ALo(3,"localeDate"),t.qZA()),2&n){const o=e.ngIf;t.xp6(1),t.AsE(" ",t.lcZ(2,2,o.start)," - ",t.lcZ(3,4,o.end)," ")}}const Gt=M.Ps`
    query GetOrderSummary($start: DateTime!, $end: DateTime!) {
        orders(options: { filter: { orderPlacedAt: { between: { start: $start, end: $end } } } }) {
            totalItems
            items {
                id
                totalWithTax
                currencyCode
            }
        }
    }
`;class k{constructor(e){this.dataService=e,this.today=new Date,this.yesterday=new Date((new Date).setDate(this.today.getDate()-1)),this.selection$=new Y.X({timeframe:"day",date:this.today})}ngOnInit(){this.dateRange$=this.selection$.pipe((0,E.x)(),(0,m.U)(o=>({start:q()(o.date).startOf(o.timeframe).toDate(),end:q()(o.date).endOf(o.timeframe).toDate()})),(0,Q.d)(1));const e=this.dateRange$.pipe((0,$.w)(({start:o,end:r})=>this.dataService.query(d.OY9,{start:o.toISOString(),end:r.toISOString()}).refetchOnChannelChange().mapStream(a=>a.orders)),(0,Q.d)(1));this.totalOrderCount$=e.pipe((0,m.U)(o=>o.totalItems)),this.totalOrderValue$=e.pipe((0,m.U)(o=>o.items.reduce((r,a)=>r+a.totalWithTax,0)/100)),this.currencyCode$=this.dataService.settings.getActiveChannel().refetchOnChannelChange().mapStream(o=>o.activeChannel.defaultCurrencyCode||void 0)}}(T=k).\u0275fac=function(e){return new(e||T)(t.Y36(d.DoR))},T.\u0275cmp=t.Xpm({type:T,selectors:[["vdr-order-summary-widget"]],decls:22,vars:23,consts:[[1,"stats"],[1,"stat"],[1,"stat-figure"],[1,"stat-label"],[1,"footer"],["class","flex",4,"ngIf"],["class","date-range p5",4,"ngIf"],[1,"flex"],[1,"button-small",3,"click"],[1,"ml-1","button-small",3,"click"],[1,"date-range","p5"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._uU(3),t.ALo(4,"async"),t.qZA(),t.TgZ(5,"div",3),t._uU(6),t.ALo(7,"translate"),t.qZA()(),t.TgZ(8,"div",1)(9,"div",2),t._uU(10),t.ALo(11,"currency"),t.ALo(12,"async"),t.ALo(13,"async"),t.qZA(),t.TgZ(14,"div",3),t._uU(15),t.ALo(16,"translate"),t.qZA()()(),t.TgZ(17,"div",4),t.YNc(18,jt,13,20,"div",5),t.ALo(19,"async"),t.YNc(20,Nt,4,6,"div",6),t.ALo(21,"async"),t.qZA()),2&e&&(t.xp6(3),t.Oqu(t.lcZ(4,6,o.totalOrderCount$)),t.xp6(3),t.Oqu(t.lcZ(7,8,"dashboard.total-orders")),t.xp6(4),t.hij(" ",t.xi3(11,10,t.lcZ(12,13,o.totalOrderValue$),t.lcZ(13,15,o.currencyCode$)||void 0)," "),t.xp6(5),t.Oqu(t.lcZ(16,17,"dashboard.total-order-value")),t.xp6(3),t.Q6J("ngIf",t.lcZ(19,19,o.selection$)),t.xp6(2),t.Q6J("ngIf",t.lcZ(21,21,o.dateRange$)))},dependencies:[c.O5,c.Ov,c.H9,_.X$,Ft.H],styles:[".stats[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.stat[_ngcontent-%COMP%]{text-align:center}.stat-figure[_ngcontent-%COMP%]{font-size:2rem;line-height:3rem}.stat-label[_ngcontent-%COMP%]{text-transform:uppercase}.date-range[_ngcontent-%COMP%]{margin-top:0}.footer[_ngcontent-%COMP%]{margin-top:24px;display:flex;flex-direction:column;justify-content:space-between}.button-small.active[_ngcontent-%COMP%]{background-color:var(--color-primary-200);color:var(--color-primary-900)}"],changeDetection:0});class B{}(g=B).\u0275fac=function(e){return new(e||g)},g.\u0275mod=t.oAB({type:g}),g.\u0275inj=t.cJS({imports:[d.IR2]});const H=[{id:"metrics",width:12},{id:"orderSummary",width:6},{id:"latestOrders",width:6}],V={metrics:{title:(0,L.J)("dashboard.metrics"),supportedWidths:[6,8,12],loadComponent:()=>U,requiresPermissions:[d.y3$.ReadOrder]},orderSummary:{title:(0,L.J)("dashboard.orders-summary"),loadComponent:()=>k,supportedWidths:[4,6,8,12],requiresPermissions:[d.y3$.ReadOrder]},latestOrders:{title:(0,L.J)("dashboard.latest-orders"),loadComponent:()=>S,supportedWidths:[6,8,12],requiresPermissions:[d.y3$.ReadOrder]}};var u,b,h,w,f;class K{constructor(e){Object.entries(V).map(([o,r])=>{e.getWidgetById(o)||e.registerWidget(o,r)}),0===e.getDefaultLayout().length&&e.setDefaultLayout(H)}}(u=K).\u0275fac=function(e){return new(e||u)(t.LFG(d.ayj))},u.\u0275mod=t.oAB({type:u}),u.\u0275inj=t.cJS({imports:[d.m81,F.Bz.forChild(j)]});class X{}(b=X).\u0275fac=function(e){return new(e||b)},b.\u0275cmp=t.Xpm({type:b,selectors:[["vdr-test-widget"]],decls:2,vars:0,template:function(e,o){1&e&&(t.TgZ(0,"p"),t._uU(1,"This is a test widget!"),t.qZA())},changeDetection:0});class z{}function Yt(n,e){if(1&n&&(t.TgZ(0,"p",4),t._uU(1),t.qZA()),2&n){const o=t.oxw(2);t.xp6(1),t.AsE(" ",o.hideVendureBranding?"":"Vendure"," ",o.hideVersion?"":"Admin UI v"+o.version," ")}}function Et(n,e){if(1&n&&(t.TgZ(0,"div")(1,"h4",3),t._uU(2),t._UZ(3,"br"),t.TgZ(4,"small",4),t._uU(5),t.ALo(6,"timeAgo"),t.qZA()(),t.YNc(7,Yt,2,2,"p",5),t.qZA()),2&n){const o=e.ngIf,r=t.oxw();t.xp6(2),t.AsE(" Welcome, ",o.firstName," ",o.lastName,""),t.xp6(3),t.hij("Last login: ",t.lcZ(6,4,o.user.lastLogin),""),t.xp6(2),t.Q6J("ngIf",!r.hideVendureBranding||!r.hideVersion)}}(h=z).\u0275fac=function(e){return new(e||h)},h.\u0275mod=t.oAB({type:h}),h.\u0275inj=t.cJS({});class tt{constructor(e){this.dataService=e,this.version=d.s5M,this.brand=(0,d.hq7)().brand,this.hideVendureBranding=(0,d.hq7)().hideVendureBranding,this.hideVersion=(0,d.hq7)().hideVersion}ngOnInit(){this.administrator$=this.dataService.administrator.getActiveAdministrator().mapStream(e=>e.activeAdministrator||null)}}(w=tt).\u0275fac=function(e){return new(e||w)(t.Y36(d.DoR))},w.\u0275cmp=t.Xpm({type:w,selectors:[["vdr-welcome-widget"]],decls:4,vars:3,consts:[[4,"ngIf"],[1,"placeholder"],["shape","line-chart","size","128"],[1,""],[1,"p5"],["class","p5",4,"ngIf"]],template:function(e,o){1&e&&(t.YNc(0,Et,8,6,"div",0),t.ALo(1,"async"),t.TgZ(2,"div",1),t._UZ(3,"clr-icon",2),t.qZA()),2&e&&t.Q6J("ngIf",t.lcZ(1,1,o.administrator$))},dependencies:[v.qvL,c.O5,c.Ov,N.e],styles:["[_nghost-%COMP%]{display:flex;justify-content:space-between}.placeholder[_ngcontent-%COMP%]{color:var(--color-grey-200)}"],changeDetection:0});class et{}(f=et).\u0275fac=function(e){return new(e||f)},f.\u0275mod=t.oAB({type:f}),f.\u0275inj=t.cJS({imports:[d.IR2]})}}]);
//# sourceMappingURL=132.0ff758b2e2a562ae.js.map