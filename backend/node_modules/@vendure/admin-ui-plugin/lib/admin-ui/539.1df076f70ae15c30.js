"use strict";(self.webpackChunkvendure_admin=self.webpackChunkvendure_admin||[]).push([[539],{8539:(dc,qt,d)=>{d.r(qt),d.d(qt,{AddManualPaymentDialogComponent:()=>Be,CancelOrderDialogComponent:()=>We,CouponCodeSelectorComponent:()=>De,DraftOrderDetailComponent:()=>$e,DraftOrderVariantSelectorComponent:()=>ct,FulfillOrderDialogComponent:()=>dt,FulfillmentCardComponent:()=>pt,FulfillmentDetailComponent:()=>He,FulfillmentStateLabelComponent:()=>st,GET_COUPON_CODE_SELECTOR_PROMOTION_LIST:()=>Zn,GET_CUSTOMER_ADDRESSES:()=>lc,GET_SELLER_ORDERS:()=>nn,LineFulfillmentComponent:()=>je,LineRefundsComponent:()=>ie,ModificationDetailComponent:()=>_t,NODE_HEIGHT:()=>mt,ORDER_DETAIL_QUERY:()=>za,OrderCustomFieldsCardComponent:()=>it,OrderDataTableComponent:()=>at,OrderDetailComponent:()=>At,OrderEditResultType:()=>I,OrderEditorComponent:()=>Mt,OrderEditsPreviewDialogComponent:()=>It,OrderGuard:()=>Pe,OrderHistoryComponent:()=>bt,OrderHistoryEntryHostComponent:()=>Zt,OrderListComponent:()=>wt,OrderModule:()=>sn,OrderPaymentCardComponent:()=>Ot,OrderProcessEdgeComponent:()=>gt,OrderProcessGraphComponent:()=>ft,OrderProcessGraphDialogComponent:()=>ht,OrderProcessNodeComponent:()=>Ge,OrderResolver:()=>Ft,OrderStateSelectDialogComponent:()=>tt,OrderTableComponent:()=>le,OrderTotalColumnComponent:()=>Re,OrderTransitionService:()=>z,PaymentDetailComponent:()=>Ke,PaymentStateLabelComponent:()=>vt,RefundOrderDialogComponent:()=>xt,RefundStateLabelComponent:()=>yt,SelectAddressDialogComponent:()=>Qe,SelectCustomerDialogComponent:()=>ze,SelectShippingMethodDialogComponent:()=>et,SellerOrdersCardComponent:()=>Tt,SettleRefundDialogComponent:()=>Ct,SimpleItemListComponent:()=>_e,createRoutes:()=>ln,modifyingOrderBreadcrumb:()=>dn,orderBreadcrumb:()=>cn});var $,l=d(5086),c=d(848),R=d(2840),e=d(6108),L=d(4992),Je=d(8369),x=d(8251),Z=d(4351),y=d(4073),p=d(8046),m=d(1317),h=d(4531);function _n(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.Oqu(e.lcZ(1,1,"order.add-payment-to-order"))}function un(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",7),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"button",8),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.submit())}),e._uU(4),e.ALo(5,"translate"),e.ALo(6,"localeCurrency"),e.qZA()}if(2&r){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,4,"common.cancel")),e.xp6(2),e.Q6J("disabled",t.form.invalid||t.form.pristine),e.xp6(1),e.AsE(" ",e.lcZ(5,6,"order.add-payment")," (",e.xi3(6,8,t.outstandingAmount,t.currencyCode),") ")}}R.Ps`
    query GetAddManualPaymentMethodList($options: PaymentMethodListOptions!) {
        paymentMethods(options: $options) {
            items {
                id
                createdAt
                updatedAt
                name
                code
                description
                enabled
            }
            totalItems
        }
    }
`;class Be{constructor(n){this.dataService=n,this.form=new l.nJ({method:new l.p4("",l.kI.required),transactionId:new l.p4("",l.kI.required)})}ngOnInit(){this.paymentMethods$=this.dataService.query(c.nv3,{options:{take:999}}).mapSingle(n=>n.paymentMethods.items)}submit(){const n=this.form.value;this.resolveWith({method:n.method,transactionId:n.transactionId})}cancel(){this.resolveWith()}}($=Be).\u0275fac=function(n){return new(n||$)(e.Y36(c.DoR))},$.\u0275cmp=e.Xpm({type:$,selectors:[["vdr-add-manual-payment-dialog"]],decls:10,vars:11,consts:[["vdrDialogTitle",""],[3,"formGroup"],["for","method",3,"label"],["bindLabel","code","appendTo","body","autofocus","","bindValue","code","formControlName","method",3,"items","addTag"],["for","transactionId",3,"label"],["id","transactionId","type","text","formControlName","transactionId"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(n,t){1&n&&(e.YNc(0,_n,2,3,"ng-template",0),e.TgZ(1,"form",1)(2,"vdr-form-field",2),e.ALo(3,"translate"),e._UZ(4,"ng-select",3),e.ALo(5,"async"),e.qZA(),e.TgZ(6,"vdr-form-field",4),e.ALo(7,"translate"),e._UZ(8,"input",5),e.qZA()(),e.YNc(9,un,7,11,"ng-template",6)),2&n&&(e.xp6(1),e.Q6J("formGroup",t.form),e.xp6(1),e.Q6J("label",e.lcZ(3,5,"order.payment-method")),e.xp6(2),e.Q6J("items",e.lcZ(5,7,t.paymentMethods$))("addTag",!0),e.xp6(2),e.Q6J("label",e.lcZ(7,9,"order.transaction-id")))},dependencies:[l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,L.w9,Je.h,x.y,Z.n,y.q,p.Ov,m.X$,h.k],styles:[".ng-select[_ngcontent-%COMP%]{min-width:100%}"],changeDetection:0});var H,u=d(186),_=d(6445),D=d(7903);function mn(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.Oqu(e.lcZ(1,1,"order.cancel-order"))}function gn(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"input",19),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw().$implicit,s=e.oxw();return e.KtG(s.lineQuantities[a.id]=i)})("input",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.checkIfAllSelected())}),e.qZA()}if(2&r){const t=e.oxw().$implicit,o=e.oxw();e.Q6J("ngModel",o.lineQuantities[t.id])("disabled",o.cancelAll)("max",t.quantity)}}function fn(r,n){if(1&r&&e._uU(0),2&r){const t=e.oxw().$implicit;e.Oqu(t.quantity)}}function hn(r,n){if(1&r&&(e.TgZ(0,"tr",10)(1,"td",11),e._UZ(2,"img",12),e.ALo(3,"assetPreview"),e.qZA(),e.TgZ(4,"td",13),e._uU(5),e.qZA(),e.TgZ(6,"td",14),e._uU(7),e.qZA(),e.TgZ(8,"td",15),e._uU(9),e.qZA(),e.TgZ(10,"td",15),e._uU(11),e.ALo(12,"localeCurrency"),e.qZA(),e.TgZ(13,"td",16),e.YNc(14,gn,1,3,"input",17),e.YNc(15,fn,1,1,"ng-template",null,18,e.W1O),e.qZA()()),2&r){const t=n.$implicit,o=e.MAs(16),i=e.oxw();e.ekj("is-disabled",i.cancelAll)("is-cancelled",0===t.quantity),e.xp6(2),e.Q6J("src",e.xi3(3,11,t.featuredAsset,"tiny"),e.LSH),e.xp6(3),e.Oqu(t.productVariant.name),e.xp6(2),e.Oqu(t.productVariant.sku),e.xp6(2),e.Oqu(t.quantity),e.xp6(2),e.hij(" ",e.xi3(12,14,t.unitPriceWithTax,i.order.currencyCode)," "),e.xp6(3),e.Q6J("ngIf",t.quantity>0&&!i.order.active)("ngIfElse",o)}}function xn(r,n){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"clr-radio-wrapper")(2,"input",20),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.cancelAll=i)})("ngModelChange",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.radioChanged())}),e.qZA(),e.TgZ(3,"label"),e._uU(4),e.ALo(5,"translate"),e.qZA()(),e.TgZ(6,"clr-radio-wrapper")(7,"input",20),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.cancelAll=i)})("ngModelChange",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.radioChanged())}),e.qZA(),e.TgZ(8,"label"),e._uU(9),e.ALo(10,"translate"),e.qZA()(),e.BQk()}if(2&r){const t=e.oxw();e.xp6(2),e.Q6J("value",!0)("ngModel",t.cancelAll),e.xp6(2),e.Oqu(e.lcZ(5,6,"order.cancel-entire-order")),e.xp6(3),e.Q6J("value",!1)("ngModel",t.cancelAll),e.xp6(2),e.Oqu(e.lcZ(10,8,"order.cancel-specified-items"))}}function Cn(r,n){1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.cancel-selected-items")," "))}function vn(r,n){1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.cancel-order")," "))}function yn(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"button",22),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.select())}),e.YNc(4,Cn,3,3,"ng-container",6),e.YNc(5,vn,3,3,"ng-container",6),e.qZA()}if(2&r){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,4,"common.cancel")),e.xp6(2),e.Q6J("disabled",!t.reason||!t.order.active&&0===t.selectionCount),e.xp6(1),e.Q6J("ngIf",!t.order.active),e.xp6(1),e.Q6J("ngIf",t.order.active)}}class We{get selectionCount(){return Object.values(this.lineQuantities).reduce((n,t)=>n+t,0)}constructor(n){this.i18nService=n,this.cancelAll=!0,this.lineQuantities={},this.reasons=(0,c.hq7)().cancellationReasons??[(0,u.J)("order.cancel-reason-customer-request"),(0,u.J)("order.cancel-reason-not-available")],this.reasons=this.reasons.map(t=>this.i18nService.translate(t))}ngOnInit(){this.lineQuantities=this.order.lines.reduce((n,t)=>({...n,[t.id]:t.quantity}),{})}radioChanged(){if(this.cancelAll)for(const n of this.order.lines)this.lineQuantities[n.id]=n.quantity;else for(const n of this.order.lines)this.lineQuantities[n.id]=0}checkIfAllSelected(){for(const[n,t]of Object.entries(this.lineQuantities)){const o=this.order.lines.find(i=>i.id===n)?.quantity;if(o&&t<o)return}this.cancelAll=!0}select(){this.resolveWith({orderId:this.order.id,lines:this.getLineInputs(),reason:this.reason,cancelShipping:this.cancelAll})}cancel(){this.resolveWith()}getLineInputs(){if(!this.order.active)return Object.entries(this.lineQuantities).map(([n,t])=>({orderLineId:n,quantity:t})).filter(n=>0<n.quantity)}}(H=We).\u0275fac=function(n){return new(n||H)(e.Y36(c.Dp7))},H.\u0275cmp=e.Xpm({type:H,selectors:[["vdr-cancel-order-dialog"]],decls:30,vars:23,consts:[["vdrDialogTitle",""],[1,"fulfillment-wrapper"],[1,"order-lines"],[1,"table"],["class","order-line",3,"is-disabled","is-cancelled",4,"ngFor","ngForOf"],[1,"cancellation-details"],[4,"ngIf"],[1,"clr-control-label"],["bindLabel","name","autofocus","","bindValue","id",3,"items","addTag","ngModel","ngModelChange"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[1,"align-middle","fulfil"],["type","number","min","0",3,"ngModel","disabled","max","ngModelChange","input",4,"ngIf","ngIfElse"],["nonEditable",""],["type","number","min","0",3,"ngModel","disabled","max","ngModelChange","input"],["type","radio","clrRadio","","name","options",3,"value","ngModel","ngModelChange"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(n,t){1&n&&(e.YNc(0,mn,2,3,"ng-template",0),e.TgZ(1,"div",1)(2,"div",2)(3,"table",3)(4,"thead")(5,"tr"),e._UZ(6,"th"),e.TgZ(7,"th"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"th"),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"th"),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"th"),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.TgZ(19,"th"),e._uU(20),e.ALo(21,"translate"),e.qZA()()(),e.YNc(22,hn,17,17,"tr",4),e.qZA()(),e.TgZ(23,"div",5),e.YNc(24,xn,11,10,"ng-container",6),e.TgZ(25,"label",7),e._uU(26),e.ALo(27,"translate"),e.qZA(),e.TgZ(28,"ng-select",8),e.NdJ("ngModelChange",function(i){return t.reason=i}),e.qZA()()(),e.YNc(29,yn,6,6,"ng-template",9)),2&n&&(e.xp6(8),e.Oqu(e.lcZ(9,11,"order.product-name")),e.xp6(3),e.Oqu(e.lcZ(12,13,"order.product-sku")),e.xp6(3),e.Oqu(e.lcZ(15,15,"order.quantity")),e.xp6(3),e.Oqu(e.lcZ(18,17,"order.unit-price")),e.xp6(3),e.Oqu(e.lcZ(21,19,"order.cancel")),e.xp6(2),e.Q6J("ngForOf",t.order.lines),e.xp6(2),e.Q6J("ngIf",!0!==t.order.active),e.xp6(2),e.Oqu(e.lcZ(27,21,"order.cancellation-reason")),e.xp6(2),e.Q6J("items",t.reasons)("addTag",!0)("ngModel",t.reason))},dependencies:[_.MgK,_.asN,_.EeQ,p.sg,p.O5,l.Fj,l.wV,l._,l.JJ,l.qQ,l.Fd,l.On,L.w9,x.y,Z.n,y.q,m.X$,D.M,h.k],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}.fulfillment-wrapper[_ngcontent-%COMP%]{flex:1}@media screen and (min-width: 768px){.fulfillment-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row}}@media screen and (min-width: 768px){.fulfillment-wrapper[_ngcontent-%COMP%]   .cancellation-details[_ngcontent-%COMP%]{margin-top:0;margin-inline-start:24px;width:250px}}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-lines[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-lines[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.fulfillment-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}.fulfillment-wrapper[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}.fulfillment-wrapper[_ngcontent-%COMP%]   .is-disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .fulfillment-wrapper[_ngcontent-%COMP%]   .is-disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}"],changeDetection:0});var G,N=d(7807),St=d(7625),Xe=d(590),Pt=d(24),g=d(4154),b=d(3044),Jt=d(6940),M=d(7017);function On(r,n){if(1&r&&(e.TgZ(0,"vdr-chip"),e._uU(1),e.qZA(),e._uU(2)),2&r){const t=n.item;e.xp6(1),e.Oqu(t.code),e.xp6(1),e.hij(" ",t.promotionName," ")}}const Zn=R.Ps`
    query GetCouponCodeSelectorPromotionList($options: PromotionListOptions) {
        promotions(options: $options) {
            items {
                id
                name
                couponCode
            }
            totalItems
        }
    }
`;class De{constructor(n){this.dataService=n,this.addCouponCode=new e.vpe,this.removeCouponCode=new e.vpe,this.couponCodeInput$=new N.x}ngOnInit(){this.availableCouponCodes$=(0,St.z)(this.couponCodeInput$.pipe((0,Xe.b)(200),(0,Pt.x)(),(0,g.w)(n=>this.dataService.query(c.RZZ,{options:{take:10,skip:0,filter:{couponCode:{contains:n}}}}).single$),(0,b.U)(({promotions:n})=>n.items.map(t=>({code:t.couponCode,promotionName:t.name}))),(0,Jt.O)([]))),this.control||(this.control=new l.p4(this.couponCodes??[]))}}(G=De).\u0275fac=function(n){return new(n||G)(e.Y36(c.DoR))},G.\u0275cmp=e.Xpm({type:G,selectors:[["vdr-coupon-code-selector"]],inputs:{couponCodes:"couponCodes",control:"control"},outputs:{addCouponCode:"addCouponCode",removeCouponCode:"removeCouponCode"},decls:3,vars:9,consts:[["appendTo","body","bindLabel","code","bindValue","code","typeToSearchText","",3,"items","addTag","multiple","hideSelected","minTermLength","typeahead","formControl","add","remove"],["ng-option-tmp",""]],template:function(n,t){1&n&&(e.TgZ(0,"ng-select",0),e.NdJ("add",function(i){return t.addCouponCode.emit(i.code)})("remove",function(i){return t.removeCouponCode.emit(null==i.value?null:i.value.code)}),e.ALo(1,"async"),e.YNc(2,On,3,2,"ng-template",1),e.qZA()),2&n&&e.Q6J("items",e.lcZ(1,7,t.availableCouponCodes$))("addTag",!1)("multiple",!0)("hideSelected",!0)("minTermLength",2)("typeahead",t.couponCodeInput$)("formControl",t.control)},dependencies:[l.JJ,l.oH,L.w9,L.ir,M.Y,p.Ov],changeDetection:0});var V,bn=d(9034),w=d(1452),Tn=d(7140),v=d(3176),K=d(1441),Ne=d(1635),Dt=d(6283),Nt=d(989),Qt=d(8760);function An(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.Oqu(e.lcZ(1,1,"order.select-address"))}function In(r,n){if(1&r&&(e.TgZ(0,"vdr-radio-card",7),e._UZ(1,"vdr-formatted-address",8),e.qZA()),2&r){const t=n.$implicit;e.Q6J("item",t),e.xp6(1),e.Q6J("address",t)}}function Ln(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"clr-tab-content")(1,"vdr-radio-card-fieldset",5),e.NdJ("selectItem",function(i){e.CHM(t);const a=e.oxw(3);return e.KtG(a.selectedAddress=i)}),e.YNc(2,In,2,2,"vdr-radio-card",6),e.qZA()()}if(2&r){const t=e.oxw(2).ngIf,o=e.oxw();e.xp6(1),e.Q6J("idFn",o.addressIdFn)("selectedItemId",o.selectedAddress&&o.addressIdFn(o.selectedAddress)),e.xp6(1),e.Q6J("ngForOf",t)}}function Mn(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"clr-tab")(1,"button",3),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,Ln,3,3,"ng-template",4),e.NdJ("clrIfActiveChange",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.useExisting=i)}),e.qZA()}if(2&r){const t=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,2,"order.existing-address")),e.xp6(2),e.Q6J("clrIfActive",t.useExisting)}}function wn(r,n){if(1&r&&(e.TgZ(0,"clr-tab-content"),e._UZ(1,"vdr-address-form",9),e.ALo(2,"async"),e.qZA()),2&r){const t=e.oxw(2);e.xp6(1),e.Q6J("formGroup",t.addressForm)("availableCountries",e.lcZ(2,2,t.availableCountries$))}}function Fn(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"clr-tabs"),e.YNc(1,Mn,5,4,"clr-tab",1),e.TgZ(2,"clr-tab")(3,"button",3),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.YNc(6,wn,3,4,"ng-template",4),e.NdJ("clrIfActiveChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.createNew=i)}),e.qZA()()}if(2&r){const t=n.ngIf,o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.customerId&&t.length),e.xp6(3),e.Oqu(e.lcZ(5,3,"customer.create-new-address")),e.xp6(2),e.Q6J("clrIfActive",o.createNew)}}function qn(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"button",11),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.select())}),e._uU(4),e.ALo(5,"translate"),e.qZA()}if(2&r){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,3,"common.cancel")),e.xp6(2),e.Q6J("disabled",t.useExisting&&!t.selectedAddress||t.createNew&&t.addressForm.invalid),e.xp6(1),e.hij(" ",e.lcZ(5,5,"common.okay")," ")}}class Qe{constructor(n,t){this.dataService=n,this.formBuilder=t,this.useExisting=!0,this.createNew=!1}ngOnInit(){this.addressForm=this.formBuilder.group({fullName:[this.currentAddress?.fullName??""],company:[this.currentAddress?.company??""],streetLine1:[this.currentAddress?.streetLine1??"",l.kI.required],streetLine2:[this.currentAddress?.streetLine2??""],city:[this.currentAddress?.city??"",l.kI.required],province:[this.currentAddress?.province??""],postalCode:[this.currentAddress?.postalCode??"",l.kI.required],countryCode:[this.currentAddress?.countryCode??"",l.kI.required],phoneNumber:[this.currentAddress?.phoneNumber??""]}),this.useExisting=!!this.customerId,this.addresses$=this.customerId?this.dataService.query(c.lii,{customerId:this.customerId}).mapSingle(({customer:n})=>n?.addresses??[]).pipe((0,K.b)(n=>{this.currentAddress&&(this.selectedAddress=n.find(t=>t.streetLine1===this.currentAddress?.streetLine1&&t.postalCode===this.currentAddress?.postalCode)),0===n.length&&(this.createNew=!0,this.useExisting=!1)})):(0,v.of)([]),this.availableCountries$=this.dataService.settings.getAvailableCountries().mapSingle(({countries:n})=>n.items)}trackByFn(n){return n.id}addressIdFn(n){return n.streetLine1+n.postalCode}cancel(){this.resolveWith()}select(){if(this.useExisting&&this.selectedAddress&&this.resolveWith({...(0,Tn.e)(this.selectedAddress,["fullName","company","streetLine1","streetLine2","city","province","phoneNumber","postalCode"]),countryCode:this.selectedAddress.country.code}),this.createNew&&this.addressForm.valid){const n=this.addressForm.value;this.resolveWith(n)}}}(V=Qe).\u0275fac=function(n){return new(n||V)(e.Y36(c.DoR),e.Y36(l.QS))},V.\u0275cmp=e.Xpm({type:V,selectors:[["vdr-select-address-dialog"]],decls:4,vars:3,consts:[["vdrDialogTitle",""],[4,"ngIf"],["vdrDialogButtons",""],["clrTabLink",""],[3,"clrIfActive","clrIfActiveChange"],[1,"block","mt-4",3,"idFn","selectedItemId","selectItem"],[3,"item",4,"ngFor","ngForOf"],[3,"item"],[3,"address"],[3,"formGroup","availableCountries"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(n,t){1&n&&(e.YNc(0,An,2,3,"ng-template",0),e.YNc(1,Fn,7,5,"clr-tabs",1),e.ALo(2,"async"),e.YNc(3,qn,6,7,"ng-template",2)),2&n&&(e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,t.addresses$)))},dependencies:[_.tam,_.UkA,_.S4y,_.gKI,_.Iq$,_.dl,_.Qs7,p.sg,p.O5,l.JL,l.sg,Z.n,y.q,Ne.b,Dt.C,Nt.C,Qt.m,p.Ov,m.X$],changeDetection:0});var B,Ut=d(5948);function Sn(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.Oqu(e.lcZ(1,1,"order.set-customer-for-order"))}function Pn(r,n){if(1&r&&(e.TgZ(0,"span",8),e._UZ(1,"clr-icon",9),e.TgZ(2,"span",10),e._uU(3),e.qZA(),e.TgZ(4,"vdr-chip"),e._uU(5),e.qZA()()),2&r){const t=n.item;e.xp6(3),e.AsE("",t.firstName," ",t.lastName,""),e.xp6(2),e.Oqu(t.emailAddress)}}function Jn(r,n){if(1&r&&(e.TgZ(0,"span",8),e._UZ(1,"clr-icon",9),e.TgZ(2,"span",10),e._uU(3),e.qZA(),e.TgZ(4,"vdr-chip"),e._uU(5),e.qZA()()),2&r){const t=n.item;e.xp6(3),e.AsE("",t.firstName," ",t.lastName,""),e.xp6(2),e.Oqu(t.emailAddress)}}function Dn(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"clr-tab-content")(1,"div",4)(2,"ng-select",5),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.selectedCustomer=i)}),e.ALo(3,"async"),e.YNc(4,Pn,6,3,"ng-template",6),e.YNc(5,Jn,6,3,"ng-template",7),e.qZA()()()}if(2&r){const t=e.oxw();e.xp6(2),e.Q6J("items",e.lcZ(3,9,t.customers$))("addTag",!1)("multiple",!0)("hideSelected",!0)("trackByFn",t.trackByFn)("minTermLength",2)("loading",t.isLoading)("typeahead",t.input$)("ngModel",t.selectedCustomer)}}function Nn(r,n){if(1&r&&(e.TgZ(0,"clr-tab-content")(1,"form",11)(2,"vdr-form-field",12),e.ALo(3,"translate"),e._UZ(4,"input",13),e.qZA(),e.TgZ(5,"vdr-form-field",14),e.ALo(6,"translate"),e._UZ(7,"input",15),e.qZA(),e.TgZ(8,"vdr-form-field",16),e.ALo(9,"translate"),e._UZ(10,"input",17),e.qZA(),e.TgZ(11,"vdr-form-field",18),e.ALo(12,"translate"),e._UZ(13,"input",19),e.qZA(),e.TgZ(14,"vdr-form-field",20),e.ALo(15,"translate"),e._UZ(16,"input",21),e.qZA()()()),2&r){const t=e.oxw();e.xp6(1),e.Q6J("formGroup",t.customerForm),e.xp6(1),e.Q6J("label",e.lcZ(3,6,"customer.title")),e.xp6(3),e.Q6J("label",e.lcZ(6,8,"customer.first-name")),e.xp6(3),e.Q6J("label",e.lcZ(9,10,"customer.last-name")),e.xp6(3),e.Q6J("label",e.lcZ(12,12,"customer.email-address")),e.xp6(3),e.Q6J("label",e.lcZ(15,14,"customer.phone-number"))}}function Qn(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"button",23),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.select())}),e._uU(4),e.ALo(5,"translate"),e.qZA()}if(2&r){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,3,"common.cancel")),e.xp6(2),e.Q6J("disabled",t.useExisting&&0===t.selectedCustomer.length||t.createNew&&t.customerForm.invalid),e.xp6(1),e.hij(" ",e.lcZ(5,5,"common.okay")," ")}}class ze{constructor(n,t){this.dataService=n,this.formBuilder=t,this.isLoading=!1,this.input$=new N.x,this.selectedCustomer=[],this.useExisting=!0,this.createNew=!1,this.customerForm=this.formBuilder.group({title:"",firstName:["",l.kI.required],lastName:["",l.kI.required],phoneNumber:"",emailAddress:["",[l.kI.required,l.kI.email]]})}ngOnInit(){this.customers$=(0,St.z)((0,v.of)([]),this.input$.pipe((0,Xe.b)(200),(0,Pt.x)(),(0,K.b)(()=>this.isLoading=!0),(0,g.w)(n=>this.dataService.customer.getCustomerList(10,0,n).mapStream(({customers:t})=>t.items).pipe((0,Ut.K)(()=>(0,v.of)([])),(0,K.b)(()=>this.isLoading=!1)))))}trackByFn(n){return n.id}cancel(){this.resolveWith()}select(){if(this.useExisting&&1===this.selectedCustomer.length&&this.resolveWith(this.selectedCustomer[0]),this.createNew&&this.customerForm.valid){const n=this.customerForm.value;this.resolveWith(n)}}}(B=ze).\u0275fac=function(n){return new(n||B)(e.Y36(c.DoR),e.Y36(l.QS))},B.\u0275cmp=e.Xpm({type:B,selectors:[["vdr-select-customer-dialog"]],decls:13,vars:8,consts:[["vdrDialogTitle",""],["clrTabLink",""],[3,"clrIfActive","clrIfActiveChange"],["vdrDialogButtons",""],[1,"mt-4"],["appendTo","body","bindLabel","name",3,"items","addTag","multiple","hideSelected","trackByFn","minTermLength","loading","typeahead","ngModel","ngModelChange"],["ng-label-tmp",""],["ng-option-tmp",""],[1,"item-row"],["shape","user",1,"is-solid"],[1,"mx-1"],[3,"formGroup"],["for","title",3,"label"],["id","title","type","text","formControlName","title"],["for","firstName",3,"label"],["id","firstName","type","text","formControlName","firstName"],["for","lastName",3,"label"],["id","lastName","type","text","formControlName","lastName"],["for","emailAddress",3,"label"],["id","emailAddress","type","text","formControlName","emailAddress"],["for","phoneNumber",3,"label"],["id","phoneNumber","type","text","formControlName","phoneNumber"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(n,t){1&n&&(e.YNc(0,Sn,2,3,"ng-template",0),e.TgZ(1,"clr-tabs")(2,"clr-tab")(3,"button",1),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.YNc(6,Dn,6,11,"ng-template",2),e.NdJ("clrIfActiveChange",function(i){return t.useExisting=i}),e.qZA(),e.TgZ(7,"clr-tab")(8,"button",1),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.YNc(11,Nn,17,16,"ng-template",2),e.NdJ("clrIfActiveChange",function(i){return t.createNew=i}),e.qZA()(),e.YNc(12,Qn,6,7,"ng-template",3)),2&n&&(e.xp6(4),e.Oqu(e.lcZ(5,4,"order.existing-customer")),e.xp6(2),e.Q6J("clrIfActive",t.useExisting),e.xp6(3),e.Oqu(e.lcZ(10,6,"customer.create-new-customer")),e.xp6(2),e.Q6J("clrIfActive",t.createNew))},dependencies:[_.qvL,_.tam,_.UkA,_.S4y,_.gKI,_.Iq$,_.dl,_.Qs7,l._Y,l.Fj,l.JJ,l.JL,l.On,l.sg,l.u,L.w9,L.ir,L.mR,M.Y,Je.h,x.y,Z.n,y.q,p.Ov,m.X$],styles:[".item-row[_ngcontent-%COMP%]{display:flex;align-items:center}"],changeDetection:0});var W,T=d(8679),Ue=d(1662);function Un(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.Oqu(e.lcZ(1,1,"order.select-shipping-method"))}function kn(r,n){if(1&r&&e._UZ(0,"vdr-object-tree",9),2&r){const t=e.oxw().$implicit;e.Q6J("value",t.metadata)}}function En(r,n){if(1&r&&(e.TgZ(0,"vdr-radio-card",4)(1,"div",5)(2,"vdr-labeled-data",6),e.ALo(3,"translate"),e._uU(4),e.qZA(),e.TgZ(5,"div",7)(6,"vdr-labeled-data",6),e.ALo(7,"translate"),e._uU(8),e.ALo(9,"localeCurrency"),e.qZA(),e.TgZ(10,"vdr-labeled-data",6),e.ALo(11,"translate"),e._uU(12),e.ALo(13,"localeCurrency"),e.qZA()(),e.YNc(14,kn,1,1,"vdr-object-tree",8),e.qZA()()),2&r){const t=n.$implicit,o=e.oxw();e.Q6J("item",t),e.xp6(2),e.Q6J("label",e.lcZ(3,8,"settings.shipping-method")),e.xp6(2),e.hij(" ",t.name," "),e.xp6(2),e.Q6J("label",e.lcZ(7,10,"common.price")),e.xp6(2),e.hij(" ",e.xi3(9,12,t.price,o.currencyCode)," "),e.xp6(2),e.Q6J("label",e.lcZ(11,15,"common.price-with-tax")),e.xp6(2),e.hij(" ",e.xi3(13,17,t.priceWithTax,o.currencyCode)," "),e.xp6(2),e.Q6J("ngIf",t.metadata)}}function Yn(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"button",11),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.select())}),e._uU(4),e.ALo(5,"translate"),e.qZA()}if(2&r){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,3,"common.cancel")),e.xp6(2),e.Q6J("disabled",!t.selectedMethod),e.xp6(1),e.hij(" ",e.lcZ(5,5,"common.okay")," ")}}class et{ngOnInit(){this.currentSelectionId&&(this.selectedMethod=this.eligibleShippingMethods.find(n=>n.id===this.currentSelectionId))}methodIdFn(n){return n.id}cancel(){this.resolveWith()}select(){this.selectedMethod&&this.resolveWith(this.selectedMethod.id)}}(W=et).\u0275fac=function(n){return new(n||W)},W.\u0275cmp=e.Xpm({type:W,selectors:[["vdr-select-shipping-method-dialog"]],decls:4,vars:3,consts:[["vdrDialogTitle",""],[3,"idFn","selectedItemId","selectItem"],[3,"item",4,"ngFor","ngForOf"],["vdrDialogButtons",""],[3,"item"],[1,"result-details"],[3,"label"],[1,"price-row"],[3,"value",4,"ngIf"],[3,"value"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(n,t){1&n&&(e.YNc(0,Un,2,3,"ng-template",0),e.TgZ(1,"vdr-radio-card-fieldset",1),e.NdJ("selectItem",function(i){return t.selectedMethod=i}),e.YNc(2,En,15,20,"vdr-radio-card",2),e.qZA(),e.YNc(3,Yn,6,7,"ng-template",3)),2&n&&(e.xp6(1),e.Q6J("idFn",t.methodIdFn)("selectedItemId",null==t.selectedMethod?null:t.selectedMethod.id),e.xp6(1),e.Q6J("ngForOf",t.eligibleShippingMethods))},dependencies:[p.sg,p.O5,Z.n,y.q,T.W,Ue._,Nt.C,Qt.m,m.X$,h.k],changeDetection:0});var F=d(2701),jn=d(6951),Rn=d(3729),kt=d(4718);var X,Hn=d(9249),q=d(295);function Gn(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.Oqu(e.lcZ(1,1,"order.select-state"))}function Kn(r,n){if(1&r&&(e.TgZ(0,"option",4),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"stateI18nToken"),e.qZA()),2&r){const t=n.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",e.lcZ(2,2,e.lcZ(3,4,t))," ")}}function Vn(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",7),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"common.cancel")," "))}const Bn=function(r){return{state:r}};function Wn(r,n){if(1&r){const t=e.EpF();e.YNc(0,Vn,3,3,"button",5),e.TgZ(1,"button",6),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.select())}),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"translate"),e.ALo(5,"stateI18nToken"),e.qZA()}if(2&r){const t=e.oxw();e.Q6J("ngIf",t.cancellable),e.xp6(1),e.Q6J("disabled",!t.selectedState),e.xp6(1),e.hij(" ",e.xi3(3,3,"order.transition-to-state",e.VKq(10,Bn,e.lcZ(4,6,e.lcZ(5,8,t.selectedState))))," ")}}class tt{constructor(){this.nextStates=[],this.message="",this.selectedState=""}select(){this.selectedState&&this.resolveWith(this.selectedState)}cancel(){this.resolveWith()}}var Q;(X=tt).\u0275fac=function(n){return new(n||X)},X.\u0275cmp=e.Xpm({type:X,selectors:[["vdr-order-state-select-dialog"]],decls:8,vars:5,consts:[["vdrDialogTitle",""],["name","state",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["vdrDialogButtons",""],[3,"value"],["type","submit","class","btn btn-secondary",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],["type","submit",1,"btn","btn-secondary",3,"click"]],template:function(n,t){1&n&&(e.YNc(0,Gn,2,3,"ng-template",0),e.TgZ(1,"p"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"vdr-form-field")(5,"select",1),e.NdJ("ngModelChange",function(i){return t.selectedState=i}),e.YNc(6,Kn,4,6,"option",2),e.qZA()(),e.YNc(7,Wn,6,12,"ng-template",3)),2&n&&(e.xp6(2),e.Oqu(e.lcZ(3,3,t.message)),e.xp6(3),e.Q6J("ngModel",t.selectedState),e.xp6(1),e.Q6J("ngForOf",t.nextStates))},dependencies:[p.sg,p.O5,l.YN,l.Kr,l.EJ,l.JJ,l.On,Je.h,x.y,Z.n,y.q,m.X$,q.N],changeDetection:0});class z{constructor(n,t,o,i){this.dataService=n,this.modalService=t,this.notificationService=o,this.i18nService=i}transitionToPreModifyingState(n,t){return this.getPreModifyingState(n).pipe((0,g.w)(o=>{const i={orderId:n,nextStates:t,message:this.i18nService.translate((0,u.J)("order.unable-to-transition-to-state-try-another"),{state:o}),cancellable:!1,retry:10};return o?this.transitionToStateOrThrow(n,o).pipe((0,Ut.K)(a=>this.manuallyTransitionToState(i))):this.manuallyTransitionToState(i)}))}manuallyTransitionToState(n){return this.modalService.fromComponent(tt,{locals:{nextStates:n.nextStates,cancellable:n.cancellable,message:n.message},closable:!1,size:"md"}).pipe((0,g.w)(t=>{if(t)return this.transitionToStateOrThrow(n.orderId,t);if(n.cancellable)return F.E;throw new Error("An order state must be selected")}),function $n(r){return(0,Rn.e)((n,t)=>{let o,a,i=!1;const s=()=>{o=n.subscribe((0,kt.x)(t,void 0,void 0,f=>{a||(a=new N.x,(0,jn.Xf)(r(a)).subscribe((0,kt.x)(t,()=>o?s():i=!0))),a&&a.next(f)})),i&&(o.unsubscribe(),o=null,i=!1,s())};s()})}(t=>t.pipe((0,Hn.g)(2e3),(0,w.q)(n.retry))))}getPreModifyingState(n){return this.dataService.order.getOrderHistory(n,{filter:{type:{eq:c.iYD.ORDER_STATE_TRANSITION}},sort:{createdAt:c.Asd.DESC}}).mapSingle(t=>t.order).pipe((0,b.U)(t=>{const o=t?.history.items.find(i=>"Modifying"===i.data.to);if(o)return o.data.from}))}transitionToStateOrThrow(n,t){return this.dataService.order.transitionToState(n,t).pipe((0,b.U)(({transitionOrderToState:o})=>{switch(o?.__typename){case"Order":return o?.state;case"OrderStateTransitionError":throw this.notificationService.error(o?.transitionError),new Error(o?.transitionError)}}))}}(Q=z).\u0275fac=function(n){return new(n||Q)(e.LFG(c.DoR),e.LFG(c.Z7U),e.LFG(c.gqp),e.LFG(c.Dp7))},Q.\u0275prov=e.Yz7({token:Q,factory:Q.\u0275fac,providedIn:"root"});var ne,O=d(8621),nt=d(9466),S=d(1343),P=d(2279),J=d(1921),ee=d(4043),te=d(5375),rt=d(7491),Et=d(7432),ke=d(3850),Yt=d(5276),jt=d(5655),Rt=d(9274),Ee=d(8923),ot=d(7836);function Xn(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.editable=!0)}),e._UZ(1,"clr-icon",10),e._uU(2),e.ALo(3,"translate"),e.qZA()}2&r&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"common.edit")," "))}function zn(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",11),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.onUpdateClick())}),e._UZ(1,"clr-icon",12),e._uU(2),e.ALo(3,"translate"),e.qZA()}if(2&r){const t=e.oxw(2);e.Q6J("disabled",t.customFieldForm.pristine||t.customFieldForm.invalid),e.xp6(2),e.hij(" ",e.lcZ(3,2,"common.update")," ")}}function er(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.onCancelClick())}),e._UZ(1,"clr-icon",13),e._uU(2),e.ALo(3,"translate"),e.qZA()}2&r&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"common.cancel")," "))}function tr(r,n){if(1&r&&(e.TgZ(0,"div",1)(1,"div",2),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",3)(5,"div",4),e._UZ(6,"vdr-tabbed-custom-fields",5),e.qZA()(),e.TgZ(7,"div",6),e.YNc(8,Xn,4,3,"button",7),e.YNc(9,zn,4,4,"button",8),e.YNc(10,er,4,3,"button",7),e.qZA()()),2&r){const t=e.oxw();e.xp6(2),e.hij(" ",e.lcZ(3,10,"common.custom-fields")," "),e.xp6(3),e.ekj("editable",t.editable),e.xp6(1),e.Q6J("customFields",t.customFieldsConfig)("customFieldsFormGroup",t.customFieldForm)("readonly",!t.editable)("compact",!0),e.xp6(2),e.Q6J("ngIf",!t.editable),e.xp6(1),e.Q6J("ngIf",t.editable),e.xp6(1),e.Q6J("ngIf",t.editable)}}class it{constructor(n,t){this.formBuilder=n,this.modalService=t,this.customFieldsConfig=[],this.customFieldValues={},this.updateClick=new e.vpe,this.editable=!1}ngOnInit(){this.customFieldForm=this.formBuilder.group({});for(const n of this.customFieldsConfig)this.customFieldForm.addControl(n.name,this.formBuilder.control(this.customFieldValues[n.name]))}onUpdateClick(){this.updateClick.emit(this.customFieldForm.value),this.customFieldForm.markAsPristine(),this.editable=!1}onCancelClick(){this.customFieldForm.dirty?this.modalService.dialog({title:(0,u.J)("catalog.confirm-cancel"),buttons:[{type:"secondary",label:(0,u.J)("common.keep-editing")},{type:"danger",label:(0,u.J)("common.discard-changes"),returnValue:!0}]}).subscribe(n=>{n&&(this.customFieldForm.reset(),this.customFieldForm.markAsPristine(),this.editable=!1)}):this.editable=!1}}(ne=it).\u0275fac=function(n){return new(n||ne)(e.Y36(l.QS),e.Y36(c.Z7U))},ne.\u0275cmp=e.Xpm({type:ne,selectors:[["vdr-order-custom-fields-card"]],inputs:{customFieldsConfig:"customFieldsConfig",customFieldValues:"customFieldValues"},outputs:{updateClick:"updateClick"},decls:1,vars:1,consts:[["class","card",4,"ngIf"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"card-text","custom-field-form"],["entityName","Order",3,"customFields","customFieldsFormGroup","readonly","compact"],[1,"card-footer"],["class","btn btn-sm btn-secondary",3,"click",4,"ngIf"],["class","btn btn-sm btn-primary",3,"disabled","click",4,"ngIf"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","pencil"],[1,"btn","btn-sm","btn-primary",3,"disabled","click"],["shape","check"],["shape","times"]],template:function(n,t){1&n&&e.YNc(0,tr,11,12,"div",0),2&n&&e.Q6J("ngIf",t.customFieldsConfig.length)},dependencies:[_.qvL,p.O5,ot.y,m.X$],styles:["vdr-custom-field-control[_ngcontent-%COMP%]{margin-bottom:6px;display:block}.custom-field-form[_ngcontent-%COMP%]     .clr-control-label{color:var(--color-grey-400)}.custom-field-form.editable[_ngcontent-%COMP%]     .clr-control-label{color:inherit}"],changeDetection:0});var re,C=d(4285),$t=d(2249),Ht=d(419),A=d(4415),Ye=d(2388);function nr(r,n){1&r&&e._UZ(0,"clr-icon",9)}function rr(r,n){1&r&&e._UZ(0,"clr-icon",10)}function or(r,n){1&r&&e._UZ(0,"clr-icon",11)}function ir(r,n){1&r&&(e.TgZ(0,"label",12),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.line-fulfillment-all")," "))}const ar=function(r,n){return{total:r,count:n}};function lr(r,n){if(1&r&&(e.TgZ(0,"label",12),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r){const t=e.oxw(2);e.xp6(1),e.hij(" ",e.xi3(2,1,"order.line-fulfillment-partial",e.WLB(4,ar,t.line.quantity,t.fulfilledCount))," ")}}function cr(r,n){1&r&&(e.TgZ(0,"label",12),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.line-fulfillment-none")," "))}function dr(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",15),e.ALo(1,"translate"),e._uU(2),e.qZA()),2&r){const t=e.oxw().$implicit;e.Q6J("label",e.lcZ(1,2,"order.tracking-code")),e.xp6(2),e.hij(" ",t.fulfillment.trackingCode," ")}}const sr=function(r){return{count:r}};function pr(r,n){if(1&r&&(e.TgZ(0,"div",13)(1,"div",14),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"vdr-labeled-data",15),e.ALo(6,"translate"),e._uU(7),e.ALo(8,"localeDate"),e.qZA(),e.TgZ(9,"vdr-labeled-data",15),e.ALo(10,"translate"),e._uU(11),e.qZA(),e.YNc(12,dr,3,4,"vdr-labeled-data",16),e.qZA()),2&r){const t=n.$implicit;e.xp6(2),e.lnq(" ",e.lcZ(3,8,"order.fulfillment")," #",t.fulfillment.id," (",e.xi3(4,10,"order.item-count",e.VKq(20,sr,t.count)),") "),e.xp6(3),e.Q6J("label",e.lcZ(6,13,"common.created-at")),e.xp6(2),e.hij(" ",e.xi3(8,15,t.fulfillment.createdAt,"medium")," "),e.xp6(2),e.Q6J("label",e.lcZ(10,18,"order.fulfillment-method")),e.xp6(2),e.hij(" ",t.fulfillment.method," "),e.xp6(1),e.Q6J("ngIf",t.fulfillment.trackingCode)}}function _r(r,n){if(1&r&&(e.TgZ(0,"vdr-dropdown",1)(1,"button",2),e.YNc(2,nr,1,0,"clr-icon",3),e.YNc(3,rr,1,0,"clr-icon",4),e.YNc(4,or,1,0,"clr-icon",5),e.qZA(),e.TgZ(5,"vdr-dropdown-menu",6),e.YNc(6,ir,3,3,"label",7),e.YNc(7,lr,3,7,"label",7),e.YNc(8,cr,3,3,"label",7),e.YNc(9,pr,13,22,"div",8),e.qZA()()),2&r){const t=e.oxw();e.xp6(2),e.Q6J("ngIf","full"===t.fulfillmentStatus),e.xp6(1),e.Q6J("ngIf","partial"===t.fulfillmentStatus),e.xp6(1),e.Q6J("ngIf","none"===t.fulfillmentStatus),e.xp6(2),e.Q6J("ngIf","full"===t.fulfillmentStatus),e.xp6(1),e.Q6J("ngIf","partial"===t.fulfillmentStatus),e.xp6(1),e.Q6J("ngIf","none"===t.fulfillmentStatus),e.xp6(1),e.Q6J("ngForOf",t.fulfillments)}}class je{constructor(){this.fulfilledCount=0,this.fulfillments=[]}ngOnChanges(n){this.line&&(this.fulfilledCount=this.getDeliveredCount(this.line),this.fulfillmentStatus=this.getFulfillmentStatus(this.fulfilledCount,this.line.quantity),this.fulfillments=this.getFulfillments(this.line))}getDeliveredCount(n){return n.fulfillmentLines?.reduce((t,o)=>t+o.quantity,0)??0}getFulfillmentStatus(n,t){return n===t?"full":0<n&&n<t?"partial":"none"}getFulfillments(n){return n.fulfillmentLines?.map(t=>{const o=this.allOrderFulfillments?.find(i=>i.id===t.fulfillmentId);if(o)return{count:t.quantity,fulfillment:o}}).filter(A.notNullOrUndefined)??[]}}(re=je).\u0275fac=function(n){return new(n||re)},re.\u0275cmp=e.Xpm({type:re,selectors:[["vdr-line-fulfillment"]],inputs:{line:"line",allOrderFulfillments:"allOrderFulfillments",orderState:"orderState"},features:[e.TTD],decls:1,vars:1,consts:[["class","search-settings-menu",4,"ngIf"],[1,"search-settings-menu"],["type","button","vdrDropdownTrigger","",1,"icon-button"],["class","item-fulfilled","shape","check-circle",4,"ngIf"],["class","item-partially-fulfilled","shape","check-circle",4,"ngIf"],["class","item-not-fulfilled","shape","exclamation-circle",4,"ngIf"],["vdrPosition","bottom-right"],["class","dropdown-header",4,"ngIf"],["class","fulfillment-detail",4,"ngFor","ngForOf"],["shape","check-circle",1,"item-fulfilled"],["shape","check-circle",1,"item-partially-fulfilled"],["shape","exclamation-circle",1,"item-not-fulfilled"],[1,"dropdown-header"],[1,"fulfillment-detail"],[1,"fulfillment-title"],[3,"label"],[3,"label",4,"ngIf"]],template:function(n,t){1&n&&e.YNc(0,_r,10,7,"vdr-dropdown",0),2&n&&e.Q6J("ngIf",t.fulfilledCount||"PartiallyDelivered"===t.orderState)},dependencies:[_.qvL,_.MgK,p.sg,p.O5,S.J,P.N,J.U,T.W,m.X$,Ye.H],styles:[".item-fulfilled[_ngcontent-%COMP%]{color:var(--color-success-700)}.item-partially-fulfilled[_ngcontent-%COMP%]{color:var(--color-warning-700)}.item-not-fulfilled[_ngcontent-%COMP%]{color:var(--color-error-700)}.fulfillment-detail[_ngcontent-%COMP%]{margin:6px 12px}.fulfillment-detail[_ngcontent-%COMP%]:not(:last-of-type){border-bottom:1px dashed var(--color-component-border-200)}"],changeDetection:0});var oe,Gt=d(5425);const ur=function(r){return{count:r}};function mr(r,n){if(1&r&&(e.TgZ(0,"span",1),e.ALo(1,"translate"),e._UZ(2,"clr-icon",2),e.qZA()),2&r){const t=e.oxw();e.Q6J("title",e.xi3(1,1,"order.refunded-count",e.VKq(4,ur,t.getRefundedCount())))}}class ie{getRefundedCount(){return(this.payments?.reduce((t,o)=>[...t,...o.refunds],[]).filter(t=>"Failed"!==t.state).reduce((t,o)=>[...t,...o.lines],[])??[]).filter(t=>t.orderLineId===this.line.id).reduce((t,o)=>t+o.quantity,0)}}var U;(oe=ie).\u0275fac=function(n){return new(n||oe)},oe.\u0275cmp=e.Xpm({type:oe,selectors:[["vdr-line-refunds"]],inputs:{line:"line",payments:"payments"},decls:1,vars:1,consts:[[3,"title",4,"ngIf"],[3,"title"],["shape","redo","dir","down",1,"is-solid"]],template:function(n,t){1&n&&e.YNc(0,mr,3,6,"span",0),2&n&&e.Q6J("ngIf",t.getRefundedCount())},dependencies:[_.qvL,p.O5,Gt.Lv,m.X$],styles:["[_nghost-%COMP%]{color:var(--color-error-500)}"],changeDetection:0});class Re extends c.Up6{constructor(){super(...arguments),this.orderable=!1}}(U=Re).\u0275fac=function(){let r;return function(t){return(r||(r=e.n5z(U)))(t||U)}}(),U.\u0275cmp=e.Xpm({type:U,selectors:[["vdr-order-total-column"]],exportAs:["row"],features:[e.qOj],decls:0,vars:0,template:function(n,t){},encapsulation:2});var k,gr=d(6035),fr=d(3517),hr=d(2136),xr=d(6346),Cr=d(2977);function vr(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"th",18)(1,"input",19),e.NdJ("change",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onToggleAllClick())}),e.qZA()()}if(2&r){const t=e.oxw();e.xp6(1),e.Q6J("checked",null==t.selectionManager?null:t.selectionManager.areAllCurrentItemsSelected())}}function yr(r,n){1&r&&e._UZ(0,"clr-icon",29)}function Or(r,n){1&r&&e._UZ(0,"clr-icon",30)}function Zr(r,n){1&r&&e._UZ(0,"clr-icon",31)}function br(r,n){if(1&r&&(e.TgZ(0,"div",32),e._uU(1),e.qZA()),2&r){const t=e.oxw().ngIf;e.xp6(1),e.Oqu(t.sortOrder)}}function Tr(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div",23)(1,"button",24),e.NdJ("click",function(){const a=e.CHM(t).ngIf;return e.KtG(a.toggleSortOrder())}),e.YNc(2,yr,1,0,"clr-icon",25),e.YNc(3,Or,1,0,"clr-icon",26),e.YNc(4,Zr,1,0,"clr-icon",27),e.qZA(),e.YNc(5,br,2,1,"div",28),e.qZA()}if(2&r){const t=n.ngIf;e.xp6(1),e.ekj("active",t.sortOrder),e.xp6(1),e.Q6J("ngIf",!t.sortOrder),e.xp6(1),e.Q6J("ngIf","ASC"===t.sortOrder),e.xp6(1),e.Q6J("ngIf","DESC"===t.sortOrder),e.xp6(1),e.Q6J("ngIf",t.sortOrder)}}function Ar(r,n){if(1&r&&(e.TgZ(0,"th")(1,"div",20)(2,"vdr-ui-extension-point",21)(3,"span"),e._uU(4),e.qZA()(),e.YNc(5,Tr,6,6,"div",22),e.qZA()()),2&r){const t=n.$implicit,o=e.oxw();e.ekj("expand",t.expand),e.xp6(1),e.Q6J("ngClass",t.align),e.xp6(1),e.Q6J("locationId",o.id)("metadata",t.id)("topPx",-6)("leftPx",-24),e.xp6(2),e.Oqu(t.heading),e.xp6(1),e.Q6J("ngIf",t.sort)}}function Ir(r,n){1&r&&e.GkF(0)}function Lr(r,n){1&r&&e.GkF(0)}function Mr(r,n){if(1&r&&e._UZ(0,"vdr-data-table-filters",41),2&r){const t=n.$implicit,o=e.oxw(3);e.Q6J("filterWithValue",t)("filters",o.filters)}}function wr(r,n){if(1&r&&e._UZ(0,"vdr-data-table-filters",42),2&r){const t=e.oxw(3);e.Q6J("filters",t.filters)}}function Fr(r,n){if(1&r&&(e.ynx(0),e.TgZ(1,"div",38),e.YNc(2,Mr,1,2,"vdr-data-table-filters",39),e.YNc(3,wr,1,1,"vdr-data-table-filters",40),e.qZA(),e.BQk()),2&r){const t=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",t.filters.activeFilters),e.xp6(1),e.Q6J("ngIf",t.filters.length)}}function qr(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"tr")(1,"th",33)(2,"button",34),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.toggleSearchFilterRow())}),e.ALo(3,"translate"),e._UZ(4,"clr-icon",35),e.qZA(),e.TgZ(5,"div",36),e.YNc(6,Ir,1,0,"ng-container",37),e.YNc(7,Lr,1,0,"ng-container",37),e.YNc(8,Fr,4,2,"ng-container",8),e.qZA()()()}if(2&r){const t=e.oxw();e.xp6(1),e.ekj("active",t.showSearchFilterRow),e.uIk("colspan",t.visibleSortedColumns.length+(t.selectionManager?2:1)),e.xp6(1),e.ekj("active",t.showSearchFilterRow),e.Q6J("title",e.lcZ(3,11,"common.search-and-filter-list")),e.xp6(3),e.ekj("hidden",!t.showSearchFilterRow),e.xp6(1),e.Q6J("ngTemplateOutlet",null==t.searchComponent?null:t.searchComponent.template),e.xp6(1),e.Q6J("ngTemplateOutlet",t.customSearchTemplate),e.xp6(1),e.Q6J("ngIf",t.filters)}}function Sr(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"td",18)(1,"input",45),e.NdJ("click",function(i){e.CHM(t);const a=e.oxw().$implicit,s=e.oxw();return e.KtG(s.onRowClick(a,i))}),e.qZA()()}if(2&r){const t=e.oxw(),o=t.index,i=t.$implicit,a=e.oxw();e.ekj("active",a.activeIndex===o),e.xp6(1),e.Q6J("checked",null==a.selectionManager?null:a.selectionManager.isSelected(i))}}function Pr(r,n){1&r&&e.GkF(0)}const Jr=function(r){return{rowItem:r}};function Dr(r,n){if(1&r&&(e.ynx(0),e.YNc(1,Pr,1,0,"ng-container",48),e.BQk()),2&r){const t=n.ngIf,o=e.oxw(2).$implicit;e.xp6(1),e.Q6J("ngComponentOutlet",t.config.component)("ngComponentOutletInputs",e.VKq(3,Jr,o))("ngComponentOutletInjector",t.injector)}}function Nr(r,n){1&r&&e.GkF(0)}const Qr=function(r,n){return{item:r,index:n}};function Ur(r,n){if(1&r&&e.YNc(0,Nr,1,0,"ng-container",49),2&r){const t=e.oxw().$implicit,o=e.oxw(),i=o.$implicit,a=o.index;e.Q6J("ngTemplateOutlet",t.template)("ngTemplateOutletContext",e.WLB(2,Qr,i,a))}}function kr(r,n){if(1&r&&(e.TgZ(0,"td")(1,"div",20),e.YNc(2,Dr,2,5,"ng-container",46),e.YNc(3,Ur,1,5,"ng-template",null,47,e.W1O),e.qZA()()),2&r){const t=n.$implicit,o=e.MAs(4),i=e.oxw().index,a=e.oxw();e.ekj("active",a.activeIndex===i),e.xp6(1),e.Q6J("ngClass",t.align),e.xp6(1),e.Q6J("ngIf",a.customComponents.get(t.id))("ngIfElse",o)}}function Er(r,n){if(1&r&&(e.TgZ(0,"tr"),e.YNc(1,Sr,2,3,"td",43),e.YNc(2,kr,5,5,"td",44),e._UZ(3,"td"),e.qZA()),2&r){const t=n.index,o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.selectionManager),e.xp6(1),e.Q6J("ngForOf",o.visibleSortedColumns),e.xp6(1),e.ekj("active",o.activeIndex===t)}}function Yr(r,n){if(1&r&&(e.TgZ(0,"tr")(1,"td"),e._UZ(2,"vdr-empty-placeholder",50),e.ALo(3,"translate"),e.qZA()()),2&r){const t=e.oxw();e.xp6(1),e.uIk("colspan",t.visibleSortedColumns.length+(t.selectionManager?2:1)),e.xp6(1),e.Q6J("emptyStateLabel",e.lcZ(3,2,"order.order-is-empty"))}}function jr(r,n){if(1&r&&(e.TgZ(0,"tr",51)(1,"td",52),e._uU(2),e.qZA(),e.TgZ(3,"td",53),e._uU(4),e.qZA(),e._UZ(5,"td",54),e.TgZ(6,"td",55),e._uU(7),e.ALo(8,"localeCurrency"),e.TgZ(9,"div",14),e.ALo(10,"translate"),e._uU(11),e.ALo(12,"localeCurrency"),e.qZA()(),e._UZ(13,"td"),e.qZA()),2&r){const t=n.$implicit,o=e.oxw();e.xp6(2),e.Oqu(t.description),e.xp6(2),e.Oqu(t.sku),e.xp6(1),e.uIk("colspan",o.visibleSortedColumns.length-4),e.xp6(2),e.hij(" ",e.xi3(8,6,t.priceWithTax,o.order.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(10,9,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(12,11,t.price,o.order.currencyCode)," ")}}function Rr(r,n){if(1&r&&(e.TgZ(0,"vdr-chip"),e._uU(1),e.qZA()),2&r){const t=n.ngIf;e.xp6(1),e.Oqu(t)}}function $r(r,n){if(1&r&&(e.TgZ(0,"tr",57)(1,"td",2)(2,"a",58),e._uU(3),e.qZA(),e.YNc(4,Rr,2,1,"vdr-chip",8),e.qZA(),e.TgZ(5,"td",2),e._uU(6),e.ALo(7,"localeCurrency"),e.TgZ(8,"div",14),e.ALo(9,"translate"),e._uU(10),e.ALo(11,"localeCurrency"),e.qZA()(),e._UZ(12,"td"),e.qZA()),2&r){const t=e.oxw().$implicit,o=e.oxw();e.xp6(1),e.uIk("colspan",o.visibleSortedColumns.length-1),e.xp6(1),e.Q6J("routerLink",o.getPromotionLink(t)),e.xp6(1),e.Oqu(t.description),e.xp6(1),e.Q6J("ngIf",o.getCouponCodeForAdjustment(o.order,t)),e.xp6(2),e.hij(" ",e.xi3(7,7,t.amountWithTax,o.order.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(9,10,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(11,12,t.amount,o.order.currencyCode)," ")}}function Hr(r,n){if(1&r&&(e.ynx(0),e.YNc(1,$r,13,15,"tr",56),e.BQk()),2&r){const t=n.$implicit;e.xp6(1),e.Q6J("ngIf","OTHER"!==t.type)}}function Gr(r,n){if(1&r&&(e.TgZ(0,"vdr-chip",59),e._uU(1),e.qZA()),2&r){const t=n.$implicit;e.xp6(1),e.hij(" ",t.shippingMethod.name," ")}}const Kr=[[["vdr-bulk-action-menu"]]],Vr=function(r,n,t,o){return{id:r,itemsPerPage:n,currentPage:t,totalItems:o}};class at extends c.eJ5{get allColumns(){return[...this.columns??[],...this.customFieldColumns??[],...this.totalColumns??[]]}get sortedColumns(){const n=this.allColumns,t=this.getDataTableConfig();for(const[o,i]of Object.entries(t[this.id].order)){const a=n.find(f=>f.id===o),s=n.findIndex(f=>f.id===o);-1!==s&&a&&(n.splice(s,1),n.splice(i,0,a))}return n}getPromotionLink(n){return["/marketing","promotions",n.adjustmentSource.split(":")[1]]}getCouponCodeForAdjustment(n,t){const o=t.adjustmentSource.split(":")[1],i=n.promotions.find(a=>a.id===o);if(i)return i.couponCode||void 0}getShippingNames(n){return n.shippingLines.length?n.shippingLines.map(t=>t.shippingMethod.name).join(", "):""}}var ae;function Wr(r,n){if(1&r&&(e._UZ(0,"img",11),e.ALo(1,"assetPreview")),2&r){const t=n.ngIf;e.Q6J("src",e.xi3(1,1,t,"tiny"),e.LSH)}}function Xr(r,n){1&r&&(e.TgZ(0,"div",12),e._UZ(1,"clr-icon",13),e.qZA())}function zr(r,n){if(1&r&&(e.TgZ(0,"div",8),e.YNc(1,Wr,2,4,"img",9),e.YNc(2,Xr,2,0,"ng-template",null,10,e.W1O),e.qZA()),2&r){const t=n.item,o=e.MAs(3);e.xp6(1),e.Q6J("ngIf",t.featuredAsset)("ngIfElse",o)}}function eo(r,n){if(1&r&&e._uU(0),2&r){const t=n.item;e.hij(" ",t.productVariant.name," ")}}function to(r,n){if(1&r&&e._uU(0),2&r){const t=n.item;e.hij(" ",t.productVariant.sku," ")}}function no(r,n){if(1&r&&(e.TgZ(0,"div",14),e._uU(1),e.ALo(2,"localeCurrency"),e.TgZ(3,"div",15),e.ALo(4,"translate"),e._uU(5),e.ALo(6,"localeCurrency"),e.qZA()()),2&r){const t=n.item,o=e.oxw();e.xp6(1),e.hij(" ",e.xi3(2,3,t.unitPriceWithTax,o.order.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(4,6,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(6,8,t.unitPrice,o.order.currencyCode)," ")}}function ro(r,n){if(1&r&&(e.TgZ(0,"div",22),e.ALo(1,"translate"),e._uU(2),e.qZA()),2&r){const t=e.oxw(2).item;e.Q6J("title",e.lcZ(1,2,"order.original-quantity-at-checkout")),e.xp6(2),e.hij(" ",t.orderPlacedQuantity," ")}}function oo(r,n){if(1&r&&(e.ynx(0),e.TgZ(1,"div",20),e.YNc(2,ro,3,4,"div",21),e.TgZ(3,"div"),e._uU(4),e.qZA()(),e.BQk()),2&r){const t=e.oxw().item;e.xp6(2),e.Q6J("ngIf",t.orderPlacedQuantity&&t.quantity!==t.orderPlacedQuantity),e.xp6(2),e.Oqu(t.quantity)}}function io(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div",20)(1,"input",23,24),e.NdJ("blur",function(){e.CHM(t);const i=e.MAs(2),a=e.oxw().item,s=e.oxw();return e.KtG(s.draftInputBlur(a,i.valueAsNumber))}),e.qZA(),e.TgZ(3,"button",25),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().item,a=e.oxw();return e.KtG(a.remove.emit({lineId:i.id}))}),e._UZ(4,"clr-icon",26),e.qZA()()}if(2&r){const t=e.oxw().item;e.xp6(1),e.Q6J("value",t.quantity)}}function ao(r,n){if(1&r&&(e.YNc(0,oo,5,2,"ng-container",16),e.YNc(1,io,5,1,"ng-template",null,17,e.W1O),e._UZ(3,"vdr-line-refunds",18)(4,"vdr-line-fulfillment",19)),2&r){const t=n.item,o=e.MAs(2),i=e.oxw();e.Q6J("ngIf",!i.isDraft)("ngIfElse",o),e.xp6(3),e.Q6J("line",t)("payments",i.order.payments),e.xp6(1),e.Q6J("line",t)("orderState",i.order.state)("allOrderFulfillments",i.order.fulfillments)}}function lo(r,n){if(1&r&&e._UZ(0,"vdr-dt2-custom-field-column",27),2&r){const t=n.$implicit;e.Q6J("customField",t)}}function co(r,n){if(1&r&&(e.TgZ(0,"div",31)(1,"a",32),e._uU(2),e.qZA(),e.TgZ(3,"div",33),e._uU(4),e.ALo(5,"localeCurrency"),e.TgZ(6,"div",15),e.ALo(7,"translate"),e._uU(8),e.ALo(9,"localeCurrency"),e.qZA()()()),2&r){const t=n.$implicit,o=e.oxw(4);e.xp6(1),e.Q6J("routerLink",o.getPromotionLink(t)),e.xp6(1),e.Oqu(t.description),e.xp6(2),e.hij(" ",e.xi3(5,5,t.amountWithTax,o.order.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(7,8,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(9,10,t.amount,o.order.currencyCode)," ")}}function so(r,n){if(1&r&&(e.TgZ(0,"vdr-dropdown")(1,"div",29),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"vdr-dropdown-menu"),e.YNc(5,co,10,13,"div",30),e.qZA()()),2&r){const t=e.oxw().ngIf;e.xp6(2),e.hij(" ",e.lcZ(3,2,"order.promotions-applied")," "),e.xp6(3),e.Q6J("ngForOf",t)}}function po(r,n){if(1&r&&(e.ynx(0),e.YNc(1,so,6,4,"vdr-dropdown",28),e.BQk()),2&r){const t=n.ngIf;e.xp6(1),e.Q6J("ngIf",t.length)}}function _o(r,n){if(1&r&&(e.TgZ(0,"div",14),e._uU(1),e.ALo(2,"localeCurrency"),e.TgZ(3,"div",15),e.ALo(4,"translate"),e._uU(5),e.ALo(6,"localeCurrency"),e.qZA()(),e.YNc(7,po,2,1,"ng-container",28)),2&r){const t=n.item,o=e.oxw();e.xp6(1),e.hij(" ",e.xi3(2,4,t.linePriceWithTax,o.order.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(4,7,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(6,9,t.linePrice,o.order.currencyCode)," "),e.xp6(2),e.Q6J("ngIf",o.getLineDiscounts(t))}}(k=at).\u0275fac=function(){let r;return function(t){return(r||(r=e.n5z(k)))(t||k)}}(),k.\u0275cmp=e.Xpm({type:k,selectors:[["vdr-order-data-table"]],contentQueries:function(n,t,o){if(1&n&&e.Suo(o,Re,4),2&n){let i;e.iGM(i=e.CRH())&&(t.totalColumns=i)}},inputs:{order:"order"},features:[e.qOj],ngContentSelectors:["vdr-bulk-action-menu"],decls:60,vars:70,consts:[[1,"bulk-actions"],[1,"table-wrapper"],[1,""],[1,"heading-row"],["class","selection-col",4,"ngIf"],[3,"expand",4,"ngFor","ngForOf"],[1,"column-picker"],[3,"uiLanguage","columns","reorder","resetColumns"],[4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],["class","surcharge",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"sub-total"],[1,"clr-align-middle"],[1,"net-price",3,"title"],[1,"shipping"],["class","shipping-method-name",4,"ngFor","ngForOf"],[1,"total"],[1,"selection-col"],["type","checkbox","clrCheckbox","",3,"checked","change"],[1,"cell-content",3,"ngClass"],["api","dataTable","display","block",3,"locationId","metadata","topPx","leftPx"],["class","sort-toggle",4,"ngIf"],[1,"sort-toggle"],[3,"click"],["shape","two-way-arrows left",4,"ngIf"],["shape","arrow up",4,"ngIf"],["shape","arrow down",4,"ngIf"],["class","sort-label",4,"ngIf"],["shape","two-way-arrows left"],["shape","arrow up"],["shape","arrow down"],[1,"sort-label"],[1,"filter-row"],[1,"button-ghost","toggle-search-filter-row",3,"title","click"],["shape","search"],[1,"filter-row-wrapper"],[4,"ngTemplateOutlet"],[1,"filters"],["class","mt-1",3,"filterWithValue","filters",4,"ngFor","ngForOf"],["class","mt-1",3,"filters",4,"ngIf"],[1,"mt-1",3,"filterWithValue","filters"],[1,"mt-1",3,"filters"],["class","selection-col",3,"active",4,"ngIf"],[3,"active",4,"ngFor","ngForOf"],["type","checkbox","clrCheckbox","",3,"checked","click"],[4,"ngIf","ngIfElse"],["defaultComponent",""],[4,"ngComponentOutlet","ngComponentOutletInputs","ngComponentOutletInjector"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"emptyStateLabel"],[1,"surcharge"],["colspan","2",1,"align-middle","name","left"],[1,"align-middle","sku"],[1,"align-middle"],[1,"align-middle","total"],["class","order-adjustment",4,"ngIf"],[1,"order-adjustment"],[3,"routerLink"],[1,"shipping-method-name"]],template:function(n,t){1&n&&(e.F$t(Kr),e.TgZ(0,"div",0),e.Hsn(1),e.qZA(),e.TgZ(2,"div",1)(3,"table",2)(4,"thead")(5,"tr",3),e.YNc(6,vr,2,1,"th",4),e.YNc(7,Ar,6,9,"th",5),e.TgZ(8,"th")(9,"div",6)(10,"vdr-data-table-colum-picker",7),e.NdJ("reorder",function(i){return t.onColumnReorder(i)})("resetColumns",function(){return t.onColumnsReset()}),e.ALo(11,"async"),e.qZA()()()(),e.YNc(12,qr,9,13,"tr",8),e.qZA(),e.TgZ(13,"tbody"),e.YNc(14,Er,4,4,"tr",9),e.ALo(15,"paginate"),e.ynx(16),e.YNc(17,Yr,4,4,"tr",8),e.BQk(),e.YNc(18,jr,14,14,"tr",10),e.YNc(19,Hr,2,1,"ng-container",11),e.TgZ(20,"tr",12)(21,"td",2),e._uU(22),e.ALo(23,"translate"),e.qZA(),e._UZ(24,"td"),e.TgZ(25,"td",13),e._uU(26),e.ALo(27,"localeCurrency"),e.TgZ(28,"div",14),e.ALo(29,"translate"),e._uU(30),e.ALo(31,"localeCurrency"),e.qZA()(),e._UZ(32,"td"),e.qZA(),e.TgZ(33,"tr",15)(34,"td",2),e._uU(35),e.ALo(36,"translate"),e.qZA(),e.TgZ(37,"td"),e.YNc(38,Gr,2,1,"vdr-chip",16),e.qZA(),e.TgZ(39,"td",13),e._uU(40),e.ALo(41,"localeCurrency"),e.TgZ(42,"div",14),e.ALo(43,"translate"),e._uU(44),e.ALo(45,"localeCurrency"),e.qZA()(),e._UZ(46,"td"),e.qZA(),e.TgZ(47,"tr",17)(48,"td",2),e._uU(49),e.ALo(50,"translate"),e.qZA(),e._UZ(51,"td"),e.TgZ(52,"td",13),e._uU(53),e.ALo(54,"localeCurrency"),e.TgZ(55,"div",14),e.ALo(56,"translate"),e._uU(57),e.ALo(58,"localeCurrency"),e.qZA()(),e._UZ(59,"td"),e.qZA()()()()),2&n&&(e.xp6(3),e.ekj("no-select",t.disableSelect),e.xp6(1),e.ekj("items-selected",null==t.selectionManager?null:t.selectionManager.selection.length),e.xp6(2),e.Q6J("ngIf",t.selectionManager),e.xp6(1),e.Q6J("ngForOf",t.visibleSortedColumns),e.xp6(3),e.Q6J("uiLanguage",e.lcZ(11,30,t.uiLanguage$))("columns",t.sortedColumns),e.xp6(2),e.Q6J("ngIf",t.searchComponent||t.customSearchTemplate||(null==t.filters?null:t.filters.length)),e.xp6(2),e.Q6J("ngForOf",e.xi3(15,32,t.items,e.l5B(65,Vr,t.id,t.itemsPerPage,t.currentPage,t.totalItems)))("ngForTrackBy",t.trackByFn),e.xp6(3),e.Q6J("ngIf",!(null!=t.items&&t.items.length)),e.xp6(1),e.Q6J("ngForOf",t.order.surcharges),e.xp6(1),e.Q6J("ngForOf",t.order.discounts),e.xp6(3),e.Oqu(e.lcZ(23,35,"order.sub-total")),e.xp6(2),e.uIk("colspan",t.visibleSortedColumns.length-2),e.xp6(2),e.hij(" ",e.xi3(27,37,t.order.subTotalWithTax,t.order.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(29,40,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(31,42,t.order.subTotal,t.order.currencyCode)," "),e.xp6(5),e.Oqu(e.lcZ(36,45,"order.shipping")),e.xp6(2),e.uIk("colspan",t.visibleSortedColumns.length-2),e.xp6(1),e.Q6J("ngForOf",t.order.shippingLines),e.xp6(2),e.hij(" ",e.xi3(41,47,t.order.shippingWithTax,t.order.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(43,50,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(45,52,t.order.shipping,t.order.currencyCode)," "),e.xp6(5),e.Oqu(e.lcZ(50,55,"order.total")),e.xp6(2),e.uIk("colspan",t.visibleSortedColumns.length-2),e.xp6(2),e.hij(" ",e.xi3(54,57,t.order.totalWithTax,t.order.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(56,60,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(58,62,t.order.total,t.order.currencyCode)," "))},dependencies:[_.q0d,_.qvL,_.KKC,p.mk,p.$G,p.sg,p.O5,p.tP,C.rH,M.Y,x.y,gr.j,fr.r,hr.I,xr.L,p.Ov,Cr._s,m.X$,h.k],styles:["[_nghost-%COMP%]{display:block;max-width:100%;position:relative;margin-bottom:calc(var(--space-unit) * 4);container-type:inline-size}th[_ngcontent-%COMP%]{border-bottom:1px solid var(--color-table-header-border);font-size:var(--font-size-xs);font-weight:600;text-transform:uppercase;position:relative;white-space:nowrap}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:calc(var(--space-unit) * 1.5) calc(var(--space-unit) * 1)}tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-of-type, tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:first-of-type{text-align:center}@media screen and (min-width: 992px){tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-of-type, tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:first-of-type{padding-inline-start:var(--surface-margin-left);text-align:start}}th[_ngcontent-%COMP%]:last-of-type, td[_ngcontent-%COMP%]:last-of-type{border-inline-end:1px solid var(--color-table-header-border)}tr[_ngcontent-%COMP%]:first-of-type   th[_ngcontent-%COMP%]:last-of-type{border-image:linear-gradient(0deg,var(--color-table-header-border),transparent) 1}tr[_ngcontent-%COMP%]:last-of-type   td[_ngcontent-%COMP%]:last-of-type{border-image:linear-gradient(180deg,var(--color-table-header-border),transparent) 1}tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:1px solid var(--color-table-row-separator)}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:var(--color-table-row-hover-bg)}.bulk-actions[_ngcontent-%COMP%]{margin-inline-start:calc(var(--space-unit) * 5);background-color:var(--color-surface-bg);z-index:10;display:flex;position:absolute;top:5px;height:40px}@media screen and (min-width: 992px){.bulk-actions[_ngcontent-%COMP%]{margin-inline-start:calc(var(--space-unit) * 8.5)}}@media screen and (min-width: 1280px){.bulk-actions[_ngcontent-%COMP%]{margin-inline-start:calc(var(--space-unit) * 10.5)}}.table-wrapper[_ngcontent-%COMP%]{display:block;overflow-y:hidden;overflow-x:auto;position:relative;width:100%;max-width:var(--surface-width)}table[_ngcontent-%COMP%]{width:100%}table.no-select[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.column-picker[_ngcontent-%COMP%]{width:24px}.sort-toggle[_ngcontent-%COMP%]{display:flex;align-items:center;margin-inline-start:calc(var(--space-unit) * .5)}.sort-toggle[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:0;border-radius:var(--border-radius-lg);color:var(--color-weight-500);padding:0 2px;cursor:pointer;background-color:transparent}.sort-toggle[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{color:var(--color-primary-700)}.sort-toggle[_ngcontent-%COMP%]   .sort-label[_ngcontent-%COMP%]{margin-inline-start:calc(var(--space-unit) * .5);font-size:10px;color:var(--color-primary-600);font-weight:400}.toggle-search-filter-row[_ngcontent-%COMP%]{position:absolute;top:-12px;left:4px}@media screen and (min-width: 1280px){.toggle-search-filter-row[_ngcontent-%COMP%]{left:8px}}.toggle-search-filter-row.active[_ngcontent-%COMP%]{background-color:var(--color-primary-700);color:var(--color-primary-100);border-color:var(--color-primary-700)}th.filter-row[_ngcontent-%COMP%]{position:relative;font-size:var(--font-size-base);font-weight:400;background-color:var(--color-weight-100);box-shadow:var(--data-table-filter-box-shadow);border-left-width:0;border-right-width:0;text-align:initial;padding:0}th.filter-row[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%}th.filter-row.active[_ngcontent-%COMP%]{border-bottom:1px solid var(--color-table-header-border)}th.filter-row[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]{margin-top:calc(var(--space-unit) * 1);display:flex;flex-wrap:wrap;gap:calc(var(--space-unit) * .5)}.filter-row-wrapper[_ngcontent-%COMP%]{padding:calc(var(--space-unit) * 4);padding-inline-start:0;max-height:150px;transition:max-height .2s,padding .2s,opacity .2s}.filter-row-wrapper.hidden[_ngcontent-%COMP%]{max-height:0px;padding-top:0;padding-bottom:0;overflow:hidden;opacity:0}.cell-link[_ngcontent-%COMP%]{display:block;width:100%;height:100%}td.active[_ngcontent-%COMP%]{background-color:var(--color-table-row-active-bg)}.cell-content[_ngcontent-%COMP%]{display:flex;align-items:center;line-height:var(--font-size-sm);color:var(--color-weight-700)}.cell-content.left[_ngcontent-%COMP%]{justify-content:flex-start}.cell-content.center[_ngcontent-%COMP%]{justify-content:center}.cell-content.right[_ngcontent-%COMP%]{justify-content:flex-end}.selection-col[_ngcontent-%COMP%]{width:calc(var(--space-unit) * 8)}vdr-empty-placeholder[_ngcontent-%COMP%]{width:100%}.table-footer[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:space-between;margin-top:var(--space-unit);margin-inline-start:var(--surface-margin-left);margin-inline-end:var(--space-unit)}.total-items-count[_ngcontent-%COMP%]{font-size:var(--font-size-xs)}@container (max-width: 500px){.total-items-count[_ngcontent-%COMP%]{display:none}}","[_nghost-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}[_nghost-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}[_nghost-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700;border-top:1px dashed var(--color-component-border-200)}[_nghost-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}[_nghost-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}[_nghost-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-inline-end:18px}[_nghost-%COMP%]   .draft-qty[_ngcontent-%COMP%]{max-width:48px}[_nghost-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}[_nghost-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}[_nghost-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px;color:var(--color-text-300);line-height:14px}[_nghost-%COMP%]   .promotions-label[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted var(--color-text-200);text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}[_nghost-%COMP%]   .thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px}[_nghost-%COMP%]   .shipping-method-name[_ngcontent-%COMP%]{font-size:var(--font-size-xs);margin-inline-end:2px}[_nghost-%COMP%]   .order-placed-quantity[_ngcontent-%COMP%]{text-decoration:line-through;color:var(--color-text-300);margin-inline-end:2px}"],changeDetection:0});class le{constructor(){this.isDraft=!1,this.adjust=new e.vpe,this.remove=new e.vpe,this.orderLineCustomFieldsVisible=!1,this.customFieldsForLine={}}get visibleOrderLineCustomFields(){return this.orderLineCustomFieldsVisible?this.orderLineCustomFields:[]}get showElided(){return!this.orderLineCustomFieldsVisible&&0<this.orderLineCustomFields.length}ngOnInit(){this.orderLineCustomFieldsVisible=this.orderLineCustomFields.length<2,this.getLineCustomFields()}draftInputBlur(n,t){n.quantity!==t&&this.adjust.emit({lineId:n.id,quantity:t})}toggleOrderLineCustomFields(){this.orderLineCustomFieldsVisible=!this.orderLineCustomFieldsVisible}getLineDiscounts(n){return n.discounts.filter(t=>t.type===c.S2X.PROMOTION)}getLineCustomFields(){for(const n of this.order.lines){const t=new l.nJ({}),o=this.orderLineCustomFields.map(i=>{const a=n.customFields[i.name];return t.addControl(i.name,new l.p4(a)),{config:i,formGroup:t,value:a}}).filter(i=>!!this.orderLineCustomFieldsVisible||null!=i.value);this.customFieldsForLine[n.id]=o}}getPromotionLink(n){return["/marketing","promotions",n.adjustmentSource.split(":")[1]]}getCouponCodeForAdjustment(n,t){const o=t.adjustmentSource.split(":")[1],i=n.promotions.find(a=>a.id===o);if(i)return i.couponCode||void 0}getShippingNames(n){return n.shippingLines.length?n.shippingLines.map(t=>t.shippingMethod.name).join(", "):""}}(ae=le).\u0275fac=function(n){return new(n||ae)},ae.\u0275cmp=e.Xpm({type:ae,selectors:[["vdr-order-table"]],inputs:{order:"order",orderLineCustomFields:"orderLineCustomFields",isDraft:"isDraft"},outputs:{adjust:"adjust",remove:"remove"},decls:20,vars:24,consts:[["id","order-detail-list",3,"items","order"],["id","image",3,"heading"],["id","product-name",3,"heading"],["id","product-sku",3,"heading","optional"],["id","unit-price",3,"heading"],["id","quantity",3,"heading","optional"],[3,"customField",4,"ngFor","ngForOf"],["id","total",3,"heading","optional"],[1,"image-placeholder"],[3,"src",4,"ngIf","ngIfElse"],["imagePlaceholder",""],[3,"src"],[1,"placeholder"],["shape","image","size","48"],[1,"unit-price"],[1,"net-price",3,"title"],[4,"ngIf","ngIfElse"],["draft",""],[3,"line","payments"],[3,"line","orderState","allOrderFulfillments"],[1,"flex"],["class","order-placed-quantity",3,"title",4,"ngIf"],[1,"order-placed-quantity",3,"title"],["type","number","min","0",1,"draft-qty",3,"value","blur"],["qtyInput",""],[1,"icon-button",3,"click"],["shape","trash"],[3,"customField"],[4,"ngIf"],["vdrDropdownTrigger","",1,"promotions-label"],["class","line-promotion",4,"ngFor","ngForOf"],[1,"line-promotion"],[1,"promotion-name",3,"routerLink"],[1,"promotion-amount"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-order-data-table",0)(1,"vdr-dt2-column",1),e.ALo(2,"translate"),e.YNc(3,zr,4,2,"ng-template"),e.qZA(),e.TgZ(4,"vdr-dt2-column",2),e.ALo(5,"translate"),e.YNc(6,eo,1,1,"ng-template"),e.qZA(),e.TgZ(7,"vdr-dt2-column",3),e.ALo(8,"translate"),e.YNc(9,to,1,1,"ng-template"),e.qZA(),e.TgZ(10,"vdr-dt2-column",4),e.ALo(11,"translate"),e.YNc(12,no,7,11,"ng-template"),e.qZA(),e.TgZ(13,"vdr-dt2-column",5),e.ALo(14,"translate"),e.YNc(15,ao,5,7,"ng-template"),e.qZA(),e.YNc(16,lo,1,1,"vdr-dt2-custom-field-column",6),e.TgZ(17,"vdr-order-total-column",7),e.ALo(18,"translate"),e.YNc(19,_o,8,12,"ng-template"),e.qZA()()),2&n&&(e.Q6J("items",t.order.lines)("order",t.order),e.xp6(1),e.Q6J("heading",e.lcZ(2,12,"common.image")),e.xp6(3),e.Q6J("heading",e.lcZ(5,14,"order.product-name")),e.xp6(3),e.Q6J("heading",e.lcZ(8,16,"order.product-sku"))("optional",!1),e.xp6(3),e.Q6J("heading",e.lcZ(11,18,"order.unit-price")),e.xp6(3),e.Q6J("heading",e.lcZ(14,20,"order.quantity"))("optional",!1),e.xp6(3),e.Q6J("ngForOf",t.orderLineCustomFields),e.xp6(1),e.Q6J("heading",e.lcZ(18,22,"order.total"))("optional",!1))},dependencies:[_.qvL,p.sg,p.O5,C.rH,x.y,S.J,P.N,J.U,$t.U,Ht.j,je,ie,at,Re,m.X$,D.M,h.k],styles:["[_nghost-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}[_nghost-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}[_nghost-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700;border-top:1px dashed var(--color-component-border-200)}[_nghost-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}[_nghost-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}[_nghost-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-inline-end:18px}[_nghost-%COMP%]   .draft-qty[_ngcontent-%COMP%]{max-width:48px}[_nghost-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}[_nghost-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}[_nghost-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px;color:var(--color-text-300);line-height:14px}[_nghost-%COMP%]   .promotions-label[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted var(--color-text-200);text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}[_nghost-%COMP%]   .thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px}[_nghost-%COMP%]   .shipping-method-name[_ngcontent-%COMP%]{font-size:var(--font-size-xs);margin-inline-end:2px}[_nghost-%COMP%]   .order-placed-quantity[_ngcontent-%COMP%]{text-decoration:line-through;color:var(--color-text-300);margin-inline-end:2px}  .line-promotion{display:flex;justify-content:space-between;padding:6px 12px}  .line-promotion .promotion-amount{margin-inline-start:12px}  .line-promotion .net-price{font-size:11px;color:var(--color-text-300)}"],changeDetection:0});var ce,de,lt=d(7977),Kt=d(4512);function uo(r,n){if(1&r&&(e.TgZ(0,"div",16),e._UZ(1,"vdr-custom-field-control",17),e.qZA()),2&r){const t=n.$implicit,o=e.oxw(3);e.xp6(1),e.Q6J("compact",!0)("readonly",!1)("customField",t)("customFieldsFormGroup",o.customFieldsFormGroup)}}function mo(r,n){if(1&r&&(e.ynx(0),e.YNc(1,uo,2,4,"div",15),e.BQk()),2&r){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.orderLineCustomFields)}}function go(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div",1)(1,"div",5),e._UZ(2,"img",6),e.ALo(3,"assetPreview"),e.TgZ(4,"div",7)(5,"div"),e._uU(6),e.qZA(),e.TgZ(7,"div",8),e._uU(8),e.qZA()(),e.TgZ(9,"div",9)(10,"div",8),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"div",8),e._uU(14),e.ALo(15,"translate"),e.qZA()(),e._UZ(16,"div",10),e.TgZ(17,"div",7)(18,"div"),e._uU(19),e.ALo(20,"localeCurrency"),e.qZA(),e.TgZ(21,"div",11),e.ALo(22,"translate"),e._uU(23),e.ALo(24,"localeCurrency"),e.qZA()(),e.TgZ(25,"div")(26,"input",12),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.quantity=i)}),e.qZA()(),e.TgZ(27,"button",13),e.NdJ("click",function(){const a=e.CHM(t).ngIf,s=e.oxw();return e.KtG(s.addItemClick(a))}),e._uU(28),e.ALo(29,"translate"),e.qZA()(),e.YNc(30,mo,2,1,"ng-container",14),e.qZA()}if(2&r){const t=n.ngIf,o=e.oxw();e.xp6(2),e.Q6J("src",e.xi3(3,15,t.featuredAsset||t.product.featuredAsset,32),e.LSH),e.xp6(4),e.Oqu(null==t?null:t.name),e.xp6(2),e.Oqu(null==t?null:t.sku),e.xp6(3),e.AsE(" ",e.lcZ(12,18,"catalog.stock-on-hand"),": ",t.stockOnHand," "),e.xp6(3),e.AsE(" ",e.lcZ(15,20,"catalog.stock-allocated"),": ",t.stockAllocated," "),e.xp6(5),e.Oqu(e.xi3(20,22,null==t?null:t.priceWithTax,o.currencyCode)),e.xp6(2),e.Q6J("title",e.lcZ(22,25,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(24,27,null==t?null:t.price,o.currencyCode)," "),e.xp6(3),e.Q6J("disabled",!t)("ngModel",o.quantity),e.xp6(1),e.Q6J("disabled",!t),e.xp6(1),e.hij(" ",e.lcZ(29,30,"order.add-item-to-order")," "),e.xp6(2),e.Q6J("ngIf",o.orderLineCustomFields.length)}}class ct{constructor(n){this.dataService=n,this.addItem=new e.vpe,this.customFieldsFormGroup=new l.nJ({}),this.selectedVariantId$=new N.x,this.quantity=1}ngOnInit(){this.selectedVariant$=this.selectedVariantId$.pipe((0,g.w)(n=>n?this.dataService.product.getProductVariant(n).mapSingle(({productVariant:t})=>t):[void 0]));for(const n of this.orderLineCustomFields)this.customFieldsFormGroup.addControl(n.name,new l.p4(""))}addItemClick(n){n&&(this.addItem.emit({productVariantId:n.id,quantity:this.quantity,customFields:this.orderLineCustomFields.length?this.customFieldsFormGroup.value:void 0}),this.selectedVariantId$.next(void 0),this.customFieldsFormGroup.reset())}}function fo(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"vdr-action-bar")(1,"vdr-ab-left")(2,"div",1),e._UZ(3,"vdr-order-state-label",2),e.qZA()(),e.TgZ(4,"vdr-ab-right"),e._UZ(5,"vdr-action-bar-items",3),e.TgZ(6,"button",4),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.completeOrder())}),e._UZ(7,"clr-icon",5),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"vdr-dropdown")(11,"button",6),e._UZ(12,"clr-icon",7),e.qZA(),e.TgZ(13,"vdr-dropdown-menu",8)(14,"button",9),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.deleteOrder())}),e._UZ(15,"clr-icon",10),e._uU(16),e.ALo(17,"translate"),e.qZA()()()()()}if(2&r){const t=n.ngIf;e.xp6(3),e.Q6J("state",t.state),e.xp6(3),e.Q6J("disabled",!t.customer||!t.lines.length||!t.shippingLines.length),e.xp6(2),e.hij(" ",e.lcZ(9,4,"order.complete-draft-order")," "),e.xp6(8),e.hij(" ",e.lcZ(17,6,"order.delete-draft-order")," ")}}function ho(r,n){1&r&&e._UZ(0,"clr-icon",26)}function xo(r,n){1&r&&e._UZ(0,"clr-icon",27)}function Co(r,n){if(1&r&&(e.YNc(0,ho,1,0,"clr-icon",24),e.YNc(1,xo,1,0,"clr-icon",25)),2&r){const t=e.oxw().ngIf;e.Q6J("ngIf",!t.customer),e.xp6(1),e.Q6J("ngIf",t.customer)}}function vo(r,n){if(1&r&&e._UZ(0,"vdr-customer-label",28),2&r){const t=e.oxw().ngIf;e.Q6J("customer",t.customer)}}function yo(r,n){1&r&&e._UZ(0,"clr-icon",26)}function Oo(r,n){1&r&&e._UZ(0,"clr-icon",27)}function Zo(r,n){if(1&r&&(e.YNc(0,yo,1,0,"clr-icon",24),e.YNc(1,Oo,1,0,"clr-icon",25)),2&r){const t=e.oxw().ngIf;e.Q6J("ngIf",!t.billingAddress.streetLine1),e.xp6(1),e.Q6J("ngIf",t.billingAddress.streetLine1)}}function bo(r,n){if(1&r&&e._UZ(0,"vdr-formatted-address",29),2&r){const t=e.oxw().ngIf;e.Q6J("address",t.billingAddress)}}function To(r,n){1&r&&e._UZ(0,"clr-icon",26)}function Ao(r,n){1&r&&e._UZ(0,"clr-icon",27)}function Io(r,n){if(1&r&&(e.YNc(0,To,1,0,"clr-icon",24),e.YNc(1,Ao,1,0,"clr-icon",25)),2&r){const t=e.oxw().ngIf;e.Q6J("ngIf",!t.shippingAddress.streetLine1||!t.shippingLines.length),e.xp6(1),e.Q6J("ngIf",t.shippingAddress.streetLine1&&t.shippingLines.length)}}function Lo(r,n){if(1&r&&e._UZ(0,"vdr-formatted-address",29),2&r){const t=e.oxw().ngIf;e.Q6J("address",t.shippingAddress)}}function Mo(r,n){if(1&r&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&r){const t=n.$implicit;e.xp6(1),e.hij(" ",t.shippingMethod.name," ")}}function wo(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",14),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.displayCouponCodeInput=!i.displayCouponCodeInput)}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.set-coupon-codes")," "))}function Fo(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div")(1,"label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"vdr-coupon-code-selector",30),e.NdJ("addCouponCode",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.applyCouponCode(i))})("removeCouponCode",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.removeCouponCode(i))}),e.qZA()()}if(2&r){const t=e.oxw().ngIf;e.xp6(2),e.Oqu(e.lcZ(3,2,"order.set-coupon-codes")),e.xp6(2),e.Q6J("couponCodes",t.couponCodes)}}function qo(r,n){if(1&r&&e._UZ(0,"vdr-page-entity-info",31),2&r){const t=n.ngIf;e.Q6J("entity",t)}}function So(r,n){if(1&r&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.ALo(5,"percent"),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.ALo(8,"localeCurrency"),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.ALo(11,"localeCurrency"),e.qZA()()),2&r){const t=n.$implicit,o=e.oxw(2).ngIf;e.xp6(2),e.Oqu(t.description),e.xp6(2),e.Oqu(e.lcZ(5,4,t.taxRate/100)),e.xp6(3),e.Oqu(e.xi3(8,6,t.taxBase,o.currencyCode)),e.xp6(3),e.Oqu(e.xi3(11,9,t.taxTotal,o.currencyCode))}}function Po(r,n){if(1&r&&(e.ynx(0),e.TgZ(1,"table",32)(2,"thead")(3,"tr")(4,"th"),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"th"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"th"),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"th"),e._uU(14),e.ALo(15,"translate"),e.qZA()()(),e.TgZ(16,"tbody"),e.YNc(17,So,12,12,"tr",17),e.qZA()(),e.BQk()),2&r){const t=e.oxw().ngIf;e.xp6(5),e.Oqu(e.lcZ(6,5,"common.description")),e.xp6(3),e.Oqu(e.lcZ(9,7,"order.tax-rate")),e.xp6(3),e.Oqu(e.lcZ(12,9,"order.tax-base")),e.xp6(3),e.Oqu(e.lcZ(15,11,"order.tax-total")),e.xp6(3),e.Q6J("ngForOf",t.taxSummary)}}function Jo(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"vdr-page-detail-layout")(1,"vdr-page-detail-sidebar")(2,"vdr-card",11),e.ALo(3,"translate"),e.YNc(4,Co,2,2,"ng-template",12),e.YNc(5,vo,1,1,"vdr-customer-label",13),e.TgZ(6,"button",14),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.setCustomer())}),e._uU(7),e.ALo(8,"translate"),e.qZA()(),e.TgZ(9,"vdr-card",11),e.ALo(10,"translate"),e.YNc(11,Zo,2,2,"ng-template",12),e.YNc(12,bo,1,1,"vdr-formatted-address",15),e.TgZ(13,"button",14),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.setBillingAddress())}),e._uU(14),e.ALo(15,"translate"),e.qZA()(),e.TgZ(16,"vdr-card",11),e.ALo(17,"translate"),e.YNc(18,Io,2,2,"ng-template",12),e.YNc(19,Lo,1,1,"vdr-formatted-address",15),e.TgZ(20,"button",16),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.setShippingAddress())}),e._uU(21),e.ALo(22,"translate"),e.qZA(),e.YNc(23,Mo,2,1,"div",17),e.TgZ(24,"button",14),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.setShippingMethod())}),e._uU(25),e.ALo(26,"translate"),e.qZA()(),e.TgZ(27,"vdr-card"),e.YNc(28,wo,3,3,"button",18),e.YNc(29,Fo,5,4,"div",0),e.qZA(),e.TgZ(30,"vdr-card"),e.YNc(31,qo,1,1,"vdr-page-entity-info",19),e.ALo(32,"async"),e.qZA()(),e.TgZ(33,"vdr-page-block")(34,"vdr-card")(35,"vdr-draft-order-variant-selector",20),e.NdJ("addItem",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.addItemToOrder(i))}),e.qZA(),e.TgZ(36,"vdr-order-table",21),e.NdJ("adjust",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.adjustOrderLine(i))})("remove",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.removeOrderLine(i))}),e.qZA()(),e.TgZ(37,"vdr-card",11),e.ALo(38,"translate"),e.YNc(39,Po,18,13,"ng-container",0),e.qZA(),e._UZ(40,"vdr-custom-detail-component-host",22),e.TgZ(41,"vdr-order-custom-fields-card",23),e.NdJ("updateClick",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.updateCustomFields(i))}),e.qZA()()()}if(2&r){const t=n.ngIf,o=e.oxw();e.xp6(2),e.Q6J("title",e.lcZ(3,25,"order.customer")),e.xp6(3),e.Q6J("ngIf",t.customer),e.xp6(2),e.hij(" ",e.lcZ(8,27,"order.set-customer-for-order")," "),e.xp6(2),e.Q6J("title",e.lcZ(10,29,"order.billing-address")),e.xp6(3),e.Q6J("ngIf",t.billingAddress),e.xp6(2),e.hij(" ",e.lcZ(15,31,"order.set-billing-address")," "),e.xp6(2),e.Q6J("title",e.lcZ(17,33,"order.shipping")),e.xp6(3),e.Q6J("ngIf",t.shippingAddress),e.xp6(2),e.hij(" ",e.lcZ(22,35,"order.set-shipping-address")," "),e.xp6(2),e.Q6J("ngForOf",t.shippingLines),e.xp6(2),e.hij(" ",e.lcZ(26,37,"order.set-shipping-method")," "),e.xp6(3),e.Q6J("ngIf",0===t.couponCodes.length&&!o.displayCouponCodeInput),e.xp6(1),e.Q6J("ngIf",t.couponCodes.length||o.displayCouponCodeInput),e.xp6(2),e.Q6J("ngIf",e.lcZ(32,39,o.entity$)),e.xp6(4),e.Q6J("orderLineCustomFields",o.orderLineCustomFields)("currencyCode",t.currencyCode),e.xp6(1),e.Q6J("order",t)("orderLineCustomFields",o.orderLineCustomFields)("isDraft",!0),e.xp6(1),e.Q6J("title",e.lcZ(38,41,"order.tax-summary")),e.xp6(2),e.Q6J("ngIf",t.taxSummary.length),e.xp6(1),e.Q6J("entity$",o.entity$)("detailForm",o.detailForm),e.xp6(1),e.Q6J("customFieldsConfig",o.customFields)("customFieldValues",t.customFields)}}(ce=ct).\u0275fac=function(n){return new(n||ce)(e.Y36(c.DoR))},ce.\u0275cmp=e.Xpm({type:ce,selectors:[["vdr-draft-order-variant-selector"]],inputs:{currencyCode:"currencyCode",orderLineCustomFields:"orderLineCustomFields"},outputs:{addItem:"addItem"},decls:8,vars:6,consts:[[1,"card"],[1,"card-block"],[1,"card-title"],[3,"productSelected"],["class","card-block",4,"ngIf"],[1,"variant-details"],[1,"mr-2",3,"src"],[1,"details"],[1,"small"],[1,"details","ml-4"],[1,"flex-spacer"],[1,"small",3,"title"],["type","number","min","0",3,"disabled","ngModel","ngModelChange"],[1,"btn","btn-small","btn-primary",3,"disabled","click"],[4,"ngIf"],["class","custom-field",4,"ngFor","ngForOf"],[1,"custom-field"],[3,"compact","readonly","customField","customFieldsFormGroup"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"vdr-product-variant-selector",3),e.NdJ("productSelected",function(i){return t.selectedVariantId$.next(i.productVariantId)}),e.qZA()(),e.YNc(6,go,31,32,"div",4),e.ALo(7,"async"),e.qZA()),2&n&&(e.xp6(3),e.Oqu(e.lcZ(4,2,"order.add-item-to-order")),e.xp6(3),e.Q6J("ngIf",e.lcZ(7,4,t.selectedVariant$)))},dependencies:[p.sg,p.O5,l.Fj,l.wV,l.JJ,l.qQ,l.On,lt.M,x.y,Kt.e,p.Ov,m.X$,D.M,h.k],styles:[".variant-details[_ngcontent-%COMP%]{display:flex;align-items:center}.variant-details[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img);width:32px;height:32px}.variant-details[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{font-size:.65rem;line-height:.7rem}.variant-details[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:48px;margin:0 6px}.variant-details[_ngcontent-%COMP%]   .small[_ngcontent-%COMP%]{font-size:11px;color:var(--color-text-300)}"],changeDetection:0});class $e extends c.VE7{constructor(n,t,o,i,a){super(),this.changeDetector=n,this.dataService=t,this.notificationService=o,this.modalService=i,this.orderTransitionService=a,this.customFields=this.getCustomFieldConfig("Order"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.detailForm=new l.nJ({}),this.fetchHistory=new N.x,this.displayCouponCodeInput=!1}ngOnInit(){this.init(),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.eligibleShippingMethods$=this.entity$.pipe((0,g.w)(n=>this.dataService.order.getDraftOrderEligibleShippingMethods(n.id).mapSingle(({eligibleShippingMethodsForDraftOrder:t})=>t)))}ngOnDestroy(){this.destroy()}addItemToOrder(n){this.dataService.order.addItemToDraftOrder(this.id,n).subscribe(t=>{"Order"!==t.addItemToDraftOrder.__typename&&this.notificationService.error(t.addItemToDraftOrder.message)})}adjustOrderLine(n){this.dataService.order.adjustDraftOrderLine(this.id,{orderLineId:n.lineId,quantity:n.quantity}).subscribe(t=>{"Order"!==t.adjustDraftOrderLine.__typename&&this.notificationService.error(t.adjustDraftOrderLine.message)})}removeOrderLine(n){this.dataService.order.removeDraftOrderLine(this.id,n.lineId).subscribe(t=>{"Order"!==t.removeDraftOrderLine.__typename&&this.notificationService.error(t.removeDraftOrderLine.message)})}getOrderAddressLines(n){return n?Object.values(n).filter(t=>"OrderAddress"!==t).filter(t=>!!t):[]}setCustomer(){this.modalService.fromComponent(ze).subscribe(n=>{this.hasId(n)?this.dataService.order.setCustomerForDraftOrder(this.id,{customerId:n.id}).subscribe():n&&this.dataService.order.setCustomerForDraftOrder(this.id,{input:n}).subscribe()})}setShippingAddress(){this.entity$.pipe((0,w.q)(1),(0,g.w)(n=>this.modalService.fromComponent(Qe,{locals:{customerId:n.customer?.id,currentAddress:n.shippingAddress??void 0}}))).subscribe(n=>{n&&this.dataService.order.setDraftOrderShippingAddress(this.id,n).subscribe()})}setBillingAddress(){this.entity$.pipe((0,w.q)(1),(0,g.w)(n=>this.modalService.fromComponent(Qe,{locals:{customerId:n.customer?.id,currentAddress:n.billingAddress??void 0}}))).subscribe(n=>{n&&this.dataService.order.setDraftOrderBillingAddress(this.id,n).subscribe()})}applyCouponCode(n){this.dataService.order.applyCouponCodeToDraftOrder(this.id,n).subscribe()}removeCouponCode(n){this.dataService.order.removeCouponCodeFromDraftOrder(this.id,n).subscribe()}setShippingMethod(){(0,bn.a)(this.entity$,this.eligibleShippingMethods$).pipe((0,w.q)(1),(0,g.w)(([n,t])=>this.modalService.fromComponent(et,{locals:{eligibleShippingMethods:t,currencyCode:n.currencyCode,currentSelectionId:n.shippingLines?.[0]?.shippingMethod.id}}))).subscribe(n=>{n&&this.dataService.order.setDraftOrderShippingMethod(this.id,n).subscribe()})}updateCustomFields(n){this.dataService.order.updateOrderCustomFields({id:this.id,customFields:n}).subscribe()}deleteOrder(){this.dataService.order.deleteDraftOrder(this.id).subscribe(({deleteDraftOrder:n})=>{n.result===c.PcR.DELETED?(this.notificationService.success((0,u.J)("common.notify-delete-success"),{entity:"Order"}),this.router.navigate(["/orders"])):n.message&&this.notificationService.error(n.message)})}completeOrder(){this.dataService.order.transitionToState(this.id,"ArrangingPayment").subscribe(({transitionOrderToState:n})=>{"Order"===n?.__typename?this.router.navigate(["/orders",this.id]):"OrderStateTransitionError"===n?.__typename&&this.notificationService.error(n.transitionError)})}hasId(n){return"object"==typeof n&&!!n.id}setFormValues(n){}}(de=$e).\u0275fac=function(n){return new(n||de)(e.Y36(e.sBO),e.Y36(c.DoR),e.Y36(c.gqp),e.Y36(c.Z7U),e.Y36(z))},de.\u0275cmp=e.Xpm({type:de,selectors:[["vdr-draft-order-detail"]],features:[e.qOj],decls:5,vars:6,consts:[[4,"ngIf"],[1,"flex","clr-align-items-center"],[3,"state"],["locationId","draft-order-detail"],[1,"btn","btn-primary",3,"disabled","click"],["shape","check"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",3,"click"],["shape","trash",1,"is-danger"],[3,"title"],["vdrCardControls",""],["class","block mb-2",3,"customer",4,"ngIf"],[1,"button-small",3,"click"],["class","block mb-2",3,"address",4,"ngIf"],[1,"button-small","mr-2",3,"click"],[4,"ngFor","ngForOf"],["class","button-small",3,"click",4,"ngIf"],[3,"entity",4,"ngIf"],[3,"orderLineCustomFields","currencyCode","addItem"],[3,"order","orderLineCustomFields","isDraft","adjust","remove"],["locationId","draft-order-detail",3,"entity$","detailForm"],[3,"customFieldsConfig","customFieldValues","updateClick"],["shape","unknown-status","class","is-warning",4,"ngIf"],["shape","check","class","is-success",4,"ngIf"],["shape","unknown-status",1,"is-warning"],["shape","check",1,"is-success"],[1,"block","mb-2",3,"customer"],[1,"block","mb-2",3,"address"],[3,"couponCodes","addCouponCode","removeCouponCode"],[3,"entity"],[1,"table"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-page-block"),e.YNc(1,fo,18,8,"vdr-action-bar",0),e.ALo(2,"async"),e.qZA(),e.YNc(3,Jo,42,43,"vdr-page-detail-layout",0),e.ALo(4,"async")),2&n&&(e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,t.entity$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,4,t.entity$)))},dependencies:[_.qvL,_.MgK,p.sg,p.O5,O.Kk,O.BN,O.mz,nt.d,S.J,P.N,J.U,ee.H,te.G,Ne.b,rt.W,Et.C,ke.z,Yt.D,jt.T,Rt.W,Ee.A,Ee.D,it,le,ct,De,p.Ov,p.Zx,m.X$,h.k],changeDetection:0});var se,pe,ue,me,ge,Do=d(7336);function No(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.Oqu(e.lcZ(1,1,"order.fulfill-order"))}function Qo(r,n){if(1&r&&(e._UZ(0,"img",17),e.ALo(1,"assetPreview")),2&r){const t=e.oxw().$implicit;e.Q6J("src",e.xi3(1,1,t.featuredAsset,"tiny"),e.LSH)}}function Uo(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"input",18),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw().$implicit,s=e.oxw();return e.KtG(s.fulfillmentQuantities[a.id].fulfillCount=i)}),e.qZA()}if(2&r){const t=e.oxw().$implicit,o=e.oxw();e.Q6J("disabled",0===o.getUnfulfilledCount(t))("ngModel",o.fulfillmentQuantities[t.id].fulfillCount)("max",o.fulfillmentQuantities[t.id].max)}}function ko(r,n){if(1&r&&(e.TgZ(0,"tr",9)(1,"td",10),e.YNc(2,Qo,2,4,"img",11),e.qZA(),e.TgZ(3,"td",12),e._uU(4),e.qZA(),e.TgZ(5,"td",13),e._uU(6),e.qZA(),e.TgZ(7,"td",14),e._uU(8),e.qZA(),e.TgZ(9,"td",14),e._uU(10),e.qZA(),e.TgZ(11,"td",15),e.YNc(12,Uo,1,3,"input",16),e.qZA()()),2&r){const t=n.$implicit,o=e.oxw();e.ekj("ignore",0===o.getUnfulfilledCount(t)),e.xp6(2),e.Q6J("ngIf",t.featuredAsset),e.xp6(2),e.Oqu(t.productVariant.name),e.xp6(2),e.Oqu(t.productVariant.sku),e.xp6(2),e.Oqu(o.getUnfulfilledCount(t)),e.xp6(2),e.Oqu(t.productVariant.stockOnHand),e.xp6(2),e.Q6J("ngIf",o.fulfillmentQuantities[t.id])}}function Eo(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"button",20),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.select())}),e._uU(4),e.ALo(5,"translate"),e.qZA()}if(2&r){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,3,"common.cancel")),e.xp6(2),e.Q6J("disabled",!t.canSubmit()),e.xp6(1),e.hij(" ",e.lcZ(5,5,"order.create-fulfillment")," ")}}class dt{constructor(n,t){this.dataService=n,this.changeDetector=t,this.fulfillmentHandlerControl=new l.p4,this.fulfillmentQuantities={}}ngOnInit(){this.dataService.settings.getGlobalSettings().single$.subscribe(({globalSettings:n})=>{this.fulfillmentQuantities=this.order.lines.reduce((t,o)=>{const i=this.getFulfillableCount(o,n.trackInventory);return{...t,[o.id]:{fulfillCount:i,max:i}}},{}),this.changeDetector.markForCheck()}),this.dataService.shippingMethod.getShippingMethodOperations().mapSingle(n=>n.fulfillmentHandlers).subscribe(n=>{this.fulfillmentHandlerDef=n.find(t=>t.code===this.order.shippingLines[0]?.shippingMethod?.fulfillmentHandlerCode)||n[0],this.fulfillmentHandler=(0,c.miO)(this.fulfillmentHandlerDef),this.fulfillmentHandlerControl.patchValue(this.fulfillmentHandler),this.changeDetector.markForCheck()})}getFulfillableCount(n,t){const{trackInventory:o,stockOnHand:i}=n.productVariant,a=o===c.TvZ.INHERIT?t:o===c.TvZ.TRUE,s=this.getUnfulfilledCount(n);return a?Math.min(s,i):s}getUnfulfilledCount(n){const t=this.order.fulfillments?.filter(o=>"Cancelled"!==o.state).map(o=>o.lines).flat().filter(o=>o.orderLineId===n.id).reduce((o,i)=>o+i.quantity,0)??0;return n.quantity-t}canSubmit(){const n=Object.values(this.fulfillmentQuantities).reduce((i,{fulfillCount:a})=>i+a,0),t=Object.values(this.fulfillmentQuantities).every(({fulfillCount:i,max:a})=>i<=a);return(0,c.dOS)(this.fulfillmentHandlerDef,this.fulfillmentHandlerControl.value)&&this.fulfillmentHandlerControl.valid&&0<n&&t}select(){const n=Object.entries(this.fulfillmentQuantities).map(([t,{fulfillCount:o}])=>({orderLineId:t,quantity:o}));this.resolveWith({lines:n,handler:(0,c.RnJ)(this.fulfillmentHandler,this.fulfillmentHandlerControl.value)})}cancel(){this.resolveWith()}}function Yo(r,n){if(1&r&&(e.TgZ(0,"li",2)(1,"div",3),e._uU(2),e.qZA(),e._UZ(3,"clr-icon",4),e._uU(4),e.qZA()),2&r){const t=n.$implicit;e.Q6J("title",t.name),e.xp6(2),e.Oqu(t.quantity),e.xp6(2),e.hij(" ",t.name," ")}}(se=dt).\u0275fac=function(n){return new(n||se)(e.Y36(c.DoR),e.Y36(e.sBO))},se.\u0275cmp=e.Xpm({type:se,selectors:[["vdr-fulfill-order-dialog"]],decls:34,vars:29,consts:[["vdrDialogTitle",""],[1,"fulfillment-wrapper"],[1,"order-table"],[1,"table"],["class","order-line",3,"ignore",4,"ngFor","ngForOf"],[1,"shipping-details"],[3,"address"],[3,"operationDefinition","operation","formControl","removable"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[1,"align-middle","fulfil"],["type","number","min","0",3,"disabled","ngModel","max","ngModelChange",4,"ngIf"],[3,"src"],["type","number","min","0",3,"disabled","ngModel","max","ngModelChange"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(n,t){1&n&&(e.YNc(0,No,2,3,"ng-template",0),e.TgZ(1,"div",1)(2,"div",2)(3,"table",3)(4,"thead")(5,"tr"),e._UZ(6,"th"),e.TgZ(7,"th"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"th"),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"th"),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"th"),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.TgZ(19,"th"),e._uU(20),e.ALo(21,"translate"),e.qZA()()(),e.YNc(22,ko,13,8,"tr",4),e.qZA()(),e.TgZ(23,"div",5),e._UZ(24,"vdr-formatted-address",6),e.TgZ(25,"h6"),e._uU(26),e.ALo(27,"translate"),e.qZA(),e._uU(28),e.TgZ(29,"strong"),e._uU(30),e.ALo(31,"localeCurrency"),e.qZA(),e._UZ(32,"vdr-configurable-input",7),e.qZA()(),e.YNc(33,Eo,6,7,"ng-template",8)),2&n&&(e.xp6(8),e.Oqu(e.lcZ(9,14,"order.product-name")),e.xp6(3),e.Oqu(e.lcZ(12,16,"order.product-sku")),e.xp6(3),e.Oqu(e.lcZ(15,18,"order.unfulfilled")),e.xp6(3),e.Oqu(e.lcZ(18,20,"catalog.stock-on-hand")),e.xp6(3),e.Oqu(e.lcZ(21,22,"order.fulfill")),e.xp6(2),e.Q6J("ngForOf",t.order.lines),e.xp6(2),e.Q6J("address",t.order.shippingAddress),e.xp6(2),e.Oqu(e.lcZ(27,24,"order.shipping-method")),e.xp6(2),e.hij(" ",null==t.order.shippingLines[0]||null==t.order.shippingLines[0].shippingMethod?null:t.order.shippingLines[0].shippingMethod.name," "),e.xp6(2),e.Oqu(e.xi3(31,26,t.order.shipping,t.order.currencyCode)),e.xp6(2),e.Q6J("operationDefinition",t.fulfillmentHandlerDef)("operation",t.fulfillmentHandler)("formControl",t.fulfillmentHandlerControl)("removable",!1))},dependencies:[p.sg,p.O5,l.Fj,l.wV,l.JJ,l.qQ,l.Fd,l.On,l.oH,Do.q,x.y,Z.n,y.q,Ne.b,m.X$,D.M,h.k],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}[_nghost-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}[_nghost-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}[_nghost-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700;border-top:1px dashed var(--color-component-border-200)}[_nghost-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}[_nghost-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}[_nghost-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-inline-end:18px}[_nghost-%COMP%]   .draft-qty[_ngcontent-%COMP%]{max-width:48px}[_nghost-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}[_nghost-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}[_nghost-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px;color:var(--color-text-300);line-height:14px}[_nghost-%COMP%]   .promotions-label[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted var(--color-text-200);text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}[_nghost-%COMP%]   .thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px}[_nghost-%COMP%]   .shipping-method-name[_ngcontent-%COMP%]{font-size:var(--font-size-xs);margin-inline-end:2px}[_nghost-%COMP%]   .order-placed-quantity[_ngcontent-%COMP%]{text-decoration:line-through;color:var(--color-text-300);margin-inline-end:2px}.fulfillment-wrapper[_ngcontent-%COMP%]{flex:1}@media screen and (min-width: 768px){.fulfillment-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row}}.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]{margin-top:24px}@media screen and (min-width: 768px){.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]{margin-top:0;margin-inline-start:24px;width:250px}}.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]   clr-input-container[_ngcontent-%COMP%]{margin-top:24px}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.fulfillment-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}"],changeDetection:0});class _e{}function jo(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",0),e.ALo(1,"translate"),e._uU(2),e.qZA()),2&r){const t=e.oxw();e.Q6J("label",e.lcZ(1,2,"order.tracking-code")),e.xp6(2),e.hij(" ",null==t.fulfillment?null:t.fulfillment.trackingCode,"\n")}}function Ro(r,n){if(1&r&&e._UZ(0,"vdr-custom-field-control",5),2&r){const t=e.oxw().$implicit,o=e.oxw();e.Q6J("readonly",!0)("compact",!0)("customField",t)("customFieldsFormGroup",o.customFieldFormGroup)}}function $o(r,n){if(1&r&&(e.ynx(0),e.YNc(1,Ro,1,4,"vdr-custom-field-control",4),e.BQk()),2&r){const t=n.$implicit,o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.customFieldFormGroup.get(t.name))}}(pe=_e).\u0275fac=function(n){return new(n||pe)},pe.\u0275cmp=e.Xpm({type:pe,selectors:[["vdr-simple-item-list"]],inputs:{items:"items"},decls:3,vars:1,consts:[[1,"items-list"],[3,"title",4,"ngFor","ngForOf"],[3,"title"],[1,"quantity"],["shape","times","size","12"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"ul"),e.YNc(2,Yo,5,3,"li",1),e.qZA()()),2&n&&(e.xp6(2),e.Q6J("ngForOf",t.items))},dependencies:[_.qvL,p.sg],styles:[".items-list[_ngcontent-%COMP%]{font-size:12px}.items-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin-top:6px;list-style-type:none;margin-inline-start:2px}.items-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{line-height:14px;text-overflow:ellipsis;overflow:hidden}.items-list[_ngcontent-%COMP%]   .quantity[_ngcontent-%COMP%]{min-width:16px;display:inline-block}"],changeDetection:0});class He{constructor(n){this.serverConfigService=n,this.customFieldConfig=[],this.customFieldFormGroup=new l.nJ({})}ngOnInit(){this.customFieldConfig=this.serverConfigService.getCustomFieldsFor("Fulfillment")}ngOnChanges(n){this.buildCustomFieldsFormGroup()}get fulfillment(){return this.order.fulfillments&&this.order.fulfillments.find(n=>n.id===this.fulfillmentId)}get items(){return this.fulfillment?.lines.map(n=>({name:this.order.lines.find(t=>t.id===n.orderLineId)?.productVariant.name??"",quantity:n.quantity}))??[]}buildCustomFieldsFormGroup(){const n=this.fulfillment.customFields;for(const t of this.serverConfigService.getCustomFieldsFor("Fulfillment"))this.customFieldFormGroup.addControl(t.name,new l.p4(n[t.name]))}customFieldIsObject(n){return Array.isArray(n)||(0,A.isObject)(n)}}function Ho(r,n){1&r&&e._UZ(0,"clr-icon",2)}(ue=He).\u0275fac=function(n){return new(n||ue)(e.Y36(c.iHG))},ue.\u0275cmp=e.Xpm({type:ue,selectors:[["vdr-fulfillment-detail"]],inputs:{fulfillmentId:"fulfillmentId",order:"order"},features:[e.TTD],decls:12,vars:17,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"items"],[4,"ngFor","ngForOf"],[3,"readonly","compact","customField","customFieldsFormGroup",4,"ngIf"],[3,"readonly","compact","customField","customFieldsFormGroup"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-labeled-data",0),e.ALo(1,"translate"),e._uU(2),e.ALo(3,"localeDate"),e.qZA(),e.TgZ(4,"vdr-labeled-data",0),e.ALo(5,"translate"),e._uU(6),e.qZA(),e.YNc(7,jo,3,4,"vdr-labeled-data",1),e.TgZ(8,"vdr-labeled-data",0),e.ALo(9,"translate"),e._UZ(10,"vdr-simple-item-list",2),e.qZA(),e.YNc(11,$o,2,1,"ng-container",3)),2&n&&(e.Q6J("label",e.lcZ(1,8,"common.created-at")),e.xp6(2),e.hij(" ",e.xi3(3,10,null==t.fulfillment?null:t.fulfillment.createdAt,"medium"),"\n"),e.xp6(2),e.Q6J("label",e.lcZ(5,13,"order.fulfillment-method")),e.xp6(2),e.hij(" ",null==t.fulfillment?null:t.fulfillment.method,"\n"),e.xp6(1),e.Q6J("ngIf",null==t.fulfillment?null:t.fulfillment.trackingCode),e.xp6(1),e.Q6J("label",e.lcZ(9,15,"order.contents")),e.xp6(2),e.Q6J("items",t.items),e.xp6(1),e.Q6J("ngForOf",t.customFieldConfig))},dependencies:[p.sg,p.O5,lt.M,T.W,_e,m.X$,Ye.H],changeDetection:0});class st{get chipColorType(){switch(this.state){case"Pending":case"Shipped":return"warning";case"Delivered":return"success";case"Cancelled":return"error"}}}function Go(r,n){if(1&r&&e._UZ(0,"vdr-fulfillment-detail",7),2&r){const t=e.oxw();e.Q6J("fulfillmentId",null==t.fulfillment?null:t.fulfillment.id)("order",t.order)}}(me=st).\u0275fac=function(n){return new(n||me)},me.\u0275cmp=e.Xpm({type:me,selectors:[["vdr-fulfillment-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-chip",0),e.ALo(1,"translate"),e.YNc(2,Ho,1,0,"clr-icon",1),e._uU(3),e.ALo(4,"translate"),e.ALo(5,"stateI18nToken"),e.qZA()),2&n&&(e.Q6J("title",e.lcZ(1,4,"order.payment-state"))("colorType",t.chipColorType),e.xp6(2),e.Q6J("ngIf","Delivered"===t.state),e.xp6(1),e.hij(" ",e.lcZ(4,6,e.lcZ(5,8,t.state)),"\n"))},dependencies:[_.qvL,p.O5,M.Y,m.X$,q.N],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0});const Vt=function(r){return{state:r}};function Ko(r,n){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",14),e.NdJ("click",function(){const a=e.CHM(t).ngIf,s=e.oxw(2);return e.KtG(s.transitionState.emit(a))}),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"translate"),e.ALo(5,"stateI18nToken"),e.qZA(),e.BQk()}if(2&r){const t=n.ngIf;e.xp6(2),e.hij(" ",e.xi3(3,1,"order.set-fulfillment-state",e.VKq(8,Vt,e.lcZ(4,4,e.lcZ(5,6,t))))," ")}}function Vo(r,n){if(1&r&&(e.ynx(0),e._UZ(1,"clr-icon",18),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"translate"),e.ALo(5,"stateI18nToken"),e.BQk()),2&r){const t=e.oxw().$implicit;e.xp6(2),e.hij(" ",e.xi3(3,1,"order.transition-to-state",e.VKq(8,Vt,e.lcZ(4,4,e.lcZ(5,6,t))))," ")}}function Bo(r,n){1&r&&(e._UZ(0,"clr-icon",19),e._uU(1),e.ALo(2,"translate")),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.cancel-fulfillment")," "))}function Wo(r,n){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",15),e.NdJ("click",function(){const a=e.CHM(t).$implicit,s=e.oxw(2);return e.KtG(s.transitionState.emit(a))}),e.YNc(2,Vo,6,10,"ng-container",16),e.YNc(3,Bo,3,3,"ng-template",null,17,e.W1O),e.qZA(),e.BQk()}if(2&r){const t=n.$implicit,o=e.MAs(4);e.xp6(2),e.Q6J("ngIf","Cancelled"!==t)("ngIfElse",o)}}function Xo(r,n){if(1&r&&(e.TgZ(0,"div",8),e.YNc(1,Ko,6,10,"ng-container",9),e.TgZ(2,"vdr-dropdown")(3,"button",10),e._UZ(4,"clr-icon",11),e.qZA(),e.TgZ(5,"vdr-dropdown-menu",12),e.YNc(6,Wo,5,2,"ng-container",13),e.qZA()()()),2&r){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.nextSuggestedState()),e.xp6(5),e.Q6J("ngForOf",t.nextOtherStates())}}class pt{constructor(){this.transitionState=new e.vpe}nextSuggestedState(){if(!this.fulfillment)return;const{nextStates:n}=this.fulfillment,t=o=>n.includes(o)?o:n[0];switch(this.fulfillment?.state){case"Pending":return t("Shipped");case"Shipped":return t("Delivered");default:return n.find(o=>"Cancelled"!==o)}}nextOtherStates(){if(!this.fulfillment)return[];const n=this.nextSuggestedState();return this.fulfillment.nextStates.filter(t=>t!==n)}}var fe;function zo(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",0),e.ALo(1,"translate"),e._uU(2),e.qZA()),2&r){const t=e.oxw();e.Q6J("label",e.lcZ(1,2,"order.note")),e.xp6(2),e.Oqu(t.modification.note)}}function ei(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",0),e.ALo(1,"translate"),e._uU(2),e.ALo(3,"localeCurrency"),e.qZA()),2&r){const t=n.$implicit,o=e.oxw();let i;e.Q6J("label",e.lcZ(1,3,"order.surcharges")),e.xp6(2),e.AsE(" ",null==(i=o.getSurcharge(t.id))?null:i.description," ",e.xi3(3,5,null==(i=o.getSurcharge(t.id))?null:i.priceWithTax,o.order.currencyCode),"")}}function ti(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",0),e.ALo(1,"translate"),e._UZ(2,"vdr-simple-item-list",3),e.qZA()),2&r){const t=e.oxw();e.Q6J("label",e.lcZ(1,2,"order.added-items")),e.xp6(2),e.Q6J("items",t.getAddedItems())}}function ni(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",0),e.ALo(1,"translate"),e._UZ(2,"vdr-simple-item-list",3),e.qZA()),2&r){const t=e.oxw();e.Q6J("label",e.lcZ(1,2,"order.removed-items")),e.xp6(2),e.Q6J("items",t.getRemovedItems())}}(ge=pt).\u0275fac=function(n){return new(n||ge)},ge.\u0275cmp=e.Xpm({type:ge,selectors:[["vdr-fulfillment-card"]],inputs:{fulfillment:"fulfillment",order:"order"},outputs:{transitionState:"transitionState"},decls:10,vars:6,consts:[[1,"card"],[1,"card-header","fulfillment-header"],[1,"fulfillment-state"],[3,"state"],[1,"card-block"],[3,"fulfillmentId","order",4,"ngIf"],["class","card-footer",4,"ngIf"],[3,"fulfillmentId","order"],[1,"card-footer"],[4,"ngIf"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm","btn-primary",3,"click"],["type","button","vdrDropdownItem","",3,"click"],[4,"ngIf","ngIfElse"],["cancel",""],["shape","step-forward-2"],["shape","error-standard",1,"is-error"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"div",2),e._UZ(6,"vdr-fulfillment-state-label",3),e.qZA()(),e.TgZ(7,"div",4),e.YNc(8,Go,1,2,"vdr-fulfillment-detail",5),e.qZA(),e.YNc(9,Xo,7,2,"div",6),e.qZA()),2&n&&(e.xp6(3),e.Oqu(e.lcZ(4,4,"order.fulfillment")),e.xp6(3),e.Q6J("state",null==t.fulfillment?null:t.fulfillment.state),e.xp6(2),e.Q6J("ngIf",!!t.fulfillment),e.xp6(1),e.Q6J("ngIf",null==t.fulfillment?null:t.fulfillment.nextStates.length))},dependencies:[_.qvL,p.sg,p.O5,S.J,P.N,J.U,ee.H,He,st,m.X$,q.N],styles:[".fulfillment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}"],changeDetection:0});class _t{constructor(){this.addedItems=new Map,this.removedItems=new Map}ngOnChanges(){const{added:n,removed:t}=this.getModifiedLines();this.addedItems=n,this.removedItems=t}getSurcharge(n){return this.order.surcharges.find(t=>t.id===n)}getAddedItems(){return[...this.addedItems.entries()].map(([n,t])=>({name:n.productVariant.name,quantity:t}))}getRemovedItems(){return[...this.removedItems.entries()].map(([n,t])=>({name:n.productVariant.name,quantity:t}))}getModifiedLines(){const n=new Map,t=new Map;for(const o of this.modification.lines||[]){const i=this.order.lines.find(a=>a.id===o.orderLineId);i&&(o.quantity<0?t.set(i,-o.quantity):n.set(i,o.quantity))}return{added:n,removed:t}}}(fe=_t).\u0275fac=function(n){return new(n||fe)},fe.\u0275cmp=e.Xpm({type:fe,selectors:[["vdr-modification-detail"]],inputs:{order:"order",modification:"modification"},features:[e.TTD],decls:7,vars:8,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"label",4,"ngFor","ngForOf"],[3,"items"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-labeled-data",0),e.ALo(1,"translate"),e._uU(2),e.qZA(),e.YNc(3,zo,3,4,"vdr-labeled-data",1),e.YNc(4,ei,4,8,"vdr-labeled-data",2),e.YNc(5,ti,3,4,"vdr-labeled-data",1),e.YNc(6,ni,3,4,"vdr-labeled-data",1)),2&n&&(e.Q6J("label",e.lcZ(1,6,"common.ID")),e.xp6(2),e.Oqu(t.modification.id),e.xp6(1),e.Q6J("ngIf",t.modification.note),e.xp6(1),e.Q6J("ngForOf",t.modification.surcharges),e.xp6(1),e.Q6J("ngIf",t.getAddedItems().length),e.xp6(1),e.Q6J("ngIf",t.getRemovedItems().length))},dependencies:[p.sg,p.O5,T.W,_e,m.X$,h.k],changeDetection:0});var Bt=d(1502),ut=d(4790);const mt=72;var he,xe,Ce,ve;function ri(r,n){if(1&r&&(e.TgZ(0,"div",3),e._UZ(1,"div",4)(2,"clr-icon",5),e.TgZ(3,"div",6),e._uU(4),e.ALo(5,"translate"),e.ALo(6,"stateI18nToken"),e.qZA()()),2&r){const t=e.oxw();e.xp6(4),e.hij(" ",e.lcZ(5,1,e.lcZ(6,3,t.cancelledState))," ")}}class Ge{constructor(n){this.elementRef=n,this.active$=new ut.X(!1),this.activeTarget$=new ut.X(!1),this.isCancellable=!1,this.cancelledState="Cancelled"}ngOnChanges(n){this.isCancellable=!!this.node.to.find(t=>"Cancelled"===t.name),n.active&&this.active$.next(this.active)}getPos(n="top"){this.elementRef.nativeElement.getBoundingClientRect();const o=this.elementRef.nativeElement.querySelector(".node")?.getBoundingClientRect().height??0;return{x:10,y:this.index*mt+("bottom"===n?o:0)}}getStyle(){const n=this.getPos();return{"top.px":n.y,"left.px":n.x}}}(he=Ge).\u0275fac=function(n){return new(n||he)(e.Y36(e.SBq))},he.\u0275cmp=e.Xpm({type:he,selectors:[["vdr-order-process-node"]],inputs:{node:"node",index:"index",active:"active"},features:[e.TTD],decls:8,vars:15,consts:[[1,"node-wrapper",3,"ngStyle"],[1,"node"],["class","cancelled-wrapper",4,"ngIf"],[1,"cancelled-wrapper"],[1,"cancelled-edge"],["shape","dot-circle"],[1,"cancelled-node"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0),e.ALo(1,"async"),e.TgZ(2,"div",1),e.ALo(3,"async"),e._uU(4),e.ALo(5,"translate"),e.ALo(6,"stateI18nToken"),e.qZA(),e.YNc(7,ri,7,5,"div",2),e.qZA()),2&n&&(e.ekj("active",e.lcZ(1,7,t.active$)),e.Q6J("ngStyle",t.getStyle()),e.xp6(2),e.ekj("active-target",e.lcZ(3,9,t.activeTarget$)),e.xp6(2),e.hij(" ",e.lcZ(5,11,e.lcZ(6,13,t.node.name))," "),e.xp6(3),e.Q6J("ngIf",t.isCancellable))},dependencies:[_.qvL,p.O5,p.PC,p.Ov,m.X$,q.N],styles:["[_nghost-%COMP%]{display:block}.node-wrapper[_ngcontent-%COMP%]{position:absolute;z-index:1;display:flex;align-items:center}.node[_ngcontent-%COMP%]{display:inline-block;border:2px solid var(--color-component-border-200);border-radius:3px;padding:3px 6px;z-index:1;background-color:var(--color-component-bg-100);opacity:.7;transition:opacity .2s,background-color .2s,color .2s;cursor:default}.node.active-target[_ngcontent-%COMP%]{border-color:var(--color-primary-500);opacity:.9}.cancelled-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;color:var(--color-grey-300);transition:color .2s,opacity .2s;opacity:.7}.cancelled-edge[_ngcontent-%COMP%]{width:48px;height:2px;background-color:var(--color-component-bg-300);transition:background-color .2s}clr-icon[_ngcontent-%COMP%]{margin-inline-start:-1px}.cancelled-node[_ngcontent-%COMP%]{margin-inline-start:6px}.active[_ngcontent-%COMP%]   .cancelled-wrapper[_ngcontent-%COMP%]{opacity:1}.active[_ngcontent-%COMP%]   .node[_ngcontent-%COMP%]{opacity:1;background-color:var(--color-primary-600);border-color:var(--color-primary-600);color:var(--color-primary-100)}.active[_ngcontent-%COMP%]   .cancelled-wrapper[_ngcontent-%COMP%]{color:var(--color-error-500)}.active[_ngcontent-%COMP%]   .cancelled-edge[_ngcontent-%COMP%]{background-color:var(--color-error-500)}"],changeDetection:0});class gt{ngOnInit(){this.active$=this.from.active$.asObservable().pipe((0,K.b)(n=>this.to.activeTarget$.next(n)))}getStyle(){const n=this.from.index<this.to.index?"down":"up",t=this.from.getPos("down"===n?"bottom":"top"),o=this.to.getPos("down"===n?"top":"bottom"),i=Math.abs(t.x-o.x),a=Math.abs(t.y-o.y),s=Math.sqrt(i**2+a**2);return{"top.px":t.y,"left.px":t.x+("down"===n?10:40)+12*this.index,"height.px":s,"width.px":1,..."up"===n?{transform:"rotateZ(180deg)","transform-origin":"top"}:{}}}}function oi(r,n){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"vdr-order-process-node",1),e.NdJ("mouseenter",function(){const a=e.CHM(t).$implicit,s=e.oxw();return e.KtG(s.onMouseOver(a.name))})("mouseleave",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onMouseOut())}),e.ALo(2,"async"),e.qZA(),e.BQk()}if(2&r){const t=n.$implicit,o=n.index,i=e.oxw();e.xp6(1),e.Q6J("node",t)("index",o)("active",e.lcZ(2,3,i.activeState$)===t.name)}}function ii(r,n){if(1&r&&(e.ynx(0),e._UZ(1,"vdr-order-process-edge",2),e.BQk()),2&r){const t=n.$implicit;e.xp6(1),e.Q6J("from",t.from)("to",t.to)("index",t.index)}}(xe=gt).\u0275fac=function(n){return new(n||xe)},xe.\u0275cmp=e.Xpm({type:xe,selectors:[["vdr-order-process-edge"]],inputs:{from:"from",to:"to",index:"index"},decls:3,vars:7,consts:[[1,"edge",3,"ngStyle"],["shape","arrow","flip","vertical",1,"arrow"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0),e.ALo(1,"async"),e._UZ(2,"clr-icon",1),e.qZA()),2&n&&(e.ekj("active",e.lcZ(1,5,t.active$)),e.Q6J("ngStyle",t.getStyle()),e.uIk("data-from",t.from.node.name)("data-to",t.to.node.name))},dependencies:[_.qvL,p.PC,p.Ov],styles:[".edge[_ngcontent-%COMP%]{position:absolute;border:1px solid var(--color-component-border-200);background-color:var(--color-component-bg-300);opacity:.3;transition:border .2s,opacity .2s,background-color .2s}.edge.active[_ngcontent-%COMP%]{border-color:var(--color-primary-500);background-color:var(--color-primary-500);opacity:1}.edge.active[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{color:var(--color-primary-500)}.edge[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{position:absolute;bottom:-4px;left:-8px;color:var(--color-grey-300)}"],changeDetection:0});class ft{constructor(n){this.changeDetector=n,this.setActiveState$=new ut.X(void 0),this.nodes=[],this.edges=[]}get outerHeight(){return this.nodes.length*mt}ngOnInit(){this.setActiveState$.next(this.initialState),this.activeState$=this.setActiveState$.pipe((0,Xe.b)(150))}ngOnChanges(n){this.populateNodes()}ngAfterViewInit(){setTimeout(()=>this.populateEdges())}onMouseOver(n){this.setActiveState$.next(n)}onMouseOut(){this.setActiveState$.next(this.initialState)}getNodeFor(n){if(this.nodeComponents)return this.nodeComponents.find(t=>t.node.name===n)}populateNodes(){const n=new Map;for(const t of this.states)n.set(t.name,{name:t.name,to:[]});for(const[t,o]of n.entries()){const i=this.states.find(a=>a.name===t)?.to??[];for(const a of i){const s=n.get(a);s&&o.to.push(s)}}this.nodes=[...n.values()].filter(t=>"Cancelled"!==t.name)}populateEdges(){for(const n of this.nodes){const t=this.getNodeFor(n.name);let o=0;for(const i of n.to){const a=this.getNodeFor(i.name);t&&a&&t!==a&&(this.edges.push({to:a,from:t,index:o}),o++)}}this.edges=[...this.edges],this.changeDetector.markForCheck()}}function ai(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.Oqu(e.lcZ(1,1,"order.order-state-diagram"))}(Ce=ft).\u0275fac=function(n){return new(n||Ce)(e.Y36(e.sBO))},Ce.\u0275cmp=e.Xpm({type:Ce,selectors:[["vdr-order-process-graph"]],viewQuery:function(n,t){if(1&n&&e.Gf(Ge,5),2&n){let o;e.iGM(o=e.CRH())&&(t.nodeComponents=o)}},hostVars:2,hostBindings:function(n,t){2&n&&e.Udp("height",t.outerHeight,"px")},inputs:{states:"states",initialState:"initialState"},features:[e.TTD],decls:2,vars:2,consts:[[4,"ngFor","ngForOf"],[3,"node","index","active","mouseenter","mouseleave"],[3,"from","to","index"]],template:function(n,t){1&n&&(e.YNc(0,oi,3,5,"ng-container",0),e.YNc(1,ii,2,3,"ng-container",0)),2&n&&(e.Q6J("ngForOf",t.nodes),e.xp6(1),e.Q6J("ngForOf",t.edges))},dependencies:[p.sg,Ge,gt,p.Ov],styles:["[_nghost-%COMP%]{display:block;border:1px hotpink;margin:20px;padding:12px;position:relative}.state-row[_ngcontent-%COMP%]{display:flex}"],changeDetection:0});class ht{constructor(n){this.serverConfigService=n,this.states=[]}ngOnInit(){this.states=this.serverConfigService.getOrderProcessStates()}}(ve=ht).\u0275fac=function(n){return new(n||ve)(e.Y36(c.iHG))},ve.\u0275cmp=e.Xpm({type:ve,selectors:[["vdr-order-process-graph-dialog"]],decls:2,vars:2,consts:[["vdrDialogTitle",""],[3,"states","initialState"]],template:function(n,t){1&n&&(e.YNc(0,ai,2,3,"ng-template",0),e._UZ(1,"vdr-order-process-graph",1)),2&n&&(e.xp6(1),e.Q6J("states",t.states)("initialState",t.activeState))},dependencies:[y.q,ft,m.X$],changeDetection:0});var ye,Wt=d(2089);function li(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.Oqu(e.lcZ(1,1,"order.refund-and-cancel-order"))}function ci(r,n){if(1&r&&(e.TgZ(0,"div",36),e._uU(1),e.TgZ(2,"div",37),e._uU(3),e.ALo(4,"currency"),e.ALo(5,"number"),e.qZA()()),2&r){const t=n.$implicit,o=e.oxw(3).$implicit,i=e.oxw();e.xp6(1),e.hij(" ",t.description," "),e.xp6(2),e.hij(" ",e.xi3(4,2,e.xi3(5,5,t.amount/100/o.quantity,"1.0-2"),i.order.currencyCode)," ")}}function di(r,n){if(1&r&&(e.TgZ(0,"vdr-dropdown")(1,"div",32)(2,"button",33),e._UZ(3,"clr-icon",34),e.qZA()(),e.TgZ(4,"vdr-dropdown-menu"),e.YNc(5,ci,6,8,"div",35),e.qZA()()),2&r){const t=e.oxw().ngIf;e.xp6(5),e.Q6J("ngForOf",t)}}function si(r,n){if(1&r&&(e.ynx(0),e.YNc(1,di,6,1,"vdr-dropdown",26),e.BQk()),2&r){const t=n.ngIf;e.xp6(1),e.Q6J("ngIf",t.length)}}function pi(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"input",38),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw().$implicit,s=e.oxw();return e.KtG(s.lineQuantities[a.id].quantity=i)})("input",function(){e.CHM(t);const i=e.oxw().$implicit,a=e.oxw();return e.KtG(a.handleZeroQuantity(a.lineQuantities[i.id]))}),e.qZA()}if(2&r){const t=e.oxw().$implicit,o=e.oxw();e.Q6J("ngModel",o.lineQuantities[t.id].quantity)("max",t.quantity)}}function _i(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"input",39),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw().$implicit,s=e.oxw();return e.KtG(s.lineQuantities[a.id].refund=i)}),e.qZA()}if(2&r){const t=e.oxw().$implicit,o=e.oxw();e.Q6J("disabled",0===o.lineQuantities[t.id].quantity)("ngModel",o.lineQuantities[t.id].refund)}}function ui(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"input",39),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw().$implicit,s=e.oxw();return e.KtG(s.lineQuantities[a.id].cancel=i)}),e.qZA()}if(2&r){const t=e.oxw().$implicit,o=e.oxw();e.Q6J("disabled",0===o.lineQuantities[t.id].quantity)("ngModel",o.lineQuantities[t.id].cancel)}}function mi(r,n){if(1&r&&(e.TgZ(0,"tr",18)(1,"td",19),e._UZ(2,"img",20),e.ALo(3,"assetPreview"),e.qZA(),e.TgZ(4,"td",21),e._uU(5),e.qZA(),e.TgZ(6,"td",22),e._uU(7),e.qZA(),e.TgZ(8,"td",23),e._uU(9),e._UZ(10,"vdr-line-refunds",24),e.qZA(),e.TgZ(11,"td",23),e._uU(12),e.ALo(13,"localeCurrency"),e.qZA(),e.TgZ(14,"td",23)(15,"div",25),e._uU(16),e.ALo(17,"localeCurrency"),e.YNc(18,si,2,1,"ng-container",26),e.qZA()(),e.TgZ(19,"td",27),e.YNc(20,pi,1,2,"input",28),e.qZA(),e.TgZ(21,"td",29)(22,"div",30),e.YNc(23,_i,1,2,"input",31),e.qZA()(),e.TgZ(24,"td",29)(25,"div",30),e.YNc(26,ui,1,2,"input",31),e.qZA()()()),2&r){const t=n.$implicit,o=e.oxw();e.xp6(2),e.Q6J("src",e.xi3(3,12,t.featuredAsset,"tiny"),e.LSH),e.xp6(3),e.Oqu(t.productVariant.name),e.xp6(2),e.Oqu(t.productVariant.sku),e.xp6(2),e.hij(" ",t.quantity," "),e.xp6(1),e.Q6J("line",t)("payments",o.order.payments),e.xp6(2),e.hij(" ",e.xi3(13,15,t.unitPriceWithTax,o.order.currencyCode)," "),e.xp6(4),e.hij(" ",e.xi3(17,18,t.proratedUnitPriceWithTax,o.order.currencyCode)," "),e.xp6(2),e.Q6J("ngIf",t.discounts),e.xp6(2),e.Q6J("ngIf",o.lineCanBeRefundedOrCancelled(t)),e.xp6(3),e.Q6J("ngIf",o.lineCanBeRefundedOrCancelled(t)),e.xp6(3),e.Q6J("ngIf",o.lineCanBeRefundedOrCancelled(t))}}function gi(r,n){if(1&r&&(e.TgZ(0,"option",40),e._uU(1),e.ALo(2,"localeCurrency"),e.qZA()),2&r){const t=n.$implicit,o=e.oxw();e.Q6J("ngValue",t)("disabled","Settled"!==t.state),e.xp6(1),e.lnq(" #",t.id," ",t.method,": ",e.xi3(2,5,t.amount,o.order.currencyCode)," ")}}const fi=function(r,n){return{min:r,max:n}};function hi(r,n){if(1&r&&(e.TgZ(0,"div",41),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"currency"),e.ALo(4,"localeCurrency"),e.qZA()),2&r){const t=e.oxw();e.xp6(1),e.hij(" ",e.xi3(2,1,"order.refund-total-error",e.WLB(10,fi,e.xi3(3,4,0,t.order.currencyCode),e.xi3(4,7,t.settledPaymentsTotal,t.order.currencyCode)))," ")}}function xi(r,n){1&r&&(e.TgZ(0,"div",42),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.refund-total-warning")," "))}const Ci=function(r){return{amount:r}};function vi(r,n){if(1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"localeCurrency"),e.BQk()),2&r){const t=e.oxw(2);e.xp6(1),e.hij(" ",e.xi3(2,1,"order.refund-with-amount",e.VKq(7,Ci,e.xi3(3,4,t.refundTotal,t.order.currencyCode)))," ")}}function yi(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.hij(" ",e.lcZ(1,1,"order.cancel-selected-items")," ")}function Oi(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",43),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"button",44),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.select())}),e.YNc(4,vi,4,9,"ng-container",45),e.YNc(5,yi,2,3,"ng-template",null,46,e.W1O),e.qZA()}if(2&r){const t=e.MAs(6),o=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,4,"common.cancel")),e.xp6(2),e.Q6J("disabled",!o.canSubmit()),e.xp6(1),e.Q6J("ngIf",o.isRefunding())("ngIfElse",t)}}class xt{constructor(n){this.i18nService=n,this.lineQuantities={},this.refundShipping=!1,this.adjustment=0,this.reasons=(0,c.hq7)().cancellationReasons??[(0,u.J)("order.refund-reason-customer-request"),(0,u.J)("order.refund-reason-not-available")],this.reasons=this.reasons.map(t=>this.i18nService.translate(t))}get refundTotal(){return this.order.lines.reduce((t,o)=>{const i=this.lineQuantities[o.id],a=i.refund&&i.quantity||0;return t+o.proratedUnitPriceWithTax*a},0)+(this.refundShipping?this.order.shippingWithTax:0)+this.adjustment}get settledPaymentsTotal(){return this.settledPayments.map(n=>n.amount-(0,A.summate)(n.refunds.filter(i=>"Failed"!==i.state),"total")).reduce((n,t)=>n+t,0)}lineCanBeRefundedOrCancelled(n){return(this.order.payments?.reduce((o,i)=>[...o,...i.refunds],[]).filter(o=>"Failed"!==o.state).reduce((o,i)=>[...o,...i.lines],[]).filter(o=>o.orderLineId===n.id).reduce((o,i)=>o+i.quantity,0)??0)<n.quantity}ngOnInit(){this.lineQuantities=this.order.lines.reduce((n,t)=>({...n,[t.id]:{quantity:0,refund:!1,cancel:!1}}),{}),this.settledPayments=(this.order.payments||[]).filter(n=>"Settled"===n.state),this.settledPayments.length&&(this.selectedPayment=this.settledPayments[0])}handleZeroQuantity(n){0===n?.quantity&&(n.cancel=!1,n.refund=!1)}isRefunding(){return Object.values(this.lineQuantities).reduce((t,o)=>t||0<o.quantity&&o.refund,!1)}isCancelling(){return Object.values(this.lineQuantities).reduce((t,o)=>t||0<o.quantity&&o.cancel,!1)}canSubmit(){return this.isRefunding()?!!(this.selectedPayment&&this.reason&&0<this.refundTotal&&this.refundTotal<=this.settledPaymentsTotal):!!this.isCancelling()&&!!this.reason}select(){const n=this.selectedPayment;if(n){const t=this.getOrderLineInput(i=>i.refund),o=this.getOrderLineInput(i=>i.cancel);this.resolveWith({refund:{lines:t,reason:this.reason,shipping:this.refundShipping?this.order.shippingWithTax:0,adjustment:this.adjustment,paymentId:n.id},cancel:{lines:o,orderId:this.order.id,reason:this.reason,cancelShipping:this.refundShipping}})}}cancel(){this.resolveWith()}getOrderLineInput(n){return Object.entries(this.lineQuantities).filter(([t,o])=>0<o.quantity&&n(o)).map(([t,o])=>({orderLineId:t,quantity:o.quantity}))}}var Oe;function Zi(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.Oqu(e.lcZ(1,1,"order.settle-refund"))}function bi(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",4),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"button",5),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.submit())}),e._uU(4),e.ALo(5,"translate"),e.qZA()}if(2&r){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,3,"common.cancel")),e.xp6(2),e.Q6J("disabled",!t.transactionId),e.xp6(1),e.hij(" ",e.lcZ(5,5,"order.settle-refund")," ")}}(ye=xt).\u0275fac=function(n){return new(n||ye)(e.Y36(c.Dp7))},ye.\u0275cmp=e.Xpm({type:ye,selectors:[["vdr-refund-order-dialog"]],decls:69,vars:76,consts:[["vdrDialogTitle",""],[1,"refund-wrapper"],[1,"order-table"],[1,"table"],["class","order-line",4,"ngFor","ngForOf"],[1,"refund-details","mt-4"],[1,"clr-control-label"],["bindLabel","name","autofocus","","bindValue","id",3,"disabled","items","placeholder","addTag","ngModel","ngModelChange"],["clrSelect","","name","options",3,"ngModel","disabled","ngModelChange"],[3,"ngValue","disabled",4,"ngFor","ngForOf"],["type","checkbox","clrCheckbox","",3,"ngModel","disabled","ngModelChange"],["clrInput","",3,"disabled","currencyCode","ngModel","ngModelChange"],[1,"totals"],[1,"order-total"],[1,"refund-total"],["class","refund-total-error",4,"ngIf"],["class","refund-total-warning",4,"ngIf"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[3,"line","payments"],[1,"prorated-wrapper"],[4,"ngIf"],[1,"align-middle","quantity-col"],["type","number","min","0",3,"ngModel","max","ngModelChange","input",4,"ngIf"],[1,"align-middle"],[1,"cancel-checkbox-wrapper"],["type","checkbox","clrCheckbox","",3,"disabled","ngModel","ngModelChange",4,"ngIf"],["vdrDropdownTrigger","",1,"promotions-label"],[1,"icon-button"],["shape","info"],["class","line-promotion",4,"ngFor","ngForOf"],[1,"line-promotion"],[1,"promotion-amount"],["type","number","min","0",3,"ngModel","max","ngModelChange","input"],["type","checkbox","clrCheckbox","",3,"disabled","ngModel","ngModelChange"],[3,"ngValue","disabled"],[1,"refund-total-error"],[1,"refund-total-warning"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf","ngIfElse"],["cancelling",""]],template:function(n,t){1&n&&(e.YNc(0,li,2,3,"ng-template",0),e.TgZ(1,"div",1)(2,"div",2)(3,"table",3)(4,"thead")(5,"tr"),e._UZ(6,"th"),e.TgZ(7,"th"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"th"),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"th"),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"th"),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.TgZ(19,"th"),e._uU(20),e.ALo(21,"translate"),e.qZA(),e.TgZ(22,"th"),e._uU(23),e.ALo(24,"translate"),e.qZA(),e.TgZ(25,"th"),e._uU(26),e.ALo(27,"translate"),e.qZA(),e.TgZ(28,"th"),e._uU(29),e.ALo(30,"translate"),e.qZA()()(),e.YNc(31,mi,27,21,"tr",4),e.qZA()(),e.TgZ(32,"div",5)(33,"div")(34,"label",6),e._uU(35),e.ALo(36,"translate"),e.qZA(),e.TgZ(37,"ng-select",7),e.NdJ("ngModelChange",function(i){return t.reason=i}),e.ALo(38,"translate"),e.qZA()(),e.TgZ(39,"div")(40,"clr-select-container")(41,"label"),e._uU(42),e.ALo(43,"translate"),e.qZA(),e.TgZ(44,"select",8),e.NdJ("ngModelChange",function(i){return t.selectedPayment=i}),e.YNc(45,gi,3,8,"option",9),e.qZA()(),e.TgZ(46,"clr-checkbox-wrapper")(47,"input",10),e.NdJ("ngModelChange",function(i){return t.refundShipping=i}),e.qZA(),e.TgZ(48,"label"),e._uU(49),e.ALo(50,"translate"),e.ALo(51,"localeCurrency"),e.qZA()(),e.TgZ(52,"clr-input-container")(53,"label"),e._uU(54),e.ALo(55,"translate"),e.qZA(),e.TgZ(56,"vdr-currency-input",11),e.NdJ("ngModelChange",function(i){return t.adjustment=i}),e.qZA()(),e.TgZ(57,"div",12)(58,"div",13),e._uU(59),e.ALo(60,"translate"),e.ALo(61,"localeCurrency"),e.qZA(),e.TgZ(62,"div",14),e._uU(63),e.ALo(64,"translate"),e.ALo(65,"localeCurrency"),e.qZA(),e.YNc(66,hi,5,13,"div",15),e.YNc(67,xi,3,3,"div",16),e.qZA()()()(),e.YNc(68,Oi,7,6,"ng-template",17)),2&n&&(e.xp6(8),e.Oqu(e.lcZ(9,37,"order.product-name")),e.xp6(3),e.Oqu(e.lcZ(12,39,"order.product-sku")),e.xp6(3),e.Oqu(e.lcZ(15,41,"order.quantity")),e.xp6(3),e.Oqu(e.lcZ(18,43,"order.unit-price")),e.xp6(3),e.Oqu(e.lcZ(21,45,"order.prorated-unit-price")),e.xp6(3),e.Oqu(e.lcZ(24,47,"order.quantity")),e.xp6(3),e.Oqu(e.lcZ(27,49,"order.refund")),e.xp6(3),e.Oqu(e.lcZ(30,51,"order.cancel")),e.xp6(2),e.Q6J("ngForOf",t.order.lines),e.xp6(1),e.ekj("faded",!t.isRefunding()&&!t.isCancelling()),e.xp6(3),e.Oqu(e.lcZ(36,53,"order.refund-cancellation-reason")),e.xp6(2),e.Q6J("disabled",!t.isRefunding()&&!t.isCancelling())("items",t.reasons)("placeholder",e.lcZ(38,55,"order.refund-cancellation-reason-required"))("addTag",!0)("ngModel",t.reason),e.xp6(5),e.Oqu(e.lcZ(43,57,"order.payment-to-refund")),e.xp6(2),e.Q6J("ngModel",t.selectedPayment)("disabled",!t.isRefunding()),e.xp6(1),e.Q6J("ngForOf",t.settledPayments),e.xp6(2),e.Q6J("ngModel",t.refundShipping)("disabled",!t.isRefunding()),e.xp6(2),e.AsE(" ",e.lcZ(50,59,"order.refund-shipping")," (",e.xi3(51,61,t.order.shippingWithTax,t.order.currencyCode),") "),e.xp6(5),e.Oqu(e.lcZ(55,64,"order.refund-adjustment")),e.xp6(2),e.Q6J("disabled",!t.isRefunding())("currencyCode",t.order.currencyCode)("ngModel",t.adjustment),e.xp6(1),e.ekj("disabled",!t.isRefunding()),e.xp6(2),e.AsE(" ",e.lcZ(60,66,"order.payment-amount"),": ",e.xi3(61,68,t.selectedPayment.amount,t.order.currencyCode)," "),e.xp6(4),e.AsE(" ",e.lcZ(64,71,"order.refund-total"),": ",e.xi3(65,73,t.refundTotal,t.order.currencyCode)," "),e.xp6(3),e.Q6J("ngIf",t.refundTotal<0||t.settledPaymentsTotal<t.refundTotal),e.xp6(1),e.Q6J("ngIf",t.selectedPayment.amount<t.refundTotal))},dependencies:[_.qvL,_.MgK,_.KKC,_.PEh,_.xRP,_.G55,_.otW,_.dTv,p.sg,p.O5,l.YN,l.Kr,l.Fj,l.wV,l.Wl,l.EJ,l.JJ,l.qQ,l.Fd,l.On,L.w9,Wt.K,x.y,Z.n,y.q,S.J,P.N,J.U,ie,p.JJ,p.H9,m.X$,D.M,h.k],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}.refund-wrapper[_ngcontent-%COMP%]{flex:1;flex-direction:column}.refund-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.refund-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.refund-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}.quantity-col[_ngcontent-%COMP%]{background-color:var(--color-warning-100)}.cancel-checkbox-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}clr-checkbox-wrapper[_ngcontent-%COMP%]{margin-top:12px;margin-bottom:12px;display:block}.refund-details[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.refund-details.faded[_ngcontent-%COMP%]{opacity:.5}.totals[_ngcontent-%COMP%]{margin-top:48px}.totals[_ngcontent-%COMP%]   .refund-total[_ngcontent-%COMP%]{font-size:18px}.totals[_ngcontent-%COMP%]   .refund-total-error[_ngcontent-%COMP%]{color:var(--color-error-500)}.totals[_ngcontent-%COMP%]   .refund-total-warning[_ngcontent-%COMP%]{color:var(--color-warning-600);max-width:250px}.totals.disabled[_ngcontent-%COMP%]{color:var(--color-grey-300)}.prorated-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center}.line-promotion[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:12px;padding:3px 6px}.line-promotion[_ngcontent-%COMP%]   .promotion-amount[_ngcontent-%COMP%]{margin-inline-start:12px}"],changeDetection:0});const Ti=function(r){return{method:r}};class Ct{constructor(){this.transactionId=""}submit(){this.resolveWith(this.transactionId)}cancel(){this.resolveWith()}}var Ze,be,Te,Ae;function Ai(r,n){1&r&&e._UZ(0,"clr-icon",2)}(Oe=Ct).\u0275fac=function(n){return new(n||Oe)},Oe.\u0275cmp=e.Xpm({type:Oe,selectors:[["vdr-settle-refund-dialog"]],decls:10,vars:10,consts:[["vdrDialogTitle",""],[1,"instruction"],["clrInput","","name","transactionId",3,"ngModel","ngModelChange"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(n,t){1&n&&(e.YNc(0,Zi,2,3,"ng-template",0),e.TgZ(1,"p",1),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"clr-input-container")(5,"label"),e._uU(6),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"input",2),e.NdJ("ngModelChange",function(i){return t.transactionId=i}),e.qZA()(),e.YNc(9,bi,6,7,"ng-template",3)),2&n&&(e.xp6(2),e.hij(" ",e.xi3(3,3,"order.settle-refund-manual-instructions",e.VKq(8,Ti,t.refund.method)),"\n"),e.xp6(4),e.Oqu(e.lcZ(7,6,"order.transaction-id")),e.xp6(2),e.Q6J("ngModel",t.transactionId))},dependencies:[_.MgK,_.xRP,_.G55,l.Fj,l.JJ,l.On,x.y,Z.n,y.q,m.X$],styles:["[_nghost-%COMP%]{padding-bottom:32px}.instruction[_ngcontent-%COMP%]{margin-top:0;margin-bottom:24px}"],changeDetection:0});class vt{get chipColorType(){switch(this.state){case"Authorized":return"warning";case"Settled":return"success";case"Declined":case"Cancelled":return"error"}}}function Ii(r,n){1&r&&e._UZ(0,"clr-icon",2)}(Ze=vt).\u0275fac=function(n){return new(n||Ze)},Ze.\u0275cmp=e.Xpm({type:Ze,selectors:[["vdr-payment-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-chip",0),e.ALo(1,"translate"),e.YNc(2,Ai,1,0,"clr-icon",1),e._uU(3),e.ALo(4,"translate"),e.ALo(5,"stateI18nToken"),e.qZA()),2&n&&(e.Q6J("title",e.lcZ(1,4,"order.payment-state"))("colorType",t.chipColorType),e.xp6(2),e.Q6J("ngIf","Settled"===t.state),e.xp6(1),e.hij(" ",e.lcZ(4,6,e.lcZ(5,8,t.state)),"\n"))},dependencies:[_.qvL,p.O5,M.Y,m.X$,q.N],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0});class yt{get chipColorType(){switch(this.state){case"Pending":return"warning";case"Settled":return"success";case"Failed":return"error"}}}function Li(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",0),e.ALo(1,"translate"),e._uU(2),e.qZA()),2&r){const t=e.oxw();e.Q6J("label",e.lcZ(1,2,"order.error-message")),e.xp6(2),e.hij(" ",t.payment.errorMessage,"\n")}}function Mi(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",0),e.ALo(1,"translate"),e._uU(2),e.qZA()),2&r){const t=e.oxw();e.Q6J("label",e.lcZ(1,2,"order.transaction-id")),e.xp6(2),e.hij(" ",t.payment.transactionId,"\n")}}(be=yt).\u0275fac=function(n){return new(n||be)},be.\u0275cmp=e.Xpm({type:be,selectors:[["vdr-refund-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-chip",0),e.ALo(1,"translate"),e.YNc(2,Ii,1,0,"clr-icon",1),e._uU(3),e.ALo(4,"translate"),e.ALo(5,"stateI18nToken"),e.qZA()),2&n&&(e.Q6J("title",e.lcZ(1,4,"order.payment-state"))("colorType",t.chipColorType),e.xp6(2),e.Q6J("ngIf","Settled"===t.state),e.xp6(1),e.hij(" ",e.lcZ(4,6,e.lcZ(5,8,t.state)),"\n"))},dependencies:[_.qvL,p.O5,M.Y,m.X$,q.N],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0});class Ke{}function wi(r,n){if(1&r&&(e.ynx(0),e._uU(1),e.BQk()),2&r){const t=e.oxw();e.xp6(1),e.hij("#",t.payment.transactionId,"")}}function Fi(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",11),e.ALo(1,"translate"),e._uU(2),e.qZA()),2&r){const t=e.oxw().$implicit;e.Q6J("label",e.lcZ(1,2,"order.transaction-id")),e.xp6(2),e.hij(" ",t.transactionId," ")}}function qi(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",11),e.ALo(1,"translate"),e._uU(2),e.qZA()),2&r){const t=e.oxw().$implicit;e.Q6J("label",e.lcZ(1,2,"order.refund-reason")),e.xp6(2),e.hij(" ",t.reason," ")}}function Si(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",11),e.ALo(1,"translate"),e._UZ(2,"vdr-object-tree",13),e.qZA()),2&r){const t=e.oxw().$implicit;e.Q6J("label",e.lcZ(1,2,"order.refund-metadata")),e.xp6(2),e.Q6J("value",t.metadata)}}function Pi(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div",14)(1,"button",15),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,a=e.oxw();return e.KtG(a.settleRefund.emit(i))}),e._uU(2),e.ALo(3,"translate"),e.qZA()()}2&r&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"order.settle-refund")," "))}function Ji(r,n){if(1&r&&(e.ynx(0),e.TgZ(1,"div",1),e._UZ(2,"clr-icon",9),e._uU(3),e.ALo(4,"translate"),e._UZ(5,"div",10)(6,"vdr-refund-state-label",4),e.qZA(),e.TgZ(7,"div",5)(8,"vdr-labeled-data",11),e.ALo(9,"translate"),e._uU(10),e.ALo(11,"localeDate"),e.qZA(),e.TgZ(12,"vdr-labeled-data",11),e.ALo(13,"translate"),e._uU(14),e.ALo(15,"localeCurrency"),e.qZA(),e.YNc(16,Fi,3,4,"vdr-labeled-data",12),e.YNc(17,qi,3,4,"vdr-labeled-data",12),e.YNc(18,Si,3,4,"vdr-labeled-data",12),e.qZA(),e.YNc(19,Pi,4,3,"div",8),e.BQk()),2&r){const t=n.$implicit,o=e.oxw();e.xp6(3),e.AsE(" ",e.lcZ(4,11,"order.refund")," #",t.id," "),e.xp6(3),e.Q6J("state",t.state),e.xp6(2),e.Q6J("label",e.lcZ(9,13,"common.created-at")),e.xp6(2),e.hij(" ",e.xi3(11,15,t.createdAt,"medium")," "),e.xp6(2),e.Q6J("label",e.lcZ(13,18,"order.refund-total")),e.xp6(2),e.hij(" ",e.xi3(15,20,t.total,o.currencyCode)," "),e.xp6(2),e.Q6J("ngIf",t.transactionId),e.xp6(1),e.Q6J("ngIf",t.reason),e.xp6(1),e.Q6J("ngIf",o.refundHasMetadata(t)),e.xp6(1),e.Q6J("ngIf","Pending"===t.state)}}function Di(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.settlePayment.emit(i.payment))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.settle-payment")," "))}(Te=Ke).\u0275fac=function(n){return new(n||Te)},Te.\u0275cmp=e.Xpm({type:Te,selectors:[["vdr-payment-detail"]],inputs:{payment:"payment",currencyCode:"currencyCode"},decls:12,vars:17,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"value"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-labeled-data",0),e.ALo(1,"translate"),e._uU(2),e.qZA(),e.TgZ(3,"vdr-labeled-data",0),e.ALo(4,"translate"),e._uU(5),e.ALo(6,"localeCurrency"),e.qZA(),e.YNc(7,Li,3,4,"vdr-labeled-data",1),e.YNc(8,Mi,3,4,"vdr-labeled-data",1),e.TgZ(9,"vdr-labeled-data",0),e.ALo(10,"translate"),e._UZ(11,"vdr-object-tree",2),e.qZA()),2&n&&(e.Q6J("label",e.lcZ(1,8,"order.payment-method")),e.xp6(2),e.hij(" ",t.payment.method,"\n"),e.xp6(1),e.Q6J("label",e.lcZ(4,10,"order.amount")),e.xp6(2),e.hij(" ",e.xi3(6,12,t.payment.amount,t.currencyCode),"\n"),e.xp6(2),e.Q6J("ngIf",t.payment.errorMessage),e.xp6(1),e.Q6J("ngIf",t.payment.transactionId),e.xp6(1),e.Q6J("label",e.lcZ(10,15,"order.payment-metadata")),e.xp6(2),e.Q6J("value",t.payment.metadata))},dependencies:[p.O5,T.W,Ue._,m.X$,h.k],changeDetection:0});const Ni=function(r){return{state:r}};function Qi(r,n){if(1&r&&(e.ynx(0),e._UZ(1,"clr-icon",23),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"translate"),e.ALo(5,"stateI18nToken"),e.BQk()),2&r){const t=e.oxw().$implicit;e.xp6(2),e.hij(" ",e.xi3(3,1,"order.transition-to-state",e.VKq(8,Ni,e.lcZ(4,4,e.lcZ(5,6,t))))," ")}}function Ui(r,n){1&r&&(e._UZ(0,"clr-icon",24),e._uU(1),e.ALo(2,"translate")),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.cancel-payment")," "))}function ki(r,n){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",20),e.NdJ("click",function(){const a=e.CHM(t).$implicit,s=e.oxw(2);return e.KtG(s.transitionPaymentState.emit({payment:s.payment,state:a}))}),e.YNc(2,Qi,6,10,"ng-container",21),e.YNc(3,Ui,3,3,"ng-template",null,22,e.W1O),e.qZA(),e.BQk()}if(2&r){const t=n.$implicit,o=e.MAs(4);e.xp6(2),e.Q6J("ngIf","Cancelled"!==t)("ngIfElse",o)}}function Ei(r,n){if(1&r&&(e.TgZ(0,"div",14),e.YNc(1,Di,3,3,"button",16),e.TgZ(2,"vdr-dropdown")(3,"button",17),e._UZ(4,"clr-icon",18),e.qZA(),e.TgZ(5,"vdr-dropdown-menu",19),e.YNc(6,ki,5,2,"ng-container",7),e.qZA()()()),2&r){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.payment.nextStates.includes("Settled")),e.xp6(5),e.Q6J("ngForOf",t.nextOtherStates())}}class Ot{constructor(){this.settlePayment=new e.vpe,this.transitionPaymentState=new e.vpe,this.settleRefund=new e.vpe}refundHasMetadata(n){return!!n&&Object.keys(n.metadata).length>0}nextOtherStates(){return this.payment?this.payment.nextStates.filter(n=>"Settled"!==n&&"Error"!==n):[]}}(Ae=Ot).\u0275fac=function(n){return new(n||Ae)},Ae.\u0275cmp=e.Xpm({type:Ae,selectors:[["vdr-order-payment-card"]],inputs:{payment:"payment",currencyCode:"currencyCode"},outputs:{settlePayment:"settlePayment",transitionPaymentState:"transitionPaymentState",settleRefund:"settleRefund"},decls:12,vars:9,consts:[[1,"card"],[1,"card-header","payment-header"],[4,"ngIf"],[1,"payment-state"],[3,"state"],[1,"card-block"],[3,"payment","currencyCode"],[4,"ngFor","ngForOf"],["class","card-footer",4,"ngIf"],["shape","redo","dir","down",1,"refund-icon"],[1,"clr-flex-fill"],[3,"label"],[3,"label",4,"ngIf"],[3,"value"],[1,"card-footer"],[1,"btn","btn-sm","btn-primary",3,"click"],["class","btn btn-sm btn-primary",3,"click",4,"ngIf"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",3,"click"],[4,"ngIf","ngIfElse"],["cancel",""],["shape","step-forward-2"],["shape","error-standard",1,"is-error"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div"),e._uU(3),e.ALo(4,"translate"),e.YNc(5,wi,2,1,"ng-container",2),e.qZA(),e.TgZ(6,"div",3),e._UZ(7,"vdr-payment-state-label",4),e.qZA()(),e.TgZ(8,"div",5),e._UZ(9,"vdr-payment-detail",6),e.qZA(),e.YNc(10,Ji,20,23,"ng-container",7),e.YNc(11,Ei,7,2,"div",8),e.qZA()),2&n&&(e.xp6(3),e.hij(" ",e.lcZ(4,7,"order.payment")," "),e.xp6(2),e.Q6J("ngIf",t.payment.transactionId),e.xp6(2),e.Q6J("state",t.payment.state),e.xp6(2),e.Q6J("payment",t.payment)("currencyCode",t.currencyCode),e.xp6(1),e.Q6J("ngForOf",t.payment.refunds),e.xp6(1),e.Q6J("ngIf",t.payment.nextStates.length))},dependencies:[_.qvL,p.sg,p.O5,Gt.Lv,S.J,P.N,J.U,ee.H,T.W,Ue._,vt,yt,Ke,m.X$,q.N,Ye.H,h.k],styles:[".payment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.refund-icon[_ngcontent-%COMP%]{margin-inline-end:6px;color:var(--color-grey-400)}.card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}"],changeDetection:0});var Ie,Xt=d(4959),Yi=d(4481);const ji=["portal"];class Zt{constructor(n){this.historyEntryComponentService=n,this.expandClick=new e.vpe}ngOnInit(){const n=this.historyEntryComponentService.getComponent(this.entry.type),t=this.portalRef.createComponent(n);t.instance.entry=this.entry,t.instance.order=this.order,this.instance=t.instance,this.componentRef=t}ngOnDestroy(){this.componentRef?.destroy()}}(Ie=Zt).\u0275fac=function(n){return new(n||Ie)(e.Y36(c.GwB))},Ie.\u0275cmp=e.Xpm({type:Ie,selectors:[["vdr-order-history-entry-host"]],viewQuery:function(n,t){if(1&n&&e.Gf(ji,7,e.s_b),2&n){let o;e.iGM(o=e.CRH())&&(t.portalRef=o.first)}},inputs:{entry:"entry",order:"order",expanded:"expanded"},outputs:{expandClick:"expandClick"},exportAs:["historyEntry"],decls:3,vars:6,consts:[[3,"displayType","iconShape","createdAt","name","featured","collapsed","expandClick"],["portal",""]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-timeline-entry",0),e.NdJ("expandClick",function(){return t.expandClick.emit()}),e._UZ(1,"div",null,1),e.qZA()),2&n&&e.Q6J("displayType",t.instance.getDisplayType(t.entry))("iconShape",t.instance.getIconShape&&t.instance.getIconShape(t.entry))("createdAt",t.entry.createdAt)("name",t.instance.getName&&t.instance.getName(t.entry))("featured",t.instance.isFeatured(t.entry))("collapsed",!t.expanded&&!t.instance.isFeatured(t.entry))},dependencies:[Xt._],encapsulation:2});var Le,zt=d(9360);function Ri(r,n){1&r&&(e.TgZ(0,"span",12),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.note-only-visible-to-administrators")," "))}function $i(r,n){1&r&&(e.TgZ(0,"span",13),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.note-visible-to-customer")," "))}function Hi(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"vdr-order-history-entry-host",16),e.NdJ("expandClick",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.expanded=!i.expanded)}),e.qZA()}if(2&r){const t=e.oxw().$implicit,o=e.oxw();e.Q6J("order",o.order)("entry",t)("expanded",o.expanded)}}function Gi(r,n){1&r&&(e.TgZ(0,"div",11),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.history-order-fulfilled")," "))}function Ki(r,n){1&r&&(e.TgZ(0,"div",11),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.history-order-cancelled")," "))}const en=function(r,n){return{from:r,to:n}};function Vi(r,n){if(1&r&&(e._uU(0),e.ALo(1,"translate")),2&r){const t=e.oxw(3).$implicit;e.hij(" ",e.xi3(1,1,"order.history-order-transition",e.WLB(4,en,t.data.from,t.data.to))," ")}}function Bi(r,n){if(1&r&&(e.ynx(0),e.YNc(1,Gi,3,3,"div",21),e.YNc(2,Ki,3,3,"div",21),e.YNc(3,Vi,2,7,"ng-template",22),e.BQk()),2&r){const t=e.oxw(2).$implicit;e.xp6(1),e.Q6J("ngIf","Delivered"===t.data.to),e.xp6(1),e.Q6J("ngIf","Cancelled"===t.data.to),e.xp6(1),e.Q6J("ngIf","Cancelled"!==t.data.to&&"Delivered"!==t.data.to)}}function Wi(r,n){1&r&&(e.TgZ(0,"vdr-chip",27),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"order.modification-settled")))}function Xi(r,n){1&r&&(e.TgZ(0,"vdr-chip",28),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"order.modification-not-settled")))}function zi(r,n){if(1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.TgZ(3,"strong"),e._uU(4),e.ALo(5,"localeCurrency"),e.qZA(),e.YNc(6,Wi,3,3,"vdr-chip",24),e.YNc(7,Xi,3,3,"vdr-chip",25),e.TgZ(8,"vdr-history-entry-detail"),e._UZ(9,"vdr-modification-detail",26),e.qZA(),e.BQk()),2&r){const t=n.ngIf,o=e.oxw(4);e.xp6(1),e.hij(" ",e.lcZ(2,6,"order.modify-order-price-difference"),": "),e.xp6(3),e.Oqu(e.xi3(5,8,t.priceChange,o.order.currencyCode)),e.xp6(2),e.Q6J("ngIf",t.isSettled),e.xp6(1),e.Q6J("ngIf",!t.isSettled),e.xp6(2),e.Q6J("order",o.order)("modification",t)}}function ea(r,n){if(1&r&&(e.ynx(0),e.TgZ(1,"div",11),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,zi,10,11,"ng-container",23),e.BQk()),2&r){const t=e.oxw(2).$implicit,o=e.oxw();e.xp6(2),e.hij(" ",e.lcZ(3,2,"order.history-order-modified")," "),e.xp6(2),e.Q6J("ngIf",o.getModification(t.data.modificationId))}}function ta(r,n){if(1&r&&(e.TgZ(0,"vdr-history-entry-detail"),e._UZ(1,"vdr-payment-detail",31),e.qZA()),2&r){const t=n.ngIf,o=e.oxw(5);e.xp6(1),e.Q6J("payment",t)("currencyCode",o.order.currencyCode)}}function na(r,n){if(1&r&&(e.ynx(0),e.TgZ(1,"div",11),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._uU(4),e.ALo(5,"translate"),e.YNc(6,ta,2,2,"vdr-history-entry-detail",23),e.BQk()),2&r){const t=e.oxw(3).$implicit,o=e.oxw();let i;e.xp6(2),e.hij(" ",e.lcZ(3,4,"order.history-payment-settled")," "),e.xp6(2),e.AsE(" ",e.lcZ(5,6,"order.transaction-id"),": ",null==(i=o.getPayment(t))?null:i.transactionId," "),e.xp6(2),e.Q6J("ngIf",o.getPayment(t))}}const tn=function(r,n,t){return{from:r,to:n,id:t}};function ra(r,n){if(1&r&&(e._uU(0),e.ALo(1,"translate")),2&r){const t=e.oxw(3).$implicit,o=e.oxw();let i;e.hij(" ",e.xi3(1,1,"order.history-payment-transition",e.kEZ(4,tn,t.data.from,t.data.to,null==(i=o.getPayment(t))?null:i.transactionId))," ")}}function oa(r,n){if(1&r&&(e.ynx(0),e.YNc(1,na,7,8,"ng-container",29),e.YNc(2,ra,2,8,"ng-template",null,30,e.W1O),e.BQk()),2&r){const t=e.MAs(3),o=e.oxw(2).$implicit;e.xp6(1),e.Q6J("ngIf","Settled"===o.data.to)("ngIfElse",t)}}function ia(r,n){if(1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&r){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,"order.history-refund-transition",e.kEZ(4,tn,t.data.from,t.data.to,t.data.refundId))," ")}}function aa(r,n){if(1&r&&(e.TgZ(0,"vdr-history-entry-detail")(1,"vdr-labeled-data",32),e.ALo(2,"translate"),e._uU(3),e.qZA(),e.TgZ(4,"vdr-labeled-data",32),e.ALo(5,"translate"),e._UZ(6,"vdr-simple-item-list",33),e.qZA(),e.TgZ(7,"vdr-labeled-data",32),e.ALo(8,"translate"),e._uU(9),e.qZA()()),2&r){const t=n.ngIf,o=e.oxw(3).$implicit;e.xp6(1),e.Q6J("label",e.lcZ(2,6,"order.cancellation-reason")),e.xp6(2),e.hij(" ",o.data.reason," "),e.xp6(1),e.Q6J("label",e.lcZ(5,8,"order.contents")),e.xp6(2),e.Q6J("items",t),e.xp6(1),e.Q6J("label",e.lcZ(8,10,"order.shipping-cancelled")),e.xp6(2),e.hij(" ",o.data.shippingCancelled," ")}}const la=function(r){return{count:r}};function ca(r,n){if(1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.YNc(3,aa,10,12,"vdr-history-entry-detail",23),e.BQk()),2&r){const t=e.oxw(2).$implicit,o=e.oxw();e.xp6(1),e.hij(" ",e.xi3(2,2,"order.history-items-cancelled",e.VKq(5,la,o.getCancelledQuantity(t)))," "),e.xp6(2),e.Q6J("ngIf",o.getCancelledItems(t))}}function da(r,n){if(1&r&&(e.TgZ(0,"vdr-history-entry-detail"),e._UZ(1,"vdr-fulfillment-detail",34),e.qZA()),2&r){const t=n.ngIf,o=e.oxw(4);e.xp6(1),e.Q6J("fulfillmentId",t.id)("order",o.order)}}function sa(r,n){if(1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.YNc(3,da,2,2,"vdr-history-entry-detail",23),e.BQk()),2&r){const t=e.oxw(2).$implicit,o=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,2,"order.history-fulfillment-created")," "),e.xp6(2),e.Q6J("ngIf",o.getFulfillment(t))}}function pa(r,n){if(1&r&&(e.ynx(0),e.TgZ(1,"div",11),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._uU(4),e.ALo(5,"translate"),e.BQk()),2&r){const t=e.oxw(3).$implicit,o=e.oxw();let i;e.xp6(2),e.hij(" ",e.lcZ(3,3,"order.history-fulfillment-delivered")," "),e.xp6(2),e.AsE(" ",e.lcZ(5,5,"order.tracking-code"),": ",null==(i=o.getFulfillment(t))?null:i.trackingCode," ")}}function _a(r,n){if(1&r&&(e.ynx(0),e.TgZ(1,"div",11),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._uU(4),e.ALo(5,"translate"),e.BQk()),2&r){const t=e.oxw(3).$implicit,o=e.oxw();let i;e.xp6(2),e.hij(" ",e.lcZ(3,3,"order.history-fulfillment-shipped")," "),e.xp6(2),e.AsE(" ",e.lcZ(5,5,"order.tracking-code"),": ",null==(i=o.getFulfillment(t))?null:i.trackingCode," ")}}function ua(r,n){if(1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&r){const t=e.oxw(3).$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,"order.history-fulfillment-transition",e.WLB(4,en,t.data.from,t.data.to))," ")}}function ma(r,n){if(1&r&&(e.TgZ(0,"vdr-history-entry-detail"),e._UZ(1,"vdr-fulfillment-detail",34),e.qZA()),2&r){const t=n.ngIf,o=e.oxw(4);e.xp6(1),e.Q6J("fulfillmentId",t.id)("order",o.order)}}function ga(r,n){if(1&r&&(e.ynx(0),e.YNc(1,pa,6,7,"ng-container",23),e.YNc(2,_a,6,7,"ng-container",23),e.YNc(3,ua,3,7,"ng-container",23),e.YNc(4,ma,2,2,"vdr-history-entry-detail",23),e.BQk()),2&r){const t=e.oxw(2).$implicit,o=e.oxw();e.xp6(1),e.Q6J("ngIf","Delivered"===t.data.to),e.xp6(1),e.Q6J("ngIf","Shipped"===t.data.to),e.xp6(1),e.Q6J("ngIf","Delivered"!==t.data.to&&"Shipped"!==t.data.to),e.xp6(1),e.Q6J("ngIf",o.getFulfillment(t))}}function fa(r,n){1&r&&(e.TgZ(0,"span",47),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"common.public")))}function ha(r,n){1&r&&(e.TgZ(0,"span",48),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"common.private")))}function xa(r,n){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",35)(2,"div",36),e.YNc(3,fa,3,3,"span",37),e.YNc(4,ha,3,3,"span",38),e._uU(5),e.qZA(),e._UZ(6,"div",39),e.TgZ(7,"vdr-dropdown")(8,"button",40),e._UZ(9,"clr-icon",41),e.qZA(),e.TgZ(10,"vdr-dropdown-menu",42)(11,"button",43),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2).$implicit,a=e.oxw();return e.KtG(a.updateNote.emit(i))}),e.ALo(12,"hasPermission"),e._UZ(13,"clr-icon",44),e._uU(14),e.ALo(15,"translate"),e.qZA(),e._UZ(16,"div",45),e.TgZ(17,"button",43),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2).$implicit,a=e.oxw();return e.KtG(a.deleteNote.emit(i))}),e.ALo(18,"hasPermission"),e._UZ(19,"clr-icon",46),e._uU(20),e.ALo(21,"translate"),e.qZA()()()(),e.BQk()}if(2&r){const t=e.oxw(2).$implicit;e.xp6(3),e.Q6J("ngIf",t.isPublic),e.xp6(1),e.Q6J("ngIf",!t.isPublic),e.xp6(1),e.hij(" ",t.data.note," "),e.xp6(6),e.Q6J("disabled",!e.lcZ(12,7,"UpdateOrder")),e.xp6(3),e.hij(" ",e.lcZ(15,9,"common.edit")," "),e.xp6(3),e.Q6J("disabled",!e.lcZ(18,11,"UpdateOrder")),e.xp6(3),e.hij(" ",e.lcZ(21,13,"common.delete")," ")}}const Ca=function(r){return["/marketing","promotions",r]};function va(r,n){if(1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.TgZ(3,"vdr-chip")(4,"a",49),e._uU(5),e.qZA()(),e.BQk()),2&r){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,3,"order.history-coupon-code-applied"),": "),e.xp6(3),e.Q6J("routerLink",e.VKq(5,Ca,t.data.promotionId)),e.xp6(1),e.Oqu(t.data.couponCode)}}function ya(r,n){if(1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.TgZ(3,"vdr-chip")(4,"span",50),e._uU(5),e.qZA()(),e.BQk()),2&r){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,2,"order.history-coupon-code-removed"),": "),e.xp6(4),e.Oqu(t.data.couponCode)}}function Oa(r,n){if(1&r&&(e.TgZ(0,"vdr-history-entry-detail"),e._UZ(1,"vdr-object-tree",51),e.qZA()),2&r){const t=e.oxw(3).$implicit;e.xp6(1),e.Q6J("value",t.data)}}function Za(r,n){if(1&r&&(e.ynx(0),e.TgZ(1,"div",11),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,Oa,2,1,"vdr-history-entry-detail",23),e.BQk()),2&r){const t=e.oxw(2).$implicit;e.xp6(2),e.hij(" ",e.lcZ(3,2,t.type)," "),e.xp6(2),e.Q6J("ngIf",t.data)}}function ba(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"vdr-timeline-entry",17),e.NdJ("expandClick",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.expanded=!i.expanded)}),e.ynx(1,18),e.YNc(2,Bi,4,3,"ng-container",19),e.YNc(3,ea,5,4,"ng-container",19),e.YNc(4,oa,4,2,"ng-container",19),e.YNc(5,ia,3,8,"ng-container",19),e.YNc(6,ca,4,7,"ng-container",19),e.YNc(7,sa,4,4,"ng-container",19),e.YNc(8,ga,5,4,"ng-container",19),e.YNc(9,xa,22,15,"ng-container",19),e.YNc(10,va,6,7,"ng-container",19),e.YNc(11,ya,6,4,"ng-container",19),e.YNc(12,Za,5,4,"ng-container",20),e.BQk(),e.qZA()}if(2&r){const t=e.oxw().$implicit,o=e.oxw();e.Q6J("displayType",o.getDisplayType(t))("iconShape",o.getTimelineIcon(t))("createdAt",t.createdAt)("name",o.getName(t))("featured",o.isFeatured(t))("collapsed",!o.expanded&&!o.isFeatured(t)),e.xp6(1),e.Q6J("ngSwitch",t.type),e.xp6(1),e.Q6J("ngSwitchCase",o.type.ORDER_STATE_TRANSITION),e.xp6(1),e.Q6J("ngSwitchCase",o.type.ORDER_MODIFIED),e.xp6(1),e.Q6J("ngSwitchCase",o.type.ORDER_PAYMENT_TRANSITION),e.xp6(1),e.Q6J("ngSwitchCase",o.type.ORDER_REFUND_TRANSITION),e.xp6(1),e.Q6J("ngSwitchCase",o.type.ORDER_CANCELLATION),e.xp6(1),e.Q6J("ngSwitchCase",o.type.ORDER_FULFILLMENT),e.xp6(1),e.Q6J("ngSwitchCase",o.type.ORDER_FULFILLMENT_TRANSITION),e.xp6(1),e.Q6J("ngSwitchCase",o.type.ORDER_NOTE),e.xp6(1),e.Q6J("ngSwitchCase",o.type.ORDER_COUPON_APPLIED),e.xp6(1),e.Q6J("ngSwitchCase",o.type.ORDER_COUPON_REMOVED)}}function Ta(r,n){if(1&r&&(e.ynx(0),e.YNc(1,Hi,1,3,"vdr-order-history-entry-host",14),e.YNc(2,ba,13,17,"ng-template",null,15,e.W1O),e.BQk()),2&r){const t=n.$implicit,o=e.MAs(3),i=e.oxw();e.xp6(1),e.Q6J("ngIf",i.hasCustomComponent(t.type))("ngIfElse",o)}}class bt{constructor(n){this.historyEntryComponentService=n,this.addNote=new e.vpe,this.updateNote=new e.vpe,this.deleteNote=new e.vpe,this.note="",this.noteIsPrivate=!0,this.expanded=!1,this.type=c.iYD}hasCustomComponent(n){return!!this.historyEntryComponentService.getComponent(n)}getDisplayType(n){if(n.type===c.iYD.ORDER_STATE_TRANSITION){if("Delivered"===n.data.to)return"success";if("Cancelled"===n.data.to)return"error"}return n.type===c.iYD.ORDER_FULFILLMENT_TRANSITION&&"Delivered"===n.data.to?"success":n.type===c.iYD.ORDER_PAYMENT_TRANSITION&&("Declined"===n.data.to||"Cancelled"===n.data.to)||n.type===c.iYD.ORDER_CANCELLATION?"error":n.type===c.iYD.ORDER_REFUND_TRANSITION?"warning":"default"}getTimelineIcon(n){if(n.type===c.iYD.ORDER_STATE_TRANSITION){if("Delivered"===n.data.to)return["success-standard","is-solid"];if("Cancelled"===n.data.to)return"ban"}return n.type===c.iYD.ORDER_PAYMENT_TRANSITION&&"Settled"===n.data.to?"credit-card":n.type===c.iYD.ORDER_NOTE?"note":n.type===c.iYD.ORDER_MODIFIED?"pencil":n.type!==c.iYD.ORDER_FULFILLMENT_TRANSITION||"Shipped"!==n.data.to&&"Delivered"!==n.data.to?void 0:"truck"}isFeatured(n){switch(n.type){case c.iYD.ORDER_STATE_TRANSITION:return"Delivered"===n.data.to||"Cancelled"===n.data.to||"Settled"===n.data.to;case c.iYD.ORDER_PAYMENT_TRANSITION:return"Settled"===n.data.to||"Cancelled"===n.data.to;case c.iYD.ORDER_FULFILLMENT_TRANSITION:return"Delivered"===n.data.to||"Shipped"===n.data.to;case c.iYD.ORDER_NOTE:case c.iYD.ORDER_MODIFIED:return!0;default:return!1}}getFulfillment(n){if((n.type===c.iYD.ORDER_FULFILLMENT||n.type===c.iYD.ORDER_FULFILLMENT_TRANSITION)&&this.order.fulfillments)return this.order.fulfillments.find(t=>t.id===n.data.fulfillmentId)}getPayment(n){if(n.type===c.iYD.ORDER_PAYMENT_TRANSITION&&this.order.payments)return this.order.payments.find(t=>t.id===n.data.paymentId)}getCancelledQuantity(n){return n.data.lines.reduce((t,o)=>t+o.quantity,0)}getCancelledItems(n){const t=new Map,o=n.data.lines;for(const i of this.order.lines){const a=o.find(s=>s.orderLineId===i.id);if(a){t.get(i.productVariant.name);t.set(i.productVariant.name,a.quantity)}}return Array.from(t.entries()).map(([i,a])=>({name:i,quantity:a}))}getModification(n){return this.order.modifications.find(t=>t.id===n)}getName(n){const{administrator:t}=n;if(t)return`${t.firstName} ${t.lastName}`;{const o=this.order.customer;if(o)return`${o.firstName} ${o.lastName}`}return""}addNoteToOrder(){this.addNote.emit({note:this.note,isPublic:!this.noteIsPrivate}),this.note="",this.noteIsPrivate=!0}}(Le=bt).\u0275fac=function(n){return new(n||Le)(e.Y36(c.GwB))},Le.\u0275cmp=e.Xpm({type:Le,selectors:[["vdr-order-history"]],inputs:{order:"order",history:"history"},outputs:{addNote:"addNote",updateNote:"updateNote",deleteNote:"deleteNote"},decls:20,vars:21,consts:[[1,"entry-list"],["iconShape","note","displayType","muted",3,"featured"],[1,"note-entry"],["name","note",1,"note",3,"ngModel","ngModelChange"],[1,"btn","btn-secondary",3,"disabled","click"],[1,"visibility-select"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],["class","private",4,"ngIf"],["class","public",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"isLast","createdAt","featured"],[1,"title"],[1,"private"],[1,"public"],[3,"order","entry","expanded","expandClick",4,"ngIf","ngIfElse"],["defaultComponents",""],[3,"order","entry","expanded","expandClick"],[3,"displayType","iconShape","createdAt","name","featured","collapsed","expandClick"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["class","title",4,"ngIf"],[3,"ngIf"],[4,"ngIf"],["colorType","success",4,"ngIf"],["colorType","error",4,"ngIf"],[3,"order","modification"],["colorType","success"],["colorType","error"],[4,"ngIf","ngIfElse"],["regularPaymentTransition",""],[3,"payment","currencyCode"],[3,"label"],[3,"items"],[3,"fulfillmentId","order"],[1,"flex"],[1,"note-text"],["class","note-visibility public",4,"ngIf"],["class","note-visibility private",4,"ngIf"],[1,"flex-spacer"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["vdrDropdownItem","",3,"disabled","click"],["shape","edit"],[1,"dropdown-divider"],["shape","trash",1,"is-danger"],[1,"note-visibility","public"],[1,"note-visibility","private"],[3,"routerLink"],[1,"cancelled-coupon-code"],[3,"value"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"vdr-timeline-entry",1)(2,"div",2)(3,"textarea",3),e.NdJ("ngModelChange",function(i){return t.note=i}),e.qZA(),e.TgZ(4,"button",4),e.NdJ("click",function(){return t.addNoteToOrder()}),e._uU(5),e.ALo(6,"translate"),e.qZA()(),e.TgZ(7,"div",5)(8,"clr-checkbox-wrapper")(9,"input",6),e.NdJ("ngModelChange",function(i){return t.noteIsPrivate=i}),e.qZA(),e.TgZ(10,"label"),e._uU(11),e.ALo(12,"translate"),e.qZA()(),e.YNc(13,Ri,3,3,"span",7),e.YNc(14,$i,3,3,"span",8),e.qZA()(),e.YNc(15,Ta,4,2,"ng-container",9),e.TgZ(16,"vdr-timeline-entry",10)(17,"div",11),e._uU(18),e.ALo(19,"translate"),e.qZA()()()),2&n&&(e.ekj("expanded",t.expanded),e.xp6(1),e.Q6J("featured",!0),e.xp6(2),e.Q6J("ngModel",t.note),e.xp6(1),e.Q6J("disabled",!t.note),e.xp6(1),e.hij(" ",e.lcZ(6,15,"common.add-note")," "),e.xp6(4),e.Q6J("ngModel",t.noteIsPrivate),e.xp6(2),e.Oqu(e.lcZ(12,17,"order.note-is-private")),e.xp6(2),e.Q6J("ngIf",t.noteIsPrivate),e.xp6(1),e.Q6J("ngIf",!t.noteIsPrivate),e.xp6(1),e.Q6J("ngForOf",t.history),e.xp6(1),e.Q6J("isLast",!0)("createdAt",t.order.createdAt)("featured",!0),e.xp6(2),e.hij(" ",e.lcZ(19,19,"order.history-order-created")," "))},dependencies:[_.qvL,_.MgK,_.KKC,_.PEh,p.sg,p.O5,p.RF,p.n9,p.ED,l.Fj,l.Wl,l.JJ,l.On,C.rH,M.Y,x.y,S.J,P.N,J.U,ee.H,T.W,Ue._,Xt._,Yi.C,He,Ke,_e,_t,Zt,m.X$,zt.j,h.k],styles:["[_nghost-%COMP%]{display:block}.entry-list[_ngcontent-%COMP%]{margin-inline-start:calc(var(--space-unit) * 2)}.note-entry[_ngcontent-%COMP%]{display:flex;align-items:center}.note-entry[_ngcontent-%COMP%]   .note[_ngcontent-%COMP%]{flex:1}.note-entry[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0}.visibility-select[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:baseline}.visibility-select[_ngcontent-%COMP%]   .public[_ngcontent-%COMP%]{color:var(--color-warning-700)}.visibility-select[_ngcontent-%COMP%]   .private[_ngcontent-%COMP%]{color:var(--color-success-700)}textarea.note[_ngcontent-%COMP%]{flex:1;height:36px;border-radius:3px;margin-inline-end:6px}.note-text[_ngcontent-%COMP%]{color:var(--color-grey-800);white-space:pre-wrap}.cancelled-coupon-code[_ngcontent-%COMP%]{text-decoration:line-through}.note-visibility[_ngcontent-%COMP%]{text-transform:lowercase}.note-visibility.public[_ngcontent-%COMP%]{color:var(--color-warning-700)}.note-visibility.private[_ngcontent-%COMP%]{color:var(--color-success-700)}"],changeDetection:0});var Aa=d(2058);const nn=R.Ps`
    query GetSellerOrders($orderId: ID!) {
        order(id: $orderId) {
            id
            sellerOrders {
                id
                code
                state
                orderPlacedAt
                currencyCode
                totalWithTax
                channels {
                    id
                    code
                    seller {
                        id
                        name
                    }
                }
            }
        }
    }
`;var Me;function Ia(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",5),e.ALo(1,"translate"),e._uU(2),e.qZA()),2&r){const t=n.ngIf;e.Q6J("label",e.lcZ(1,2,"common.seller")),e.xp6(2),e.hij(" ",t.name," ")}}function La(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",5),e.ALo(1,"translate"),e._uU(2),e.ALo(3,"localeCurrency"),e.qZA()),2&r){const t=e.oxw().$implicit;e.Q6J("label",e.lcZ(1,2,"order.total")),e.xp6(2),e.hij(" ",e.xi3(3,4,t.totalWithTax,t.currencyCode)," ")}}const Ma=function(r){return["seller-orders",r]};function wa(r,n){if(1&r&&(e.TgZ(0,"div")(1,"a",3),e._uU(2),e._UZ(3,"clr-icon",4),e.qZA(),e.TgZ(4,"vdr-labeled-data",5),e.ALo(5,"translate"),e._UZ(6,"vdr-order-state-label",6),e.qZA(),e.YNc(7,Ia,3,4,"vdr-labeled-data",7),e.YNc(8,La,4,7,"vdr-labeled-data",7),e.qZA()),2&r){const t=n.$implicit,o=e.oxw();e.xp6(1),e.Q6J("routerLink",e.VKq(8,Ma,t.id)),e.xp6(1),e.hij("",t.code," "),e.xp6(2),e.Q6J("label",e.lcZ(5,6,"order.state")),e.xp6(2),e.Q6J("state",t.state),e.xp6(1),e.Q6J("ngIf",o.getSeller(t)),e.xp6(1),e.Q6J("ngIf",o.getSeller(t))}}class Tt{constructor(n,t,o){this.router=n,this.dataService=t,this.channelService=o}ngOnInit(){this.sellerOrders$=this.dataService.query(nn,{orderId:this.orderId}).mapSingle(({order:n})=>n?.sellerOrders??[])}getSeller(n){return n.channels.find(o=>o.code!==Aa.z$)?.seller}navigateToSellerOrder(n){this.router.navigate(["/orders",n.id])}}var we;function Fa(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",11),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().ngIf,a=e.oxw();return e.KtG(a.addManualPayment(i))}),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"localeCurrency"),e.qZA()}if(2&r){const t=e.oxw().ngIf,o=e.oxw();e.xp6(1),e.AsE(" ",e.lcZ(2,2,"order.add-payment-to-order")," (",e.xi3(3,4,o.outstandingPaymentAmount(t),t.currencyCode),") ")}}function qa(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",11),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.transitionToState("ArrangingAdditionalPayment"))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.arrange-additional-payment")," "))}function Sa(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.fulfillOrder())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&r){const t=e.oxw().ngIf,o=e.oxw();e.Q6J("disabled",!o.canAddFulfillment(t)),e.xp6(1),e.hij(" ",e.lcZ(2,2,"order.fulfill-order")," ")}}function Pa(r,n){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",9),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.transitionToModifying())}),e._UZ(2,"clr-icon",13),e._uU(3),e.ALo(4,"translate"),e.qZA(),e._UZ(5,"div",8),e.BQk()}2&r&&(e.xp6(3),e.hij(" ",e.lcZ(4,1,"order.modify-order")," "))}function Ja(r,n){1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.refund-and-cancel-order")," "))}function Da(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.hij(" ",e.lcZ(1,1,"order.cancel-order")," ")}function Na(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().ngIf,a=e.oxw();return e.KtG(a.cancelOrRefund(i))}),e._UZ(1,"clr-icon",14),e.YNc(2,Ja,3,3,"ng-container",15),e.YNc(3,Da,2,3,"ng-template",null,16,e.W1O),e.qZA()}if(2&r){const t=e.MAs(4),o=e.oxw().ngIf,i=e.oxw();e.xp6(2),e.Q6J("ngIf",i.orderHasSettledPayments(o))("ngIfElse",t)}}(Me=Tt).\u0275fac=function(n){return new(n||Me)(e.Y36(C.F0),e.Y36(c.DoR),e.Y36(c.Tjy))},Me.\u0275cmp=e.Xpm({type:Me,selectors:[["vdr-seller-orders-card"]],inputs:{orderId:"orderId"},decls:5,vars:6,consts:[[3,"title"],[1,"form-grid"],[4,"ngFor","ngForOf"],[1,"button-ghost","mb-1",3,"routerLink"],["shape","arrow right"],[3,"label"],[3,"state"],[3,"label",4,"ngIf"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-card",0),e.ALo(1,"translate"),e.TgZ(2,"div",1),e.YNc(3,wa,9,10,"div",2),e.ALo(4,"async"),e.qZA()()),2&n&&(e.Q6J("title",e.lcZ(1,2,"order.seller-orders")),e.xp6(3),e.Q6J("ngForOf",e.lcZ(4,4,t.sellerOrders$)))},dependencies:[_.qvL,p.sg,p.O5,C.rH,te.G,T.W,Ee.A,p.Ov,m.X$,h.k],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0});const Qa=function(r){return{state:r}};function Ua(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){const a=e.CHM(t).$implicit,s=e.oxw(3);return e.KtG(s.transitionToState(a))}),e._UZ(1,"clr-icon",18),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"translate"),e.ALo(5,"stateI18nToken"),e.qZA()}if(2&r){const t=n.$implicit;e.xp6(2),e.hij(" ",e.xi3(3,1,"order.transition-to-state",e.VKq(8,Qa,e.lcZ(4,4,e.lcZ(5,6,t))))," ")}}function ka(r,n){if(1&r&&(e.ynx(0),e._UZ(1,"div",8),e.YNc(2,Ua,6,10,"button",17),e.ALo(3,"async"),e.BQk()),2&r){const t=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",e.lcZ(3,1,t.nextStates$))}}function Ea(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"vdr-action-bar"),e._UZ(1,"vdr-ab-left"),e.TgZ(2,"vdr-ab-right"),e._UZ(3,"vdr-action-bar-items",1),e.YNc(4,Fa,4,7,"button",2),e.YNc(5,qa,3,3,"button",2),e.YNc(6,Sa,3,4,"button",3),e.TgZ(7,"vdr-dropdown")(8,"button",4),e._UZ(9,"clr-icon",5),e.qZA(),e.TgZ(10,"vdr-dropdown-menu",6),e.YNc(11,Pa,6,3,"ng-container",0),e.YNc(12,Na,5,2,"button",7),e.YNc(13,ka,4,3,"ng-container",0),e.ALo(14,"async"),e._UZ(15,"div",8),e.TgZ(16,"button",9),e.NdJ("click",function(){const a=e.CHM(t).ngIf,s=e.oxw();return e.KtG(s.manuallyTransitionToState(a))}),e._UZ(17,"clr-icon",10),e._uU(18),e.ALo(19,"translate"),e.qZA()()()()()}if(2&r){const t=n.ngIf,o=e.oxw();let i;e.xp6(4),e.Q6J("ngIf","Aggregate"!==t.type&&("ArrangingPayment"===t.state||"ArrangingAdditionalPayment"===t.state)&&(o.hasUnsettledModifications(t)||0<o.outstandingPaymentAmount(t))),e.xp6(1),e.Q6J("ngIf","Aggregate"!==t.type&&!1===t.active&&"ArrangingAdditionalPayment"!==t.state&&"ArrangingPayment"!==t.state&&0<o.outstandingPaymentAmount(t)),e.xp6(1),e.Q6J("ngIf","Aggregate"!==t.type),e.xp6(5),e.Q6J("ngIf","Aggregate"!==t.type&&t.nextStates.includes("Modifying")),e.xp6(1),e.Q6J("ngIf","Aggregate"!==t.type&&t.nextStates.includes("Cancelled")),e.xp6(1),e.Q6J("ngIf",null==(i=e.lcZ(14,7,o.nextStates$))?null:i.length),e.xp6(5),e.hij(" ",e.lcZ(19,9,"order.manually-transition-to-state")," ")}}function Ya(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",36),e.ALo(1,"translate"),e._UZ(2,"vdr-formatted-address",37),e.qZA()),2&r){const t=e.oxw().ngIf;e.Q6J("label",e.lcZ(1,2,"order.shipping-address")),e.xp6(2),e.Q6J("address",t.shippingAddress)}}function ja(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",38),e.ALo(1,"translate"),e._UZ(2,"vdr-formatted-address",37),e.qZA()),2&r){const t=e.oxw().ngIf;e.Q6J("label",e.lcZ(1,2,"order.billing-address")),e.xp6(2),e.Q6J("address",t.billingAddress)}}function Ra(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"vdr-order-payment-card",40),e.NdJ("settlePayment",function(i){e.CHM(t);const a=e.oxw(3);return e.KtG(a.settlePayment(i))})("transitionPaymentState",function(i){e.CHM(t);const a=e.oxw(3);return e.KtG(a.transitionPaymentState(i))})("settleRefund",function(i){e.CHM(t);const a=e.oxw(3);return e.KtG(a.settleRefund(i))}),e.qZA()}if(2&r){const t=n.$implicit,o=e.oxw(2).ngIf;e.Q6J("currencyCode",o.currencyCode)("payment",t)}}function $a(r,n){if(1&r&&(e.TgZ(0,"vdr-card",22),e.ALo(1,"translate"),e.YNc(2,Ra,1,2,"vdr-order-payment-card",39),e.qZA()),2&r){const t=e.oxw().ngIf;e.Q6J("title",e.lcZ(1,2,"order.payments")),e.xp6(2),e.Q6J("ngForOf",t.payments)}}function Ha(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"vdr-fulfillment-card",42),e.NdJ("transitionState",function(i){const s=e.CHM(t).$implicit,f=e.oxw(3);return e.KtG(f.transitionFulfillment(s.id,i))}),e.qZA()}if(2&r){const t=n.$implicit,o=e.oxw(2).ngIf;e.Q6J("fulfillment",t)("order",o)}}function Ga(r,n){if(1&r&&(e.TgZ(0,"vdr-card"),e.YNc(1,Ha,1,2,"vdr-fulfillment-card",41),e.qZA()),2&r){const t=e.oxw().ngIf;e.xp6(1),e.Q6J("ngForOf",t.fulfillments)}}function Ka(r,n){if(1&r&&e._UZ(0,"vdr-page-entity-info",43),2&r){const t=n.ngIf;e.Q6J("entity",t)}}function Va(r,n){if(1&r&&e._UZ(0,"vdr-seller-orders-card",44),2&r){const t=e.oxw().ngIf;e.Q6J("orderId",t.id)}}function Ba(r,n){if(1&r&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.ALo(5,"percent"),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.ALo(8,"localeCurrency"),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.ALo(11,"localeCurrency"),e.qZA()()),2&r){const t=n.$implicit,o=e.oxw().ngIf;e.xp6(2),e.Oqu(t.description),e.xp6(2),e.Oqu(e.xi3(5,4,t.taxRate/100,"0.0-2")),e.xp6(3),e.Oqu(e.xi3(8,7,t.taxBase,o.currencyCode)),e.xp6(3),e.Oqu(e.xi3(11,10,t.taxTotal,o.currencyCode))}}function Wa(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"vdr-card",22),e.ALo(1,"translate"),e._UZ(2,"vdr-tabbed-custom-fields",45),e.ALo(3,"hasPermission"),e.TgZ(4,"button",46),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.updateCustomFields())}),e._uU(5),e.ALo(6,"translate"),e.qZA()()}if(2&r){const t=e.oxw(2);let o;e.Q6J("title",e.lcZ(1,6,"common.custom-fields")),e.xp6(2),e.Q6J("customFields",t.customFields)("customFieldsFormGroup",t.detailForm.get("customFields"))("readonly",!e.lcZ(3,8,"UpdateOrder")),e.xp6(2),e.Q6J("disabled",(null==(o=t.detailForm.get("customFields"))?null:o.pristine)||(null==(o=t.detailForm.get("customFields"))?null:o.invalid)),e.xp6(1),e.hij(" ",e.lcZ(6,10,"common.update")," ")}}function Xa(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"vdr-page-detail-layout")(1,"vdr-page-detail-sidebar")(2,"vdr-card")(3,"vdr-order-state-label",19)(4,"button",20),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.openStateDiagram())}),e.ALo(5,"translate"),e._UZ(6,"clr-icon",21),e.qZA()()(),e.TgZ(7,"vdr-card",22),e.ALo(8,"translate"),e._UZ(9,"vdr-customer-label",23),e.YNc(10,Ya,3,4,"vdr-labeled-data",24),e.YNc(11,ja,3,4,"vdr-labeled-data",25),e.qZA(),e.YNc(12,$a,3,4,"vdr-card",26),e.YNc(13,Ga,2,1,"vdr-card",0),e.TgZ(14,"vdr-card"),e.YNc(15,Ka,1,1,"vdr-page-entity-info",27),e.ALo(16,"async"),e.qZA()(),e.TgZ(17,"vdr-page-block"),e.YNc(18,Va,1,1,"vdr-seller-orders-card",28),e.TgZ(19,"vdr-card",29),e._UZ(20,"vdr-order-table",30),e.qZA(),e.TgZ(21,"vdr-card",31),e.ALo(22,"translate"),e.TgZ(23,"table",32)(24,"thead")(25,"tr")(26,"th"),e._uU(27),e.ALo(28,"translate"),e.qZA(),e.TgZ(29,"th"),e._uU(30),e.ALo(31,"translate"),e.qZA(),e.TgZ(32,"th"),e._uU(33),e.ALo(34,"translate"),e.qZA(),e.TgZ(35,"th"),e._uU(36),e.ALo(37,"translate"),e.qZA()()(),e.TgZ(38,"tbody"),e.YNc(39,Ba,12,13,"tr",33),e.qZA()()(),e.YNc(40,Wa,7,12,"vdr-card",26),e._UZ(41,"vdr-custom-detail-component-host",34),e.TgZ(42,"vdr-card",22),e.ALo(43,"translate"),e.TgZ(44,"vdr-order-history",35),e.NdJ("addNote",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.addNote(i))})("updateNote",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.updateNote(i))})("deleteNote",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.deleteNote(i))}),e.ALo(45,"async"),e.qZA()()()()}if(2&r){const t=n.ngIf,o=e.oxw();e.xp6(3),e.Q6J("state",t.state),e.xp6(1),e.Q6J("title",e.lcZ(5,26,"order.order-state-diagram")),e.xp6(3),e.Q6J("title",e.lcZ(8,28,"order.customer")),e.xp6(2),e.Q6J("customer",t.customer),e.xp6(1),e.Q6J("ngIf",o.getOrderAddressLines(t.shippingAddress).length),e.xp6(1),e.Q6J("ngIf",o.getOrderAddressLines(t.billingAddress).length),e.xp6(1),e.Q6J("ngIf",null==t.payments?null:t.payments.length),e.xp6(1),e.Q6J("ngIf",null==t.fulfillments?null:t.fulfillments.length),e.xp6(2),e.Q6J("ngIf",e.lcZ(16,30,o.entity$)),e.xp6(3),e.Q6J("ngIf",t.sellerOrders.length),e.xp6(1),e.Q6J("paddingX",!1),e.xp6(1),e.Q6J("order",t)("orderLineCustomFields",o.orderLineCustomFields),e.xp6(1),e.Q6J("title",e.lcZ(22,32,"order.tax-summary"))("paddingX",!1),e.xp6(6),e.Oqu(e.lcZ(28,34,"common.description")),e.xp6(3),e.Oqu(e.lcZ(31,36,"order.tax-rate")),e.xp6(3),e.Oqu(e.lcZ(34,38,"order.tax-base")),e.xp6(3),e.Oqu(e.lcZ(37,40,"order.tax-total")),e.xp6(3),e.Q6J("ngForOf",t.taxSummary),e.xp6(1),e.Q6J("ngIf",o.customFields.length),e.xp6(1),e.Q6J("entity$",o.entity$)("detailForm",o.detailForm),e.xp6(1),e.Q6J("title",e.lcZ(43,42,"order.order-history")),e.xp6(2),e.Q6J("order",t)("history",e.lcZ(45,44,o.history$))}}const za=R.Ps`
    query OrderDetailQuery($id: ID!) {
        order(id: $id) {
            ...OrderDetail
        }
    }
    ${c.gfD}
`;class At extends c.VE7{constructor(n,t,o,i,a,s){super(),this.changeDetector=n,this.dataService=t,this.notificationService=o,this.modalService=i,this.orderTransitionService=a,this.formBuilder=s,this.customFields=this.getCustomFieldConfig("Order"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.detailForm=new l.cw({customFields:this.formBuilder.group((0,c.Lrj)(this.customFields))}),this.fetchHistory=new N.x,this.defaultStates=["AddingItems","ArrangingPayment","PaymentAuthorized","PaymentSettled","PartiallyShipped","Shipped","PartiallyDelivered","Delivered","Cancelled","Modifying","ArrangingAdditionalPayment"]}ngOnInit(){this.init(),this.entity$.pipe((0,w.q)(1)).subscribe(n=>{"Modifying"===n.state&&this.router.navigate(["./","modify"],{relativeTo:this.route})}),this.history$=this.fetchHistory.pipe((0,Jt.O)(null),(0,g.w)(()=>this.dataService.order.getOrderHistory(this.id,{sort:{createdAt:c.Asd.DESC}}).mapStream(n=>n.order?.history.items))),this.nextStates$=this.entity$.pipe((0,b.U)(n=>this.defaultStates.includes(n.state)?n.nextStates.filter(o=>!this.defaultStates.includes(o)):n.nextStates))}ngOnDestroy(){this.destroy()}openStateDiagram(){this.entity$.pipe((0,w.q)(1),(0,g.w)(n=>this.modalService.fromComponent(ht,{closable:!0,locals:{activeState:n.state}}))).subscribe()}transitionToState(n){this.dataService.order.transitionToState(this.id,n).subscribe(({transitionOrderToState:t})=>{switch(t?.__typename){case"Order":this.notificationService.success((0,u.J)("order.transitioned-to-state-success"),{state:n}),this.fetchHistory.next();break;case"OrderStateTransitionError":this.notificationService.error(t.transitionError)}})}manuallyTransitionToState(n){this.orderTransitionService.manuallyTransitionToState({orderId:n.id,nextStates:n.nextStates,cancellable:!0,message:(0,u.J)("order.manually-transition-to-state-message"),retry:0}).subscribe()}transitionToModifying(){this.dataService.order.transitionToState(this.id,"Modifying").subscribe(({transitionOrderToState:n})=>{switch(n?.__typename){case"Order":this.router.navigate(["./modify"],{relativeTo:this.route});break;case"OrderStateTransitionError":this.notificationService.error(n.transitionError)}})}updateCustomFields(){this.dataService.order.updateOrderCustomFields({id:this.id,customFields:this.detailForm.value.customFields}).subscribe(()=>{this.notificationService.success((0,u.J)("common.notify-update-success"),{entity:"Order"})})}getOrderAddressLines(n){return n?Object.values(n).filter(t=>"OrderAddress"!==t).filter(t=>!!t):[]}settlePayment(n){this.dataService.order.settlePayment(n.id).subscribe(({settlePayment:t})=>{switch(t.__typename){case"Payment":"Settled"===t.state?this.notificationService.success((0,u.J)("order.settle-payment-success")):this.notificationService.error((0,u.J)("order.settle-payment-error")),this.dataService.order.getOrder(this.id).single$.subscribe(),this.fetchHistory.next();break;case"OrderStateTransitionError":case"PaymentStateTransitionError":case"SettlePaymentError":this.notificationService.error(t.message)}})}transitionPaymentState({payment:n,state:t}){"Cancelled"===t?this.dataService.order.cancelPayment(n.id).subscribe(({cancelPayment:o})=>{switch(o.__typename){case"Payment":this.notificationService.success((0,u.J)("order.transitioned-payment-to-state-success"),{state:t}),this.dataService.order.getOrder(this.id).single$.subscribe(),this.fetchHistory.next();break;case"PaymentStateTransitionError":this.notificationService.error(o.transitionError);break;case"CancelPaymentError":this.notificationService.error(o.paymentErrorMessage)}}):this.dataService.order.transitionPaymentToState(n.id,t).subscribe(({transitionPaymentToState:o})=>{switch(o.__typename){case"Payment":this.notificationService.success((0,u.J)("order.transitioned-payment-to-state-success"),{state:t}),this.dataService.order.getOrder(this.id).single$.subscribe(),this.fetchHistory.next();break;case"PaymentStateTransitionError":this.notificationService.error(o.message)}})}canAddFulfillment(n){const t=(n.fulfillments??[]).filter(i=>"Cancelled"!==i.state).reduce((i,a)=>[...i,...a.lines],[]);let o=!0;for(const i of n.lines)t.filter(s=>s.orderLineId===i.id).reduce((s,f)=>s+f.quantity,0)<i.quantity&&(o=!1);return!o&&!this.hasUnsettledModifications(n)&&0===this.outstandingPaymentAmount(n)&&(n.nextStates.includes("Shipped")||n.nextStates.includes("PartiallyShipped")||n.nextStates.includes("Delivered"))}hasUnsettledModifications(n){return 0<n.modifications.filter(t=>!t.isSettled).length}getOutstandingModificationAmount(n){return(0,A.summate)(n.modifications.filter(t=>!t.isSettled),"priceChange")}outstandingPaymentAmount(n){const t=i=>"Cancelled"!==i.state&&"Declined"!==i.state&&"Error"!==i.state;let o=0;for(const i of n.payments?.filter(t)??[]){const a=i.refunds.filter(f=>"Failed"!==f.state)??[],s=(0,A.summate)(a,"total");o+=i.amount-s}return n.totalWithTax-o}addManualPayment(n){const t=n.state;this.modalService.fromComponent(Be,{closable:!0,locals:{outstandingAmount:this.outstandingPaymentAmount(n),currencyCode:n.currencyCode}}).pipe((0,g.w)(o=>o?this.dataService.order.addManualPaymentToOrder({orderId:this.id,transactionId:o.transactionId,method:o.method,metadata:o.metadata||{}}):F.E),(0,g.w)(({addManualPaymentToOrder:o})=>{switch(o.__typename){case"Order":return this.notificationService.success((0,u.J)("order.add-payment-to-order-success")),"ArrangingAdditionalPayment"===t?this.orderTransitionService.transitionToPreModifyingState(n.id,n.nextStates):(0,v.of)("PaymentSettled");case"ManualPaymentStateError":return this.notificationService.error(o.message),F.E;default:return F.E}})).subscribe(o=>{o&&this.refetchOrder({result:o})})}fulfillOrder(){this.entity$.pipe((0,w.q)(1),(0,g.w)(n=>this.modalService.fromComponent(dt,{size:"xl",locals:{order:n}})),(0,g.w)(n=>n?this.dataService.order.createFulfillment(n):(0,v.of)(void 0)),(0,g.w)(n=>this.refetchOrder(n).pipe((0,Bt.h)(n)))).subscribe(n=>{if(n){const{addFulfillmentToOrder:t}=n;switch(t.__typename){case"Fulfillment":this.notificationService.success((0,u.J)("order.create-fulfillment-success"));break;case"EmptyOrderLineSelectionError":case"InsufficientStockOnHandError":case"ItemsAlreadyFulfilledError":case"InvalidFulfillmentHandlerError":this.notificationService.error(t.message);break;case"FulfillmentStateTransitionError":this.notificationService.error(t.transitionError);break;case"CreateFulfillmentError":this.notificationService.error(t.fulfillmentHandlerError);break;case void 0:this.notificationService.error(JSON.stringify(t));break;default:(0,A.assertNever)(t)}}})}transitionFulfillment(n,t){this.dataService.order.transitionFulfillmentToState(n,t).pipe((0,g.w)(o=>this.refetchOrder(o))).subscribe(()=>{this.notificationService.success((0,u.J)("order.successfully-updated-fulfillment"))})}cancelOrRefund(n){const t=this.orderHasSettledPayments(n);"PaymentAuthorized"!==n.state&&!0!==n.active&&t?this.refundOrder(n):this.cancelOrder(n)}settleRefund(n){this.modalService.fromComponent(Ct,{size:"md",locals:{refund:n}}).pipe((0,g.w)(t=>t?this.dataService.order.settleRefund({transactionId:t,id:n.id},this.id):(0,v.of)(void 0))).subscribe(t=>{t&&this.notificationService.success((0,u.J)("order.settle-refund-success"))})}addNote(n){const{note:t,isPublic:o}=n;this.dataService.order.addNoteToOrder({id:this.id,note:t,isPublic:o}).pipe((0,g.w)(i=>this.refetchOrder(i))).subscribe(i=>{this.notificationService.success((0,u.J)("common.notify-create-success"),{entity:"Note"})})}updateNote(n){this.modalService.fromComponent(c.UlA,{closable:!0,locals:{displayPrivacyControls:!0,note:n.data.note,noteIsPrivate:!n.isPublic}}).pipe((0,g.w)(t=>t?this.dataService.order.updateOrderNote({noteId:n.id,isPublic:!t.isPrivate,note:t.note}):F.E)).subscribe(t=>{this.fetchHistory.next(),this.notificationService.success((0,u.J)("common.notify-update-success"),{entity:"Note"})})}deleteNote(n){return this.modalService.dialog({title:(0,u.J)("common.confirm-delete-note"),body:n.data.note,buttons:[{type:"secondary",label:(0,u.J)("common.cancel")},{type:"danger",label:(0,u.J)("common.delete"),returnValue:!0}]}).pipe((0,g.w)(t=>t?this.dataService.order.deleteOrderNote(n.id):F.E)).subscribe(()=>{this.fetchHistory.next(),this.notificationService.success((0,u.J)("common.notify-delete-success"),{entity:"Note"})})}orderHasSettledPayments(n){return!!n.payments?.find(t=>"Settled"===t.state)}cancelOrder(n){this.modalService.fromComponent(We,{size:"xl",locals:{order:n}}).pipe((0,g.w)(t=>t?this.dataService.order.cancelOrder(t):(0,v.of)(void 0)),(0,g.w)(t=>this.refetchOrder(t))).subscribe(t=>{t&&this.notificationService.success((0,u.J)("order.cancelled-order-success"))})}refundOrder(n){this.modalService.fromComponent(xt,{size:"xl",locals:{order:n}}).pipe((0,g.w)(t=>t?t.cancel.lines?.length?this.dataService.order.cancelOrder(t.cancel).pipe((0,b.U)(o=>{const i=o.cancelOrder;switch(i.__typename){case"Order":return this.refetchOrder(i).subscribe(),this.notificationService.success((0,u.J)("order.cancelled-order-success")),t;case"CancelActiveOrderError":case"QuantityTooGreatError":case"MultipleOrderError":case"OrderStateTransitionError":case"EmptyOrderLineSelectionError":return void this.notificationService.error(i.message)}})):[t]:(0,v.of)(void 0)),(0,g.w)(t=>t?t.refund.lines.length?this.dataService.order.refundOrder(t.refund).pipe((0,b.U)(o=>o.refundOrder)):[void 0]:(0,v.of)(void 0))).subscribe(t=>{if(t)switch(t.__typename){case"Refund":this.refetchOrder(t).subscribe(),"Failed"===t.state?this.notificationService.error((0,u.J)("order.refund-order-failed")):this.notificationService.success((0,u.J)("order.refund-order-success"));break;case"AlreadyRefundedError":case"NothingToRefundError":case"PaymentOrderMismatchError":case"RefundOrderStateError":case"RefundStateTransitionError":this.notificationService.error(t.message)}})}refetchOrder(n){return this.fetchHistory.next(),n?this.dataService.order.getOrder(this.id).single$:(0,v.of)(void 0)}setFormValues(n){this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get(["customFields"]),n)}}(we=At).\u0275fac=function(n){return new(n||we)(e.Y36(e.sBO),e.Y36(c.DoR),e.Y36(c.gqp),e.Y36(c.Z7U),e.Y36(z),e.Y36(l.qu))},we.\u0275cmp=e.Xpm({type:we,selectors:[["vdr-order-detail"]],features:[e.qOj],decls:5,vars:6,consts:[[4,"ngIf"],["locationId","order-detail"],["class","button primary mr-1",3,"click",4,"ngIf"],["class","button primary mr-1",3,"disabled","click",4,"ngIf"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",3,"click",4,"ngIf"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",3,"click"],["shape","step-forward-2",1,"is-warning"],[1,"button","primary","mr-1",3,"click"],[1,"button","primary","mr-1",3,"disabled","click"],["shape","pencil"],["shape","error-standard",1,"is-error"],[4,"ngIf","ngIfElse"],["cancelOnly",""],["type","button","vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["shape","step-forward-2"],[3,"state"],[1,"icon-button",3,"title","click"],["shape","list"],[3,"title"],[3,"customer"],["class","mt-2",3,"label",4,"ngIf"],[3,"label",4,"ngIf"],[3,"title",4,"ngIf"],[3,"entity",4,"ngIf"],["class","mb-2",3,"orderId",4,"ngIf"],[3,"paddingX"],[3,"order","orderLineCustomFields"],[3,"title","paddingX"],[1,"table"],[4,"ngFor","ngForOf"],["locationId","order-detail",3,"entity$","detailForm"],[3,"order","history","addNote","updateNote","deleteNote"],[1,"mt-2",3,"label"],[1,"mt-1",3,"address"],[3,"label"],[3,"currencyCode","payment","settlePayment","transitionPaymentState","settleRefund",4,"ngFor","ngForOf"],[3,"currencyCode","payment","settlePayment","transitionPaymentState","settleRefund"],[3,"fulfillment","order","transitionState",4,"ngFor","ngForOf"],[3,"fulfillment","order","transitionState"],[3,"entity"],[1,"mb-2",3,"orderId"],["entityName","Order",3,"customFields","customFieldsFormGroup","readonly"],[1,"button","primary",3,"disabled","click"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-page-block"),e.YNc(1,Ea,20,11,"vdr-action-bar",0),e.ALo(2,"async"),e.qZA(),e.YNc(3,Xa,46,46,"vdr-page-detail-layout",0),e.ALo(4,"async")),2&n&&(e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,t.entity$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,4,t.entity$)))},dependencies:[_.qvL,p.sg,p.O5,O.Kk,O.BN,O.mz,nt.d,S.J,P.N,J.U,ee.H,te.G,Ne.b,T.W,rt.W,ot.y,Et.C,ke.z,Yt.D,jt.T,Rt.W,Ee.A,Ot,bt,pt,le,Tt,p.Ov,p.Zx,m.X$,zt.j,q.N,h.k],styles:[".shipping-address[_ngcontent-%COMP%]{list-style-type:none;line-height:1.3em}.order-cards[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin-top:6px;color:var(--color-text-200)}"],changeDetection:0});var Fe,I,r,el=d(1262),Ve=d(8163),rn=d(5808);function tl(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.Oqu(e.lcZ(1,1,"order.confirm-modifications"))}function nl(r,n){if(1&r&&(e.TgZ(0,"option",9),e._uU(1),e.ALo(2,"localeCurrency"),e.qZA()),2&r){const t=n.$implicit,o=e.oxw(2);e.Q6J("ngValue",t),e.xp6(1),e.lnq(" #",t.id," ",t.method,": ",e.xi3(2,4,t.amount,o.order.currencyCode)," ")}}function rl(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div")(1,"clr-select-container")(2,"label"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"select",5),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.selectedPayment=i)}),e.YNc(6,nl,3,7,"option",6),e.qZA()(),e.TgZ(7,"label",7),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"textarea",8),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.refundNote=i)}),e.qZA()()}if(2&r){const t=e.oxw();e.xp6(3),e.Oqu(e.lcZ(4,5,"order.payment-to-refund")),e.xp6(2),e.Q6J("ngModel",t.selectedPayment),e.xp6(1),e.Q6J("ngForOf",t.order.payments),e.xp6(2),e.Oqu(e.lcZ(9,7,"order.refund-cancellation-reason")),e.xp6(2),e.Q6J("ngModel",t.refundNote)}}function ol(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"button",11),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.submit())}),e._uU(4),e.ALo(5,"translate"),e.qZA()}if(2&r){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,3,"common.cancel")),e.xp6(2),e.Q6J("disabled",t.priceDifference<0&&!t.selectedPayment),e.xp6(1),e.hij(" ",e.lcZ(5,5,"common.confirm")," ")}}(r=I||(I={}))[r.Refund=0]="Refund",r[r.Payment=1]="Payment",r[r.PriceUnchanged=2]="PriceUnchanged",r[r.Cancel=3]="Cancel";class It{get priceDifference(){return this.order.totalWithTax-this.originalTotalWithTax}ngOnInit(){this.refundNote=this.modifyOrderInput.note||""}cancel(){this.resolveWith({result:I.Cancel})}submit(){0<this.priceDifference?this.resolveWith({result:I.Payment}):this.priceDifference<0?this.resolveWith({result:I.Refund,refundPaymentId:this.selectedPayment.id,refundNote:this.refundNote}):this.resolveWith({result:I.PriceUnchanged})}}(Fe=It).\u0275fac=function(n){return new(n||Fe)},Fe.\u0275cmp=e.Xpm({type:Fe,selectors:[["vdr-order-edits-preview-dialog"]],decls:10,vars:10,consts:[["vdrDialogTitle",""],[3,"order","orderLineCustomFields"],[1,"h4"],[4,"ngIf"],["vdrDialogButtons",""],["clrSelect","","name","options",3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"clr-control-label"],["name","refundNote","clrTextarea","","required","",3,"ngModel","ngModelChange"],[3,"ngValue"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(n,t){1&n&&(e.YNc(0,tl,2,3,"ng-template",0),e._UZ(1,"vdr-order-table",1),e.TgZ(2,"h4",2),e._uU(3),e.ALo(4,"translate"),e.TgZ(5,"strong"),e._uU(6),e.ALo(7,"localeCurrency"),e.qZA()(),e.YNc(8,rl,11,9,"div",3),e.YNc(9,ol,6,7,"ng-template",4)),2&n&&(e.xp6(1),e.Q6J("order",t.order)("orderLineCustomFields",t.orderLineCustomFields),e.xp6(2),e.hij(" ",e.lcZ(4,5,"order.modify-order-price-difference"),": "),e.xp6(3),e.Oqu(e.xi3(7,7,t.priceDifference,t.order.currencyCode)),e.xp6(2),e.Q6J("ngIf",t.priceDifference<0))},dependencies:[_.MgK,_.otW,_.dTv,_.XE5,p.sg,p.O5,l.YN,l.Kr,l.Fj,l.EJ,l.JJ,l.Q7,l.On,x.y,Z.n,y.q,le,m.X$,h.k],changeDetection:0});var qe,il=d(9311);function al(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"vdr-action-bar")(1,"vdr-ab-left")(2,"div",1),e._UZ(3,"vdr-order-state-label",2),e.qZA()(),e.TgZ(4,"vdr-ab-right")(5,"button",3),e.NdJ("click",function(){const a=e.CHM(t).ngIf,s=e.oxw();return e.KtG(s.transitionToPriorState(a))}),e._uU(6),e.ALo(7,"translate"),e.qZA()()()}if(2&r){const t=n.ngIf;e.xp6(3),e.Q6J("state",t.state),e.xp6(3),e.hij(" ",e.lcZ(7,2,"order.cancel-modification")," ")}}function ll(r,n){1&r&&(e.TgZ(0,"th"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"common.custom-fields")," "))}function cl(r,n){if(1&r&&(e._UZ(0,"img",40),e.ALo(1,"assetPreview")),2&r){const t=e.oxw().$implicit;e.Q6J("src",e.xi3(1,1,t.featuredAsset,"tiny"),e.LSH)}}const on=function(r){return[r]};function dl(r,n){if(1&r&&(e.TgZ(0,"td",41),e._UZ(1,"vdr-tabbed-custom-fields",42),e.qZA()),2&r){const t=e.oxw().index,o=e.oxw(2);e.xp6(1),e.Q6J("customFields",o.orderLineCustomFields)("customFieldsFormGroup",o.orderLineCustomFieldsFormArray.get(e.VKq(3,on,t)))("compact",!0)}}function sl(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"tr",28)(1,"td",29),e.YNc(2,cl,2,4,"img",30),e.qZA(),e.TgZ(3,"td",31),e._uU(4),e.qZA(),e.TgZ(5,"td",32),e._uU(6),e.qZA(),e.TgZ(7,"td",33),e._uU(8),e.ALo(9,"localeCurrency"),e.TgZ(10,"div",15),e.ALo(11,"translate"),e._uU(12),e.ALo(13,"localeCurrency"),e.qZA()(),e.TgZ(14,"td",34)(15,"input",35),e.NdJ("input",function(i){const s=e.CHM(t).$implicit,f=e.oxw(2);return e.KtG(f.updateLineQuantity(s,i.target.value))}),e.qZA(),e._UZ(16,"vdr-line-refunds",36)(17,"vdr-line-fulfillment",37),e.qZA(),e.YNc(18,dl,2,5,"td",38),e.TgZ(19,"td",39),e._uU(20),e.ALo(21,"localeCurrency"),e.TgZ(22,"div",15),e.ALo(23,"translate"),e._uU(24),e.ALo(25,"localeCurrency"),e.qZA()()()}if(2&r){const t=n.$implicit,o=e.oxw().ngIf,i=e.oxw();e.ekj("is-cancelled",0===t.quantity)("modified",i.isLineModified(t)),e.xp6(2),e.Q6J("ngIf",t.featuredAsset),e.xp6(2),e.Oqu(t.productVariant.name),e.xp6(2),e.Oqu(t.productVariant.sku),e.xp6(2),e.hij(" ",e.xi3(9,20,t.unitPriceWithTax,o.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(11,23,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(13,25,t.unitPrice,o.currencyCode)," "),e.xp6(3),e.Q6J("value",t.quantity),e.xp6(1),e.Q6J("line",t)("payments",o.payments),e.xp6(1),e.Q6J("line",t)("allOrderFulfillments",o.fulfillments)("orderState",o.state),e.xp6(1),e.Q6J("ngIf",i.orderLineCustomFields.length),e.xp6(2),e.hij(" ",e.xi3(21,28,t.linePriceWithTax,o.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(23,31,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(25,33,t.linePrice,o.currencyCode)," ")}}function pl(r,n){if(1&r&&(e._UZ(0,"img",40),e.ALo(1,"assetPreview")),2&r){const t=e.oxw().$implicit;e.Q6J("src",e.xi3(1,1,t.productAsset,"tiny"),e.LSH)}}function _l(r,n){if(1&r&&(e.ynx(0),e._UZ(1,"vdr-custom-field-control",47),e.BQk()),2&r){const t=n.$implicit,o=e.oxw(2).index,i=e.oxw(2);e.xp6(1),e.Q6J("customField",t)("customFieldsFormGroup",i.addItemCustomFieldsFormArray.get(e.VKq(3,on,o)))("compact",!0)}}function ul(r,n){if(1&r&&(e.TgZ(0,"td",41),e.YNc(1,_l,2,5,"ng-container",46),e.qZA()),2&r){const t=e.oxw(3);e.xp6(1),e.Q6J("ngForOf",t.orderLineCustomFields)}}function ml(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"tr",43)(1,"td",29),e.YNc(2,pl,2,4,"img",30),e.qZA(),e.TgZ(3,"td",31),e._uU(4),e.qZA(),e.TgZ(5,"td",32),e._uU(6),e.qZA(),e.TgZ(7,"td",33),e._uU(8),e.ALo(9,"localeCurrency"),e.TgZ(10,"div",15),e.ALo(11,"translate"),e._uU(12),e.ALo(13,"localeCurrency"),e.qZA()(),e.TgZ(14,"td",34)(15,"input",35),e.NdJ("input",function(i){const s=e.CHM(t).$implicit,f=e.oxw(2);return e.KtG(f.updateAddedItemQuantity(s,i.target.value))}),e.qZA(),e.TgZ(16,"button",44),e.NdJ("click",function(){const a=e.CHM(t).index,s=e.oxw(2);return e.KtG(s.removeAddedItem(a))}),e._UZ(17,"clr-icon",45),e.qZA()(),e.YNc(18,ul,2,1,"td",38),e.TgZ(19,"td",39),e._uU(20),e.ALo(21,"currency"),e.TgZ(22,"div",15),e.ALo(23,"translate"),e._uU(24),e.ALo(25,"currency"),e.qZA()()()}if(2&r){const t=n.$implicit,o=e.oxw().ngIf,i=e.oxw();e.xp6(2),e.Q6J("ngIf",t.productAsset),e.xp6(2),e.Oqu(t.productVariantName),e.xp6(2),e.Oqu(t.sku),e.xp6(2),e.hij(" ",e.xi3(9,11,t.priceWithTax,o.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(11,14,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(13,16,t.price,o.currencyCode)," "),e.xp6(3),e.Q6J("value",t.quantity),e.xp6(3),e.Q6J("ngIf",i.orderLineCustomFields.length),e.xp6(2),e.hij(" ",e.xi3(21,19,t.priceWithTax*t.quantity/100,o.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(23,22,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(25,24,t.price*t.quantity/100,o.currencyCode)," ")}}function gl(r,n){1&r&&e._UZ(0,"td")}function fl(r,n){if(1&r&&(e.TgZ(0,"tr",48)(1,"td",49),e._uU(2),e.qZA(),e.TgZ(3,"td",32),e._uU(4),e.qZA(),e._UZ(5,"td",50)(6,"td"),e.YNc(7,gl,1,0,"td",0),e.TgZ(8,"td",39),e._uU(9),e.ALo(10,"localeCurrency"),e.TgZ(11,"div",15),e.ALo(12,"translate"),e._uU(13),e.ALo(14,"localeCurrency"),e.qZA()()()),2&r){const t=n.$implicit,o=e.oxw().ngIf,i=e.oxw();e.xp6(2),e.Oqu(t.description),e.xp6(2),e.Oqu(t.sku),e.xp6(3),e.Q6J("ngIf",i.orderLineCustomFields.length),e.xp6(2),e.hij(" ",e.xi3(10,6,t.priceWithTax,o.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(12,9,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(14,11,t.price,o.currencyCode)," ")}}function hl(r,n){1&r&&e._UZ(0,"td")}function xl(r,n){if(1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"localeCurrency"),e.TgZ(3,"div",15),e.ALo(4,"translate"),e._uU(5),e.ALo(6,"localeCurrency"),e.qZA(),e.BQk()),2&r){const t=n.ngIf,o=e.oxw(2).ngIf;e.xp6(1),e.hij(" ",e.xi3(2,3,t.priceWithTax,o.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(4,6,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(6,8,t.price,o.currencyCode)," ")}}function Cl(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"tr",51)(1,"td",49),e._uU(2),e.TgZ(3,"button",44),e.NdJ("click",function(){const a=e.CHM(t).index,s=e.oxw(2);return e.KtG(s.removeSurcharge(a))}),e._UZ(4,"clr-icon",45),e.qZA()(),e.TgZ(5,"td",32),e._uU(6),e.qZA(),e._UZ(7,"td",50)(8,"td"),e.YNc(9,hl,1,0,"td",0),e.TgZ(10,"td",39),e.YNc(11,xl,7,11,"ng-container",0),e.qZA()()}if(2&r){const t=n.$implicit,o=e.oxw(2);e.xp6(2),e.hij(" ",t.description," "),e.xp6(4),e.Oqu(t.sku),e.xp6(3),e.Q6J("ngIf",o.orderLineCustomFields.length),e.xp6(2),e.Q6J("ngIf",o.getSurchargePrices(t))}}function vl(r,n){1&r&&e._UZ(0,"td")}function yl(r,n){if(1&r&&(e._UZ(0,"img",58),e.ALo(1,"assetPreview")),2&r){const t=n.ngIf;e.Q6J("src",e.xi3(1,1,t,"tiny"),e.LSH)}}function Ol(r,n){if(1&r&&(e.TgZ(0,"div",55),e.YNc(1,yl,2,4,"img",56),e.TgZ(2,"div")(3,"strong",57),e._uU(4),e.qZA(),e.TgZ(5,"small"),e._uU(6),e.qZA(),e.TgZ(7,"div"),e._uU(8),e.ALo(9,"localeCurrency"),e.qZA()()()),2&r){const t=e.oxw(2).ngIf,o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.addItemSelectedVariant.productAsset),e.xp6(3),e.Oqu(o.addItemSelectedVariant.productVariantName),e.xp6(2),e.Oqu(o.addItemSelectedVariant.sku),e.xp6(2),e.hij(" ",e.xi3(9,4,o.getSelectedItemPrice(o.addItemSelectedVariant),t.currencyCode)," ")}}function Zl(r,n){if(1&r&&(e.ynx(0),e._UZ(1,"vdr-custom-field-control",59),e.BQk()),2&r){const t=n.$implicit,o=e.oxw(3);e.xp6(1),e.Q6J("readonly",!o.addItemSelectedVariant)("customField",t)("customFieldsFormGroup",o.addItemCustomFieldsForm)("compact",!0)}}function bl(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"clr-accordion-content")(1,"vdr-product-variant-selector",52),e.NdJ("productSelected",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.addItemSelectedVariant=i)}),e.qZA(),e.YNc(2,Ol,10,7,"div",53),e.YNc(3,Zl,2,4,"ng-container",46),e.TgZ(4,"button",54),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.addItemToOrder(i.addItemSelectedVariant))}),e._uU(5),e.ALo(6,"translate"),e.qZA()()}if(2&r){const t=e.oxw(2);e.xp6(2),e.Q6J("ngIf",t.addItemSelectedVariant),e.xp6(1),e.Q6J("ngForOf",t.orderLineCustomFields),e.xp6(1),e.Q6J("disabled",!t.addItemSelectedVariant||t.addItemCustomFieldsForm.invalid),e.xp6(1),e.hij(" ",e.lcZ(6,4,"order.add-item-to-order")," ")}}function Tl(r,n){if(1&r&&(e.TgZ(0,"clr-accordion-content"),e._UZ(1,"vdr-coupon-code-selector",60),e.qZA()),2&r){const t=e.oxw(2);e.xp6(1),e.Q6J("control",t.couponCodesControl)}}const Al=function(r){return{rate:r}};function Il(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"clr-accordion-content")(1,"form",61),e.NdJ("submit",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.addSurcharge(i.surchargeForm.value))}),e.TgZ(2,"vdr-form-field",62),e.ALo(3,"translate"),e._UZ(4,"input",63),e.qZA(),e.TgZ(5,"vdr-form-field",64),e.ALo(6,"translate"),e._UZ(7,"input",65),e.qZA(),e.TgZ(8,"vdr-form-field",66),e.ALo(9,"translate"),e._UZ(10,"vdr-currency-input",67),e.qZA(),e.TgZ(11,"vdr-form-field",68),e.ALo(12,"translate"),e._UZ(13,"input",69),e.qZA(),e.TgZ(14,"vdr-form-field",70),e.ALo(15,"translate"),e.TgZ(16,"vdr-affixed-input",71),e._UZ(17,"input",72),e.qZA()(),e.TgZ(18,"vdr-form-field",73),e.ALo(19,"translate"),e._UZ(20,"input",74),e.qZA(),e.TgZ(21,"button",75),e._uU(22),e.ALo(23,"translate"),e.qZA()()()}if(2&r){const t=e.oxw().ngIf,o=e.oxw();let i,a;e.xp6(1),e.Q6J("formGroup",o.surchargeForm),e.xp6(1),e.Q6J("label",e.lcZ(3,10,"common.description")),e.xp6(3),e.Q6J("label",e.lcZ(6,12,"order.product-sku")),e.xp6(3),e.Q6J("label",e.lcZ(9,14,"common.price")),e.xp6(2),e.Q6J("currencyCode",t.currencyCode),e.xp6(1),e.Q6J("label",e.xi3(12,16,"catalog.price-includes-tax-at",e.VKq(25,Al,null==(i=o.surchargeForm.get("taxRate"))?null:i.value))),e.xp6(3),e.Q6J("label",e.lcZ(15,19,"order.tax-rate")),e.xp6(4),e.Q6J("label",e.lcZ(19,21,"order.tax-description")),e.xp6(3),e.Q6J("disabled",o.surchargeForm.invalid||o.surchargeForm.pristine||0===(null==(a=o.surchargeForm.get("price"))?null:a.value)),e.xp6(1),e.hij(" ",e.lcZ(23,23,"order.add-surcharge")," ")}}function Ll(r,n){if(1&r&&(e.TgZ(0,"clr-accordion-content"),e._UZ(1,"vdr-address-form",76),e.ALo(2,"async"),e.qZA()),2&r){const t=e.oxw(2);e.xp6(1),e.Q6J("formGroup",t.shippingAddressForm)("availableCountries",e.lcZ(2,3,t.availableCountries$))("customFields",t.addressCustomFields)}}function Ml(r,n){if(1&r&&(e.TgZ(0,"clr-accordion-content"),e._UZ(1,"vdr-address-form",76),e.ALo(2,"async"),e.qZA()),2&r){const t=e.oxw(2);e.xp6(1),e.Q6J("formGroup",t.billingAddressForm)("availableCountries",e.lcZ(2,3,t.availableCountries$))("customFields",t.addressCustomFields)}}const Lt=function(r){return{count:r}};function wl(r,n){if(1&r&&(e.TgZ(0,"li"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r){const t=e.oxw(2);e.xp6(1),e.hij(" ",e.xi3(2,1,"order.modification-adding-items",e.VKq(4,Lt,null==t.modifyOrderInput.addItems?null:t.modifyOrderInput.addItems.length))," ")}}function Fl(r,n){if(1&r&&(e.TgZ(0,"li"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r){const t=e.oxw(2);e.xp6(1),e.hij(" ",e.xi3(2,1,"order.modification-adjusting-lines",e.VKq(4,Lt,null==t.modifyOrderInput.adjustOrderLines?null:t.modifyOrderInput.adjustOrderLines.length))," ")}}function ql(r,n){if(1&r&&(e.TgZ(0,"li"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r){const t=e.oxw(2);e.xp6(1),e.hij(" ",e.xi3(2,1,"order.modification-adding-surcharges",e.VKq(4,Lt,null==t.modifyOrderInput.surcharges?null:t.modifyOrderInput.surcharges.length))," ")}}function Sl(r,n){1&r&&(e.TgZ(0,"li"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.modification-updating-shipping-address")," "))}function Pl(r,n){1&r&&(e.TgZ(0,"li"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.modification-updating-billing-address")," "))}function Jl(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div")(1,"div",4)(2,"div",5)(3,"table",6)(4,"thead")(5,"tr"),e._UZ(6,"th"),e.TgZ(7,"th"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"th"),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"th"),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"th"),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.YNc(19,ll,3,3,"th",0),e.TgZ(20,"th"),e._uU(21),e.ALo(22,"translate"),e.qZA()()(),e.TgZ(23,"tbody"),e.YNc(24,sl,26,36,"tr",7),e.YNc(25,ml,26,27,"tr",8),e.YNc(26,fl,15,14,"tr",9),e.YNc(27,Cl,12,4,"tr",10),e.TgZ(28,"tr",11)(29,"td",12),e._uU(30),e.ALo(31,"translate"),e.qZA(),e.TgZ(32,"td",13),e._uU(33),e.qZA(),e._UZ(34,"td",14),e.YNc(35,vl,1,0,"td",0),e.TgZ(36,"td",13),e._uU(37),e.ALo(38,"localeCurrency"),e.TgZ(39,"div",15),e.ALo(40,"translate"),e._uU(41),e.ALo(42,"localeCurrency"),e.qZA()()()()(),e.TgZ(43,"h4",16),e._uU(44),e.ALo(45,"translate"),e.qZA(),e.TgZ(46,"clr-accordion")(47,"clr-accordion-panel")(48,"clr-accordion-title"),e._uU(49),e.ALo(50,"translate"),e.qZA(),e.YNc(51,bl,7,6,"clr-accordion-content",17),e.qZA(),e.TgZ(52,"clr-accordion-panel")(53,"clr-accordion-title"),e._uU(54),e.ALo(55,"translate"),e.qZA(),e.YNc(56,Tl,2,1,"clr-accordion-content",17),e.qZA(),e.TgZ(57,"clr-accordion-panel")(58,"clr-accordion-title"),e._uU(59),e.ALo(60,"translate"),e.qZA(),e.YNc(61,Il,24,27,"clr-accordion-content",17),e.qZA(),e.TgZ(62,"clr-accordion-panel")(63,"clr-accordion-title"),e._uU(64),e.ALo(65,"translate"),e.qZA(),e.YNc(66,Ll,3,5,"clr-accordion-content",17),e.qZA(),e.TgZ(67,"clr-accordion-panel")(68,"clr-accordion-title"),e._uU(69),e.ALo(70,"translate"),e.qZA(),e.YNc(71,Ml,3,5,"clr-accordion-content",17),e.qZA()()(),e.TgZ(72,"div",18)(73,"div",19)(74,"div",20),e._uU(75),e.ALo(76,"translate"),e.qZA(),e.TgZ(77,"div",21)(78,"ul"),e.YNc(79,wl,3,6,"li",0),e.YNc(80,Fl,3,6,"li",0),e.YNc(81,ql,3,6,"li",0),e.YNc(82,Sl,3,3,"li",0),e.YNc(83,Pl,3,3,"li",0),e.qZA()(),e.TgZ(84,"div",21)(85,"label",22),e._uU(86),e.ALo(87,"translate"),e.qZA(),e.TgZ(88,"textarea",23),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.note=i)}),e.qZA(),e.TgZ(89,"clr-checkbox-wrapper",24)(90,"input",25),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.recalculateShipping=i)}),e.qZA(),e.TgZ(91,"label"),e._uU(92),e.ALo(93,"translate"),e.qZA()()(),e.TgZ(94,"div",26)(95,"button",27),e.NdJ("click",function(){const a=e.CHM(t).ngIf,s=e.oxw();return e.KtG(s.previewAndModify(a))}),e._uU(96),e.ALo(97,"translate"),e.qZA()()()()()()}if(2&r){const t=n.ngIf,o=e.oxw();e.xp6(8),e.Oqu(e.lcZ(9,35,"order.product-name")),e.xp6(3),e.Oqu(e.lcZ(12,37,"order.product-sku")),e.xp6(3),e.Oqu(e.lcZ(15,39,"order.unit-price")),e.xp6(3),e.Oqu(e.lcZ(18,41,"order.quantity")),e.xp6(2),e.Q6J("ngIf",o.orderLineCustomFields.length),e.xp6(2),e.Oqu(e.lcZ(22,43,"order.total")),e.xp6(3),e.Q6J("ngForOf",t.lines),e.xp6(1),e.Q6J("ngForOf",o.addedLines)("ngForTrackBy",o.trackByProductVariantId),e.xp6(1),e.Q6J("ngForOf",t.surcharges),e.xp6(1),e.Q6J("ngForOf",o.modifyOrderInput.surcharges),e.xp6(3),e.Oqu(e.lcZ(31,45,"order.shipping")),e.xp6(3),e.hij(" ",null==t.shippingLines[0]||null==t.shippingLines[0].shippingMethod?null:t.shippingLines[0].shippingMethod.name," "),e.xp6(2),e.Q6J("ngIf",o.orderLineCustomFields.length),e.xp6(2),e.hij(" ",e.xi3(38,47,t.shippingWithTax,t.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(40,50,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(42,52,t.shipping,t.currencyCode)," "),e.xp6(3),e.Oqu(e.lcZ(45,55,"order.modifications")),e.xp6(5),e.Oqu(e.lcZ(50,57,"order.add-item-to-order")),e.xp6(5),e.Oqu(e.lcZ(55,59,"order.set-coupon-codes")),e.xp6(5),e.Oqu(e.lcZ(60,61,"order.add-surcharge")),e.xp6(5),e.Oqu(e.lcZ(65,63,"order.edit-shipping-address")),e.xp6(5),e.Oqu(e.lcZ(70,65,"order.edit-billing-address")),e.xp6(6),e.hij(" ",e.lcZ(76,67,"order.modification-summary")," "),e.xp6(4),e.Q6J("ngIf",null==o.modifyOrderInput.addItems?null:o.modifyOrderInput.addItems.length),e.xp6(1),e.Q6J("ngIf",null==o.modifyOrderInput.adjustOrderLines?null:o.modifyOrderInput.adjustOrderLines.length),e.xp6(1),e.Q6J("ngIf",null==o.modifyOrderInput.surcharges?null:o.modifyOrderInput.surcharges.length),e.xp6(1),e.Q6J("ngIf",o.shippingAddressForm.dirty),e.xp6(1),e.Q6J("ngIf",o.billingAddressForm.dirty),e.xp6(3),e.Oqu(e.lcZ(87,69,"order.note")),e.xp6(2),e.Q6J("ngModel",o.note),e.xp6(2),e.Q6J("ngModel",o.recalculateShipping),e.xp6(2),e.Oqu(e.lcZ(93,71,"order.modification-recalculate-shipping")),e.xp6(3),e.Q6J("disabled",!o.canPreviewChanges()),e.xp6(1),e.hij(" ",e.lcZ(97,73,"order.preview-changes")," ")}}class Mt extends c.UT_{constructor(n,t,o,i,a,s,f,pn){super(t,n,o,a),this.changeDetector=i,this.dataService=a,this.notificationService=s,this.modalService=f,this.orderTransitionService=pn,this.detailForm=new l.nJ({}),this.couponCodesControl=new l.p4,this.modifyOrderInput={dryRun:!0,orderId:"",addItems:[],adjustOrderLines:[],surcharges:[],note:"",updateShippingAddress:{},updateBillingAddress:{}},this.note="",this.recalculateShipping=!0,this.addedVariants=new Map}get addedLines(){const n=t=>"SinglePrice"===t.__typename?t.value:0;return(this.modifyOrderInput.addItems||[]).map(t=>{const o=this.addedVariants.get(t.productVariantId);if(o)return{...o,price:n(o.price),priceWithTax:n(o.priceWithTax),quantity:t.quantity}}).filter(A.notNullOrUndefined)}ngOnInit(){this.init(),this.addressCustomFields=this.getCustomFieldConfig("Address"),this.modifyOrderInput.orderId=this.route.snapshot.paramMap.get("id"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.entity$.pipe((0,Ve.R)(this.destroy$)).subscribe(n=>{n.couponCodes.length&&this.couponCodesControl.setValue(n.couponCodes),this.surchargeForm=new l.nJ({description:new l.p4("",l.kI.required),sku:new l.p4(""),price:new l.p4(0,l.kI.required),priceIncludesTax:new l.p4(!0),taxRate:new l.p4(0),taxDescription:new l.p4("")}),this.shippingAddressForm||(this.shippingAddressForm=new l.nJ({fullName:new l.p4(n.shippingAddress?.fullName),company:new l.p4(n.shippingAddress?.company),streetLine1:new l.p4(n.shippingAddress?.streetLine1),streetLine2:new l.p4(n.shippingAddress?.streetLine2),city:new l.p4(n.shippingAddress?.city),province:new l.p4(n.shippingAddress?.province),postalCode:new l.p4(n.shippingAddress?.postalCode),countryCode:new l.p4(n.shippingAddress?.countryCode),phoneNumber:new l.p4(n.shippingAddress?.phoneNumber)}),this.addAddressCustomFieldsFormGroup(this.shippingAddressForm,n.shippingAddress)),this.billingAddressForm||(this.billingAddressForm=new l.nJ({fullName:new l.p4(n.billingAddress?.fullName),company:new l.p4(n.billingAddress?.company),streetLine1:new l.p4(n.billingAddress?.streetLine1),streetLine2:new l.p4(n.billingAddress?.streetLine2),city:new l.p4(n.billingAddress?.city),province:new l.p4(n.billingAddress?.province),postalCode:new l.p4(n.billingAddress?.postalCode),countryCode:new l.p4(n.billingAddress?.countryCode),phoneNumber:new l.p4(n.billingAddress?.phoneNumber)}),this.addAddressCustomFieldsFormGroup(this.billingAddressForm,n.billingAddress)),this.orderLineCustomFieldsFormArray=new l.vC([]);for(const t of n.lines){const o=new l.nJ({});for(const{name:i}of this.orderLineCustomFields)o.addControl(i,new l.p4(t.customFields[i]));o.valueChanges.pipe((0,Ve.R)(this.destroy$)).subscribe(i=>{let a=this.modifyOrderInput.adjustOrderLines.find(s=>s.orderLineId===t.id);a||(a={orderLineId:t.id,quantity:t.quantity},this.modifyOrderInput.adjustOrderLines.push(a)),this.orderLineCustomFields.length&&(a.customFields=i)}),this.orderLineCustomFieldsFormArray.push(o)}}),this.addItemCustomFieldsFormArray=new l.vC([]),this.addItemCustomFieldsForm=new l.nJ({});for(const n of this.orderLineCustomFields)this.addItemCustomFieldsForm.addControl(n.name,new l.p4);this.availableCountries$=this.dataService.settings.getAvailableCountries().mapSingle(n=>n.countries.items).pipe((0,rn.d)(1)),this.dataService.order.getOrderHistory(this.id,{take:1,sort:{createdAt:c.Asd.DESC},filter:{type:{eq:c.iYD.ORDER_STATE_TRANSITION}}}).single$.subscribe(({order:n})=>{this.previousState=n?.history.items[0].data.from})}ngOnDestroy(){this.destroy()}transitionToPriorState(n){this.orderTransitionService.transitionToPreModifyingState(n.id,n.nextStates).subscribe(t=>{this.router.navigate([".."],{relativeTo:this.route})})}canPreviewChanges(){const{addItems:n,adjustOrderLines:t,surcharges:o}=this.modifyOrderInput;return!!n?.length||!!o?.length||!!t?.length||this.shippingAddressForm.dirty&&this.shippingAddressForm.valid||this.billingAddressForm.dirty&&this.billingAddressForm.valid||this.couponCodesControl.dirty}isLineModified(n){return!!this.modifyOrderInput.adjustOrderLines?.find(t=>t.orderLineId===n.id&&t.quantity!==n.quantity)}updateLineQuantity(n,t){const{adjustOrderLines:o}=this.modifyOrderInput;let i=o?.find(a=>a.orderLineId===n.id);i&&+t===n.quantity&&o?.splice(o?.indexOf(i),1),i||(i={orderLineId:n.id,quantity:+t},o?.push(i)),i.quantity=+t}updateAddedItemQuantity(n,t){const o=this.modifyOrderInput.addItems?.find(i=>i.productVariantId===n.productVariantId);o&&(o.quantity=+t)}trackByProductVariantId(n,t){return t.productVariantId}getSelectedItemPrice(n){return"SinglePrice"===n?.priceWithTax.__typename?n.priceWithTax.value:0}addItemToOrder(n){if(!n)return;const t=this.orderLineCustomFields.length?this.addItemCustomFieldsForm.value:void 0;let o=this.modifyOrderInput.addItems?.find(i=>this.isMatchingAddItemRow(i,n,t));if(o?o.quantity++:(o={productVariantId:n.productVariantId,quantity:1},t&&(o.customFields=t),this.modifyOrderInput.addItems?.push(o)),t){const i=new l.nJ({});for(const[a,s]of Object.entries(t))i.addControl(a,new l.p4(s));this.addItemCustomFieldsFormArray.push(i),i.valueChanges.pipe((0,Ve.R)(this.destroy$)).subscribe(a=>{o&&(o.customFields=a)})}this.addItemCustomFieldsForm.reset({}),this.addItemSelectedVariant=void 0,this.addedVariants.set(n.productVariantId,n)}isMatchingAddItemRow(n,t,o){return n.productVariantId===t.productVariantId&&JSON.stringify(n.customFields)===JSON.stringify(o)}removeAddedItem(n){this.modifyOrderInput.addItems.splice(n,1),-1<n&&this.addItemCustomFieldsFormArray.removeAt(n)}getSurchargePrices(n){const t=n.priceIncludesTax?n.price:Math.round(n.price*((100+(n.taxRate||0))/100));return{price:n.priceIncludesTax?Math.round(n.price/((100+(n.taxRate||0))/100)):n.price,priceWithTax:t}}addSurcharge(n){this.modifyOrderInput.surcharges?.push(n),this.surchargeForm.reset({price:0,priceIncludesTax:!0,taxRate:0})}removeSurcharge(n){this.modifyOrderInput.surcharges?.splice(n,1)}previewAndModify(n){const o={...{...this.modifyOrderInput,adjustOrderLines:this.modifyOrderInput.adjustOrderLines.map(a=>(0,c.EJQ)((0,el.I)(a),this.orderLineCustomFields))},...this.billingAddressForm.dirty?{updateBillingAddress:this.billingAddressForm.value}:{},...this.shippingAddressForm.dirty?{updateShippingAddress:this.shippingAddressForm.value}:{},dryRun:!0,couponCodes:this.couponCodesControl.dirty?this.couponCodesControl.value:void 0,note:this.note??"",options:{recalculateShipping:this.recalculateShipping}},i=n.totalWithTax;this.dataService.order.modifyOrder(o).pipe((0,g.w)(({modifyOrder:a})=>{switch(a.__typename){case"Order":return this.modalService.fromComponent(It,{size:"xl",closable:!1,locals:{originalTotalWithTax:i,order:a,orderLineCustomFields:this.orderLineCustomFields,modifyOrderInput:o}});case"InsufficientStockError":case"NegativeQuantityError":case"NoChangesSpecifiedError":case"OrderLimitError":case"OrderModificationStateError":case"PaymentMethodMissingError":case"RefundPaymentIdMissingError":case"CouponCodeLimitError":case"CouponCodeExpiredError":case"CouponCodeInvalidError":return this.notificationService.error(a.message),(0,v.of)(!1);case null:case void 0:return(0,v.of)(!1);default:(0,A.assertNever)(a)}}),(0,g.w)(a=>{if(!a||a.result===I.Cancel)return this.dataService.order.getOrder(this.id).mapSingle(()=>!1);{const s={...o,dryRun:!1};return a.result===I.Refund&&(s.refund={paymentId:a.refundPaymentId,reason:a.refundNote}),this.dataService.order.modifyOrder(s).pipe((0,g.w)(({modifyOrder:f})=>{if("Order"===f.__typename){const cc=0<f.totalWithTax-i?"ArrangingAdditionalPayment":this.previousState;return this.dataService.order.transitionToState(n.id,cc).pipe((0,Bt.h)(!0))}return this.notificationService.error(f.message),F.E}))}})).subscribe(a=>{a&&this.router.navigate(["../"],{relativeTo:this.route})})}addAddressCustomFieldsFormGroup(n,t){if(t&&this.addressCustomFields.length){const o=new l.nJ({});for(const i of this.addressCustomFields){const a=i.name,s=t.customFields?.[a];o.addControl(a,new l.p4(s))}n.addControl("customFields",o)}}setFormValues(n,t){}}(qe=Mt).\u0275fac=function(n){return new(n||qe)(e.Y36(C.F0),e.Y36(C.gz),e.Y36(c.iHG),e.Y36(e.sBO),e.Y36(c.DoR),e.Y36(c.gqp),e.Y36(c.Z7U),e.Y36(z))},qe.\u0275cmp=e.Xpm({type:qe,selectors:[["vdr-order-editor"]],features:[e.qOj],decls:7,vars:6,consts:[[4,"ngIf"],[1,"flex","clr-align-items-center"],[3,"state"],[1,"btn","btn-secondary",3,"click"],[1,"clr-row"],[1,"clr-col-lg-8"],[1,"order-table","table"],["class","order-line",3,"is-cancelled","modified",4,"ngFor","ngForOf"],["class","modified",4,"ngFor","ngForOf","ngForTrackBy"],["class","surcharge",4,"ngFor","ngForOf"],["class","surcharge modified",4,"ngFor","ngForOf"],[1,"shipping"],[1,"left","clr-align-middle"],[1,"clr-align-middle"],["colspan","3"],[1,"net-price",3,"title"],[1,"mb-2"],[4,"clrIfExpanded"],[1,"clr-col-lg-4","order-cards"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"clr-control-label"],["name","note","clrTextarea","","required","",3,"ngModel","ngModelChange"],[1,""],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],[1,"card-footer"],[1,"btn","btn-primary",3,"disabled","click"],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","unit-price"],[1,"align-middle","quantity"],["type","number","min","0",3,"value","input"],[3,"line","payments"],[3,"line","allOrderFulfillments","orderState"],["class","order-line-custom-field align-middle",4,"ngIf"],[1,"align-middle","total"],[3,"src"],[1,"order-line-custom-field","align-middle"],["entityName","OrderLine",3,"customFields","customFieldsFormGroup","compact"],[1,"modified"],[1,"icon-button",3,"click"],["shape","trash"],[4,"ngFor","ngForOf"],["entityName","OrderLine",3,"customField","customFieldsFormGroup","compact"],[1,"surcharge"],["colspan","2",1,"align-middle","name","left"],[1,"align-middle"],[1,"surcharge","modified"],[1,"mb-4",3,"productSelected"],["class","flex mb-4",4,"ngIf"],[1,"btn","btn-secondary",3,"disabled","click"],[1,"flex","mb-4"],["class","mr-4 add-item-thumb",3,"src",4,"ngIf"],[1,"mr-4"],[1,"mr-4","add-item-thumb",3,"src"],["entityName","OrderLine",3,"readonly","customField","customFieldsFormGroup","compact"],[3,"control"],[3,"formGroup","submit"],["for","description",3,"label"],["id","description","type","text","formControlName","description"],["for","sku",3,"label"],["id","sku","type","text","formControlName","sku"],["for","price",3,"label"],["id","price","formControlName","price",3,"currencyCode"],["for","priceIncludesTax",3,"label"],["id","priceIncludesTax","type","checkbox","clrCheckbox","","formControlName","priceIncludesTax"],["for","taxRate",3,"label"],["suffix","%"],["id","taxRate","type","number","min","0","max","100","formControlName","taxRate"],["for","taxDescription",3,"label"],["id","taxDescription","type","text","formControlName","taxDescription"],[1,"btn","btn-secondary",3,"disabled"],[3,"formGroup","availableCountries","customFields"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-page-block"),e.YNc(1,al,8,4,"vdr-action-bar",0),e.ALo(2,"async"),e.qZA(),e.TgZ(3,"vdr-page-block"),e.YNc(4,Jl,98,75,"div",0),e.ALo(5,"async"),e._UZ(6,"vdr-page-block"),e.qZA()),2&n&&(e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,t.entity$)),e.xp6(3),e.Q6J("ngIf",e.lcZ(5,4,t.entity$)))},dependencies:[_.q0d,_.Nz$,_.qvL,_.DbV,_.MgK,_.KKC,_.PEh,_.XE5,_.bZL,_.GmI,_.UJ5,_.r6y,_.dxz,_.twP,p.sg,p.O5,l._Y,l.Fj,l.wV,l.Wl,l.JJ,l.JL,l.Q7,l.qQ,l.Fd,l.On,l.sg,l.u,O.Kk,O.BN,O.mz,il.K,Wt.K,lt.M,Je.h,x.y,te.G,Kt.e,Dt.C,ot.y,ke.z,je,ie,De,p.Ov,p.H9,m.X$,D.M,h.k],styles:[".order-table[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}.order-table[_ngcontent-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700;border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}.order-table[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-inline-end:18px}.order-table[_ngcontent-%COMP%]   .draft-qty[_ngcontent-%COMP%]{max-width:48px}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px;color:var(--color-text-300);line-height:14px}.order-table[_ngcontent-%COMP%]   .promotions-label[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted var(--color-text-200);text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}.order-table[_ngcontent-%COMP%]   .thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px}.order-table[_ngcontent-%COMP%]   .shipping-method-name[_ngcontent-%COMP%]{font-size:var(--font-size-xs);margin-inline-end:2px}.order-table[_ngcontent-%COMP%]   .order-placed-quantity[_ngcontent-%COMP%]{text-decoration:line-through;color:var(--color-text-300);margin-inline-end:2px}.order-table[_ngcontent-%COMP%]   tr.modified[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-warning-100)}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{text-align:start}.add-item-thumb[_ngcontent-%COMP%]{max-width:50px}"],changeDetection:0});var Se,Dl=d(5796),Nl=d(7615),Ql=d(106),Ul=d(8269),kl=d(2814);const El=function(){return["./draft/create"]};function Yl(r,n){1&r&&(e.TgZ(0,"a",17),e._UZ(1,"clr-icon",18),e._uU(2),e.ALo(3,"translate"),e.qZA()),2&r&&(e.Q6J("routerLink",e.DdM(4,El)),e.xp6(2),e.hij(" ",e.lcZ(3,2,"catalog.create-draft-order")," "))}const jl=function(){return["CreateOrder"]};function Rl(r,n){1&r&&(e.ynx(0),e.YNc(1,Yl,4,5,"a",16),e.BQk()),2&r&&(e.xp6(1),e.Q6J("vdrIfPermissions",e.DdM(1,jl)))}function $l(r,n){if(1&r&&e._uU(0),2&r){const t=n.item;e.hij(" ",t.id," ")}}function Hl(r,n){if(1&r&&(e._uU(0),e.ALo(1,"localeDate")),2&r){const t=n.item;e.hij(" ",e.xi3(1,1,t.createdAt,"short")," ")}}const Gl=function(r){return["./draft",r]},Kl=function(r){return["./",r]};function Vl(r,n){if(1&r&&(e.TgZ(0,"a",19)(1,"span"),e._uU(2),e.qZA(),e._UZ(3,"clr-icon",20),e.qZA()),2&r){const t=n.item;e.Q6J("routerLink","Draft"===t.state?e.VKq(2,Gl,t.id):e.VKq(4,Kl,t.id)),e.xp6(2),e.Oqu(t.code)}}function Bl(r,n){if(1&r&&(e.TgZ(0,"vdr-customer-label",21),e.NdJ("click",function(o){return o.stopPropagation()}),e.qZA()),2&r){const t=n.item;e.Q6J("customer",t.customer)}}function Wl(r,n){1&r&&(e.TgZ(0,"vdr-chip"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"order.order-type-regular")))}function Xl(r,n){1&r&&(e.TgZ(0,"vdr-chip"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"order.order-type-aggregate")))}function zl(r,n){1&r&&(e.TgZ(0,"vdr-chip"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"order.order-type-seller")))}function ec(r,n){if(1&r&&(e.YNc(0,Wl,3,3,"vdr-chip",1),e.YNc(1,Xl,3,3,"vdr-chip",1),e.YNc(2,zl,3,3,"vdr-chip",1)),2&r){const t=n.item,o=e.oxw();e.Q6J("ngIf",t.type===o.OrderType.Regular),e.xp6(1),e.Q6J("ngIf",t.type===o.OrderType.Aggregate),e.xp6(1),e.Q6J("ngIf",t.type===o.OrderType.Seller)}}function tc(r,n){if(1&r&&e._UZ(0,"vdr-order-state-label",22),2&r){const t=n.item;e.Q6J("state",t.state)}}function nc(r,n){if(1&r&&(e._uU(0),e.ALo(1,"localeCurrency")),2&r){const t=n.item;e.hij(" ",e.xi3(1,1,t.totalWithTax,t.currencyCode)," ")}}function rc(r,n){if(1&r&&(e._uU(0),e.ALo(1,"timeAgo")),2&r){const t=n.item;e.hij(" ",e.lcZ(1,1,t.updatedAt)," ")}}function oc(r,n){if(1&r&&(e._uU(0),e.ALo(1,"localeDate")),2&r){const t=n.item;e.hij(" ",e.xi3(1,1,t.orderPlacedAt,"short")," ")}}function ic(r,n){if(1&r&&e._uU(0),2&r){const t=n.item,o=e.oxw();e.hij(" ",o.getShippingNames(t)," ")}}function ac(r,n){if(1&r&&e._UZ(0,"vdr-dt2-custom-field-column",23),2&r){const t=n.$implicit,o=e.oxw();e.Q6J("customField",t)("sorts",o.sorts)}}class wt extends c.$ms{constructor(n,t){super(),this.serverConfigService=n,this.channelService=t,this.orderStates=this.serverConfigService.getOrderProcessStates().map(o=>o.name),this.OrderType=c.mrS,this.customFields=this.getCustomFieldConfig("Order"),this.filters=this.createFilterCollection().addIdFilter().addDateFilters().addFilter({name:"active",type:{kind:"boolean"},label:(0,u.J)("order.filter-is-active"),filterField:"active"}).addFilter({name:"totalWithTax",type:{kind:"number",inputType:"currency",currencyCode:"USD"},label:(0,u.J)("order.total"),filterField:"totalWithTax"}).addFilter({name:"state",type:{kind:"select",options:this.orderStates.map(o=>({value:o,label:(0,c.yr0)(o)}))},label:(0,u.J)("order.state"),filterField:"state"}).addFilter({name:"type",type:{kind:"select",options:[{value:c.mrS.Regular,label:(0,u.J)("order.order-type-regular")},{value:c.mrS.Aggregate,label:(0,u.J)("order.order-type-aggregate")},{value:c.mrS.Seller,label:(0,u.J)("order.order-type-seller")}]},label:(0,u.J)("order.order-type"),filterField:"type"}).addFilter({name:"orderPlacedAt",type:{kind:"dateRange"},label:(0,u.J)("order.placed-at"),filterField:"orderPlacedAt"}).addFilter({name:"customerLastName",type:{kind:"text"},label:(0,u.J)("customer.last-name"),filterField:"customerLastName"}).addFilter({name:"transactionId",type:{kind:"text"},label:(0,u.J)("order.transaction-id"),filterField:"transactionId"}).addCustomFieldFilters(this.customFields).connectToRoute(this.route),this.sorts=this.createSortCollection().defaultSort("updatedAt","DESC").addSort({name:"id"}).addSort({name:"createdAt"}).addSort({name:"updatedAt"}).addSort({name:"orderPlacedAt"}).addSort({name:"customerLastName"}).addSort({name:"state"}).addSort({name:"totalWithTax"}).addCustomFieldSorts(this.customFields).connectToRoute(this.route),this.canCreateDraftOrder=!1,this.activeChannelIsDefaultChannel=!1,super.configure({document:c.a4G,getItems:o=>o.orders,setVariables:(o,i)=>this.createQueryOptions(o,i,this.searchTermControl.value),refreshListOnChanges:[this.filters.valueChanges,this.sorts.valueChanges]}),this.canCreateDraftOrder=!!this.serverConfigService.getOrderProcessStates().find(o=>"Created"===o.name)?.to.includes("Draft")}ngOnInit(){super.ngOnInit();const n=this.channelService.defaultChannelIsActive$.pipe((0,K.b)(t=>this.activeChannelIsDefaultChannel=t));super.refreshListOnChanges(this.filters.valueChanges,this.sorts.valueChanges,n)}createQueryOptions(n,t,o){let i=this.filters.createFilterInput();return this.activeChannelIsDefaultChannel&&(i={...i??{}}),o&&(i={code:{contains:o},customerLastName:{contains:o},transactionId:{contains:o}}),{options:{skip:n,take:t,filter:{...i??{}},filterOperator:o?c.FnJ.OR:c.FnJ.AND,sort:this.sorts.createSortInput()}}}getShippingNames(n){return n.shippingLines.length?n.shippingLines.map(t=>t.shippingMethod.name).join(", "):""}}(Se=wt).\u0275fac=function(n){return new(n||Se)(e.Y36(c.iHG),e.Y36(c.Tjy))},Se.\u0275cmp=e.Xpm({type:Se,selectors:[["vdr-order-list"]],features:[e.qOj],decls:44,vars:60,consts:[["locationId","order-list"],[4,"ngIf"],["id","order-list",1,"mt-2",3,"items","itemsPerPage","totalItems","currentPage","filters","pageChange","itemsPerPageChange"],["locationId","order-list",3,"hostComponent","selectionManager"],[3,"searchTermControl","searchTermPlaceholder"],["id","id",3,"heading","hiddenByDefault","sort"],["id","created-at",3,"heading","hiddenByDefault"],["id","code",3,"heading","optional"],["id","customer",3,"heading","sort"],["id","order-type",3,"heading","hiddenByDefault"],["id","state",3,"heading","sort"],["id","total",3,"heading","sort"],["id","updated-at",3,"heading"],["id","placed-at",3,"heading","sort"],["id","shipping",3,"heading"],[3,"customField","sorts",4,"ngFor","ngForOf"],["class","btn",3,"routerLink",4,"vdrIfPermissions"],[1,"btn",3,"routerLink"],["shape","plus"],[1,"button-ghost",3,"routerLink"],["shape","arrow right"],[3,"customer","click"],[3,"state"],[3,"customField","sorts"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-page-block")(1,"vdr-action-bar")(2,"vdr-ab-right"),e._UZ(3,"vdr-action-bar-items",0),e.YNc(4,Rl,2,2,"ng-container",1),e.qZA()()(),e.TgZ(5,"vdr-data-table-2",2),e.NdJ("pageChange",function(i){return t.setPageNumber(i)})("itemsPerPageChange",function(i){return t.setItemsPerPage(i)}),e.ALo(6,"async"),e.ALo(7,"async"),e.ALo(8,"async"),e.ALo(9,"async"),e._UZ(10,"vdr-bulk-action-menu",3)(11,"vdr-dt2-search",4),e.ALo(12,"translate"),e.TgZ(13,"vdr-dt2-column",5),e.ALo(14,"translate"),e.YNc(15,$l,1,1,"ng-template"),e.qZA(),e.TgZ(16,"vdr-dt2-column",6),e.ALo(17,"translate"),e.YNc(18,Hl,2,4,"ng-template"),e.qZA(),e.TgZ(19,"vdr-dt2-column",7),e.ALo(20,"translate"),e.YNc(21,Vl,4,6,"ng-template"),e.qZA(),e.TgZ(22,"vdr-dt2-column",8),e.ALo(23,"translate"),e.YNc(24,Bl,1,1,"ng-template"),e.qZA(),e.TgZ(25,"vdr-dt2-column",9),e.ALo(26,"translate"),e.YNc(27,ec,3,3,"ng-template"),e.qZA(),e.TgZ(28,"vdr-dt2-column",10),e.ALo(29,"translate"),e.YNc(30,tc,1,1,"ng-template"),e.qZA(),e.TgZ(31,"vdr-dt2-column",11),e.ALo(32,"translate"),e.YNc(33,nc,2,4,"ng-template"),e.qZA(),e.TgZ(34,"vdr-dt2-column",12),e.ALo(35,"translate"),e.YNc(36,rc,2,3,"ng-template"),e.qZA(),e.TgZ(37,"vdr-dt2-column",13),e.ALo(38,"translate"),e.YNc(39,oc,2,4,"ng-template"),e.qZA(),e.TgZ(40,"vdr-dt2-column",14),e.ALo(41,"translate"),e.YNc(42,ic,1,1,"ng-template"),e.qZA(),e.YNc(43,ac,1,2,"vdr-dt2-custom-field-column",15),e.qZA()),2&n&&(e.xp6(4),e.Q6J("ngIf",t.canCreateDraftOrder),e.xp6(1),e.Q6J("items",e.lcZ(6,30,t.items$))("itemsPerPage",e.lcZ(7,32,t.itemsPerPage$))("totalItems",e.lcZ(8,34,t.totalItems$))("currentPage",e.lcZ(9,36,t.currentPage$))("filters",t.filters),e.xp6(5),e.Q6J("hostComponent",t)("selectionManager",t.selectionManager),e.xp6(1),e.Q6J("searchTermControl",t.searchTermControl)("searchTermPlaceholder",e.lcZ(12,38,"order.search-by-order-filters")),e.xp6(2),e.Q6J("heading",e.lcZ(14,40,"common.id"))("hiddenByDefault",!0)("sort",t.sorts.get("id")),e.xp6(3),e.Q6J("heading",e.lcZ(17,42,"common.created-at"))("hiddenByDefault",!0),e.xp6(3),e.Q6J("heading",e.lcZ(20,44,"common.code"))("optional",!1),e.xp6(3),e.Q6J("heading",e.lcZ(23,46,"order.customer"))("sort",t.sorts.get("customerLastName")),e.xp6(3),e.Q6J("heading",e.lcZ(26,48,"order.order-type"))("hiddenByDefault",!0),e.xp6(3),e.Q6J("heading",e.lcZ(29,50,"order.state"))("sort",t.sorts.get("state")),e.xp6(3),e.Q6J("heading",e.lcZ(32,52,"order.total"))("sort",t.sorts.get("totalWithTax")),e.xp6(3),e.Q6J("heading",e.lcZ(35,54,"common.updated-at")),e.xp6(3),e.Q6J("heading",e.lcZ(38,56,"order.placed-at"))("sort",t.sorts.get("orderPlacedAt")),e.xp6(3),e.Q6J("heading",e.lcZ(41,58,"order.shipping")),e.xp6(3),e.Q6J("ngForOf",t.customFields))},dependencies:[_.qvL,p.sg,p.O5,C.rH,O.Kk,O.mz,M.Y,nt.d,te.G,Dl.H,rt.W,Nl.c,Ql.e,$t.U,Ul.J,Ht.j,ke.z,p.Ov,m.X$,kl.e,Ye.H,h.k],styles:[".search-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:baseline;width:100%;max-width:100vw;margin-bottom:6px}.filter-presets[_ngcontent-%COMP%]{max-width:90vw;overflow-x:auto}.search-input[_ngcontent-%COMP%]{margin-top:6px;min-width:300px}.custom-filters[_ngcontent-%COMP%]{overflow:hidden;max-height:0;padding-bottom:6px}.custom-filters.expanded[_ngcontent-%COMP%]{max-height:initial}.custom-filters[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.custom-filters[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%}ng-select[_ngcontent-%COMP%]{flex:1;min-width:200px;height:36px}ng-select[_ngcontent-%COMP%]     .ng-select-container{height:36px}"],changeDetection:0});const lc=R.Ps`
    query GetCustomerAddresses($customerId: ID!) {
        customer(id: $customerId) {
            id
            addresses {
                ...Address
            }
        }
    }
    ${c.UYy}
`;var E,Y,an=d(2727);class Ft{constructor(n,t){this.router=n,this.dataService=t}resolve(n,t){const o=n.paramMap.get("id"),i=this.router.events.pipe((0,an.h)(s=>s instanceof C.wM)),a=this.dataService.order.getOrder(o).mapStream(s=>s.order).pipe((0,g.w)(s=>"Draft"===s?.state&&n.component!==$e?(this.router.navigate(["/orders/draft",o]),F.E):[s]),(0,Ve.R)(i),(0,an.h)(A.notNullOrUndefined),(0,rn.d)(1));return a.pipe((0,w.q)(1),(0,b.U)(()=>a))}}(E=Ft).\u0275fac=function(n){return new(n||E)(e.LFG(C.F0),e.LFG(c.DoR))},E.\u0275prov=e.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"});class Pe{constructor(n,t){this.dataService=n,this.router=t}canActivate(n,t){const o=t.url.includes("orders/draft"),i=n.paramMap.get("id");return!o||"create"!==i||this.dataService.order.createDraftOrder().pipe((0,b.U)(({createDraftOrder:a})=>this.router.parseUrl(`/orders/draft/${a.id}`)))}}(Y=Pe).\u0275fac=function(n){return new(n||Y)(e.LFG(c.DoR),e.LFG(C.F0))},Y.\u0275prov=e.Yz7({token:Y,factory:Y.\u0275fac,providedIn:"root"});const ln=r=>[{path:"",component:c.IIO,pathMatch:"full",data:{locationId:"order-list",breadcrumb:(0,u.J)("breadcrumb.orders")},children:r.getPageTabRoutes("order-list")},{path:"draft/:id",component:c.IIO,canActivate:[Pe],data:{locationId:"draft-order-detail",breadcrumb:{label:(0,u.J)("breadcrumb.orders"),link:["../"]}},children:r.getPageTabRoutes("draft-order-detail")},{path:":id",component:c.IIO,canActivate:[Pe],data:{locationId:"order-detail",breadcrumb:{label:(0,u.J)("breadcrumb.orders"),link:["../"]}},children:r.getPageTabRoutes("order-detail")},{path:":aggregateOrderId/seller-orders/:id",component:c.IIO,canActivate:[Pe],data:{locationId:"order-detail",breadcrumb:{label:(0,u.J)("breadcrumb.orders"),link:["../"]}},children:r.getPageTabRoutes("order-detail")},{path:":id/modify",component:Mt,resolve:{entity:Ft},data:{breadcrumb:dn}}];function cn(r,n){return r.entity.pipe((0,b.U)(t=>t.aggregateOrder?[{label:"breadcrumb.orders",link:["../"]},{label:t.aggregateOrder.code,link:["../",t.aggregateOrder.id]},{label:(0,u.J)("breadcrumb.seller-orders"),link:["../",t.aggregateOrder.id]},{label:t.code,link:[t.id]}]:[{label:"breadcrumb.orders",link:["../"]},{label:t.code,link:[t.id]}]))}function dn(r,n){return cn(r).pipe((0,b.U)(t=>{const o=t.slice();return o[1].link=["../",t[1].link[0]],o.concat({label:(0,u.J)("breadcrumb.modifying"),link:[""]})}))}var j;class sn{constructor(n){this.pageService=n,n.registerPageTab({priority:0,location:"order-list",tab:(0,u.J)("order.orders"),route:"",component:wt}),n.registerPageTab({priority:0,location:"order-detail",tab:(0,u.J)("order.order"),route:"",component:(0,c.IX9)({component:At,query:c.jCp,entityKey:"order",getBreadcrumbs:t=>t?.type===c.mrS.Seller&&t?.aggregateOrder?[{label:`${t?.aggregateOrder?.code}`,link:["/orders/",t?.aggregateOrder?.id]},{label:(0,u.J)("breadcrumb.seller-orders"),link:["/orders/",t?.aggregateOrder?.id]},{label:`${t?.code}`,link:[t?.id]}]:[{label:`${t?.code}`,link:[t?.id]}]})}),n.registerPageTab({priority:0,location:"draft-order-detail",tab:(0,u.J)("order.order"),route:"",component:(0,c.IX9)({component:$e,query:c.jCp,entityKey:"order",getBreadcrumbs:t=>[{label:(0,u.J)("order.draft-order"),link:[t?.id]}]})})}}(j=sn).\u0275fac=function(n){return new(n||j)(e.LFG(c.PhL))},j.\u0275mod=e.oAB({type:j}),j.\u0275inj=e.cJS({providers:[{provide:C.Z6,useFactory:r=>ln(r),multi:!0,deps:[c.PhL]}],imports:[c.m81,C.Bz.forChild([])]})}}]);
//# sourceMappingURL=539.1df076f70ae15c30.js.map