"use strict";(self.webpackChunkvendure_admin=self.webpackChunkvendure_admin||[]).push([[396],{8396:(Yt,T,a)=>{a.r(T),a.d(T,{GET_PROMOTION_DETAIL:()=>ut,GET_PROMOTION_LIST:()=>$t,MarketingModule:()=>Q,PromotionDetailComponent:()=>_,PromotionListComponent:()=>b,assignPromotionsToChannelBulkAction:()=>U,createRoutes:()=>O,deletePromotionsBulkAction:()=>D,promotionBreadcrumb:()=>Bt,removePromotionsFromChannelBulkAction:()=>I});var h,c=a(5086),l=a(186),s=a(848),C=a(2840),k=a(9034),$=a(1452),B=a(6526),t=a(6108),f=a(6445),p=a(8046),u=a(8621),Y=a(7336),M=a(8369),E=a(8251),y=a(1300),j=a(200),q=a(1343),G=a(2279),S=a(1921),R=a(4043),F=a(5796),x=a(7491),w=a(2707),H=a(7836),K=a(7432),J=a(3850),V=a(5276),z=a(5655),W=a(9274),X=a(8923),N=a(1317),tt=a(9360);function ot(n,e){if(1&n){const o=t.EpF();t.TgZ(0,"button",27),t.NdJ("click",function(){t.CHM(o);const r=t.oxw();return t.KtG(r.create())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&n){const o=t.oxw();t.Q6J("disabled",!o.saveButtonEnabled()),t.xp6(1),t.hij(" ",t.lcZ(2,2,"common.create")," ")}}function et(n,e){if(1&n){const o=t.EpF();t.TgZ(0,"button",27),t.NdJ("click",function(){t.CHM(o);const r=t.oxw(2);return t.KtG(r.save())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&n){const o=t.oxw(2);t.Q6J("disabled",!o.saveButtonEnabled()),t.xp6(1),t.hij(" ",t.lcZ(2,2,"common.update")," ")}}function nt(n,e){1&n&&t.YNc(0,et,3,4,"button",28),2&n&&t.Q6J("vdrIfPermissions","UpdatePromotion")}function it(n,e){1&n&&(t.TgZ(0,"vdr-card")(1,"clr-toggle-wrapper"),t._UZ(2,"input",29),t.TgZ(3,"label"),t._uU(4),t.ALo(5,"translate"),t.qZA()()()),2&n&&(t.xp6(4),t.Oqu(t.lcZ(5,1,"common.enabled")))}function rt(n,e){if(1&n&&(t.TgZ(0,"vdr-card"),t._UZ(1,"vdr-page-entity-info",30),t.qZA()),2&n){const o=e.ngIf;t.xp6(1),t.Q6J("entity",o)}}function at(n,e){if(1&n&&(t.TgZ(0,"vdr-card",31),t.ALo(1,"translate"),t._UZ(2,"vdr-tabbed-custom-fields",32),t.ALo(3,"hasPermission"),t.qZA()),2&n){const o=t.oxw();t.Q6J("title",t.lcZ(1,4,"common.custom-fields")),t.xp6(2),t.Q6J("customFields",o.customFields)("customFieldsFormGroup",o.detailForm.get("customFields"))("readonly",!t.lcZ(3,6,"UpdatePromotion"))}}function st(n,e){if(1&n){const o=t.EpF();t.TgZ(0,"div")(1,"vdr-configurable-input",33),t.NdJ("remove",function(r){t.CHM(o);const m=t.oxw();return t.KtG(m.removeCondition(r))}),t.ALo(2,"hasPermission"),t.qZA()()}if(2&n){const o=e.$implicit,i=e.index,r=t.oxw();t.xp6(1),t.Q6J("position",i)("readonly",!t.lcZ(2,5,"UpdatePromotion"))("operation",o)("operationDefinition",r.getConditionDefinition(o))("formControlName",i)}}function mt(n,e){if(1&n){const o=t.EpF();t.TgZ(0,"button",38),t.NdJ("click",function(){const m=t.CHM(o).$implicit,d=t.oxw(2);return t.KtG(d.addCondition(m))}),t._uU(1),t.qZA()}if(2&n){const o=e.$implicit;t.xp6(1),t.hij(" ",o.description," ")}}function lt(n,e){if(1&n&&(t.TgZ(0,"vdr-dropdown")(1,"button",34),t._UZ(2,"clr-icon",35),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"vdr-dropdown-menu",36),t.YNc(6,mt,2,1,"button",37),t.qZA()()),2&n){const o=t.oxw();t.xp6(3),t.hij(" ",t.lcZ(4,2,"marketing.add-condition")," "),t.xp6(3),t.Q6J("ngForOf",o.getAvailableConditions())}}function dt(n,e){if(1&n){const o=t.EpF();t.TgZ(0,"div")(1,"vdr-configurable-input",39),t.NdJ("remove",function(r){t.CHM(o);const m=t.oxw();return t.KtG(m.removeAction(r))}),t.ALo(2,"hasPermission"),t.qZA()()}if(2&n){const o=e.$implicit,i=e.index,r=t.oxw();t.xp6(1),t.Q6J("position",i)("operation",o)("readonly",!t.lcZ(2,5,"UpdatePromotion"))("operationDefinition",r.getActionDefinition(o))("formControlName",i)}}function ct(n,e){if(1&n){const o=t.EpF();t.TgZ(0,"button",38),t.NdJ("click",function(){const m=t.CHM(o).$implicit,d=t.oxw(2);return t.KtG(d.addAction(m))}),t._uU(1),t.qZA()}if(2&n){const o=e.$implicit;t.xp6(1),t.hij(" ",o.description," ")}}function pt(n,e){if(1&n&&(t.TgZ(0,"vdr-dropdown")(1,"button",34),t._UZ(2,"clr-icon",35),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"vdr-dropdown-menu",36),t.YNc(6,ct,2,1,"button",37),t.qZA()()),2&n){const o=t.oxw();t.xp6(3),t.hij(" ",t.lcZ(4,2,"marketing.add-action")," "),t.xp6(3),t.Q6J("ngForOf",o.getAvailableActions())}}const ut=C.Ps`
    query GetPromotionDetail($id: ID!) {
        promotion(id: $id) {
            ...Promotion
        }
    }
    ${s.CXu}
`;class _ extends s.VE7{constructor(e,o,i,r){super(),this.changeDetector=e,this.dataService=o,this.formBuilder=i,this.notificationService=r,this.customFields=this.getCustomFieldConfig("Promotion"),this.detailForm=this.formBuilder.group({name:["",c.kI.required],description:"",enabled:!0,couponCode:null,perCustomerUsageLimit:null,usageLimit:null,startsAt:null,endsAt:null,conditions:this.formBuilder.array([]),actions:this.formBuilder.array([]),customFields:this.formBuilder.group((0,s.Lrj)(this.customFields))}),this.conditions=[],this.actions=[],this.allConditions=[],this.allActions=[],this.customFields=this.getCustomFieldConfig("Promotion")}ngOnInit(){this.init(),this.dataService.promotion.getPromotionActionsAndConditions().single$.subscribe(e=>{this.allActions=e.promotionActions,this.allConditions=e.promotionConditions,this.changeDetector.markForCheck()})}ngOnDestroy(){this.destroy()}getAvailableConditions(){return this.allConditions.filter(e=>!this.conditions.find(o=>o.code===e.code))}getConditionDefinition(e){return this.allConditions.find(o=>o.code===e.code)}getAvailableActions(){return this.allActions.filter(e=>!this.actions.find(o=>o.code===e.code))}getActionDefinition(e){return this.allActions.find(o=>o.code===e.code)}saveButtonEnabled(){return!(!this.detailForm.dirty||!this.detailForm.valid||0===this.conditions.length&&!this.detailForm.value.couponCode||0===this.actions.length)}addCondition(e){this.addOperation("conditions",e),this.detailForm.markAsDirty()}addAction(e){this.addOperation("actions",e),this.detailForm.markAsDirty()}removeCondition(e){this.removeOperation("conditions",e),this.detailForm.markAsDirty()}removeAction(e){this.removeOperation("actions",e),this.detailForm.markAsDirty()}formArrayOf(e){return this.detailForm.get(e)}create(){if(!this.detailForm.dirty)return;const e=this.getUpdatedPromotion({id:"",createdAt:"",updatedAt:"",startsAt:"",endsAt:"",name:"",description:"",couponCode:null,perCustomerUsageLimit:null,usageLimit:null,enabled:!1,conditions:[],actions:[],translations:[]},this.detailForm,this.languageCode);this.dataService.promotion.createPromotion(e).subscribe(({createPromotion:o})=>{switch(o.__typename){case"Promotion":this.notificationService.success((0,l.J)("common.notify-create-success"),{entity:"Promotion"}),this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.router.navigate(["../",o.id],{relativeTo:this.route});break;case"MissingConditionsError":this.notificationService.error(o.message)}},o=>{this.notificationService.error((0,l.J)("common.notify-create-error"),{entity:"Promotion"})})}save(){this.detailForm.dirty&&(0,k.a)(this.entity$,this.languageCode$).pipe((0,$.q)(1),(0,B.z)(([e,o])=>{const i=this.getUpdatedPromotion(e,this.detailForm,o);return this.dataService.promotion.updatePromotion(i)})).subscribe(e=>{this.notificationService.success((0,l.J)("common.notify-update-success"),{entity:"Promotion"}),this.detailForm.markAsPristine(),this.changeDetector.markForCheck()},e=>{this.notificationService.error((0,l.J)("common.notify-update-error"),{entity:"Promotion"})})}getUpdatedPromotion(e,o,i){const r=o.value;return{...(0,s.iSy)({translatable:e,updatedFields:r,customFieldConfig:this.customFields,languageCode:i,defaultTranslation:{languageCode:i,name:e.name||"",description:e.description||""}}),conditions:this.mapOperationsToInputs(this.conditions,r.conditions),actions:this.mapOperationsToInputs(this.actions,r.actions)}}setFormValues(e,o){const i=(0,s.ZIM)(e,o);this.detailForm.patchValue({name:i?.name,description:i?.description,enabled:e.enabled,couponCode:e.couponCode,perCustomerUsageLimit:e.perCustomerUsageLimit,usageLimit:e.usageLimit,startsAt:e.startsAt,endsAt:e.endsAt}),e.conditions.forEach(r=>{this.addOperation("conditions",r)}),e.actions.forEach(r=>this.addOperation("actions",r)),this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get("customFields"),e)}mapOperationsToInputs(e,o){return e.map((i,r)=>({code:i.code,arguments:Object.values(o[r].args).map((m,d)=>({name:i.args[d].name,value:(0,s.qrw)(m)}))}))}addOperation(e,o){const i=this.formArrayOf(e),r="conditions"===e?this.conditions:this.actions;if(-1===i.value.findIndex(d=>d.code===o.code)){const d=o.args.reduce((A,L)=>({...A,[L.name]:(0,s.sux)(L.value)??this.getDefaultArgValue(e,o,L.name)}),{});i.push(this.formBuilder.control({code:o.code,args:d})),r.push({code:o.code,args:o.args.map(A=>({name:A.name,value:(0,s.sux)(A.value)}))})}}getDefaultArgValue(e,o,i){const r="conditions"===e?this.allConditions.find(m=>m.code===o.code):this.allActions.find(m=>m.code===o.code);if(r){const m=r.args.find(d=>d.name===i);if(m)return(0,s.NWQ)(m)}throw new Error('Could not determine default value for "argName"')}removeOperation(e,o){const i=this.formArrayOf(e),r="conditions"===e?this.conditions:this.actions,m=i.value.findIndex(d=>d.code===o.code);-1!==m&&(i.removeAt(m),r.splice(m,1))}}(h=_).\u0275fac=function(e){return new(e||h)(t.Y36(t.sBO),t.Y36(s.DoR),t.Y36(c.qu),t.Y36(s.gqp))},h.\u0275cmp=t.Xpm({type:h,selectors:[["vdr-promotion-detail"]],features:[t.qOj],decls:62,vars:73,consts:[[1,"flex","clr-align-items-center"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","promotion-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],[1,"form",3,"formGroup"],[4,"vdrIfPermissions"],[4,"ngIf"],[1,"form-grid"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly"],["formControlName","description",1,"form-grid-span",3,"readonly","label"],["for","startsAt",3,"label"],["formControlName","startsAt"],["for","endsAt",3,"label"],["formControlName","endsAt"],["for","couponCode",3,"label"],["id","couponCode","type","text","formControlName","couponCode",3,"readonly"],["for","perCustomerUsageLimit",3,"label","tooltip"],["id","perCustomerUsageLimit","type","number","min","1","max","999","formControlName","perCustomerUsageLimit",3,"readonly"],["for","usageLimit",3,"label","tooltip"],["id","usageLimit","type","number","min","1","max","9999999","formControlName","usageLimit",3,"readonly"],["formGroupName","customFields",3,"title",4,"ngIf"],["locationId","promotion-detail",3,"entity$","detailForm"],["formArrayName","conditions",3,"title"],[4,"ngFor","ngForOf"],["formArrayName","actions",3,"title"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],["type","checkbox","clrToggle","","name","enabled","formControlName","enabled"],[3,"entity"],["formGroupName","customFields",3,"title"],["entityName","Promotion",3,"customFields","customFieldsFormGroup","readonly"],[3,"position","readonly","operation","operationDefinition","formControlName","remove"],["vdrDropdownTrigger","",1,"btn","btn-outline"],["shape","plus"],["vdrPosition","bottom-left"],["type","button","vdrDropdownItem","","class","item-wrap",3,"click",4,"ngFor","ngForOf"],["type","button","vdrDropdownItem","",1,"item-wrap",3,"click"],[3,"position","operation","readonly","operationDefinition","formControlName","remove"]],template:function(e,o){if(1&e&&(t.TgZ(0,"vdr-page-block")(1,"vdr-action-bar")(2,"vdr-ab-left")(3,"div",0)(4,"vdr-language-selector",1),t.NdJ("languageCodeChange",function(r){return o.setLanguage(r)}),t.ALo(5,"async"),t.ALo(6,"async"),t.ALo(7,"async"),t.qZA()()(),t.TgZ(8,"vdr-ab-right"),t._UZ(9,"vdr-action-bar-items",2),t.YNc(10,ot,3,4,"button",3),t.ALo(11,"async"),t.YNc(12,nt,1,1,"ng-template",null,4,t.W1O),t.qZA()()(),t.TgZ(14,"form",5)(15,"vdr-page-detail-layout")(16,"vdr-page-detail-sidebar"),t.YNc(17,it,6,3,"vdr-card",6),t.YNc(18,rt,2,1,"vdr-card",7),t.ALo(19,"async"),t.qZA(),t.TgZ(20,"vdr-page-block")(21,"vdr-card")(22,"div",8)(23,"vdr-form-field",9),t.ALo(24,"translate"),t._UZ(25,"input",10),t.ALo(26,"hasPermission"),t.qZA(),t._UZ(27,"vdr-rich-text-editor",11),t.ALo(28,"hasPermission"),t.ALo(29,"translate"),t.TgZ(30,"vdr-form-field",12),t.ALo(31,"translate"),t._UZ(32,"vdr-datetime-picker",13),t.qZA(),t.TgZ(33,"vdr-form-field",14),t.ALo(34,"translate"),t._UZ(35,"vdr-datetime-picker",15),t.qZA(),t.TgZ(36,"vdr-form-field",16),t.ALo(37,"translate"),t._UZ(38,"input",17),t.ALo(39,"hasPermission"),t.qZA(),t.TgZ(40,"vdr-form-field",18),t.ALo(41,"translate"),t.ALo(42,"translate"),t._UZ(43,"input",19),t.ALo(44,"hasPermission"),t.qZA(),t.TgZ(45,"vdr-form-field",20),t.ALo(46,"translate"),t.ALo(47,"translate"),t._UZ(48,"input",21),t.ALo(49,"hasPermission"),t.qZA()()(),t.YNc(50,at,4,8,"vdr-card",22),t._UZ(51,"vdr-custom-detail-component-host",23),t.TgZ(52,"vdr-card",24),t.ALo(53,"translate"),t.YNc(54,st,3,7,"div",25),t.TgZ(55,"div"),t.YNc(56,lt,7,4,"vdr-dropdown",6),t.qZA()(),t.TgZ(57,"vdr-card",26),t.ALo(58,"translate"),t.YNc(59,dt,3,7,"div",25),t.TgZ(60,"div"),t.YNc(61,pt,7,4,"vdr-dropdown",6),t.qZA()()()()()),2&e){const i=t.MAs(13);t.xp6(4),t.Q6J("disabled",t.lcZ(5,31,o.isNew$))("availableLanguageCodes",t.lcZ(6,33,o.availableLanguages$))("currentLanguageCode",t.lcZ(7,35,o.languageCode$)),t.xp6(6),t.Q6J("ngIf",t.lcZ(11,37,o.isNew$))("ngIfElse",i),t.xp6(4),t.Q6J("formGroup",o.detailForm),t.xp6(3),t.Q6J("vdrIfPermissions","UpdatePromotion"),t.xp6(1),t.Q6J("ngIf",t.lcZ(19,39,o.entity$)),t.xp6(5),t.Q6J("label",t.lcZ(24,41,"common.name")),t.xp6(2),t.Q6J("readonly",!t.lcZ(26,43,"UpdatePromotion")),t.xp6(2),t.Q6J("readonly",!t.lcZ(28,45,"UpdatePromotion"))("label",t.lcZ(29,47,"common.description")),t.xp6(3),t.Q6J("label",t.lcZ(31,49,"marketing.starts-at")),t.xp6(3),t.Q6J("label",t.lcZ(34,51,"marketing.ends-at")),t.xp6(3),t.Q6J("label",t.lcZ(37,53,"marketing.coupon-code")),t.xp6(2),t.Q6J("readonly",!t.lcZ(39,55,"UpdatePromotion")),t.xp6(2),t.Q6J("label",t.lcZ(41,57,"marketing.per-customer-limit"))("tooltip",t.lcZ(42,59,"marketing.per-customer-limit-tooltip")),t.xp6(3),t.Q6J("readonly",!t.lcZ(44,61,"UpdatePromotion")),t.xp6(2),t.Q6J("label",t.lcZ(46,63,"marketing.usage-limit"))("tooltip",t.lcZ(47,65,"marketing.usage-limit-tooltip")),t.xp6(3),t.Q6J("readonly",!t.lcZ(49,67,"UpdatePromotion")),t.xp6(2),t.Q6J("ngIf",o.customFields.length),t.xp6(1),t.Q6J("entity$",o.entity$)("detailForm",o.detailForm),t.xp6(1),t.Q6J("title",t.lcZ(53,69,"marketing.conditions")),t.xp6(2),t.Q6J("ngForOf",o.conditions),t.xp6(2),t.Q6J("vdrIfPermissions","UpdatePromotion"),t.xp6(1),t.Q6J("title",t.lcZ(58,71,"marketing.actions")),t.xp6(2),t.Q6J("ngForOf",o.actions),t.xp6(2),t.Q6J("vdrIfPermissions","UpdatePromotion")}},dependencies:[f.qvL,f.MgK,f.KKC,f.PEh,p.sg,p.O5,c._Y,c.Fj,c.wV,c.Wl,c.JJ,c.JL,c.qQ,c.Fd,c.sg,c.u,c.x0,c.CE,u.Kk,u.BN,u.mz,Y.q,M.h,E.y,y.S,j.Y,q.J,G.N,S.U,R.H,F.H,x.W,w.I,H.y,K.C,J.z,V.D,z.T,W.W,X.A,p.Ov,N.X$,tt.j],styles:[".item-wrap[_ngcontent-%COMP%]{white-space:normal}"],changeDetection:0});var Z=a(3044);C.Ps`
    mutation AssignPromotionsToChannel($input: AssignPromotionsToChannelInput!) {
        assignPromotionsToChannel(input: $input) {
            id
            name
        }
    }
`,C.Ps`
    mutation RemovePromotionsFromChannel($input: RemovePromotionsFromChannelInput!) {
        removePromotionsFromChannel(input: $input) {
            id
            name
        }
    }
`;const D=(0,s.wwB)({location:"promotion-list",requiresPermission:s.y3$.DeletePromotion,getItemName:n=>n.name,bulkDelete:(n,e)=>n.promotion.deletePromotions(e).pipe((0,Z.U)(o=>o.deletePromotions))}),U=(0,s.z1G)({location:"promotion-list",requiresPermission:s.y3$.UpdatePromotion,getItemName:n=>n.name,bulkAssignToChannel:(n,e,o)=>n.mutate(s.bPU,{input:{channelId:o,promotionIds:e}}).pipe((0,Z.U)(i=>i.assignPromotionsToChannel))}),I=(0,s.RBx)({location:"promotion-list",requiresPermission:s.y3$.DeleteCatalog,getItemName:n=>n.name,bulkRemoveFromChannel:(n,e,o)=>n.mutate(s.o1U,{input:{channelId:o,promotionIds:e}}).pipe((0,Z.U)(i=>i.removePromotionsFromChannel))});var v,P=a(4285),gt=a(7017),ft=a(7615),ht=a(106),vt=a(2249),Ct=a(8269),At=a(419),_t=a(2388);const Zt=function(){return["./create"]};function Pt(n,e){1&n&&(t.TgZ(0,"a",16),t._UZ(1,"clr-icon",17),t._uU(2),t.ALo(3,"translate"),t.qZA()),2&n&&(t.Q6J("routerLink",t.DdM(4,Zt)),t.xp6(2),t.hij(" ",t.lcZ(3,2,"marketing.create-new-promotion")," "))}function bt(n,e){if(1&n&&t._uU(0),2&n){const o=e.item;t.Oqu(o.id)}}function Lt(n,e){if(1&n&&(t._uU(0),t.ALo(1,"localeDate")),2&n){const o=e.item;t.hij(" ",t.xi3(1,1,o.createdAt,"short")," ")}}function Tt(n,e){if(1&n&&(t._uU(0),t.ALo(1,"localeDate")),2&n){const o=e.item;t.hij(" ",t.xi3(1,1,o.updatedAt,"short")," ")}}const yt=function(n){return["./",n]};function Ft(n,e){if(1&n&&(t.TgZ(0,"a",18)(1,"span"),t._uU(2),t.qZA(),t._UZ(3,"clr-icon",19),t.qZA()),2&n){const o=e.item;t.Q6J("routerLink",t.VKq(2,yt,o.id)),t.xp6(2),t.hij(" ",o.name,"")}}function xt(n,e){1&n&&(t.TgZ(0,"vdr-chip",22),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"common.enabled")))}function Jt(n,e){1&n&&(t.TgZ(0,"vdr-chip",23),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"common.disabled")))}function Nt(n,e){if(1&n&&(t.YNc(0,xt,3,3,"vdr-chip",20),t.YNc(1,Jt,3,3,"vdr-chip",21)),2&n){const o=e.item;t.Q6J("ngIf",o.enabled),t.xp6(1),t.Q6J("ngIf",!o.enabled)}}function Dt(n,e){if(1&n&&t._uU(0),2&n){const o=e.item;t.hij(" ",o.couponCode," ")}}function Ut(n,e){if(1&n&&(t._uU(0),t.ALo(1,"localeDate")),2&n){const o=e.item;t.hij(" ",t.xi3(1,1,o.startsAt,"short")," ")}}function It(n,e){if(1&n&&(t._uU(0),t.ALo(1,"localeDate")),2&n){const o=e.item;t.hij(" ",t.xi3(1,1,o.endsAt,"short")," ")}}function Ot(n,e){if(1&n&&t._uU(0),2&n){const o=e.item;t.hij(" ",o.perCustomerUsageLimit," ")}}function Qt(n,e){if(1&n&&t._uU(0),2&n){const o=e.item;t.hij(" ",o.usageLimit," ")}}function kt(n,e){if(1&n&&t._UZ(0,"vdr-dt2-custom-field-column",24),2&n){const o=e.$implicit,i=t.oxw();t.Q6J("customField",o)("sorts",i.sorts)}}const $t=C.Ps`
    query GetPromotionList($options: PromotionListOptions) {
        promotions(options: $options) {
            items {
                ...Promotion
            }
            totalItems
        }
    }
    ${s.CXu}
`;class b extends s.$ms{constructor(){super(),this.customFields=this.getCustomFieldConfig("Promotion"),this.filters=this.createFilterCollection().addIdFilter().addDateFilters().addFilters([{name:"startsAt",type:{kind:"dateRange"},label:(0,l.J)("marketing.starts-at"),filterField:"startsAt"},{name:"endsAt",type:{kind:"dateRange"},label:(0,l.J)("marketing.ends-at"),filterField:"endsAt"},{name:"enabled",type:{kind:"boolean"},label:(0,l.J)("common.enabled"),filterField:"enabled"},{name:"name",type:{kind:"text"},label:(0,l.J)("common.name"),filterField:"name"},{name:"couponCode",type:{kind:"text"},label:(0,l.J)("marketing.coupon-code"),filterField:"couponCode"},{name:"desc",type:{kind:"text"},label:(0,l.J)("common.description"),filterField:"description"},{name:"perCustomerUsageLimit",type:{kind:"number"},label:(0,l.J)("marketing.per-customer-limit"),filterField:"perCustomerUsageLimit"},{name:"usageLimit",type:{kind:"number"},label:(0,l.J)("marketing.usage-limit"),filterField:"usageLimit"}]).addCustomFieldFilters(this.customFields).connectToRoute(this.route),this.sorts=this.createSortCollection().defaultSort("createdAt","DESC").addSorts([{name:"createdAt"},{name:"updatedAt"},{name:"startsAt"},{name:"endsAt"},{name:"name"},{name:"couponCode"},{name:"perCustomerUsageLimit"},{name:"usageLimit"}]).addCustomFieldSorts(this.customFields).connectToRoute(this.route),super.configure({document:s.dnZ,getItems:e=>e.promotions,setVariables:(e,o)=>this.createQueryOptions(e,o,this.searchTermControl.value),refreshListOnChanges:[this.filters.valueChanges,this.sorts.valueChanges]})}createQueryOptions(e,o,i){const r=this.filters.createFilterInput(),m=this.sorts.createSortInput();let d=s.FnJ.AND;return i&&(r.couponCode={contains:i},r.name={contains:i},d=s.FnJ.OR),{options:{skip:e,take:o,filter:r,filterOperator:d,sort:m}}}}(v=b).\u0275fac=function(e){return new(e||v)},v.\u0275cmp=t.Xpm({type:v,selectors:[["vdr-promotion-list"]],features:[t.qOj],decls:48,vars:71,consts:[[3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","customer-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],["id","promotion-list",3,"items","itemsPerPage","totalItems","currentPage","filters","pageChange","itemsPerPageChange"],["locationId","promotion-list",3,"hostComponent","selectionManager"],[3,"searchTermControl","searchTermPlaceholder"],["id","id",3,"heading","hiddenByDefault"],["id","created-at",3,"heading","hiddenByDefault","sort"],["id","updated-at",3,"heading","hiddenByDefault","sort"],["id","name",3,"heading","optional","sort"],["id","enabled",3,"heading"],["id","coupon-code",3,"heading","sort"],["id","starts-at",3,"heading","sort"],["id","ends-at",3,"heading","sort"],["id","per-customer-limit",3,"heading","sort","hiddenByDefault"],[3,"customField","sorts",4,"ngFor","ngForOf"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"button-ghost",3,"routerLink"],["shape","arrow right"],["colorType","success",4,"ngIf"],["colorType","warning",4,"ngIf"],["colorType","success"],["colorType","warning"],[3,"customField","sorts"]],template:function(e,o){1&e&&(t.TgZ(0,"vdr-page-block")(1,"vdr-action-bar")(2,"vdr-ab-left")(3,"vdr-language-selector",0),t.NdJ("languageCodeChange",function(r){return o.setLanguage(r)}),t.ALo(4,"async"),t.ALo(5,"async"),t.qZA()(),t.TgZ(6,"vdr-ab-right"),t._UZ(7,"vdr-action-bar-items",1),t.YNc(8,Pt,4,5,"a",2),t.qZA()()(),t.TgZ(9,"vdr-data-table-2",3),t.NdJ("pageChange",function(r){return o.setPageNumber(r)})("itemsPerPageChange",function(r){return o.setItemsPerPage(r)}),t.ALo(10,"async"),t.ALo(11,"async"),t.ALo(12,"async"),t.ALo(13,"async"),t._UZ(14,"vdr-bulk-action-menu",4)(15,"vdr-dt2-search",5),t.ALo(16,"translate"),t.TgZ(17,"vdr-dt2-column",6),t.ALo(18,"translate"),t.YNc(19,bt,1,1,"ng-template"),t.qZA(),t.TgZ(20,"vdr-dt2-column",7),t.ALo(21,"translate"),t.YNc(22,Lt,2,4,"ng-template"),t.qZA(),t.TgZ(23,"vdr-dt2-column",8),t.ALo(24,"translate"),t.YNc(25,Tt,2,4,"ng-template"),t.qZA(),t.TgZ(26,"vdr-dt2-column",9),t.ALo(27,"translate"),t.YNc(28,Ft,4,4,"ng-template"),t.qZA(),t.TgZ(29,"vdr-dt2-column",10),t.ALo(30,"translate"),t.YNc(31,Nt,2,2,"ng-template"),t.qZA(),t.TgZ(32,"vdr-dt2-column",11),t.ALo(33,"translate"),t.YNc(34,Dt,1,1,"ng-template"),t.qZA(),t.TgZ(35,"vdr-dt2-column",12),t.ALo(36,"translate"),t.YNc(37,Ut,2,4,"ng-template"),t.qZA(),t.TgZ(38,"vdr-dt2-column",13),t.ALo(39,"translate"),t.YNc(40,It,2,4,"ng-template"),t.qZA(),t.TgZ(41,"vdr-dt2-column",14),t.ALo(42,"translate"),t.YNc(43,Ot,1,1,"ng-template"),t.qZA(),t.TgZ(44,"vdr-dt2-column",14),t.ALo(45,"translate"),t.YNc(46,Qt,1,1,"ng-template"),t.qZA(),t.YNc(47,kt,1,2,"vdr-dt2-custom-field-column",15),t.qZA()),2&e&&(t.xp6(3),t.Q6J("availableLanguageCodes",t.lcZ(4,37,o.availableLanguages$))("currentLanguageCode",t.lcZ(5,39,o.contentLanguage$)),t.xp6(5),t.Q6J("vdrIfPermissions","CreatePromotion"),t.xp6(1),t.Q6J("items",t.lcZ(10,41,o.items$))("itemsPerPage",t.lcZ(11,43,o.itemsPerPage$))("totalItems",t.lcZ(12,45,o.totalItems$))("currentPage",t.lcZ(13,47,o.currentPage$))("filters",o.filters),t.xp6(5),t.Q6J("hostComponent",o)("selectionManager",o.selectionManager),t.xp6(1),t.Q6J("searchTermControl",o.searchTermControl)("searchTermPlaceholder",t.lcZ(16,49,"marketing.search-by-name-or-coupon-code")),t.xp6(2),t.Q6J("heading",t.lcZ(18,51,"common.id"))("hiddenByDefault",!0),t.xp6(3),t.Q6J("heading",t.lcZ(21,53,"common.created-at"))("hiddenByDefault",!0)("sort",o.sorts.get("createdAt")),t.xp6(3),t.Q6J("heading",t.lcZ(24,55,"common.updated-at"))("hiddenByDefault",!0)("sort",o.sorts.get("updatedAt")),t.xp6(3),t.Q6J("heading",t.lcZ(27,57,"common.name"))("optional",!1)("sort",o.sorts.get("name")),t.xp6(3),t.Q6J("heading",t.lcZ(30,59,"common.enabled")),t.xp6(3),t.Q6J("heading",t.lcZ(33,61,"marketing.coupon-code"))("sort",o.sorts.get("couponCode")),t.xp6(3),t.Q6J("heading",t.lcZ(36,63,"marketing.starts-at"))("sort",o.sorts.get("startsAt")),t.xp6(3),t.Q6J("heading",t.lcZ(39,65,"marketing.ends-at"))("sort",o.sorts.get("endsAt")),t.xp6(3),t.Q6J("heading",t.lcZ(42,67,"marketing.per-customer-limit"))("sort",o.sorts.get("perCustomerUsageLimit"))("hiddenByDefault",!0),t.xp6(3),t.Q6J("heading",t.lcZ(45,69,"marketing.per-customer-limit"))("sort",o.sorts.get("usageLimit"))("hiddenByDefault",!0),t.xp6(3),t.Q6J("ngForOf",o.customFields))},dependencies:[f.qvL,p.sg,p.O5,P.rH,u.Kk,u.BN,u.mz,gt.Y,y.S,F.H,x.W,ft.c,ht.e,vt.U,Ct.J,At.j,J.z,p.Ov,N.X$,_t.H],styles:[".search-form[_ngcontent-%COMP%]{padding:0}.search-input[_ngcontent-%COMP%]{margin:6px 8px 0 0;min-width:200px}"],changeDetection:0});const O=n=>[{path:"promotions",component:s.IIO,data:{locationId:"promotion-list",breadcrumb:(0,l.J)("breadcrumb.promotions")},children:n.getPageTabRoutes("promotion-list")},{path:"promotions/:id",component:s.IIO,data:{locationId:"promotion-detail",breadcrumb:{label:(0,l.J)("breadcrumb.promotions"),link:["../","promotions"]}},children:n.getPageTabRoutes("promotion-detail")}];function Bt(n,e){return(0,s.YWC)({entity:n.entity,id:e.id,breadcrumbKey:"breadcrumb.promotions",getName:o=>o.name,route:"promotions"})}var g;class Q{constructor(e,o){this.bulkActionRegistryService=e,e.registerBulkAction(U),e.registerBulkAction(I),e.registerBulkAction(D),o.registerPageTab({priority:0,location:"promotion-list",tab:(0,l.J)("breadcrumb.promotions"),route:"",component:b}),o.registerPageTab({priority:0,location:"promotion-detail",tab:(0,l.J)("marketing.promotion"),route:"",component:(0,s.IX9)({component:_,query:s.cRD,entityKey:"promotion",getBreadcrumbs:i=>[{label:i?i.name:(0,l.J)("marketing.create-new-promotion"),link:[i?.id]}]})})}}(g=Q).\u0275fac=function(e){return new(e||g)(t.LFG(s._4w),t.LFG(s.PhL))},g.\u0275mod=t.oAB({type:g}),g.\u0275inj=t.cJS({providers:[{provide:P.Z6,useFactory:n=>O(n),multi:!0,deps:[s.PhL]}],imports:[s.m81,P.Bz.forChild([]),s.m81,s.m81]})}}]);
//# sourceMappingURL=396.6d27eed71aaf4727.js.map