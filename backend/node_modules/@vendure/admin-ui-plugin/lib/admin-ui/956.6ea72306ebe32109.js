"use strict";(self.webpackChunkvendure_admin=self.webpackChunkvendure_admin||[]).push([[956],{7956:(At,y,a)=>{a.r(y),a.d(y,{HealthCheckComponent:()=>_,JobListComponent:()=>T,JobStateLabelComponent:()=>f,SystemModule:()=>q,systemRoutes:()=>I});var g,t=a(6108),s=a(848),i=a(6445),c=a(8046),p=a(8621),v=a(7017),C=a(7491),x=a(1563),L=a(4437),J=a(8005),j=a(3850),N=a(1317),O=a(2388);function P(e,o){1&e&&(t.ynx(0),t._uU(1),t.ALo(2,"translate"),t.BQk()),2&e&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"system.health-all-systems-up")," "))}function E(e,o){1&e&&(t._uU(0),t.ALo(1,"translate")),2&e&&t.hij(" ",t.lcZ(1,1,"system.health-error")," ")}const Y=function(e,o){return{"is-success":e,"is-danger":o}};function F(e,o){if(1&e&&(t.TgZ(0,"div",7)(1,"div",8),t._UZ(2,"clr-icon",9),t.qZA(),t.TgZ(3,"div",10),t.YNc(4,P,3,3,"ng-container",11),t.YNc(5,E,2,3,"ng-template",null,12,t.W1O),t.TgZ(7,"div",13),t._uU(8),t.ALo(9,"translate"),t.ALo(10,"localeDate"),t.ALo(11,"async"),t.qZA()()()),2&e){const n=o.ngIf,l=t.MAs(6),r=t.oxw();t.xp6(2),t.Q6J("ngClass",t.WLB(13,Y,"ok"===n,"ok"!==n)),t.uIk("shape","ok"===n?"check-circle":"exclamation-circle"),t.xp6(2),t.Q6J("ngIf","ok"===n)("ngIfElse",l),t.xp6(4),t.AsE(" ",t.lcZ(9,6,"system.health-last-checked"),": ",t.xi3(10,8,t.lcZ(11,11,r.healthCheckService.lastCheck$),"mediumTime")," ")}}function S(e,o){1&e&&(t.ynx(0),t._UZ(1,"clr-icon",17),t._uU(2),t.ALo(3,"translate"),t.BQk()),2&e&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"system.health-status-up")," "))}function k(e,o){1&e&&(t._UZ(0,"clr-icon",18),t._uU(1),t.ALo(2,"translate")),2&e&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"system.health-status-down")," "))}function D(e,o){if(1&e&&(t.TgZ(0,"tr")(1,"td",14),t._uU(2),t.qZA(),t.TgZ(3,"td",14)(4,"vdr-chip",15),t.YNc(5,S,4,3,"ng-container",11),t.YNc(6,k,3,3,"ng-template",null,16,t.W1O),t.qZA()(),t.TgZ(8,"td",14),t._uU(9),t.qZA()()),2&e){const n=o.$implicit,l=t.MAs(7);t.xp6(2),t.Oqu(n.key),t.xp6(2),t.Q6J("colorType","up"===n.result.status?"success":"error"),t.xp6(1),t.Q6J("ngIf","up"===n.result.status)("ngIfElse",l),t.xp6(4),t.Oqu(n.result.message)}}class _{constructor(o){this.healthCheckService=o}}(g=_).\u0275fac=function(o){return new(o||g)(t.Y36(s.Gpz))},g.\u0275cmp=t.Xpm({type:g,selectors:[["vdr-health-check"]],decls:30,vars:18,consts:[["class","system-status-header",4,"ngIf"],["locationId","system-status"],[1,"btn","btn-secondary",3,"click"],["shape","refresh"],[1,"table"],[1,"left"],[4,"ngFor","ngForOf"],[1,"system-status-header"],[1,"status-icon"],["size","48",3,"ngClass"],[1,"status-detail"],[4,"ngIf","ngIfElse"],["error",""],[1,"last-checked"],[1,"align-middle","left"],[3,"colorType"],["down",""],["shape","check-circle"],["shape","exclamation-circle"]],template:function(o,n){1&o&&(t.TgZ(0,"vdr-page-header"),t._UZ(1,"vdr-page-title"),t.qZA(),t.TgZ(2,"vdr-page-body")(3,"vdr-page-block")(4,"vdr-action-bar")(5,"vdr-ab-left"),t.YNc(6,F,12,16,"div",0),t.ALo(7,"async"),t.qZA(),t.TgZ(8,"vdr-ab-right"),t._UZ(9,"vdr-action-bar-items",1),t.TgZ(10,"button",2),t.NdJ("click",function(){return n.healthCheckService.refresh()}),t._UZ(11,"clr-icon",3),t._uU(12),t.ALo(13,"translate"),t.qZA()()()(),t.TgZ(14,"vdr-page-block")(15,"table",4)(16,"thead")(17,"tr")(18,"th",5),t._uU(19),t.ALo(20,"translate"),t.qZA(),t.TgZ(21,"th",5),t._uU(22),t.ALo(23,"translate"),t.qZA(),t.TgZ(24,"th",5),t._uU(25),t.ALo(26,"translate"),t.qZA()()(),t.TgZ(27,"tbody"),t.YNc(28,D,10,5,"tr",6),t.ALo(29,"async"),t.qZA()()()()),2&o&&(t.xp6(6),t.Q6J("ngIf",t.lcZ(7,6,n.healthCheckService.status$)),t.xp6(6),t.hij(" ",t.lcZ(13,8,"system.health-refresh")," "),t.xp6(7),t.hij(" ",t.lcZ(20,10,"common.name")," "),t.xp6(3),t.hij(" ",t.lcZ(23,12,"system.health-status")," "),t.xp6(3),t.hij(" ",t.lcZ(26,14,"system.health-message")," "),t.xp6(3),t.Q6J("ngForOf",t.lcZ(29,16,n.healthCheckService.details$)))},dependencies:[i.qvL,c.mk,c.sg,c.O5,p.Kk,p.BN,p.mz,v.Y,C.W,x.q,L.T,J.H,j.z,c.Ov,N.X$,O.H],styles:[".system-status-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start}.system-status-header[_ngcontent-%COMP%]   .status-detail[_ngcontent-%COMP%]{font-weight:700;margin-inline-end:6px}.system-status-header[_ngcontent-%COMP%]   .last-checked[_ngcontent-%COMP%]{font-weight:400;color:var(--color-grey-500)}"],changeDetection:0});var u,m=a(5086),w=a(9006),M=a(8163),H=a(2727),R=a(3044),b=a(4285),Z=a(4992),G=a(8251),$=a(1343),z=a(2279),B=a(1921),W=a(4043),K=a(1662),X=a(106),V=a(2249);function tt(e,o){if(1&e&&(t.TgZ(0,"span",3),t._uU(1),t.ALo(2,"percent"),t.qZA()),2&e){const n=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,n.job.progress/100)," ")}}class f{get iconShape(){switch(this.job.state){case s.Zyh.COMPLETED:return"check-circle";case s.Zyh.FAILED:return"exclamation-circle";case s.Zyh.CANCELLED:return"ban";case s.Zyh.PENDING:case s.Zyh.RETRYING:return"hourglass";case s.Zyh.RUNNING:return"sync"}}get colorType(){switch(this.job.state){case s.Zyh.COMPLETED:return"success";case s.Zyh.FAILED:case s.Zyh.CANCELLED:return"error";case s.Zyh.PENDING:case s.Zyh.RETRYING:return"";case s.Zyh.RUNNING:return"warning"}}}(u=f).\u0275fac=function(o){return new(o||u)},u.\u0275cmp=t.Xpm({type:u,selectors:[["vdr-job-state-label"]],inputs:{job:"job"},decls:5,vars:6,consts:[[3,"colorType"],[1,"mr1"],["class","progress",4,"ngIf"],[1,"progress"]],template:function(o,n){1&o&&(t.TgZ(0,"vdr-chip",0),t._UZ(1,"clr-icon",1),t._uU(2),t.ALo(3,"titlecase"),t.YNc(4,tt,3,3,"span",2),t.qZA()),2&o&&(t.Q6J("colorType",n.colorType),t.xp6(1),t.uIk("shape",n.iconShape),t.xp6(1),t.hij(" ",t.lcZ(3,4,n.job.state)," "),t.xp6(2),t.Q6J("ngIf","RUNNING"===n.job.state))},dependencies:[i.qvL,c.O5,v.Y,c.Zx,c.rS],styles:[".progress[_ngcontent-%COMP%]{margin-inline-start:3px}clr-icon[_ngcontent-%COMP%]{min-width:12px}"],changeDetection:0});var h,et=a(9360),nt=a(2814),ot=a(7247);function at(e,o){1&e&&(t.ynx(0),t.TgZ(1,"vdr-chip"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.BQk()),2&e&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"system.all-job-queues")))}function st(e,o){if(1&e&&(t.TgZ(0,"vdr-chip",20),t._uU(1),t.qZA()),2&e){const n=t.oxw().item;t.Q6J("colorFrom",n.name),t.xp6(1),t.Oqu(n.name)}}function lt(e,o){if(1&e&&(t.YNc(0,at,4,3,"ng-container",18),t.YNc(1,st,2,2,"ng-template",null,19,t.W1O)),2&e){const n=o.item,l=t.MAs(2);t.Q6J("ngIf","all"===n.name)("ngIfElse",l)}}function rt(e,o){if(1&e&&t._uU(0),2&e){const n=o.item;t.hij(" ",n.id," ")}}function ct(e,o){if(1&e&&(t._uU(0),t.ALo(1,"timeAgo")),2&e){const n=o.item;t.hij(" ",t.lcZ(1,1,n.createdAt)," ")}}function it(e,o){if(1&e&&(t.TgZ(0,"vdr-chip",20),t._uU(1),t.qZA()),2&e){const n=o.item;t.Q6J("colorFrom",n.queueName),t.xp6(1),t.Oqu(n.queueName)}}function pt(e,o){if(1&e&&(t.TgZ(0,"vdr-dropdown")(1,"button",22),t.ALo(2,"translate"),t._UZ(3,"clr-icon",23),t.qZA(),t.TgZ(4,"vdr-dropdown-menu")(5,"div",24),t._UZ(6,"vdr-object-tree",4),t.qZA()()()),2&e){const n=t.oxw().item;t.xp6(1),t.Q6J("title",t.lcZ(2,2,"system.job-data")),t.xp6(5),t.Q6J("value",n.data)}}function mt(e,o){if(1&e&&t.YNc(0,pt,7,4,"vdr-dropdown",21),2&e){const n=o.item;t.Q6J("ngIf",n.data)}}function dt(e,o){if(1&e&&(t.TgZ(0,"div",27),t._uU(1),t.qZA()),2&e){const n=t.oxw().item;t.xp6(1),t.hij("after ",n.attempts," attempts")}}function gt(e,o){if(1&e&&(t.TgZ(0,"div",27),t._uU(1),t.qZA()),2&e){const n=t.oxw().item;t.xp6(1),t.AsE(" attempting ",n.attempts," of ",n.retries+1," ")}}function ut(e,o){if(1&e&&(t._UZ(0,"vdr-job-state-label",25),t.YNc(1,dt,2,1,"div",26),t.YNc(2,gt,2,2,"div",26)),2&e){const n=o.item;t.Q6J("job",n),t.xp6(1),t.Q6J("ngIf","FAILED"===n.state),t.xp6(1),t.Q6J("ngIf","RUNNING"===n.state||"RETRYING"===n.state)}}function ht(e,o){if(1&e&&(t._uU(0),t.ALo(1,"duration")),2&e){const n=o.item;t.hij(" ",t.lcZ(1,1,n.duration)," ")}}function Zt(e,o){if(1&e&&(t.TgZ(0,"vdr-dropdown")(1,"button",28),t._UZ(2,"clr-icon",23),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"vdr-dropdown-menu")(6,"div",24),t._UZ(7,"vdr-object-tree",4),t.qZA()()()),2&e){const n=t.oxw().item;t.xp6(3),t.hij(" ",t.lcZ(4,2,"system.job-result")," "),t.xp6(4),t.Q6J("value",n.result)}}function vt(e,o){if(1&e&&(t.TgZ(0,"vdr-dropdown")(1,"button",29),t._UZ(2,"clr-icon",30),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"vdr-dropdown-menu")(6,"div",24),t._uU(7),t.qZA()()()),2&e){const n=t.oxw().item;t.xp6(3),t.hij(" ",t.lcZ(4,2,"system.job-error")," "),t.xp6(4),t.hij(" ",n.error," ")}}const _t=function(){return["DeleteSettings","DeleteSystem"]};function bt(e,o){if(1&e){const n=t.EpF();t.TgZ(0,"vdr-dropdown")(1,"button",31),t._UZ(2,"clr-icon",32),t.qZA(),t.TgZ(3,"vdr-dropdown-menu",33)(4,"button",34),t.NdJ("click",function(){t.CHM(n);const r=t.oxw().item,A=t.oxw();return t.KtG(A.cancelJob(r.id))}),t.ALo(5,"hasPermission"),t._UZ(6,"clr-icon",35),t._uU(7),t.ALo(8,"translate"),t.qZA()()()}2&e&&(t.xp6(4),t.Q6J("disabled",!t.lcZ(5,2,t.DdM(6,_t))),t.xp6(3),t.hij(" ",t.lcZ(8,4,"common.cancel")," "))}function ft(e,o){if(1&e&&(t.YNc(0,Zt,8,4,"vdr-dropdown",21),t.YNc(1,vt,8,4,"vdr-dropdown",21),t.YNc(2,bt,9,7,"vdr-dropdown",21)),2&e){const n=o.item,l=t.oxw();t.Q6J("ngIf",l.hasResult(n)),t.xp6(1),t.Q6J("ngIf",n.error),t.xp6(1),t.Q6J("ngIf",!n.isSettled&&"FAILED"!==n.state)}}class T extends s.t7C{constructor(o,n,l){super(n,l),this.dataService=o,this.liveUpdate=new m.NI(!0),this.queueFilter=new m.NI("all"),this.stateFilter=new m.NI(""),super.setQueryFn((...r)=>this.dataService.settings.getAllJobs(...r),r=>r.jobs,(r,A)=>{const Tt="all"===this.queueFilter.value?null:{queueName:{eq:this.queueFilter.value}},Q=this.stateFilter.value;return{options:{skip:r,take:A,filter:{...Tt,...Q?{state:{eq:Q}}:{}},sort:{createdAt:s.Asd.DESC}}}})}ngOnInit(){super.ngOnInit(),(0,w.H)(5e3,2e3).pipe((0,M.R)(this.destroy$),(0,H.h)(()=>!!this.liveUpdate.value)).subscribe(()=>{this.refresh()}),this.queues$=this.dataService.settings.getJobQueues().mapStream(o=>o.jobQueues).pipe((0,R.U)(o=>[{name:"all",running:!0},...o]))}hasResult(o){const n=o.result;return null!=n&&("object"!=typeof n||Object.keys(n).length>0)}cancelJob(o){this.dataService.settings.cancelJob(o).subscribe(()=>this.refresh())}}(h=T).\u0275fac=function(o){return new(o||h)(t.Y36(s.DoR),t.Y36(b.F0),t.Y36(b.gz))},h.\u0275cmp=t.Xpm({type:h,selectors:[["vdr-job-list"]],features:[t.qOj],decls:67,vars:80,consts:[[1,"mr-2"],["type","checkbox","clrCheckbox","","name","live-update",3,"formControl"],["locationId","job-list"],[1,"mr-2",3,"addTag","hideSelected","multiple","markFirst","clearable","searchable","formControl","change"],[3,"value"],["colorType","warning"],["colorType","success"],["colorType","error"],["bindValue","name",3,"addTag","items","hideSelected","multiple","markFirst","clearable","searchable","formControl","change"],["ng-label-tmp","","ng-option-tmp",""],["id","job-list",3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],["id","id",3,"heading"],["id","created-at",3,"heading"],["id","job-queue-name",3,"heading","optional"],["id","job-data",3,"heading","optional"],["id","job-state",3,"heading"],["id","job-duration",3,"heading"],["id","job-result",3,"heading"],[4,"ngIf","ngIfElse"],["others",""],[3,"colorFrom"],[4,"ngIf"],["vdrDropdownTrigger","",1,"button-small",3,"title"],["shape","details"],[1,"result-detail"],[3,"job"],["class","retry-info",4,"ngIf"],[1,"retry-info"],["vdrDropdownTrigger","",1,"button-small","mr-1"],["vdrDropdownTrigger","",1,"button-small"],["shape","exclamation-circle"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical","size","12"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","ban",1,"is-danger"]],template:function(o,n){1&o&&(t.TgZ(0,"vdr-page-header"),t._UZ(1,"vdr-page-title"),t.qZA(),t.TgZ(2,"vdr-page-body")(3,"vdr-page-block")(4,"vdr-action-bar")(5,"vdr-ab-left")(6,"clr-checkbox-wrapper",0),t._UZ(7,"input",1),t.TgZ(8,"label"),t._uU(9),t.ALo(10,"translate"),t.qZA()()(),t.TgZ(11,"vdr-ab-right"),t._UZ(12,"vdr-action-bar-items",2),t.TgZ(13,"ng-select",3),t.NdJ("change",function(){return n.refresh()}),t.TgZ(14,"ng-option",4)(15,"vdr-chip"),t._uU(16),t.ALo(17,"translate"),t.qZA()(),t.TgZ(18,"ng-option",4)(19,"vdr-chip"),t._uU(20),t.ALo(21,"translate"),t.qZA()(),t.TgZ(22,"ng-option",4)(23,"vdr-chip",5),t._uU(24),t.ALo(25,"translate"),t.qZA()(),t.TgZ(26,"ng-option",4)(27,"vdr-chip",6),t._uU(28),t.ALo(29,"translate"),t.qZA()(),t.TgZ(30,"ng-option",4)(31,"vdr-chip",7),t._uU(32),t.ALo(33,"translate"),t.qZA()(),t.TgZ(34,"ng-option",4)(35,"vdr-chip",7),t._uU(36),t.ALo(37,"translate"),t.qZA()()(),t.TgZ(38,"ng-select",8),t.NdJ("change",function(){return n.refresh()}),t.ALo(39,"async"),t.YNc(40,lt,3,2,"ng-template",9),t.qZA()()()(),t.TgZ(41,"vdr-data-table-2",10),t.NdJ("pageChange",function(r){return n.setPageNumber(r)})("itemsPerPageChange",function(r){return n.setItemsPerPage(r)}),t.ALo(42,"async"),t.ALo(43,"async"),t.ALo(44,"async"),t.ALo(45,"async"),t.TgZ(46,"vdr-dt2-column",11),t.ALo(47,"translate"),t.YNc(48,rt,1,1,"ng-template"),t.qZA(),t.TgZ(49,"vdr-dt2-column",12),t.ALo(50,"translate"),t.YNc(51,ct,2,3,"ng-template"),t.qZA(),t.TgZ(52,"vdr-dt2-column",13),t.ALo(53,"translate"),t.YNc(54,it,2,2,"ng-template"),t.qZA(),t.TgZ(55,"vdr-dt2-column",14),t.ALo(56,"translate"),t.YNc(57,mt,1,1,"ng-template"),t.qZA(),t.TgZ(58,"vdr-dt2-column",15),t.ALo(59,"translate"),t.YNc(60,ut,3,3,"ng-template"),t.qZA(),t.TgZ(61,"vdr-dt2-column",16),t.ALo(62,"translate"),t.YNc(63,ht,2,3,"ng-template"),t.qZA(),t.TgZ(64,"vdr-dt2-column",17),t.ALo(65,"translate"),t.YNc(66,ft,3,3,"ng-template"),t.qZA()()()),2&o&&(t.xp6(7),t.Q6J("formControl",n.liveUpdate),t.xp6(2),t.Oqu(t.lcZ(10,42,"common.live-update")),t.xp6(4),t.Q6J("addTag",!1)("hideSelected",!0)("multiple",!1)("markFirst",!1)("clearable",!1)("searchable",!1)("formControl",n.stateFilter),t.xp6(1),t.Q6J("value",""),t.xp6(2),t.Oqu(t.lcZ(17,44,"system.job-state-all")),t.xp6(2),t.Q6J("value","PENDING"),t.xp6(2),t.Oqu(t.lcZ(21,46,"system.job-state-pending")),t.xp6(2),t.Q6J("value","RUNNING"),t.xp6(2),t.Oqu(t.lcZ(25,48,"system.job-state-running")),t.xp6(2),t.Q6J("value","COMPLETED"),t.xp6(2),t.Oqu(t.lcZ(29,50,"system.job-state-completed")),t.xp6(2),t.Q6J("value","FAILED"),t.xp6(2),t.Oqu(t.lcZ(33,52,"system.job-state-failed")),t.xp6(2),t.Q6J("value","CANCELLED"),t.xp6(2),t.Oqu(t.lcZ(37,54,"system.job-state-cancelled")),t.xp6(2),t.Q6J("addTag",!1)("items",t.lcZ(39,56,n.queues$))("hideSelected",!0)("multiple",!1)("markFirst",!1)("clearable",!1)("searchable",!1)("formControl",n.queueFilter),t.xp6(3),t.Q6J("items",t.lcZ(42,58,n.items$))("itemsPerPage",t.lcZ(43,60,n.itemsPerPage$))("totalItems",t.lcZ(44,62,n.totalItems$))("currentPage",t.lcZ(45,64,n.currentPage$)),t.xp6(5),t.Q6J("heading",t.lcZ(47,66,"common.id")),t.xp6(3),t.Q6J("heading",t.lcZ(50,68,"common.created-at")),t.xp6(3),t.Q6J("heading",t.lcZ(53,70,"system.job-queue-name"))("optional",!1),t.xp6(3),t.Q6J("heading",t.lcZ(56,72,"system.job-data"))("optional",!1),t.xp6(3),t.Q6J("heading",t.lcZ(59,74,"system.job-state")),t.xp6(3),t.Q6J("heading",t.lcZ(62,76,"system.job-duration")),t.xp6(3),t.Q6J("heading",t.lcZ(65,78,"system.job-result")))},dependencies:[i.qvL,i.MgK,i.KKC,i.PEh,c.O5,m.Wl,m.JJ,m.oH,Z.w9,Z.jq,Z.ir,Z.mR,p.Kk,p.BN,p.mz,v.Y,G.y,$.J,z.N,B.U,W.H,K._,C.W,X.e,V.U,x.q,L.T,J.H,j.z,f,c.Ov,N.X$,et.j,nt.e,ot.u],styles:[".result-detail[_ngcontent-%COMP%]{margin:0 12px}.retry-info[_ngcontent-%COMP%]{margin-inline-start:6px;color:var(--color-grey-400)}"],changeDetection:0});var U=a(186);const I=[{path:"jobs",component:T,data:{breadcrumb:(0,U.J)("breadcrumb.job-queue")}},{path:"system-status",component:_,data:{breadcrumb:(0,U.J)("breadcrumb.system-status")}}];var d;class q{}(d=q).\u0275fac=function(o){return new(o||d)},d.\u0275mod=t.oAB({type:d}),d.\u0275inj=t.cJS({imports:[s.m81,b.Bz.forChild(I)]})}}]);
//# sourceMappingURL=956.6ea72306ebe32109.js.map