import { Injectable } from '@angular/core';
import { map } from 'rxjs/operators';
import { CanDeactivateDetailGuard } from '../../shared/providers/routing/can-deactivate-detail-guard';
import * as i0 from "@angular/core";
export class PageService {
    constructor() {
        this.registry = new Map();
    }
    registerPageTab(config) {
        if (!this.registry.has(config.location)) {
            this.registry.set(config.location, []);
        }
        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
        const pages = this.registry.get(config.location);
        if (pages.find(p => p.tab === config.tab)) {
            throw new Error(`A page with the tab "${config.tab}" has already been registered`);
        }
        pages.push(config);
    }
    getPageTabRoutes(location) {
        const configs = this.registry.get(location) || [];
        return configs.map(config => {
            const route = {
                path: config.route || '',
                pathMatch: config.route ? 'prefix' : 'full',
            };
            let component;
            if (isComponentWithResolver(config.component)) {
                const { component: cmp, breadcrumbFn, resolveFn } = config.component;
                component = cmp;
                route.resolve = { detail: resolveFn };
                route.data = {
                    breadcrumb: data => data.detail.entity.pipe(map(entity => breadcrumbFn(entity))),
                };
            }
            else {
                component = config.component;
            }
            const guards = typeof component.prototype.canDeactivate === 'function' ? [CanDeactivateDetailGuard] : [];
            route.component = component;
            route.canDeactivate = guards;
            if (config.routeConfig) {
                Object.assign(route, config.routeConfig);
            }
            return route;
        });
    }
    getPageTabs(location) {
        return this.registry.get(location)?.sort((a, b) => (a.priority ?? 0) - (b.priority ?? 0)) || [];
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.2", ngImport: i0, type: PageService, deps: [], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "16.2.2", ngImport: i0, type: PageService, providedIn: 'root' }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.2", ngImport: i0, type: PageService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root',
                }]
        }] });
function isComponentWithResolver(input) {
    return input && input.hasOwnProperty('resolveFn');
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2xpYi9jb3JlL3NyYy9wcm92aWRlcnMvcGFnZS9wYWdlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBUSxNQUFNLGVBQWUsQ0FBQztBQUVqRCxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFHckMsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sNERBQTRELENBQUM7O0FBc0R0RyxNQUFNLE9BQU8sV0FBVztJQUh4QjtRQUlZLGFBQVEsR0FBRyxJQUFJLEdBQUcsRUFBbUMsQ0FBQztLQWdEakU7SUE5Q0csZUFBZSxDQUFDLE1BQXFCO1FBQ2pDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEVBQUU7WUFDckMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQztTQUMxQztRQUNELG9FQUFvRTtRQUNwRSxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFFLENBQUM7UUFDbEQsSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDdkMsTUFBTSxJQUFJLEtBQUssQ0FBQyx3QkFBd0IsTUFBTSxDQUFDLEdBQUcsK0JBQStCLENBQUMsQ0FBQztTQUN0RjtRQUNELEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDdkIsQ0FBQztJQUVELGdCQUFnQixDQUFDLFFBQXdCO1FBQ3JDLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNsRCxPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUU7WUFDeEIsTUFBTSxLQUFLLEdBQVU7Z0JBQ2pCLElBQUksRUFBRSxNQUFNLENBQUMsS0FBSyxJQUFJLEVBQUU7Z0JBQ3hCLFNBQVMsRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLE1BQU07YUFDOUMsQ0FBQztZQUVGLElBQUksU0FBb0IsQ0FBQztZQUN6QixJQUFJLHVCQUF1QixDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsRUFBRTtnQkFDM0MsTUFBTSxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUM7Z0JBQ3JFLFNBQVMsR0FBRyxHQUFHLENBQUM7Z0JBQ2hCLEtBQUssQ0FBQyxPQUFPLEdBQUcsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLENBQUM7Z0JBQ3RDLEtBQUssQ0FBQyxJQUFJLEdBQUc7b0JBQ1QsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO2lCQUNuRixDQUFDO2FBQ0w7aUJBQU07Z0JBQ0gsU0FBUyxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUM7YUFDaEM7WUFDRCxNQUFNLE1BQU0sR0FDUixPQUFPLFNBQVMsQ0FBQyxTQUFTLENBQUMsYUFBYSxLQUFLLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDOUYsS0FBSyxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7WUFDNUIsS0FBSyxDQUFDLGFBQWEsR0FBRyxNQUFNLENBQUM7WUFDN0IsSUFBSSxNQUFNLENBQUMsV0FBVyxFQUFFO2dCQUNwQixNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUM7YUFDNUM7WUFFRCxPQUFPLEtBQUssQ0FBQztRQUNqQixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCxXQUFXLENBQUMsUUFBd0I7UUFDaEMsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsUUFBUSxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3BHLENBQUM7OEdBaERRLFdBQVc7a0hBQVgsV0FBVyxjQUZSLE1BQU07OzJGQUVULFdBQVc7a0JBSHZCLFVBQVU7bUJBQUM7b0JBQ1IsVUFBVSxFQUFFLE1BQU07aUJBQ3JCOztBQW9ERCxTQUFTLHVCQUF1QixDQUFDLEtBQVU7SUFDdkMsT0FBTyxLQUFLLElBQUksS0FBSyxDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUN0RCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgVHlwZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBSb3V0ZSB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XHJcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgZGV0YWlsQ29tcG9uZW50V2l0aFJlc29sdmVyIH0gZnJvbSAnLi4vLi4vY29tbW9uL2Jhc2UtZGV0YWlsLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IFBhZ2VMb2NhdGlvbklkIH0gZnJvbSAnLi4vLi4vY29tbW9uL2NvbXBvbmVudC1yZWdpc3RyeS10eXBlcyc7XHJcbmltcG9ydCB7IENhbkRlYWN0aXZhdGVEZXRhaWxHdWFyZCB9IGZyb20gJy4uLy4uL3NoYXJlZC9wcm92aWRlcnMvcm91dGluZy9jYW4tZGVhY3RpdmF0ZS1kZXRhaWwtZ3VhcmQnO1xyXG5cclxuLyoqXHJcbiAqIEBkZXNjcmlwdGlvblxyXG4gKiBUaGUgb2JqZWN0IHVzZWQgdG8gY29uZmlndXJlIGEgbmV3IHBhZ2UgdGFiLlxyXG4gKlxyXG4gKiBAZG9jc0NhdGVnb3J5IHRhYnNcclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgUGFnZVRhYkNvbmZpZyB7XHJcbiAgICAvKipcclxuICAgICAqIEBkZXNjcmlwdGlvblxyXG4gICAgICogQSB2YWxpZCBsb2NhdGlvbiByZXByZXNlbnRpbmcgYSBsaXN0IG9yIGRldGFpbCBwYWdlLlxyXG4gICAgICovXHJcbiAgICBsb2NhdGlvbjogUGFnZUxvY2F0aW9uSWQ7XHJcbiAgICAvKipcclxuICAgICAqIEBkZXNjcmlwdGlvblxyXG4gICAgICogQW4gb3B0aW9uYWwgaWNvbiB0byBkaXNwbGF5IGluIHRoZSB0YWIuIFRoZSBpY29uXHJcbiAgICAgKiBzaG91bGQgYmUgYSB2YWxpZCBzaGFwZSBuYW1lIGZyb20gdGhlIFtDbGFyaXR5IEljb25zXShodHRwczovL2NvcmUuY2xhcml0eS5kZXNpZ24vZm91bmRhdGlvbi9pY29ucy9zaGFwZXMvKVxyXG4gICAgICogc2V0LlxyXG4gICAgICovXHJcbiAgICB0YWJJY29uPzogc3RyaW5nO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAZGVzY3JpcHRpb25cclxuICAgICAqIFRoZSByb3V0ZSBwYXRoIHRvIHRoZSB0YWIuIFRoaXMgd2lsbCBiZSBhcHBlbmRlZCB0byB0aGVcclxuICAgICAqIHJvdXRlIG9mIHRoZSBwYXJlbnQgcGFnZS5cclxuICAgICAqL1xyXG4gICAgcm91dGU6IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICogQGRlc2NyaXB0aW9uXHJcbiAgICAgKiBUaGUgbmFtZSBvZiB0aGUgdGFiIHRvIGRpc3BsYXkgaW4gdGhlIFVJLlxyXG4gICAgICovXHJcbiAgICB0YWI6IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICogQGRlc2NyaXB0aW9uXHJcbiAgICAgKiBUaGUgcHJpb3JpdHkgb2YgdGhlIHRhYi4gVGFicyB3aXRoIGEgbG93ZXIgcHJpb3JpdHkgd2lsbCBiZSBkaXNwbGF5ZWQgZmlyc3QuXHJcbiAgICAgKi9cclxuICAgIHByaW9yaXR5PzogbnVtYmVyO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAZGVzY3JpcHRpb25cclxuICAgICAqIFRoZSBjb21wb25lbnQgdG8gcmVuZGVyIGF0IHRoZSByb3V0ZSBvZiB0aGUgdGFiLlxyXG4gICAgICovXHJcbiAgICBjb21wb25lbnQ6IFR5cGU8YW55PiB8IFJldHVyblR5cGU8dHlwZW9mIGRldGFpbENvbXBvbmVudFdpdGhSZXNvbHZlcj47XHJcbiAgICAvKipcclxuICAgICAqIEBkZXNjcmlwdGlvblxyXG4gICAgICogWW91IGNhbiBvcHRpb25hbGx5IHByb3ZpZGUgYW55IG5hdGl2ZSBBbmd1bGFyIHJvdXRlIGNvbmZpZ3VyYXRpb24gb3B0aW9ucyBoZXJlLlxyXG4gICAgICogQW55IHZhbHVlcyBwcm92aWRlZCBoZXJlIHdpbGwgdGFrZSBwcmVjZWRlbmNlIG92ZXIgdGhlIHZhbHVlcyBnZW5lcmF0ZWRcclxuICAgICAqIGJ5IHRoZSBgcm91dGVgIGFuZCBgY29tcG9uZW50YCBwcm9wZXJ0aWVzLlxyXG4gICAgICovXHJcbiAgICByb3V0ZUNvbmZpZz86IFJvdXRlO1xyXG59XHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgICBwcm92aWRlZEluOiAncm9vdCcsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBQYWdlU2VydmljZSB7XHJcbiAgICBwcml2YXRlIHJlZ2lzdHJ5ID0gbmV3IE1hcDxQYWdlTG9jYXRpb25JZCwgUGFnZVRhYkNvbmZpZ1tdPigpO1xyXG5cclxuICAgIHJlZ2lzdGVyUGFnZVRhYihjb25maWc6IFBhZ2VUYWJDb25maWcpIHtcclxuICAgICAgICBpZiAoIXRoaXMucmVnaXN0cnkuaGFzKGNvbmZpZy5sb2NhdGlvbikpIHtcclxuICAgICAgICAgICAgdGhpcy5yZWdpc3RyeS5zZXQoY29uZmlnLmxvY2F0aW9uLCBbXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbm9uLW51bGwtYXNzZXJ0aW9uXHJcbiAgICAgICAgY29uc3QgcGFnZXMgPSB0aGlzLnJlZ2lzdHJ5LmdldChjb25maWcubG9jYXRpb24pITtcclxuICAgICAgICBpZiAocGFnZXMuZmluZChwID0+IHAudGFiID09PSBjb25maWcudGFiKSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEEgcGFnZSB3aXRoIHRoZSB0YWIgXCIke2NvbmZpZy50YWJ9XCIgaGFzIGFscmVhZHkgYmVlbiByZWdpc3RlcmVkYCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHBhZ2VzLnB1c2goY29uZmlnKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRQYWdlVGFiUm91dGVzKGxvY2F0aW9uOiBQYWdlTG9jYXRpb25JZCk6IFJvdXRlW10ge1xyXG4gICAgICAgIGNvbnN0IGNvbmZpZ3MgPSB0aGlzLnJlZ2lzdHJ5LmdldChsb2NhdGlvbikgfHwgW107XHJcbiAgICAgICAgcmV0dXJuIGNvbmZpZ3MubWFwKGNvbmZpZyA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJvdXRlOiBSb3V0ZSA9IHtcclxuICAgICAgICAgICAgICAgIHBhdGg6IGNvbmZpZy5yb3V0ZSB8fCAnJyxcclxuICAgICAgICAgICAgICAgIHBhdGhNYXRjaDogY29uZmlnLnJvdXRlID8gJ3ByZWZpeCcgOiAnZnVsbCcsXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBsZXQgY29tcG9uZW50OiBUeXBlPGFueT47XHJcbiAgICAgICAgICAgIGlmIChpc0NvbXBvbmVudFdpdGhSZXNvbHZlcihjb25maWcuY29tcG9uZW50KSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgeyBjb21wb25lbnQ6IGNtcCwgYnJlYWRjcnVtYkZuLCByZXNvbHZlRm4gfSA9IGNvbmZpZy5jb21wb25lbnQ7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQgPSBjbXA7XHJcbiAgICAgICAgICAgICAgICByb3V0ZS5yZXNvbHZlID0geyBkZXRhaWw6IHJlc29sdmVGbiB9O1xyXG4gICAgICAgICAgICAgICAgcm91dGUuZGF0YSA9IHtcclxuICAgICAgICAgICAgICAgICAgICBicmVhZGNydW1iOiBkYXRhID0+IGRhdGEuZGV0YWlsLmVudGl0eS5waXBlKG1hcChlbnRpdHkgPT4gYnJlYWRjcnVtYkZuKGVudGl0eSkpKSxcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQgPSBjb25maWcuY29tcG9uZW50O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IGd1YXJkcyA9XHJcbiAgICAgICAgICAgICAgICB0eXBlb2YgY29tcG9uZW50LnByb3RvdHlwZS5jYW5EZWFjdGl2YXRlID09PSAnZnVuY3Rpb24nID8gW0NhbkRlYWN0aXZhdGVEZXRhaWxHdWFyZF0gOiBbXTtcclxuICAgICAgICAgICAgcm91dGUuY29tcG9uZW50ID0gY29tcG9uZW50O1xyXG4gICAgICAgICAgICByb3V0ZS5jYW5EZWFjdGl2YXRlID0gZ3VhcmRzO1xyXG4gICAgICAgICAgICBpZiAoY29uZmlnLnJvdXRlQ29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHJvdXRlLCBjb25maWcucm91dGVDb25maWcpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcm91dGU7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0UGFnZVRhYnMobG9jYXRpb246IFBhZ2VMb2NhdGlvbklkKTogUGFnZVRhYkNvbmZpZ1tdIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yZWdpc3RyeS5nZXQobG9jYXRpb24pPy5zb3J0KChhLCBiKSA9PiAoYS5wcmlvcml0eSA/PyAwKSAtIChiLnByaW9yaXR5ID8/IDApKSB8fCBbXTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gaXNDb21wb25lbnRXaXRoUmVzb2x2ZXIoaW5wdXQ6IGFueSk6IGlucHV0IGlzIFJldHVyblR5cGU8dHlwZW9mIGRldGFpbENvbXBvbmVudFdpdGhSZXNvbHZlcj4ge1xyXG4gICAgcmV0dXJuIGlucHV0ICYmIGlucHV0Lmhhc093blByb3BlcnR5KCdyZXNvbHZlRm4nKTtcclxufVxyXG4iXX0=