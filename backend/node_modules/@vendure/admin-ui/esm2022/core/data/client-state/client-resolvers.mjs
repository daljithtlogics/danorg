import { GET_NEWTORK_STATUS, GET_UI_STATE, GET_USER_STATUS } from '../definitions/client-definitions';
export const clientResolvers = {
    Mutation: {
        requestStarted: (_, args, { cache }) => updateRequestsInFlight(cache, 1),
        requestCompleted: (_, args, { cache }) => updateRequestsInFlight(cache, -1),
        setAsLoggedIn: (_, args, { cache }) => {
            const { input: { username, loginTime, channels, activeChannelId, administratorId }, } = args;
            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
            const permissions = channels.find(c => c.id === activeChannelId).permissions;
            const data = {
                userStatus: {
                    __typename: 'UserStatus',
                    administratorId,
                    username,
                    loginTime,
                    isLoggedIn: true,
                    permissions,
                    channels,
                    activeChannelId,
                },
            };
            cache.writeQuery({ query: GET_USER_STATUS, data });
            return data.userStatus;
        },
        setAsLoggedOut: (_, args, { cache }) => {
            const data = {
                userStatus: {
                    __typename: 'UserStatus',
                    administratorId: null,
                    username: '',
                    loginTime: '',
                    isLoggedIn: false,
                    permissions: [],
                    channels: [],
                    activeChannelId: null,
                },
            };
            cache.writeQuery({ query: GET_USER_STATUS, data });
            return data.userStatus;
        },
        setUiLanguage: (_, args, { cache }) => {
            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
            const previous = cache.readQuery({ query: GET_UI_STATE });
            const data = updateUiState(previous, 'language', args.languageCode);
            cache.writeQuery({ query: GET_UI_STATE, data });
            return args.languageCode;
        },
        setUiLocale: (_, args, { cache }) => {
            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
            const previous = cache.readQuery({ query: GET_UI_STATE });
            const data = updateUiState(previous, 'locale', args.locale);
            cache.writeQuery({ query: GET_UI_STATE, data });
            return args.locale ?? undefined;
        },
        setContentLanguage: (_, args, { cache }) => {
            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
            const previous = cache.readQuery({ query: GET_UI_STATE });
            const data = updateUiState(previous, 'contentLanguage', args.languageCode);
            cache.writeQuery({ query: GET_UI_STATE, data });
            return args.languageCode;
        },
        setUiTheme: (_, args, { cache }) => {
            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
            const previous = cache.readQuery({ query: GET_UI_STATE });
            const data = updateUiState(previous, 'theme', args.theme);
            cache.writeQuery({ query: GET_UI_STATE, data });
            return args.theme;
        },
        setDisplayUiExtensionPoints: (_, args, { cache }) => {
            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
            const previous = cache.readQuery({ query: GET_UI_STATE });
            const data = updateUiState(previous, 'displayUiExtensionPoints', args.display);
            cache.writeQuery({ query: GET_UI_STATE, data });
            return args.display;
        },
        setMainNavExpanded: (_, args, { cache }) => {
            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
            const previous = cache.readQuery({ query: GET_UI_STATE });
            const data = updateUiState(previous, 'mainNavExpanded', args.expanded);
            cache.writeQuery({ query: GET_UI_STATE, data });
            return args.expanded;
        },
        setActiveChannel: (_, args, { cache }) => {
            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
            const previous = cache.readQuery({ query: GET_USER_STATUS });
            const activeChannel = previous.userStatus.channels.find(c => c.id === args.channelId);
            if (!activeChannel) {
                throw new Error('setActiveChannel: Could not find Channel with ID ' + args.channelId);
            }
            const permissions = activeChannel.permissions;
            const data = {
                userStatus: {
                    ...previous.userStatus,
                    permissions,
                    activeChannelId: activeChannel.id,
                },
            };
            cache.writeQuery({ query: GET_USER_STATUS, data });
            return data.userStatus;
        },
        updateUserChannels: (_, args, { cache }) => {
            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
            const previous = cache.readQuery({ query: GET_USER_STATUS });
            const data = {
                userStatus: {
                    ...previous.userStatus,
                    channels: Array.isArray(args.channels) ? args.channels : [args.channels],
                },
            };
            cache.writeQuery({ query: GET_USER_STATUS, data });
            return data.userStatus;
        },
    },
};
function updateUiState(previous, key, value) {
    return {
        uiState: {
            ...previous.uiState,
            [key]: value,
            __typename: 'UiState',
        },
    };
}
function updateRequestsInFlight(cache, increment) {
    const previous = cache.readQuery({ query: GET_NEWTORK_STATUS });
    const inFlightRequests = previous ? previous.networkStatus.inFlightRequests + increment : increment;
    const data = {
        networkStatus: {
            __typename: 'NetworkStatus',
            inFlightRequests,
        },
    };
    cache.writeQuery({ query: GET_NEWTORK_STATUS, data });
    return inFlightRequests;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpZW50LXJlc29sdmVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9saWIvY29yZS9zcmMvZGF0YS9jbGllbnQtc3RhdGUvY2xpZW50LXJlc29sdmVycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFJQSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsWUFBWSxFQUFFLGVBQWUsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBY3RHLE1BQU0sQ0FBQyxNQUFNLGVBQWUsR0FBdUI7SUFDL0MsUUFBUSxFQUFFO1FBQ04sY0FBYyxFQUFFLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFVLEVBQUUsQ0FBQyxzQkFBc0IsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBQ2hGLGdCQUFnQixFQUFFLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFVLEVBQUUsQ0FBQyxzQkFBc0IsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDbkYsYUFBYSxFQUFFLENBQUMsQ0FBQyxFQUFFLElBQTRDLEVBQUUsRUFBRSxLQUFLLEVBQUUsRUFBYyxFQUFFO1lBQ3RGLE1BQU0sRUFDRixLQUFLLEVBQUUsRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxlQUFlLEVBQUUsZUFBZSxFQUFFLEdBQzdFLEdBQUcsSUFBSSxDQUFDO1lBQ1Qsb0VBQW9FO1lBQ3BFLE1BQU0sV0FBVyxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLGVBQWUsQ0FBRSxDQUFDLFdBQVcsQ0FBQztZQUM5RSxNQUFNLElBQUksR0FBK0I7Z0JBQ3JDLFVBQVUsRUFBRTtvQkFDUixVQUFVLEVBQUUsWUFBWTtvQkFDeEIsZUFBZTtvQkFDZixRQUFRO29CQUNSLFNBQVM7b0JBQ1QsVUFBVSxFQUFFLElBQUk7b0JBQ2hCLFdB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QUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQztpQkFDM0U7YUFDSixDQUFDO1lBQ0YsS0FBSyxDQUFDLFVBQVUsQ0FBQyxFQUFFLEtBQUssRUFBRSxlQUFlLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUNuRCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUM7UUFDM0IsQ0FBQztLQUNKO0NBQ0osQ0FBQztBQUVGLFNBQVMsYUFBYSxDQUNsQixRQUFpQyxFQUNqQyxHQUFNLEVBQ04sS0FBNEM7SUFFNUMsT0FBTztRQUNILE9BQU8sRUFBRTtZQUNMLEdBQUcsUUFBUSxDQUFDLE9BQU87WUFDbkIsQ0FBQyxHQUFHLENBQUMsRUFBRSxLQUFLO1lBQ1osVUFBVSxFQUFFLFNBQVM7U0FDeEI7S0FDSixDQUFDO0FBQ04sQ0FBQztBQUVELFNBQVMsc0JBQXNCLENBQUMsS0FBb0IsRUFBRSxTQUFpQjtJQUNuRSxNQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsU0FBUyxDQUFnQyxFQUFFLEtBQUssRUFBRSxrQkFBa0IsRUFBRSxDQUFDLENBQUM7SUFDL0YsTUFBTSxnQkFBZ0IsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7SUFDcEcsTUFBTSxJQUFJLEdBQWtDO1FBQ3hDLGFBQWEsRUFBRTtZQUNYLFVBQVUsRUFBRSxlQUFlO1lBQzNCLGdCQUFnQjtTQUNuQjtLQUNKLENBQUM7SUFDRixLQUFLLENBQUMsVUFBVSxDQUFDLEVBQUUsS0FBSyxFQUFFLGtCQUFrQixFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7SUFDdEQsT0FBTyxnQkFBZ0IsQ0FBQztBQUM1QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5NZW1vcnlDYWNoZSB9IGZyb20gJ0BhcG9sbG8vY2xpZW50L2NvcmUnO1xyXG5cclxuaW1wb3J0ICogYXMgQ29kZWdlbiBmcm9tICcuLi8uLi9jb21tb24vZ2VuZXJhdGVkLXR5cGVzJztcclxuaW1wb3J0IHsgR2V0VXNlclN0YXR1c1F1ZXJ5LCBMYW5ndWFnZUNvZGUsIFVzZXJTdGF0dXMgfSBmcm9tICcuLi8uLi9jb21tb24vZ2VuZXJhdGVkLXR5cGVzJztcclxuaW1wb3J0IHsgR0VUX05FV1RPUktfU1RBVFVTLCBHRVRfVUlfU1RBVEUsIEdFVF9VU0VSX1NUQVRVUyB9IGZyb20gJy4uL2RlZmluaXRpb25zL2NsaWVudC1kZWZpbml0aW9ucyc7XHJcblxyXG5leHBvcnQgdHlwZSBSZXNvbHZlckNvbnRleHQgPSB7XHJcbiAgICBjYWNoZTogSW5NZW1vcnlDYWNoZTtcclxuICAgIG9wdGltaXN0aWNSZXNwb25zZTogYW55O1xyXG4gICAgZ2V0Q2FjaGVLZXk6IChzdG9yZU9iajogYW55KSA9PiBzdHJpbmc7XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBSZXNvbHZlckRlZmluaXRpb24gPSB7XHJcbiAgICBNdXRhdGlvbjoge1xyXG4gICAgICAgIFtuYW1lOiBzdHJpbmddOiAocm9vdFZhbHVlOiBhbnksIGFyZ3M6IGFueSwgY29udGV4dDogUmVzb2x2ZXJDb250ZXh0LCBpbmZvPzogYW55KSA9PiBhbnk7XHJcbiAgICB9O1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGNsaWVudFJlc29sdmVyczogUmVzb2x2ZXJEZWZpbml0aW9uID0ge1xyXG4gICAgTXV0YXRpb246IHtcclxuICAgICAgICByZXF1ZXN0U3RhcnRlZDogKF8sIGFyZ3MsIHsgY2FjaGUgfSk6IG51bWJlciA9PiB1cGRhdGVSZXF1ZXN0c0luRmxpZ2h0KGNhY2hlLCAxKSxcclxuICAgICAgICByZXF1ZXN0Q29tcGxldGVkOiAoXywgYXJncywgeyBjYWNoZSB9KTogbnVtYmVyID0+IHVwZGF0ZVJlcXVlc3RzSW5GbGlnaHQoY2FjaGUsIC0xKSxcclxuICAgICAgICBzZXRBc0xvZ2dlZEluOiAoXywgYXJnczogQ29kZWdlbi5TZXRBc0xvZ2dlZEluTXV0YXRpb25WYXJpYWJsZXMsIHsgY2FjaGUgfSk6IFVzZXJTdGF0dXMgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB7XHJcbiAgICAgICAgICAgICAgICBpbnB1dDogeyB1c2VybmFtZSwgbG9naW5UaW1lLCBjaGFubmVscywgYWN0aXZlQ2hhbm5lbElkLCBhZG1pbmlzdHJhdG9ySWQgfSxcclxuICAgICAgICAgICAgfSA9IGFyZ3M7XHJcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbm9uLW51bGwtYXNzZXJ0aW9uXHJcbiAgICAgICAgICAgIGNvbnN0IHBlcm1pc3Npb25zID0gY2hhbm5lbHMuZmluZChjID0+IGMuaWQgPT09IGFjdGl2ZUNoYW5uZWxJZCkhLnBlcm1pc3Npb25zO1xyXG4gICAgICAgICAgICBjb25zdCBkYXRhOiB7IHVzZXJTdGF0dXM6IFVzZXJTdGF0dXMgfSA9IHtcclxuICAgICAgICAgICAgICAgIHVzZXJTdGF0dXM6IHtcclxuICAgICAgICAgICAgICAgICAgICBfX3R5cGVuYW1lOiAnVXNlclN0YXR1cycsXHJcbiAgICAgICAgICAgICAgICAgICAgYWRtaW5pc3RyYXRvcklkLFxyXG4gICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2luVGltZSxcclxuICAgICAgICAgICAgICAgICAgICBpc0xvZ2dlZEluOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb25zLFxyXG4gICAgICAgICAgICAgICAgICAgIGNoYW5uZWxzLFxyXG4gICAgICAgICAgICAgICAgICAgIGFjdGl2ZUNoYW5uZWxJZCxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGNhY2hlLndyaXRlUXVlcnkoeyBxdWVyeTogR0VUX1VTRVJfU1RBVFVTLCBkYXRhIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0YS51c2VyU3RhdHVzO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2V0QXNMb2dnZWRPdXQ6IChfLCBhcmdzLCB7IGNhY2hlIH0pOiBVc2VyU3RhdHVzID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZGF0YTogR2V0VXNlclN0YXR1c1F1ZXJ5ID0ge1xyXG4gICAgICAgICAgICAgICAgdXNlclN0YXR1czoge1xyXG4gICAgICAgICAgICAgICAgICAgIF9fdHlwZW5hbWU6ICdVc2VyU3RhdHVzJyxcclxuICAgICAgICAgICAgICAgICAgICBhZG1pbmlzdHJhdG9ySWQ6IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2luVGltZTogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgaXNMb2dnZWRJbjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnM6IFtdLFxyXG4gICAgICAgICAgICAgICAgICAgIGNoYW5uZWxzOiBbXSxcclxuICAgICAgICAgICAgICAgICAgICBhY3RpdmVDaGFubmVsSWQ6IG51bGwsXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBjYWNoZS53cml0ZVF1ZXJ5KHsgcXVlcnk6IEdFVF9VU0VSX1NUQVRVUywgZGF0YSB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGEudXNlclN0YXR1cztcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldFVpTGFuZ3VhZ2U6IChfLCBhcmdzOiBDb2RlZ2VuLlNldFVpTGFuZ3VhZ2VNdXRhdGlvblZhcmlhYmxlcywgeyBjYWNoZSB9KTogTGFuZ3VhZ2VDb2RlID0+IHtcclxuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb25cclxuICAgICAgICAgICAgY29uc3QgcHJldmlvdXMgPSBjYWNoZS5yZWFkUXVlcnk8Q29kZWdlbi5HZXRVaVN0YXRlUXVlcnk+KHsgcXVlcnk6IEdFVF9VSV9TVEFURSB9KSE7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB1cGRhdGVVaVN0YXRlKHByZXZpb3VzLCAnbGFuZ3VhZ2UnLCBhcmdzLmxhbmd1YWdlQ29kZSk7XHJcbiAgICAgICAgICAgIGNhY2hlLndyaXRlUXVlcnkoeyBxdWVyeTogR0VUX1VJX1NUQVRFLCBkYXRhIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gYXJncy5sYW5ndWFnZUNvZGU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXRVaUxvY2FsZTogKF8sIGFyZ3M6IENvZGVnZW4uU2V0VWlMb2NhbGVNdXRhdGlvblZhcmlhYmxlcywgeyBjYWNoZSB9KTogc3RyaW5nIHwgdW5kZWZpbmVkID0+IHtcclxuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb25cclxuICAgICAgICAgICAgY29uc3QgcHJldmlvdXMgPSBjYWNoZS5yZWFkUXVlcnk8Q29kZWdlbi5HZXRVaVN0YXRlUXVlcnk+KHsgcXVlcnk6IEdFVF9VSV9TVEFURSB9KSE7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB1cGRhdGVVaVN0YXRlKHByZXZpb3VzLCAnbG9jYWxlJywgYXJncy5sb2NhbGUpO1xyXG4gICAgICAgICAgICBjYWNoZS53cml0ZVF1ZXJ5KHsgcXVlcnk6IEdFVF9VSV9TVEFURSwgZGF0YSB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGFyZ3MubG9jYWxlID8/IHVuZGVmaW5lZDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldENvbnRlbnRMYW5ndWFnZTogKFxyXG4gICAgICAgICAgICBfLFxyXG4gICAgICAgICAgICBhcmdzOiBDb2RlZ2VuLlNldENvbnRlbnRMYW5ndWFnZU11dGF0aW9uVmFyaWFibGVzLFxyXG4gICAgICAgICAgICB7IGNhY2hlIH0sXHJcbiAgICAgICAgKTogTGFuZ3VhZ2VDb2RlID0+IHtcclxuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb25cclxuICAgICAgICAgICAgY29uc3QgcHJldmlvdXMgPSBjYWNoZS5yZWFkUXVlcnk8Q29kZWdlbi5HZXRVaVN0YXRlUXVlcnk+KHsgcXVlcnk6IEdFVF9VSV9TVEFURSB9KSE7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB1cGRhdGVVaVN0YXRlKHByZXZpb3VzLCAnY29udGVudExhbmd1YWdlJywgYXJncy5sYW5ndWFnZUNvZGUpO1xyXG4gICAgICAgICAgICBjYWNoZS53cml0ZVF1ZXJ5KHsgcXVlcnk6IEdFVF9VSV9TVEFURSwgZGF0YSB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGFyZ3MubGFuZ3VhZ2VDb2RlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2V0VWlUaGVtZTogKF8sIGFyZ3M6IENvZGVnZW4uU2V0VWlUaGVtZU11dGF0aW9uVmFyaWFibGVzLCB7IGNhY2hlIH0pOiBzdHJpbmcgPT4ge1xyXG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLW5vbi1udWxsLWFzc2VydGlvblxyXG4gICAgICAgICAgICBjb25zdCBwcmV2aW91cyA9IGNhY2hlLnJlYWRRdWVyeTxDb2RlZ2VuLkdldFVpU3RhdGVRdWVyeT4oeyBxdWVyeTogR0VUX1VJX1NUQVRFIH0pITtcclxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IHVwZGF0ZVVpU3RhdGUocHJldmlvdXMsICd0aGVtZScsIGFyZ3MudGhlbWUpO1xyXG4gICAgICAgICAgICBjYWNoZS53cml0ZVF1ZXJ5KHsgcXVlcnk6IEdFVF9VSV9TVEFURSwgZGF0YSB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGFyZ3MudGhlbWU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXREaXNwbGF5VWlFeHRlbnNpb25Qb2ludHM6IChcclxuICAgICAgICAgICAgXyxcclxuICAgICAgICAgICAgYXJnczogQ29kZWdlbi5TZXREaXNwbGF5VWlFeHRlbnNpb25Qb2ludHNNdXRhdGlvblZhcmlhYmxlcyxcclxuICAgICAgICAgICAgeyBjYWNoZSB9LFxyXG4gICAgICAgICk6IGJvb2xlYW4gPT4ge1xyXG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLW5vbi1udWxsLWFzc2VydGlvblxyXG4gICAgICAgICAgICBjb25zdCBwcmV2aW91cyA9IGNhY2hlLnJlYWRRdWVyeTxDb2RlZ2VuLkdldFVpU3RhdGVRdWVyeT4oeyBxdWVyeTogR0VUX1VJX1NUQVRFIH0pITtcclxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IHVwZGF0ZVVpU3RhdGUocHJldmlvdXMsICdkaXNwbGF5VWlFeHRlbnNpb25Qb2ludHMnLCBhcmdzLmRpc3BsYXkpO1xyXG4gICAgICAgICAgICBjYWNoZS53cml0ZVF1ZXJ5KHsgcXVlcnk6IEdFVF9VSV9TVEFURSwgZGF0YSB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGFyZ3MuZGlzcGxheTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldE1haW5OYXZFeHBhbmRlZDogKF8sIGFyZ3M6IENvZGVnZW4uU2V0TWFpbk5hdkV4cGFuZGVkTXV0YXRpb25WYXJpYWJsZXMsIHsgY2FjaGUgfSk6IGJvb2xlYW4gPT4ge1xyXG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLW5vbi1udWxsLWFzc2VydGlvblxyXG4gICAgICAgICAgICBjb25zdCBwcmV2aW91cyA9IGNhY2hlLnJlYWRRdWVyeTxDb2RlZ2VuLkdldFVpU3RhdGVRdWVyeT4oeyBxdWVyeTogR0VUX1VJX1NUQVRFIH0pITtcclxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IHVwZGF0ZVVpU3RhdGUocHJldmlvdXMsICdtYWluTmF2RXhwYW5kZWQnLCBhcmdzLmV4cGFuZGVkKTtcclxuICAgICAgICAgICAgY2FjaGUud3JpdGVRdWVyeSh7IHF1ZXJ5OiBHRVRfVUlfU1RBVEUsIGRhdGEgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBhcmdzLmV4cGFuZGVkO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2V0QWN0aXZlQ2hhbm5lbDogKF8sIGFyZ3M6IENvZGVnZW4uU2V0QWN0aXZlQ2hhbm5lbE11dGF0aW9uVmFyaWFibGVzLCB7IGNhY2hlIH0pOiBVc2VyU3RhdHVzID0+IHtcclxuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb25cclxuICAgICAgICAgICAgY29uc3QgcHJldmlvdXMgPSBjYWNoZS5yZWFkUXVlcnk8R2V0VXNlclN0YXR1c1F1ZXJ5Pih7IHF1ZXJ5OiBHRVRfVVNFUl9TVEFUVVMgfSkhO1xyXG4gICAgICAgICAgICBjb25zdCBhY3RpdmVDaGFubmVsID0gcHJldmlvdXMudXNlclN0YXR1cy5jaGFubmVscy5maW5kKGMgPT4gYy5pZCA9PT0gYXJncy5jaGFubmVsSWQpO1xyXG4gICAgICAgICAgICBpZiAoIWFjdGl2ZUNoYW5uZWwpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignc2V0QWN0aXZlQ2hhbm5lbDogQ291bGQgbm90IGZpbmQgQ2hhbm5lbCB3aXRoIElEICcgKyBhcmdzLmNoYW5uZWxJZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgcGVybWlzc2lvbnMgPSBhY3RpdmVDaGFubmVsLnBlcm1pc3Npb25zO1xyXG4gICAgICAgICAgICBjb25zdCBkYXRhOiB7IHVzZXJTdGF0dXM6IFVzZXJTdGF0dXMgfSA9IHtcclxuICAgICAgICAgICAgICAgIHVzZXJTdGF0dXM6IHtcclxuICAgICAgICAgICAgICAgICAgICAuLi5wcmV2aW91cy51c2VyU3RhdHVzLFxyXG4gICAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb25zLFxyXG4gICAgICAgICAgICAgICAgICAgIGFjdGl2ZUNoYW5uZWxJZDogYWN0aXZlQ2hhbm5lbC5pZCxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGNhY2hlLndyaXRlUXVlcnkoeyBxdWVyeTogR0VUX1VTRVJfU1RBVFVTLCBkYXRhIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0YS51c2VyU3RhdHVzO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdXBkYXRlVXNlckNoYW5uZWxzOiAoXywgYXJnczogQ29kZWdlbi5VcGRhdGVVc2VyQ2hhbm5lbHNNdXRhdGlvblZhcmlhYmxlcywgeyBjYWNoZSB9KTogVXNlclN0YXR1cyA9PiB7XHJcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbm9uLW51bGwtYXNzZXJ0aW9uXHJcbiAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzID0gY2FjaGUucmVhZFF1ZXJ5PEdldFVzZXJTdGF0dXNRdWVyeT4oeyBxdWVyeTogR0VUX1VTRVJfU1RBVFVTIH0pITtcclxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IHtcclxuICAgICAgICAgICAgICAgIHVzZXJTdGF0dXM6IHtcclxuICAgICAgICAgICAgICAgICAgICAuLi5wcmV2aW91cy51c2VyU3RhdHVzLFxyXG4gICAgICAgICAgICAgICAgICAgIGNoYW5uZWxzOiBBcnJheS5pc0FycmF5KGFyZ3MuY2hhbm5lbHMpID8gYXJncy5jaGFubmVscyA6IFthcmdzLmNoYW5uZWxzXSxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGNhY2hlLndyaXRlUXVlcnkoeyBxdWVyeTogR0VUX1VTRVJfU1RBVFVTLCBkYXRhIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0YS51c2VyU3RhdHVzO1xyXG4gICAgICAgIH0sXHJcbiAgICB9LFxyXG59O1xyXG5cclxuZnVuY3Rpb24gdXBkYXRlVWlTdGF0ZTxLIGV4dGVuZHMga2V5b2YgQ29kZWdlbi5HZXRVaVN0YXRlUXVlcnlbJ3VpU3RhdGUnXT4oXHJcbiAgICBwcmV2aW91czogQ29kZWdlbi5HZXRVaVN0YXRlUXVlcnksXHJcbiAgICBrZXk6IEssXHJcbiAgICB2YWx1ZTogQ29kZWdlbi5HZXRVaVN0YXRlUXVlcnlbJ3VpU3RhdGUnXVtLXSxcclxuKTogQ29kZWdlbi5HZXRVaVN0YXRlUXVlcnkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICB1aVN0YXRlOiB7XHJcbiAgICAgICAgICAgIC4uLnByZXZpb3VzLnVpU3RhdGUsXHJcbiAgICAgICAgICAgIFtrZXldOiB2YWx1ZSxcclxuICAgICAgICAgICAgX190eXBlbmFtZTogJ1VpU3RhdGUnLFxyXG4gICAgICAgIH0sXHJcbiAgICB9O1xyXG59XHJcblxyXG5mdW5jdGlvbiB1cGRhdGVSZXF1ZXN0c0luRmxpZ2h0KGNhY2hlOiBJbk1lbW9yeUNhY2hlLCBpbmNyZW1lbnQ6IDEgfCAtMSk6IG51bWJlciB7XHJcbiAgICBjb25zdCBwcmV2aW91cyA9IGNhY2hlLnJlYWRRdWVyeTxDb2RlZ2VuLkdldE5ldHdvcmtTdGF0dXNRdWVyeT4oeyBxdWVyeTogR0VUX05FV1RPUktfU1RBVFVTIH0pO1xyXG4gICAgY29uc3QgaW5GbGlnaHRSZXF1ZXN0cyA9IHByZXZpb3VzID8gcHJldmlvdXMubmV0d29ya1N0YXR1cy5pbkZsaWdodFJlcXVlc3RzICsgaW5jcmVtZW50IDogaW5jcmVtZW50O1xyXG4gICAgY29uc3QgZGF0YTogQ29kZWdlbi5HZXROZXR3b3JrU3RhdHVzUXVlcnkgPSB7XHJcbiAgICAgICAgbmV0d29ya1N0YXR1czoge1xyXG4gICAgICAgICAgICBfX3R5cGVuYW1lOiAnTmV0d29ya1N0YXR1cycsXHJcbiAgICAgICAgICAgIGluRmxpZ2h0UmVxdWVzdHMsXHJcbiAgICAgICAgfSxcclxuICAgIH07XHJcbiAgICBjYWNoZS53cml0ZVF1ZXJ5KHsgcXVlcnk6IEdFVF9ORVdUT1JLX1NUQVRVUywgZGF0YSB9KTtcclxuICAgIHJldHVybiBpbkZsaWdodFJlcXVlc3RzO1xyXG59XHJcbiJdfQ==